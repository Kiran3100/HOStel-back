### Combined Content from Folder: D:\Last Github Push\Last\HOStel-back\app\repositories\visitor ###



# ===== Folder: D:\Last Github Push\Last\HOStel-back\app\repositories\visitor =====

# --- File: D:\Last Github Push\Last\HOStel-back\app\repositories\visitor\hostel_booking_repository.py ---
# app/repositories/visitor/hostel_booking_repository.py
from __future__ import annotations

from typing import List
from uuid import UUID

from sqlalchemy.orm import Session

from app.repositories.base import BaseRepository
from app.models.visitor import HostelBooking


class HostelBookingRepository(BaseRepository[HostelBooking]):
    def __init__(self, session: Session):
        super().__init__(session, HostelBooking)

    def list_for_visitor(self, visitor_id: UUID) -> List[HostelBooking]:
        stmt = (
            self._base_select()
            .where(HostelBooking.visitor_id == visitor_id)
            .order_by(HostelBooking.check_in_date.desc())
        )
        return self.session.execute(stmt).scalars().all()

# --- File: D:\Last Github Push\Last\HOStel-back\app\repositories\visitor\hostel_review_repository.py ---
# app/repositories/visitor/hostel_review_repository.py
from __future__ import annotations

from typing import List
from uuid import UUID

from sqlalchemy.orm import Session

from app.repositories.base import BaseRepository
from app.models.visitor import HostelReview


class HostelReviewRepository(BaseRepository[HostelReview]):
    def __init__(self, session: Session):
        super().__init__(session, HostelReview)

    def list_for_hostel(self, hostel_id: UUID, *, limit: int = 50) -> List[HostelReview]:
        stmt = (
            self._base_select()
            .where(HostelReview.hostel_id == hostel_id)
            .order_by(HostelReview.created_at.desc())
            .limit(limit)
        )
        return self.session.execute(stmt).scalars().all()

# --- File: D:\Last Github Push\Last\HOStel-back\app\repositories\visitor\visitor_hostel_repository.py ---
# app/repositories/visitor/visitor_hostel_repository.py
from __future__ import annotations

from typing import List, Optional

from sqlalchemy import and_, or_
from sqlalchemy.orm import Session

from app.repositories.base import BaseRepository
from app.models.visitor import VisitorHostel


class VisitorHostelRepository(BaseRepository[VisitorHostel]):
    def __init__(self, session: Session):
        super().__init__(session, VisitorHostel)

    def search(
        self,
        *,
        city: Optional[str] = None,
        area: Optional[str] = None,
        min_price: Optional[float] = None,
        max_price: Optional[float] = None,
        gender_type: Optional[str] = None,
        search: Optional[str] = None,
        limit: int = 50,
    ) -> List[VisitorHostel]:
        stmt = self._base_select()

        if city:
            stmt = stmt.where(VisitorHostel.city == city)
        if area:
            stmt = stmt.where(VisitorHostel.area == area)
        if gender_type:
            stmt = stmt.where(VisitorHostel.gender_type == gender_type)
        if min_price is not None:
            stmt = stmt.where(VisitorHostel.min_price >= min_price)
        if max_price is not None:
            stmt = stmt.where(VisitorHostel.max_price <= max_price)
        if search:
            ilike = f"%{search.lower()}%"
            stmt = stmt.where(
                or_(
                    VisitorHostel.hostel_name.ilike(ilike),
                    VisitorHostel.location.ilike(ilike),
                    VisitorHostel.city.ilike(ilike),
                )
            )

        stmt = stmt.order_by(VisitorHostel.rating.desc(), VisitorHostel.min_price.asc().nulls_last())
        stmt = stmt.limit(limit)
        return self.session.execute(stmt).scalars().all()

# --- File: D:\Last Github Push\Last\HOStel-back\app\repositories\visitor\visitor_repository.py ---
# app/repositories/visitor/visitor_repository.py
from __future__ import annotations

from typing import Optional
from uuid import UUID

from sqlalchemy.orm import Session

from app.repositories.base import BaseRepository
from app.models.visitor import Visitor


class VisitorRepository(BaseRepository[Visitor]):
    def __init__(self, session: Session):
        super().__init__(session, Visitor)

    def get_by_user_id(self, user_id: UUID) -> Optional[Visitor]:
        stmt = self._base_select().where(Visitor.user_id == user_id)
        return self.session.execute(stmt).scalar_one_or_none()

# --- File: D:\Last Github Push\Last\HOStel-back\app\repositories\visitor\__init__.py ---
# app/repositories/visitor/__init__.py
from .visitor_repository import VisitorRepository
from .visitor_hostel_repository import VisitorHostelRepository
from .hostel_booking_repository import HostelBookingRepository
from .hostel_review_repository import HostelReviewRepository

__all__ = [
    "VisitorRepository",
    "VisitorHostelRepository",
    "HostelBookingRepository",
    "HostelReviewRepository",
]


# ===== Folder: D:\Last Github Push\Last\HOStel-back\app\repositories\visitor\__pycache__ =====
