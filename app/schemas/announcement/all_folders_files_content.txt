<<<<<<< Updated upstream
<<<<<<< Updated upstream
=======
>>>>>>> Stashed changes
### Combined Content from Folder: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement ###



# ===== Folder: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement =====

# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\announcement_approval.py ---
<<<<<<< Updated upstream
=======
### Combined Content from Folder: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\announcement ###



# ===== Folder: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\announcement =====

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\announcement\announcement_approval.py ---
>>>>>>> Stashed changes
=======
>>>>>>> Stashed changes
"""
Announcement approval schemas
"""
from datetime import datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class ApprovalRequest(BaseCreateSchema):
    """Request approval for announcement (supervisor to admin)"""
    announcement_id: UUID
    
    # Justification
    approval_reason: Optional[str] = Field(None, max_length=500, description="Why approval needed")
    
    # Urgency
    is_urgent_request: bool = Field(False)


class ApprovalResponse(BaseSchema):
    """Approval response"""
    announcement_id: UUID
    
    approved: bool
    approved_by: UUID
    approved_by_name: str
    approved_at: datetime
    
    # Feedback
    approval_notes: Optional[str]
    
    # If approved, auto-publish?
    auto_published: bool
    
    message: str


class RejectionRequest(BaseCreateSchema):
    """Reject announcement"""
    announcement_id: UUID
    
    rejection_reason: str = Field(..., min_length=20, max_length=500)
    
    # Suggestions
    suggested_modifications: Optional[str] = Field(None, max_length=1000)


class ApprovalWorkflow(BaseSchema):
    """Approval workflow status"""
    announcement_id: UUID
    title: str
    
    requires_approval: bool
    approval_status: str = Field(
        ...,
        pattern="^(pending|approved|rejected|not_required)$"
    )
    
    # Submitted by
    created_by: UUID
    created_by_name: str
    created_by_role: str
    
    # Approval timeline
    submitted_for_approval_at: Optional[datetime]
    approved_rejected_at: Optional[datetime]
    
    # Current approver
    pending_with: Optional[UUID]
    pending_with_name: Optional[str]
    
    # Reason (if rejected)
    rejection_reason: Optional[str]


class SupervisorApprovalQueue(BaseSchema):
    """Supervisor's pending approvals"""
    supervisor_id: UUID
    supervisor_name: str
    
    total_pending: int
    urgent_pending: int
    
    pending_announcements: List["PendingApprovalItem"]


class PendingApprovalItem(BaseSchema):
    """Pending approval item"""
    announcement_id: UUID
    title: str
    category: str
    
    created_by: UUID
    created_by_name: str
    
    submitted_at: datetime
    is_urgent: bool
    
    # Preview
    content_preview: str = Field(..., description="First 200 chars")
    
    target_audience: str
    estimated_recipients: int


class BulkApproval(BaseCreateSchema):
    """Approve multiple announcements"""
    announcement_ids: List[UUID] = Field(..., min_items=1)
    
    approved: bool
    approval_notes: Optional[str] = None
    
    # Publish immediately after approval
    publish_immediately: bool = Field(True)

<<<<<<< Updated upstream
<<<<<<< Updated upstream
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\announcement_base.py ---
=======
# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\announcement\announcement_base.py ---
>>>>>>> Stashed changes
=======
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\announcement_base.py ---
>>>>>>> Stashed changes
"""
Announcement base schemas
"""
from datetime import datetime
from typing import List, Optional
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import AnnouncementCategory, Priority, TargetAudience


class AnnouncementBase(BaseSchema):
    """Base announcement schema"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    
    title: str = Field(..., min_length=5, max_length=255, description="Announcement title")
    content: str = Field(..., min_length=10, max_length=5000, description="Announcement content")
    
    category: AnnouncementCategory = Field(..., description="Announcement category")
    priority: Priority = Field(Priority.MEDIUM, description="Priority level")
    
    # Visibility
    is_urgent: bool = Field(False, description="Mark as urgent")
    is_pinned: bool = Field(False, description="Pin to top")
    
    # Target audience
    target_audience: TargetAudience = Field(TargetAudience.ALL, description="Target audience")
    target_room_ids: List[UUID] = Field(default_factory=list, description="Specific rooms")
    target_student_ids: List[UUID] = Field(default_factory=list, description="Specific students")
    target_floor_numbers: List[int] = Field(default_factory=list, description="Specific floors")
    
    # Attachments
    attachments: List[HttpUrl] = Field(default_factory=list, description="Attachment URLs")
    
    # Expiry
    expires_at: Optional[datetime] = Field(None, description="When announcement expires")


class AnnouncementCreate(AnnouncementBase, BaseCreateSchema):
    """Create announcement"""
    created_by: UUID = Field(..., description="Creator (admin/supervisor)")
    
    # Delivery settings
    send_email: bool = Field(False, description="Send email notification")
    send_sms: bool = Field(False, description="Send SMS notification")
    send_push: bool = Field(True, description="Send push notification")


class AnnouncementUpdate(BaseUpdateSchema):
    """Update announcement"""
    title: Optional[str] = Field(None, min_length=5, max_length=255)
    content: Optional[str] = Field(None, min_length=10, max_length=5000)
    category: Optional[AnnouncementCategory] = None
    priority: Optional[Priority] = None
    
    is_urgent: Optional[bool] = None
    is_pinned: Optional[bool] = None
    
    expires_at: Optional[datetime] = None
    
    # Publication
    is_published: Optional[bool] = None

<<<<<<< Updated upstream
<<<<<<< Updated upstream
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\announcement_delivery.py ---
=======
# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\announcement\announcement_delivery.py ---
>>>>>>> Stashed changes
=======
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\announcement_delivery.py ---
>>>>>>> Stashed changes
"""
Announcement delivery schemas
"""
from datetime import datetime
from typing import List, Optional, Dict
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class DeliveryConfig(BaseSchema):
    """Delivery configuration"""
    announcement_id: UUID
    
    # Channels
    channels: "DeliveryChannels"
    
    # Delivery strategy
    delivery_strategy: str = Field(
        "immediate",
        pattern="^(immediate|scheduled|batched)$"
    )
    
    # Batch settings (if batched)
    batch_size: Optional[int] = Field(None, ge=10, le=1000)
    batch_interval_minutes: Optional[int] = Field(None, ge=1, le=60)


class DeliveryChannels(BaseSchema):
    """Delivery channel settings"""
    email: bool = Field(False)
    sms: bool = Field(False)
    push: bool = Field(True)
    in_app: bool = Field(True)
    
    # Channel priority (for fallback)
    primary_channel: str = Field("push", pattern="^(email|sms|push|in_app)$")
    fallback_channels: List[str] = Field(default_factory=list)


class DeliveryStatus(BaseSchema):
    """Delivery status for announcement"""
    announcement_id: UUID
    
    total_recipients: int
    
    # By channel
    email_sent: int
    email_delivered: int
    email_failed: int
    
    sms_sent: int
    sms_delivered: int
    sms_failed: int
    
    push_sent: int
    push_delivered: int
    push_failed: int
    
    # Overall
    total_delivered: int
    total_failed: int
    delivery_rate: Decimal = Field(..., description="% successfully delivered")
    
    # Timeline
    delivery_started_at: Optional[datetime]
    delivery_completed_at: Optional[datetime]


class DeliveryReport(BaseSchema):
    """Detailed delivery report"""
    announcement_id: UUID
    title: str
    
    # Recipients
    total_recipients: int
    
    # By channel
    channel_breakdown: Dict[str, "ChannelDeliveryStats"]
    
    # By status
    delivered_count: int
    failed_count: int
    pending_count: int
    
    # Failed recipients
    failed_recipients: List["FailedDelivery"] = Field(default_factory=list)
    
    # Timeline
    delivery_duration_minutes: Optional[int]
    
    generated_at: datetime


class ChannelDeliveryStats(BaseSchema):
    """Delivery stats for specific channel"""
    channel: str
    
    sent: int
    delivered: int
    failed: int
    pending: int
    
    delivery_rate: Decimal
    average_delivery_time_seconds: Optional[Decimal]


class FailedDelivery(BaseSchema):
    """Failed delivery record"""
    recipient_id: UUID
    recipient_name: str
    recipient_contact: str
    
    channel: str
    failure_reason: str
    failed_at: datetime
    
    retry_attempted: bool
    retry_successful: Optional[bool]


class BatchDelivery(BaseSchema):
    """Batch delivery progress"""
    announcement_id: UUID
    
    total_batches: int
    completed_batches: int
    current_batch: int
    
    total_recipients: int
    processed_recipients: int
    
    estimated_completion: datetime
    
    status: str = Field(..., pattern="^(processing|completed|failed|paused)$")


class RetryDelivery(BaseCreateSchema):
    """Retry failed deliveries"""
    announcement_id: UUID
    
    # Retry options
    retry_failed_only: bool = Field(True)
    retry_channels: List[str] = Field(default_factory=list, description="Specific channels to retry")
    
    # Specific recipients
    recipient_ids: Optional[List[UUID]] = Field(None, description="Retry specific recipients only")

<<<<<<< Updated upstream
<<<<<<< Updated upstream
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\announcement_filters.py ---
=======
# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\announcement\announcement_filters.py ---
>>>>>>> Stashed changes
=======
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\announcement_filters.py ---
>>>>>>> Stashed changes
"""
Announcement filter schemas
"""
from datetime import date, datetime
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseFilterSchema
from app.schemas.common.enums import AnnouncementCategory, Priority


class AnnouncementFilterParams(BaseFilterSchema):
    """Announcement filter parameters"""
    # Text search
    search: Optional[str] = Field(None, description="Search in title, content")
    
    # Hostel filter
    hostel_id: Optional[UUID] = None
    hostel_ids: Optional[List[UUID]] = None
    
    # Category
    category: Optional[AnnouncementCategory] = None
    categories: Optional[List[AnnouncementCategory]] = None
    
    # Priority
    priority: Optional[Priority] = None
    priorities: Optional[List[Priority]] = None
    
    # Status
    is_published: Optional[bool] = None
    is_urgent: Optional[bool] = None
    is_pinned: Optional[bool] = None
    
    # Creator
    created_by: Optional[UUID] = None
    created_by_role: Optional[str] = None
    
    # Date filters
    published_date_from: Optional[date] = None
    published_date_to: Optional[date] = None
    created_date_from: Optional[date] = None
    created_date_to: Optional[date] = None
    
    # Expiry
    active_only: Optional[bool] = Field(None, description="Only non-expired announcements")
    expired_only: Optional[bool] = None
    
    # Approval
    approval_pending: Optional[bool] = None


class SearchRequest(BaseFilterSchema):
    """Announcement search"""
    query: str = Field(..., min_length=1)
    hostel_id: Optional[UUID] = None
    
    search_in_title: bool = Field(True)
    search_in_content: bool = Field(True)
    
    category: Optional[AnnouncementCategory] = None
    
    page: int = Field(1, ge=1)
    page_size: int = Field(20, ge=1, le=100)


class ArchiveRequest(BaseCreateSchema):
    """Archive old announcements"""
    hostel_id: UUID
    
    # Archive criteria
    archive_before_date: date = Field(..., description="Archive announcements before this date")
    
    # Options
    archive_expired_only: bool = Field(True)
    archive_read_only: bool = Field(False, description="Archive only if all recipients read")
    
    # Exclusions
    exclude_pinned: bool = Field(True)
    exclude_important: bool = Field(True)


class AnnouncementExportRequest(BaseFilterSchema):
    """Export announcements"""
    hostel_id: UUID
    filters: Optional[AnnouncementFilterParams] = None
    
    format: str = Field("pdf", pattern="^(pdf|excel|csv)$")
    
    include_engagement_metrics: bool = Field(True)
    include_recipient_list: bool = Field(False)

<<<<<<< Updated upstream
<<<<<<< Updated upstream
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\announcement_response.py ---
=======
# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\announcement\announcement_response.py ---
>>>>>>> Stashed changes
=======
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\announcement_response.py ---
>>>>>>> Stashed changes
"""
Announcement response schemas
"""
from datetime import datetime
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import AnnouncementCategory, Priority


class AnnouncementResponse(BaseResponseSchema):
    """Announcement response"""
    hostel_id: UUID
    hostel_name: str
    
    title: str
    content: str
    
    category: AnnouncementCategory
    priority: Priority
    
    is_urgent: bool
    is_pinned: bool
    
    created_by: UUID
    created_by_name: str
    
    is_published: bool
    published_at: Optional[datetime]
    
    total_recipients: int
    read_count: int


class AnnouncementDetail(BaseResponseSchema):
    """Detailed announcement"""
    hostel_id: UUID
    hostel_name: str
    
    title: str
    content: str
    category: AnnouncementCategory
    priority: Priority
    
    is_urgent: bool
    is_pinned: bool
    
    # Target audience
    target_audience: str
    target_room_ids: List[UUID]
    target_student_ids: List[UUID]
    target_floor_numbers: List[int]
    
    # Attachments
    attachments: List[str]
    
    # Schedule
    scheduled_publish_at: Optional[datetime]
    published_at: Optional[datetime]
    expires_at: Optional[datetime]
    is_published: bool
    
    # Creation and approval
    created_by: UUID
    created_by_name: str
    created_by_role: str
    
    approved_by: Optional[UUID]
    approved_by_name: Optional[str]
    approved_at: Optional[datetime]
    requires_approval: bool
    
    # Delivery
    send_email: bool
    send_sms: bool
    send_push: bool
    
    email_sent_at: Optional[datetime]
    sms_sent_at: Optional[datetime]
    push_sent_at: Optional[datetime]
    
    # Tracking
    total_recipients: int
    read_count: int
    acknowledged_count: int
    
    # Engagement
    engagement_rate: Decimal = Field(..., description="% who read the announcement")


class AnnouncementList(BaseSchema):
    """List of announcements"""
    hostel_id: Optional[UUID] = None
    
    total_announcements: int
    active_announcements: int
    pinned_announcements: int
    
    announcements: List["AnnouncementListItem"]


class AnnouncementListItem(BaseSchema):
    """Announcement list item"""
    id: UUID
    title: str
    category: str
    priority: str
    
    is_urgent: bool
    is_pinned: bool
    
    created_by_name: str
    published_at: Optional[datetime]
    
    read_count: int
    total_recipients: int
    
    is_read: bool = Field(False, description="For student view")

<<<<<<< Updated upstream
<<<<<<< Updated upstream
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\announcement_scheduling.py ---
=======
# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\announcement\announcement_scheduling.py ---
>>>>>>> Stashed changes
=======
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\announcement_scheduling.py ---
>>>>>>> Stashed changes
"""
Announcement scheduling schemas
"""
from datetime import datetime
from typing import Optional
from pydantic import Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class ScheduleRequest(BaseCreateSchema):
    """Schedule announcement for later"""
    announcement_id: UUID
    
    scheduled_publish_at: datetime = Field(..., description="When to publish")
    
    # Auto-expire
    auto_expire: bool = Field(False)
    expire_after_hours: Optional[int] = Field(None, ge=1, le=720, description="Expire after N hours")
    
    @field_validator('scheduled_publish_at')
    @classmethod
    def validate_future_time(cls, v: datetime) -> datetime:
        """Ensure scheduled time is in future"""
        from datetime import datetime as dt
        if v <= dt.now():
            raise ValueError('Scheduled time must be in the future')
        return v


class ScheduleConfig(BaseSchema):
    """Schedule configuration"""
    announcement_id: UUID
    
    is_scheduled: bool
    scheduled_publish_at: Optional[datetime]
    
    # Recurrence
    is_recurring: bool = Field(False)
    recurrence_pattern: Optional[str] = Field(None, description="daily, weekly, monthly")
    
    # End condition
    recurrence_end_date: Optional[datetime] = None
    max_occurrences: Optional[int] = Field(None, ge=1)


class RecurringAnnouncement(BaseCreateSchema):
    """Create recurring announcement"""
    hostel_id: UUID
    
    title: str = Field(..., min_length=5, max_length=255)
    content: str = Field(..., min_length=10, max_length=5000)
    
    # Recurrence
    recurrence_pattern: str = Field(..., pattern="^(daily|weekly|monthly)$")
    start_date: datetime
    
    # End condition
    end_date: Optional[datetime] = None
    max_occurrences: Optional[int] = None
    
    # Days (for weekly)
    weekdays: Optional[List[int]] = Field(None, description="0=Monday, 6=Sunday")
    
    # Time
    publish_time: str = Field(..., description="HH:MM format")
    
    # Targeting
    target_audience: str
    target_room_ids: List[UUID] = Field(default_factory=list)


class ScheduleUpdate(BaseCreateSchema):
    """Update scheduled announcement"""
    announcement_id: UUID
    
    new_scheduled_time: datetime
    
    reason: Optional[str] = Field(None, max_length=500, description="Reason for rescheduling")


class ScheduleCancel(BaseCreateSchema):
    """Cancel scheduled announcement"""
    announcement_id: UUID
    
    cancellation_reason: str = Field(..., min_length=10, max_length=500)
    
    # Whether to delete or just unpublish
    delete_announcement: bool = Field(False)


class PublishNow(BaseCreateSchema):
    """Publish scheduled announcement immediately"""
    announcement_id: UUID
    
    override_schedule: bool = Field(True)


class ScheduledAnnouncementsList(BaseSchema):
    """List of scheduled announcements"""
    hostel_id: UUID
    
    total_scheduled: int
    upcoming_24h: int
    
    announcements: List["ScheduledAnnouncementItem"]


class ScheduledAnnouncementItem(BaseSchema):
    """Scheduled announcement item"""
    announcement_id: UUID
    title: str
    scheduled_for: datetime
    
    is_recurring: bool
    next_occurrence: Optional[datetime]
    
    target_audience: str
    estimated_recipients: int

<<<<<<< Updated upstream
<<<<<<< Updated upstream
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\announcement_targeting.py ---
=======
# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\announcement\announcement_targeting.py ---
>>>>>>> Stashed changes
=======
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\announcement_targeting.py ---
>>>>>>> Stashed changes
"""
Announcement targeting schemas
"""
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class TargetingConfig(BaseSchema):
    """Targeting configuration for announcement"""
    target_type: str = Field(
        ...,
        pattern="^(all|specific_rooms|specific_floors|specific_students|custom)$",
        description="Targeting type"
    )
    
    # Specific targets
    room_ids: List[UUID] = Field(default_factory=list)
    floor_numbers: List[int] = Field(default_factory=list)
    student_ids: List[UUID] = Field(default_factory=list)
    
    # Exclude
    exclude_student_ids: List[UUID] = Field(default_factory=list, description="Students to exclude")


class AudienceSelection(BaseCreateSchema):
    """Audience selection for announcement"""
    announcement_id: UUID
    
    # Selection criteria
    include_all: bool = Field(False)
    include_active_students: bool = Field(True)
    include_inactive_students: bool = Field(False)
    
    # Filters
    room_types: Optional[List[str]] = Field(None, description="Filter by room types")
    floors: Optional[List[int]] = None
    
    # Specific selection
    specific_room_ids: List[UUID] = Field(default_factory=list)
    specific_student_ids: List[UUID] = Field(default_factory=list)
    
    # Exclusions
    exclude_student_ids: List[UUID] = Field(default_factory=list)


class TargetRooms(BaseCreateSchema):
    """Target specific rooms"""
    announcement_id: UUID
    room_ids: List[UUID] = Field(..., min_items=1, description="Room IDs to target")
    
    # Include all students in these rooms
    include_all_students: bool = Field(True)


class TargetFloors(BaseCreateSchema):
    """Target specific floors"""
    announcement_id: UUID
    floor_numbers: List[int] = Field(..., min_items=1, description="Floor numbers")
    
    # Options
    include_all_rooms: bool = Field(True)


class IndividualTargeting(BaseCreateSchema):
    """Target individual students"""
    announcement_id: UUID
    student_ids: List[UUID] = Field(..., min_items=1, max_items=100, description="Student IDs")


class TargetingSummary(BaseSchema):
    """Summary of who will receive announcement"""
    announcement_id: UUID
    
    targeting_type: str
    
    # Counts
    total_recipients: int
    students_count: int
    rooms_count: int
    floors_count: int
    
    # Breakdown
    recipients_by_room: dict = Field(default_factory=dict, description="Room ID -> student count")
    recipients_by_floor: dict = Field(default_factory=dict, description="Floor -> student count")


class BulkTargeting(BaseCreateSchema):
    """Add multiple targeting rules"""
    announcement_id: UUID
    
    targeting_rules: List[TargetingConfig] = Field(..., min_items=1)
    
    # How to combine rules
    combine_mode: str = Field("union", pattern="^(union|intersection)$")

<<<<<<< Updated upstream
<<<<<<< Updated upstream
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\announcement_tracking.py ---
=======
# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\announcement\announcement_tracking.py ---
>>>>>>> Stashed changes
=======
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\announcement_tracking.py ---
>>>>>>> Stashed changes
"""
Announcement tracking schemas
"""
from datetime import datetime
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema


class ReadReceipt(BaseCreateSchema):
    """Mark announcement as read"""
    announcement_id: UUID
    student_id: UUID
    
    read_at: datetime = Field(default_factory=datetime.now)
    
    # Reading context
    reading_time_seconds: Optional[int] = Field(None, ge=0, description="Time spent reading")
    device_type: Optional[str] = Field(None, pattern="^(mobile|web|tablet)$")


class ReadReceiptResponse(BaseResponseSchema):
    """Read receipt response"""
    announcement_id: UUID
    student_id: UUID
    read_at: datetime
    
    # If acknowledgment is required
    requires_acknowledgment: bool
    acknowledged: bool


class AcknowledgmentTracking(BaseSchema):
    """Track acknowledgments for announcement"""
    announcement_id: UUID
    
    requires_acknowledgment: bool
    
    total_recipients: int
    acknowledged_count: int
    pending_acknowledgments: int
    
    acknowledgment_rate: Decimal = Field(..., description="% who acknowledged")
    
    # Students pending acknowledgment
    pending_students: List["PendingAcknowledgment"] = Field(default_factory=list)


class PendingAcknowledgment(BaseSchema):
    """Pending acknowledgment"""
    student_id: UUID
    student_name: str
    room_number: Optional[str]
    
    delivered_at: datetime
    read: bool
    read_at: Optional[datetime]


class AcknowledgmentRequest(BaseCreateSchema):
    """Submit acknowledgment"""
    announcement_id: UUID
    student_id: UUID
    
    acknowledged: bool = Field(True)
    acknowledgment_note: Optional[str] = Field(None, max_length=500)


class EngagementMetrics(BaseSchema):
    """Engagement metrics for announcement"""
    announcement_id: UUID
    title: str
    
    # Delivery
    total_recipients: int
    delivered_count: int
    delivery_rate: Decimal
    
    # Reading
    read_count: int
    read_rate: Decimal = Field(..., description="% who read")
    
    average_reading_time_seconds: Optional[Decimal]
    
    # Acknowledgment
    acknowledged_count: int
    acknowledgment_rate: Decimal
    
    # Timing
    average_time_to_read_hours: Optional[Decimal] = Field(
        None,
        description="Average time between delivery and reading"
    )
    
    # Engagement score
    engagement_score: Decimal = Field(..., ge=0, le=100, description="Overall engagement score")


class ReadingTime(BaseSchema):
    """Reading time analytics"""
    announcement_id: UUID
    
    # Statistics
    average_reading_time_seconds: Decimal
    median_reading_time_seconds: Decimal
    min_reading_time_seconds: int
    max_reading_time_seconds: int
    
    # Distribution
    quick_readers: int = Field(..., description="< 30 seconds")
    normal_readers: int = Field(..., description="30-120 seconds")
    thorough_readers: int = Field(..., description="> 120 seconds")


class AnnouncementAnalytics(BaseSchema):
    """Complete announcement analytics"""
    announcement_id: UUID
    title: str
    published_at: datetime
    
    # Delivery metrics
    delivery_metrics: DeliveryStatus
    
    # Engagement metrics
    engagement_metrics: EngagementMetrics
    
    # Reading patterns
    reading_by_hour: dict = Field(..., description="Hour -> read count")
    reading_by_day: dict = Field(..., description="Day -> read count")
    
    # Device breakdown
    reads_by_device: dict = Field(..., description="Device type -> count")

<<<<<<< Updated upstream
<<<<<<< Updated upstream
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\__init__.py ---
=======
# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\announcement\__init__.py ---
>>>>>>> Stashed changes
=======
# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\announcement\__init__.py ---
>>>>>>> Stashed changes
"""
Announcement schemas package
"""
from app.schemas.announcement.announcement_base import (
    AnnouncementBase,
    AnnouncementCreate,
    AnnouncementUpdate
)
from app.schemas.announcement.announcement_response import (
    AnnouncementResponse,
    AnnouncementDetail,
    AnnouncementList
)
from app.schemas.announcement.announcement_targeting import (
    TargetingConfig,
    AudienceSelection,
    TargetRooms,
    TargetFloors
)
from app.schemas.announcement.announcement_scheduling import (
    ScheduleRequest,
    ScheduleConfig,
    RecurringAnnouncement
)
from app.schemas.announcement.announcement_approval import (
    ApprovalRequest,
    ApprovalWorkflow,
    SupervisorApprovalQueue
)
from app.schemas.announcement.announcement_delivery import (
    DeliveryConfig,
    DeliveryChannels,
    DeliveryStatus,
    DeliveryReport
)
from app.schemas.announcement.announcement_tracking import (
    ReadReceipt,
    AcknowledgmentTracking,
    EngagementMetrics
)
from app.schemas.announcement.announcement_filters import (
    AnnouncementFilterParams,
    SearchRequest,
    ArchiveRequest
)

__all__ = [
    # Base
    "AnnouncementBase",
    "AnnouncementCreate",
    "AnnouncementUpdate",
    
    # Response
    "AnnouncementResponse",
    "AnnouncementDetail",
    "AnnouncementList",
    
    # Targeting
    "TargetingConfig",
    "AudienceSelection",
    "TargetRooms",
    "TargetFloors",
    
    # Scheduling
    "ScheduleRequest",
    "ScheduleConfig",
    "RecurringAnnouncement",
    
    # Approval
    "ApprovalRequest",
    "ApprovalWorkflow",
    "SupervisorApprovalQueue",
    
    # Delivery
    "DeliveryConfig",
    "DeliveryChannels",
    "DeliveryStatus",
    "DeliveryReport",
    
    # Tracking
    "ReadReceipt",
    "AcknowledgmentTracking",
    "EngagementMetrics",
    
    # Filters
    "AnnouncementFilterParams",
    "SearchRequest",
    "ArchiveRequest",
]
