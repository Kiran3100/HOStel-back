### Combined Content from Folder: D:\hostel-management-saas\app\schemas ###



# ===== Folder: D:\hostel-management-saas\app\schemas =====

# --- File: D:\hostel-management-saas\app\schemas\__init__.py ---



# ===== Folder: D:\hostel-management-saas\app\schemas\admin =====

# --- File: D:\hostel-management-saas\app\schemas\admin\admin_hostel_assignment.py ---
"""
Admin-hostel assignment schemas
"""
from datetime import date, datetime
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseUpdateSchema, BaseResponseSchema
from app.schemas.common.enums import PermissionLevel


class AdminHostelAssignment(BaseResponseSchema):
    """Admin-hostel assignment"""
    admin_id: UUID
    admin_name: str
    admin_email: str
    
    hostel_id: UUID
    hostel_name: str
    hostel_city: str
    
    assigned_by: Optional[UUID]
    assigned_by_name: Optional[str]
    assigned_date: date
    
    permission_level: PermissionLevel
    permissions: dict = Field(default_factory=dict, description="Specific permissions for this hostel")
    
    is_active: bool
    is_primary: bool = Field(False, description="Primary hostel for this admin")
    
    revoked_date: Optional[date] = None
    revoked_by: Optional[UUID] = None
    revoke_reason: Optional[str] = None


class AssignmentCreate(BaseCreateSchema):
    """Create admin-hostel assignment"""
    admin_id: UUID = Field(..., description="Admin user ID")
    hostel_id: UUID = Field(..., description="Hostel ID to assign")
    
    permission_level: PermissionLevel = Field(
        PermissionLevel.FULL_ACCESS,
        description="Permission level for this hostel"
    )
    
    # Specific permissions (for limited_access level)
    permissions: Optional[dict] = Field(
        None,
        description="Specific permissions (required if permission_level is limited_access)"
    )
    
    is_primary: bool = Field(False, description="Set as primary hostel")


class AssignmentUpdate(BaseUpdateSchema):
    """Update admin-hostel assignment"""
    permission_level: Optional[PermissionLevel] = None
    permissions: Optional[dict] = None
    is_primary: Optional[bool] = None
    is_active: Optional[bool] = None


class BulkAssignment(BaseCreateSchema):
    """Bulk assign admin to multiple hostels"""
    admin_id: UUID = Field(..., description="Admin user ID")
    hostel_ids: List[UUID] = Field(..., min_items=1, description="List of hostel IDs")
    
    permission_level: PermissionLevel = Field(PermissionLevel.FULL_ACCESS)
    permissions: Optional[dict] = None
    
    primary_hostel_id: Optional[UUID] = Field(None, description="Which hostel should be primary")


class RevokeAssignment(BaseCreateSchema):
    """Revoke admin-hostel assignment"""
    assignment_id: UUID = Field(..., description="Assignment ID")
    revoke_reason: str = Field(..., min_length=10, max_length=500, description="Reason for revocation")


class AssignmentList(BaseSchema):
    """List of assignments for an admin"""
    admin_id: UUID
    admin_name: str
    total_hostels: int
    active_hostels: int
    primary_hostel_id: Optional[UUID]
    
    assignments: List[AdminHostelAssignment]


class HostelAdminList(BaseSchema):
    """List of admins for a hostel"""
    hostel_id: UUID
    hostel_name: str
    total_admins: int
    
    admins: List["HostelAdminItem"]


class HostelAdminItem(BaseSchema):
    """Admin item in hostel admin list"""
    admin_id: UUID
    admin_name: str
    admin_email: str
    permission_level: PermissionLevel
    is_primary: bool
    assigned_date: date
    last_active: Optional[datetime]

# --- File: D:\hostel-management-saas\app\schemas\admin\admin_override.py ---
"""
Admin override schemas (for supervisor decisions)
"""
from datetime import datetime
from typing import Optional, Dict, Any
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema


class AdminOverrideRequest(BaseCreateSchema):
    """Request to override supervisor decision"""
    supervisor_id: Optional[UUID] = Field(None, description="Supervisor whose action is being overridden")
    hostel_id: UUID = Field(..., description="Hostel where override occurs")
    
    override_type: str = Field(
        ...,
        description="Type of override (complaint_reassignment, maintenance_approval, etc.)"
    )
    
    entity_type: str = Field(..., description="Type of entity (complaint, maintenance_request, etc.)")
    entity_id: UUID = Field(..., description="ID of entity being modified")
    
    reason: str = Field(..., min_length=20, max_length=1000, description="Detailed reason for override")
    
    # Original and new values
    original_action: Optional[Dict[str, Any]] = Field(None, description="Original supervisor action")
    override_action: Dict[str, Any] = Field(..., description="Admin's override action")
    
    # Notification
    notify_supervisor: bool = Field(True, description="Notify supervisor of override")


class OverrideLog(BaseResponseSchema):
    """Override log entry"""
    admin_id: UUID
    admin_name: str
    supervisor_id: Optional[UUID]
    supervisor_name: Optional[str]
    
    hostel_id: UUID
    hostel_name: str
    
    override_type: str
    entity_type: str
    entity_id: UUID
    
    reason: str
    
    original_action: Optional[Dict[str, Any]]
    override_action: Dict[str, Any]
    
    created_at: datetime


class OverrideReason(BaseSchema):
    """Predefined override reasons"""
    reason_code: str
    reason_text: str
    category: str
    requires_detailed_explanation: bool


class OverrideSummary(BaseSchema):
    """Summary of admin overrides"""
    admin_id: UUID
    period_start: date
    period_end: date
    
    total_overrides: int
    
    # By type
    overrides_by_type: Dict[str, int]
    
    # By supervisor
    overrides_by_supervisor: Dict[UUID, int]
    
    # By hostel
    overrides_by_hostel: Dict[UUID, int]
    
    # Trend
    override_trend: str = Field(
        ...,
        pattern="^(increasing|decreasing|stable)$",
        description="Override trend"
    )


class SupervisorOverrideStats(BaseSchema):
    """Override statistics for a supervisor"""
    supervisor_id: UUID
    supervisor_name: str
    
    total_actions: int
    total_overrides: int
    override_rate: Decimal = Field(..., description="% of actions overridden")
    
    # By type
    overrides_by_type: Dict[str, int]
    
    # Common reasons
    common_override_reasons: List[str]
    
    # Trend
    recent_trend: str = Field(..., pattern="^(improving|declining|stable)$")

# --- File: D:\hostel-management-saas\app\schemas\admin\admin_permissions.py ---
"""
Admin permission schemas
"""
from typing import Dict, List, Optional
from pydantic import Field

from app.schemas.common.base import BaseSchema
from app.schemas.common.enums import UserRole


class AdminPermissions(BaseSchema):
    """Admin-specific permissions for a hostel"""
    # Room management
    can_manage_rooms: bool = Field(True, description="Can create/edit/delete rooms")
    can_manage_beds: bool = Field(True, description="Can manage bed assignments")
    
    # Student management
    can_manage_students: bool = Field(True, description="Can add/edit/remove students")
    can_check_in_students: bool = Field(True, description="Can check-in students")
    can_check_out_students: bool = Field(True, description="Can check-out students")
    
    # Booking management
    can_approve_bookings: bool = Field(True, description="Can approve/reject bookings")
    can_manage_waitlist: bool = Field(True, description="Can manage waitlist")
    
    # Fee management
    can_manage_fees: bool = Field(True, description="Can configure fee structures")
    can_process_payments: bool = Field(True, description="Can process manual payments")
    can_issue_refunds: bool = Field(True, description="Can issue refunds")
    
    # Supervisor management
    can_manage_supervisors: bool = Field(True, description="Can assign/remove supervisors")
    can_configure_supervisor_permissions: bool = Field(True, description="Can modify supervisor permissions")
    can_override_supervisor_actions: bool = Field(True, description="Can override supervisor decisions")
    
    # Financial access
    can_view_financials: bool = Field(True, description="Can view financial reports")
    can_export_financial_data: bool = Field(True, description="Can export financial data")
    
    # Hostel configuration
    can_manage_hostel_settings: bool = Field(True, description="Can modify hostel settings")
    can_manage_hostel_profile: bool = Field(True, description="Can edit public hostel profile")
    can_toggle_public_visibility: bool = Field(True, description="Can make hostel public/private")
    
    # Data management
    can_delete_records: bool = Field(False, description="Can permanently delete records")
    can_export_data: bool = Field(True, description="Can export data")
    can_import_data: bool = Field(True, description="Can bulk import data")


class PermissionMatrix(BaseSchema):
    """Permission matrix showing what each role can do"""
    permissions: Dict[UserRole, List[str]] = Field(
        ...,
        description="Map of role to list of permission keys"
    )


class RolePermissions(BaseSchema):
    """Permissions for a specific role"""
    role: UserRole
    permissions: List[str] = Field(..., description="List of permission keys")
    description: str = Field(..., description="Role description")


class PermissionCheck(BaseSchema):
    """Check if user has specific permission"""
    user_id: UUID
    hostel_id: UUID
    permission_key: str
    
    has_permission: bool
    reason: Optional[str] = Field(None, description="Reason if permission denied")

# --- File: D:\hostel-management-saas\app\schemas\admin\hostel_context.py ---
"""
Hostel context management schemas (for multi-hostel admins)
"""
from datetime import datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class HostelContext(BaseSchema):
    """Current hostel context for admin"""
    admin_id: UUID
    active_hostel_id: UUID
    hostel_name: str
    hostel_city: str
    
    permission_level: str
    
    # Session info
    context_started_at: datetime
    last_accessed_at: datetime
    
    # Quick stats for active hostel
    total_students: int
    occupancy_percentage: Decimal
    pending_tasks: int


class HostelSwitchRequest(BaseCreateSchema):
    """Request to switch active hostel context"""
    hostel_id: UUID = Field(..., description="Hostel ID to switch to")


class ActiveHostelResponse(BaseSchema):
    """Response after switching hostel"""
    admin_id: UUID
    previous_hostel_id: Optional[UUID]
    active_hostel_id: UUID
    hostel_name: str
    
    permission_level: str
    permissions: dict
    
    switched_at: datetime
    message: str = Field(..., description="Success message")


class ContextHistory(BaseSchema):
    """Hostel context switch history"""
    admin_id: UUID
    switches: List["ContextSwitch"]


class ContextSwitch(BaseSchema):
    """Individual context switch record"""
    from_hostel_id: Optional[UUID]
    from_hostel_name: Optional[str]
    to_hostel_id: UUID
    to_hostel_name: str
    switched_at: datetime
    session_duration_minutes: Optional[int] = Field(
        None,
        description="Duration in previous hostel (if applicable)"
    )

# --- File: D:\hostel-management-saas\app\schemas\admin\hostel_selector.py ---
"""
Hostel selector UI schemas
"""
from datetime import datetime
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema


class HostelSelectorResponse(BaseSchema):
    """Hostel selector dropdown data"""
    admin_id: UUID
    total_hostels: int
    active_hostel_id: Optional[UUID]
    
    hostels: List["HostelSelectorItem"]
    recent_hostels: List[UUID] = Field(default_factory=list, description="Recently accessed hostel IDs")
    favorite_hostels: List[UUID] = Field(default_factory=list, description="Favorite hostel IDs")


class HostelSelectorItem(BaseSchema):
    """Individual hostel item in selector"""
    hostel_id: UUID
    hostel_name: str
    hostel_city: str
    hostel_type: str
    
    # Visual indicators
    is_active: bool = Field(False, description="Currently active hostel")
    is_primary: bool = Field(False, description="Primary hostel for admin")
    is_favorite: bool = Field(False, description="Marked as favorite")
    
    # Quick stats
    occupancy_percentage: Decimal
    pending_bookings: int
    pending_complaints: int
    
    # Permission
    permission_level: str
    
    # Activity
    last_accessed: Optional[datetime]


class RecentHostels(BaseSchema):
    """Recently accessed hostels"""
    admin_id: UUID
    hostels: List["RecentHostelItem"]


class RecentHostelItem(BaseSchema):
    """Recent hostel item"""
    hostel_id: UUID
    hostel_name: str
    hostel_city: str
    last_accessed: datetime
    access_count: int = Field(..., description="Number of times accessed")


class FavoriteHostels(BaseSchema):
    """Favorite hostels"""
    admin_id: UUID
    hostels: List["FavoriteHostelItem"]


class FavoriteHostelItem(BaseSchema):
    """Favorite hostel item"""
    hostel_id: UUID
    hostel_name: str
    hostel_city: str
    added_to_favorites: datetime
    notes: Optional[str] = None


class UpdateFavoriteRequest(BaseSchema):
    """Add/remove hostel from favorites"""
    hostel_id: UUID
    is_favorite: bool
    notes: Optional[str] = Field(None, max_length=500)

# --- File: D:\hostel-management-saas\app\schemas\admin\multi_hostel_dashboard.py ---
"""
Multi-hostel dashboard schemas
"""
from datetime import date
from decimal import Decimal
from typing import List, Dict
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema


class MultiHostelDashboard(BaseSchema):
    """Unified dashboard for multi-hostel admin"""
    admin_id: UUID
    admin_name: str
    total_hostels_managed: int
    
    # Aggregated statistics
    aggregated_stats: "AggregatedStats"
    
    # Individual hostel quick stats
    hostel_stats: List["HostelQuickStats"]
    
    # Cross-hostel comparisons
    comparisons: "CrossHostelComparison"
    
    # Consolidated notifications
    total_notifications: int
    notifications_by_hostel: Dict[UUID, int]
    
    # Consolidated pending tasks
    total_pending_tasks: int
    tasks_by_hostel: Dict[UUID, "HostelTaskSummary"]


class AggregatedStats(BaseSchema):
    """Aggregated statistics across all hostels"""
    # Occupancy
    total_beds: int
    total_occupied: int
    total_available: int
    average_occupancy_percentage: Decimal
    
    # Students
    total_students: int
    active_students: int
    
    # Revenue
    total_revenue_this_month: Decimal
    total_outstanding: Decimal
    total_overdue: Decimal
    
    # Bookings
    total_pending_bookings: int
    total_confirmed_bookings: int
    booking_conversion_rate: Decimal
    
    # Complaints
    total_open_complaints: int
    total_resolved_this_month: int
    average_resolution_time_hours: Decimal
    
    # Maintenance
    total_pending_maintenance: int
    total_completed_this_month: int
    
    # Performance
    average_rating_across_hostels: Decimal
    total_reviews: int


class HostelQuickStats(BaseSchema):
    """Quick statistics for individual hostel"""
    hostel_id: UUID
    hostel_name: str
    hostel_city: str
    
    # Occupancy
    occupancy_percentage: Decimal
    available_beds: int
    
    # Revenue
    revenue_this_month: Decimal
    outstanding_amount: Decimal
    
    # Alerts
    pending_bookings: int
    open_complaints: int
    pending_maintenance: int
    overdue_payments_count: int
    
    # Status indicators
    status_color: str = Field(
        ...,
        pattern="^(green|yellow|red)$",
        description="Overall health status"
    )
    
    # Last activity
    last_supervisor_activity: Optional[datetime]


class CrossHostelComparison(BaseSchema):
    """Comparison metrics across hostels"""
    # Best performers
    highest_occupancy_hostel: "TopPerformer"
    highest_revenue_hostel: "TopPerformer"
    highest_rated_hostel: "TopPerformer"
    
    # Areas needing attention
    lowest_occupancy_hostel: "BottomPerformer"
    most_complaints_hostel: "BottomPerformer"
    most_overdue_payments_hostel: "BottomPerformer"
    
    # Comparative metrics
    occupancy_comparison: List["HostelMetricComparison"]
    revenue_comparison: List["HostelMetricComparison"]
    complaint_rate_comparison: List["HostelMetricComparison"]


class TopPerformer(BaseSchema):
    """Top performing hostel"""
    hostel_id: UUID
    hostel_name: str
    metric_value: Decimal
    metric_name: str


class BottomPerformer(BaseSchema):
    """Bottom performing hostel (needs attention)"""
    hostel_id: UUID
    hostel_name: str
    metric_value: Decimal
    metric_name: str
    issue_severity: str = Field(..., pattern="^(low|medium|high|critical)$")


class HostelMetricComparison(BaseSchema):
    """Individual hostel metric for comparison"""
    hostel_id: UUID
    hostel_name: str
    metric_value: Decimal
    percentage_of_best: Decimal
    trend: str = Field(..., pattern="^(up|down|stable)$")


class HostelTaskSummary(BaseSchema):
    """Task summary for a hostel"""
    hostel_id: UUID
    urgent_tasks: int
    high_priority_tasks: int
    medium_priority_tasks: int
    low_priority_tasks: int
    total_tasks: int

# --- File: D:\hostel-management-saas\app\schemas\admin\__init__.py ---
"""
Admin schemas package
"""
from app.schemas.admin.admin_hostel_assignment import (
    AdminHostelAssignment,
    AssignmentCreate,
    AssignmentUpdate,
    BulkAssignment
)
from app.schemas.admin.hostel_context import (
    HostelContext,
    HostelSwitchRequest,
    ActiveHostelResponse
)
from app.schemas.admin.hostel_selector import (
    HostelSelectorResponse,
    HostelSelectorItem,
    RecentHostels,
    FavoriteHostels
)
from app.schemas.admin.multi_hostel_dashboard import (
    MultiHostelDashboard,
    AggregatedStats,
    HostelQuickStats,
    CrossHostelComparison
)
from app.schemas.admin.admin_override import (
    AdminOverrideRequest,
    OverrideLog,
    OverrideReason
)
from app.schemas.admin.admin_permissions import (
    AdminPermissions,
    PermissionMatrix,
    RolePermissions
)

__all__ = [
    # Hostel Assignment
    "AdminHostelAssignment",
    "AssignmentCreate",
    "AssignmentUpdate",
    "BulkAssignment",
    
    # Hostel Context
    "HostelContext",
    "HostelSwitchRequest",
    "ActiveHostelResponse",
    
    # Hostel Selector
    "HostelSelectorResponse",
    "HostelSelectorItem",
    "RecentHostels",
    "FavoriteHostels",
    
    # Multi-Hostel Dashboard
    "MultiHostelDashboard",
    "AggregatedStats",
    "HostelQuickStats",
    "CrossHostelComparison",
    
    # Admin Override
    "AdminOverrideRequest",
    "OverrideLog",
    "OverrideReason",
    
    # Permissions
    "AdminPermissions",
    "PermissionMatrix",
    "RolePermissions",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\analytics =====

# --- File: D:\hostel-management-saas\app\schemas\analytics\booking_analytics.py ---
"""
Booking analytics schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import List, Dict, Optional

from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.enums import BookingStatus, BookingSource
from app.schemas.common.filters import DateRangeFilter


class BookingKPI(BaseSchema):
    """Key metrics for bookings"""
    hostel_id: Optional[UUID] = None
    hostel_name: Optional[str] = None

    total_bookings: int
    confirmed_bookings: int
    cancelled_bookings: int
    rejected_bookings: int

    booking_conversion_rate: Decimal
    cancellation_rate: Decimal
    average_lead_time_days: Decimal  # between booking and check-in


class BookingTrendPoint(BaseSchema):
    """Booking trend point"""
    date: date
    total_bookings: int
    confirmed: int
    cancelled: int
    rejected: int
    revenue_for_day: Decimal


class BookingFunnel(BaseSchema):
    """Booking funnel analytics"""
    period: DateRangeFilter
    generated_at: datetime = Field(default_factory=datetime.utcnow)

    # Steps in funnel
    hostel_page_views: int
    booking_form_starts: int
    booking_submissions: int
    bookings_confirmed: int

    # Conversion
    view_to_start_rate: Decimal
    start_to_submit_rate: Decimal
    submit_to_confirm_rate: Decimal
    view_to_confirm_rate: Decimal


class CancellationAnalytics(BaseSchema):
    """Analytics around cancellations"""
    period: DateRangeFilter
    total_cancellations: int
    cancellation_rate: Decimal

    cancellations_by_reason: Dict[str, int] = Field(default_factory=dict)
    cancellations_by_status: Dict[BookingStatus, int] = Field(default_factory=dict)

    # Timing
    average_time_before_check_in_cancelled_days: Decimal


class BookingAnalyticsSummary(BaseSchema):
    """Top-level booking analytics"""
    hostel_id: Optional[UUID] = None
    hostel_name: Optional[str] = None

    period: DateRangeFilter
    generated_at: datetime = Field(default_factory=datetime.utcnow)

    kpi: BookingKPI
    trend: List[BookingTrendPoint] = Field(default_factory=list)

    funnel: BookingFunnel
    cancellations: CancellationAnalytics

    # By source
    bookings_by_source: Dict[BookingSource, int] = Field(default_factory=dict)
    conversion_rate_by_source: Dict[BookingSource, Decimal] = Field(default_factory=dict)

# --- File: D:\hostel-management-saas\app\schemas\analytics\complaint_analytics.py ---
"""
High-level complaint analytics schemas (dashboard aggregation)
"""
from datetime import date, datetime
from decimal import Decimal
from typing import List, Dict, Optional

from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.filters import DateRangeFilter


class ComplaintKPI(BaseSchema):
    """Complaint key performance indicators"""
    hostel_id: Optional[UUID] = None
    hostel_name: Optional[str] = None

    total_complaints: int
    open_complaints: int
    resolved_complaints: int
    closed_complaints: int

    average_resolution_time_hours: Decimal
    sla_compliance_rate: Decimal
    escalation_rate: Decimal
    reopen_rate: Decimal


class ComplaintTrend(BaseSchema):
    """Trend over time for complaints"""
    period: DateRangeFilter
    points: List["ComplaintTrendPoint"] = Field(default_factory=list)


class ComplaintTrendPoint(BaseSchema):
    """Complaint trend point"""
    date: date
    total_complaints: int
    open_complaints: int
    resolved_complaints: int
    escalated: int
    sla_breached: int


class CategoryBreakdown(BaseSchema):
    """Complaints by category"""
    category: str
    count: int
    percentage_of_total: Decimal
    average_resolution_time_hours: Decimal


class ComplaintDashboard(BaseSchema):
    """Complaint dashboard analytics"""
    hostel_id: Optional[UUID] = None
    hostel_name: Optional[str] = None

    period: DateRangeFilter
    generated_at: datetime = Field(default_factory=datetime.utcnow)

    kpi: ComplaintKPI
    trend: ComplaintTrend
    by_category: List[CategoryBreakdown] = Field(default_factory=list)
    by_priority: Dict[str, int] = Field(default_factory=dict)

# --- File: D:\hostel-management-saas\app\schemas\analytics\custom_reports.py ---
"""
Custom report builder schemas
"""
from datetime import datetime
from typing import Dict, List, Optional, Any
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.filters import DateRangeFilter


class CustomReportFilter(BaseSchema):
    """Filter definition for custom report"""
    field_name: str
    operator: str = Field(
        ..., description="eq, ne, gt, lt, gte, lte, in, contains, between, etc."
    )
    value: Any
    value_to: Optional[Any] = Field(None, description="Second value for between, range")


class CustomReportField(BaseSchema):
    """Field included in custom report"""
    field_name: str
    display_label: Optional[str] = None
    aggregation: Optional[str] = Field(
        None, description="sum, avg, min, max, count, none"
    )


class CustomReportRequest(BaseCreateSchema):
    """Generate a custom report"""
    report_name: str = Field(..., min_length=3, max_length=255)
    module: str = Field(
        ...,
        description="Which module: bookings, payments, complaints, attendance, etc.",
    )

    period: Optional[DateRangeFilter] = None

    # Fields
    fields: List[CustomReportField] = Field(..., min_items=1)

    # Filters
    filters: List[CustomReportFilter] = Field(default_factory=list)

    # Grouping
    group_by: Optional[List[str]] = Field(
        None, description="List of field names to group by"
    )

    # Sorting
    sort_by: Optional[str] = None
    sort_order: Optional[str] = Field("asc", pattern="^(asc|desc)$")

    # Output
    format: str = Field("table", pattern="^(table|csv|excel|json)$")
    include_summary: bool = Field(True)
    include_charts: bool = Field(False)


class CustomReportDefinition(BaseSchema):
    """Saved custom report definition"""
    id: UUID
    owner_id: UUID
    report_name: str
    module: str

    period: Optional[DateRangeFilter] = None
    fields: List[CustomReportField]
    filters: List[CustomReportFilter]
    group_by: Optional[List[str]] = None

    # Sharing
    is_public: bool = Field(False)
    shared_with_user_ids: List[UUID] = Field(default_factory=list)

    created_at: datetime
    updated_at: datetime


class CustomReportResult(BaseSchema):
    """Result of running custom report"""
    report_id: Optional[UUID] = None
    report_name: str

    generated_at: datetime = Field(default_factory=datetime.utcnow)

    # Data
    rows: List[Dict[str, Any]] = Field(default_factory=list)
    total_rows: int

    # Summary (aggregations)
    summary: Optional[Dict[str, Any]] = None

    # Charts data (if requested)
    charts: Optional[Dict[str, Any]] = None

# --- File: D:\hostel-management-saas\app\schemas\analytics\dashboard_analytics.py ---
"""
Dashboard-level analytics schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import List, Optional, Dict

from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.filters import DateRangeFilter


class KPIResponse(BaseSchema):
    """Single KPI item for dashboard"""
    name: str = Field(..., description="KPI name, e.g., 'Total Revenue'")
    value: Decimal | int | float = Field(..., description="KPI numeric value")
    unit: Optional[str] = Field(None, description="Unit, e.g., 'INR', '%', 'students'")
    trend_direction: Optional[str] = Field(
        None,
        pattern="^(up|down|stable)$",
        description="Trend indicator vs previous period",
    )
    trend_percentage: Optional[Decimal] = Field(
        None, description="Change vs previous period in %"
    )
    target_value: Optional[Decimal] = Field(None, description="Target/goal value")
    good_when: Optional[str] = Field(
        None,
        description="Interpretation rule, e.g. 'higher_is_better', 'lower_is_better'",
    )


class QuickStats(BaseSchema):
    """Quick statistics for main dashboard cards"""
    total_hostels: int
    active_hostels: int
    total_students: int
    active_students: int
    total_visitors: int

    todays_check_ins: int
    todays_check_outs: int

    open_complaints: int
    pending_maintenance: int

    todays_revenue: Decimal
    monthly_revenue: Decimal
    outstanding_payments: Decimal


class DashboardMetrics(BaseSchema):
    """Aggregated dashboard metrics for a given scope (hostel or platform)"""
    scope_type: str = Field(..., pattern="^(hostel|platform|admin)$")
    scope_id: Optional[UUID] = Field(
        None, description="Hostel ID or admin ID if scope_type is not 'platform'"
    )

    period: DateRangeFilter = Field(..., description="Analysis period")
    generated_at: datetime = Field(default_factory=datetime.utcnow)

    # KPIs
    kpis: List[KPIResponse] = Field(default_factory=list)

    # Quick stats
    quick_stats: QuickStats

    # Time series for charts
    revenue_timeseries: List["TimeseriesPoint"] = Field(default_factory=list)
    occupancy_timeseries: List["TimeseriesPoint"] = Field(default_factory=list)
    booking_timeseries: List["TimeseriesPoint"] = Field(default_factory=list)
    complaint_timeseries: List["TimeseriesPoint"] = Field(default_factory=list)


class TimeseriesPoint(BaseSchema):
    """Generic timeseries data point"""
    date: date
    value: Decimal | int | float


class RoleSpecificDashboard(BaseSchema):
    """Dashboard sections per role"""
    role: str = Field(..., pattern="^(super_admin|hostel_admin|supervisor)$")
    cards: Dict[str, QuickStats] = Field(
        default_factory=dict, description="Section name -> QuickStats"
    )
    kpis: Dict[str, List[KPIResponse]] = Field(
        default_factory=dict, description="Section name -> list of KPIs"
    )

# --- File: D:\hostel-management-saas\app\schemas\analytics\financial_analytics.py ---
"""
Financial analytics schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import List, Dict, Optional

from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.filters import DateRangeFilter


class RevenueBreakdown(BaseSchema):
    """Revenue breakdown by type/category"""
    total_revenue: Decimal
    booking_revenue: Decimal
    rent_revenue: Decimal
    mess_revenue: Decimal
    other_revenue: Decimal

    revenue_by_hostel: Dict[UUID, Decimal] = Field(
        default_factory=dict, description="Hostel ID -> revenue"
    )
    revenue_by_payment_type: Dict[str, Decimal] = Field(
        default_factory=dict, description="PaymentType -> revenue"
    )


class ExpenseBreakdown(BaseSchema):
    """Expense breakdown by category"""
    total_expenses: Decimal
    maintenance_expenses: Decimal
    staff_expenses: Decimal
    utility_expenses: Decimal
    other_expenses: Decimal

    expenses_by_hostel: Dict[UUID, Decimal] = Field(
        default_factory=dict, description="Hostel ID -> expenses"
    )
    expenses_by_category: Dict[str, Decimal] = Field(
        default_factory=dict, description="Category -> expenses"
    )


class ProfitAndLossReport(BaseSchema):
    """P&L report for a hostel or platform"""
    scope_type: str = Field(..., pattern="^(hostel|platform)$")
    scope_id: Optional[UUID] = None

    period: DateRangeFilter
    generated_at: datetime = Field(default_factory=datetime.utcnow)

    # Revenue & expense
    revenue: RevenueBreakdown
    expenses: ExpenseBreakdown

    # Calculated
    gross_profit: Decimal
    net_profit: Decimal
    profit_margin_percentage: Decimal


class CashflowSummary(BaseSchema):
    """Cashflow summary"""
    scope_type: str = Field(..., pattern="^(hostel|platform)$")
    scope_id: Optional[UUID] = None

    period: DateRangeFilter
    generated_at: datetime = Field(default_factory=datetime.utcnow)

    opening_balance: Decimal
    closing_balance: Decimal

    inflows: Decimal
    outflows: Decimal

    inflow_breakdown: Dict[str, Decimal] = Field(default_factory=dict)
    outflow_breakdown: Dict[str, Decimal] = Field(default_factory=dict)

    cashflow_timeseries: List["CashflowPoint"] = Field(default_factory=list)


class CashflowPoint(BaseSchema):
    """Cashflow timeseries point"""
    date: date
    inflow: Decimal
    outflow: Decimal
    net_flow: Decimal


class FinancialReport(BaseSchema):
    """Top-level financial analytics response"""
    scope_type: str
    scope_id: Optional[UUID] = None

    period: DateRangeFilter
    generated_at: datetime = Field(default_factory=datetime.utcnow)

    pnl_report: ProfitAndLossReport
    cashflow: CashflowSummary

    # Ratios
    collection_rate: Decimal = Field(..., description="% of billed amount collected")
    overdue_ratio: Decimal = Field(..., description="% of amount that is overdue")
    avg_revenue_per_student: Decimal
    avg_revenue_per_bed: Decimal

# --- File: D:\hostel-management-saas\app\schemas\analytics\occupancy_analytics.py ---
"""
Occupancy analytics schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import List, Dict, Optional

from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.filters import DateRangeFilter


class OccupancyKPI(BaseSchema):
    """Key occupancy metrics"""
    hostel_id: Optional[UUID] = None
    hostel_name: Optional[str] = None

    current_occupancy_percentage: Decimal
    average_occupancy_percentage: Decimal
    peak_occupancy_percentage: Decimal
    low_occupancy_percentage: Decimal

    total_beds: int
    occupied_beds: int
    available_beds: int


class OccupancyTrendPoint(BaseSchema):
    """Occupancy over time point"""
    date: date
    occupancy_percentage: Decimal
    occupied_beds: int
    total_beds: int


class ForecastData(BaseSchema):
    """Occupancy forecast data"""
    forecast_horizon_days: int
    forecast_points: List["ForecastPoint"] = Field(default_factory=list)
    model_used: Optional[str] = Field(
        None, description="e.g., 'moving_average', 'arima', 'simple_extrapolation'"
    )
    confidence_interval: Optional[Decimal] = Field(
        None, description="Confidence interval for forecast in %"
    )


class ForecastPoint(BaseSchema):
    """Single forecast point"""
    date: date
    forecasted_occupancy_percentage: Decimal
    forecasted_occupied_beds: int


class OccupancyByRoomType(BaseSchema):
    """Occupancy distribution by room type"""
    room_type: str
    total_beds: int
    occupied_beds: int
    occupancy_percentage: Decimal


class OccupancyReport(BaseSchema):
    """Complete occupancy analytics"""
    hostel_id: Optional[UUID] = None
    hostel_name: Optional[str] = None

    period: DateRangeFilter
    generated_at: datetime = Field(default_factory=datetime.utcnow)

    kpi: OccupancyKPI

    # Trends
    daily_trend: List[OccupancyTrendPoint] = Field(default_factory=list)

    # Breakdown
    by_room_type: List[OccupancyByRoomType] = Field(default_factory=list)
    by_floor: Dict[int, OccupancyKPI] = Field(default_factory=dict)

    # Forecast
    forecast: Optional[ForecastData] = None

# --- File: D:\hostel-management-saas\app\schemas\analytics\platform_analytics.py ---
"""
Platform-wide analytics (super admin)
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Dict, List

from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.filters import DateRangeFilter


class PlatformMetrics(BaseSchema):
    """High-level platform metrics"""
    period: DateRangeFilter
    generated_at: datetime = Field(default_factory=datetime.utcnow)

    # Tenants
    total_hostels: int
    active_hostels: int
    hostels_on_trial: int

    # Users
    total_users: int
    total_students: int
    total_supervisors: int
    total_admins: int
    total_visitors: int

    # Load
    avg_daily_active_users: int
    peak_concurrent_sessions: int


class GrowthMetrics(BaseSchema):
    """Growth metrics over time"""
    period: DateRangeFilter

    # Hostels
    new_hostels: int
    churned_hostels: int
    net_hostel_growth: int

    # Revenue
    total_revenue: Decimal
    revenue_growth_rate: Decimal

    # Users
    new_users: int
    user_growth_rate: Decimal

    # Charts
    monthly_revenue: List["MonthlyMetric"] = Field(default_factory=list)
    monthly_new_hostels: List["MonthlyMetric"] = Field(default_factory=list)
    monthly_new_users: List["MonthlyMetric"] = Field(default_factory=list)


class MonthlyMetric(BaseSchema):
    """Monthly metric point"""
    month: str  # YYYY-MM
    value: Decimal | int | float


class PlatformUsageAnalytics(BaseSchema):
    """Platform usage analytics"""
    period: DateRangeFilter
    generated_at: datetime = Field(default_factory=datetime.utcnow)

    # Traffic
    total_requests: int
    avg_requests_per_minute: Decimal
    api_error_rate: Decimal

    # By endpoint group
    requests_by_module: Dict[str, int] = Field(
        default_factory=dict, description="module -> request count"
    )

    # Latency
    avg_response_time_ms: Decimal
    p95_response_time_ms: Decimal
    p99_response_time_ms: Decimal

    # Resource usage (if tracked)
    avg_cpu_usage_percent: Optional[Decimal] = None
    avg_memory_usage_percent: Optional[Decimal] = None

# --- File: D:\hostel-management-saas\app\schemas\analytics\supervisor_analytics.py ---
"""
Supervisor analytics schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Dict, List, Optional

from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.filters import DateRangeFilter


class SupervisorKPI(BaseSchema):
    """Supervisor KPI metrics (aggregated)"""
    supervisor_id: UUID
    supervisor_name: str
    hostel_id: UUID
    hostel_name: str

    period: DateRangeFilter

    # Workload
    complaints_assigned: int
    complaints_resolved: int
    maintenance_requests_created: int
    maintenance_requests_completed: int
    attendance_records_marked: int

    # Performance
    avg_complaint_resolution_time_hours: Decimal
    avg_maintenance_completion_time_hours: Decimal
    complaint_sla_compliance_rate: Decimal
    maintenance_sla_compliance_rate: Decimal

    student_feedback_score: Optional[Decimal] = Field(
        None, description="Average rating from student feedback"
    )

    overall_performance_score: Decimal = Field(
        ..., ge=0, le=100, description="Composite performance score"
    )


class SupervisorTrendPoint(BaseSchema):
    """Trend point for supervisor performance"""
    period_label: str
    complaints_resolved: int
    maintenance_completed: int
    performance_score: Decimal


class SupervisorDashboardAnalytics(BaseSchema):
    """Supervisor dashboard analytics"""
    supervisor_id: UUID
    supervisor_name: str
    hostel_id: UUID
    hostel_name: str

    period: DateRangeFilter
    generated_at: datetime = Field(default_factory=datetime.utcnow)

    kpi: SupervisorKPI
    trend: List[SupervisorTrendPoint] = Field(default_factory=list)

    # Breakdown
    complaints_by_category: Dict[str, int] = Field(default_factory=dict)
    maintenance_by_category: Dict[str, int] = Field(default_factory=dict)


class SupervisorComparison(BaseSchema):
    """Compare supervisors within hostel or platform"""
    scope_type: str = Field(..., pattern="^(hostel|platform)$")
    hostel_id: Optional[UUID] = None

    period: DateRangeFilter
    generated_at: datetime = Field(default_factory=datetime.utcnow)

    supervisors: List[SupervisorKPI] = Field(default_factory=list)

    # Rankings
    ranked_by_performance: List[UUID] = Field(default_factory=list)
    ranked_by_resolution_speed: List[UUID] = Field(default_factory=list)
    ranked_by_feedback_score: List[UUID] = Field(default_factory=list)

# --- File: D:\hostel-management-saas\app\schemas\analytics\visitor_analytics.py ---
"""
Visitor & funnel analytics schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Dict, List, Optional

from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.enums import SearchSource
from app.schemas.common.filters import DateRangeFilter


class VisitorFunnel(BaseSchema):
    """Visitor funnel from views → registration → booking"""
    period: DateRangeFilter
    generated_at: datetime = Field(default_factory=datetime.utcnow)

    # Counts
    total_visits: int
    unique_visitors: int
    registrations: int
    bookings: int

    # Conversion rates
    visit_to_registration_rate: Decimal
    registration_to_booking_rate: Decimal
    visit_to_booking_rate: Decimal

    # Drop-off points
    dropped_after_search: int
    dropped_after_hostel_view: int
    dropped_after_booking_start: int


class TrafficSourceAnalytics(BaseSchema):
    """Traffic sources for visitor acquisition"""
    period: DateRangeFilter
    total_visits: int

    visits_by_source: Dict[SearchSource, int] = Field(default_factory=dict)
    registrations_by_source: Dict[SearchSource, int] = Field(default_factory=dict)
    bookings_by_source: Dict[SearchSource, int] = Field(default_factory=dict)

    # Conversion by source
    visit_to_booking_rate_by_source: Dict[SearchSource, Decimal] = Field(
        default_factory=dict
    )


class VisitorBehaviorAnalytics(BaseSchema):
    """Behavior analytics for visitors"""
    period: DateRangeFilter
    generated_at: datetime = Field(default_factory=datetime.utcnow)

    # Search behavior
    average_searches_per_session: Decimal
    average_filters_used: Decimal
    most_searched_cities: List[str] = Field(default_factory=list)
    most_filtered_amenities: List[str] = Field(default_factory=list)

    # Engagement
    average_hostels_viewed_per_session: Decimal
    average_time_on_hostel_page_seconds: Decimal
    comparison_tool_usage_rate: Decimal

    # Exit pages
    common_exit_reasons: List[str] = Field(default_factory=list)

# --- File: D:\hostel-management-saas\app\schemas\analytics\__init__.py ---
"""
Analytics schemas package
"""

from app.schemas.analytics.dashboard_analytics import (
    DashboardMetrics,
    KPIResponse,
    QuickStats,
)
from app.schemas.analytics.financial_analytics import (
    FinancialReport,
    RevenueBreakdown,
    ExpenseBreakdown,
    ProfitAndLossReport,
    CashflowSummary,
)
from app.schemas.analytics.occupancy_analytics import (
    OccupancyReport,
    OccupancyKPI,
    OccupancyTrendPoint,
    ForecastData,
)
from app.schemas.analytics.complaint_analytics import (
    ComplaintKPI,
    ComplaintDashboard,
    ComplaintTrend,
)
from app.schemas.analytics.visitor_analytics import (
    VisitorFunnel,
    TrafficSourceAnalytics,
    VisitorBehaviorAnalytics,
)
from app.schemas.analytics.booking_analytics import (
    BookingFunnel,
    BookingKPI,
    BookingTrendPoint,
    CancellationAnalytics,
)
from app.schemas.analytics.supervisor_analytics import (
    SupervisorKPI,
    SupervisorDashboardAnalytics,
    SupervisorComparison,
)
from app.schemas.analytics.platform_analytics import (
    PlatformMetrics,
    GrowthMetrics,
    PlatformUsageAnalytics,
)
from app.schemas.analytics.custom_reports import (
    CustomReportRequest,
    CustomReportDefinition,
    CustomReportResult,
)

__all__ = [
    # Dashboard
    "DashboardMetrics",
    "KPIResponse",
    "QuickStats",
    # Financial
    "FinancialReport",
    "RevenueBreakdown",
    "ExpenseBreakdown",
    "ProfitAndLossReport",
    "CashflowSummary",
    # Occupancy
    "OccupancyReport",
    "OccupancyKPI",
    "OccupancyTrendPoint",
    "ForecastData",
    # Complaints
    "ComplaintKPI",
    "ComplaintDashboard",
    "ComplaintTrend",
    # Visitor
    "VisitorFunnel",
    "TrafficSourceAnalytics",
    "VisitorBehaviorAnalytics",
    # Booking
    "BookingFunnel",
    "BookingKPI",
    "BookingTrendPoint",
    "CancellationAnalytics",
    # Supervisor
    "SupervisorKPI",
    "SupervisorDashboardAnalytics",
    "SupervisorComparison",
    # Platform
    "PlatformMetrics",
    "GrowthMetrics",
    "PlatformUsageAnalytics",
    # Custom reports
    "CustomReportRequest",
    "CustomReportDefinition",
    "CustomReportResult",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\announcement =====

# --- File: D:\hostel-management-saas\app\schemas\announcement\announcement_approval.py ---
"""
Announcement approval schemas
"""
from datetime import datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class ApprovalRequest(BaseCreateSchema):
    """Request approval for announcement (supervisor to admin)"""
    announcement_id: UUID
    
    # Justification
    approval_reason: Optional[str] = Field(None, max_length=500, description="Why approval needed")
    
    # Urgency
    is_urgent_request: bool = Field(False)


class ApprovalResponse(BaseSchema):
    """Approval response"""
    announcement_id: UUID
    
    approved: bool
    approved_by: UUID
    approved_by_name: str
    approved_at: datetime
    
    # Feedback
    approval_notes: Optional[str]
    
    # If approved, auto-publish?
    auto_published: bool
    
    message: str


class RejectionRequest(BaseCreateSchema):
    """Reject announcement"""
    announcement_id: UUID
    
    rejection_reason: str = Field(..., min_length=20, max_length=500)
    
    # Suggestions
    suggested_modifications: Optional[str] = Field(None, max_length=1000)


class ApprovalWorkflow(BaseSchema):
    """Approval workflow status"""
    announcement_id: UUID
    title: str
    
    requires_approval: bool
    approval_status: str = Field(
        ...,
        pattern="^(pending|approved|rejected|not_required)$"
    )
    
    # Submitted by
    created_by: UUID
    created_by_name: str
    created_by_role: str
    
    # Approval timeline
    submitted_for_approval_at: Optional[datetime]
    approved_rejected_at: Optional[datetime]
    
    # Current approver
    pending_with: Optional[UUID]
    pending_with_name: Optional[str]
    
    # Reason (if rejected)
    rejection_reason: Optional[str]


class SupervisorApprovalQueue(BaseSchema):
    """Supervisor's pending approvals"""
    supervisor_id: UUID
    supervisor_name: str
    
    total_pending: int
    urgent_pending: int
    
    pending_announcements: List["PendingApprovalItem"]


class PendingApprovalItem(BaseSchema):
    """Pending approval item"""
    announcement_id: UUID
    title: str
    category: str
    
    created_by: UUID
    created_by_name: str
    
    submitted_at: datetime
    is_urgent: bool
    
    # Preview
    content_preview: str = Field(..., description="First 200 chars")
    
    target_audience: str
    estimated_recipients: int


class BulkApproval(BaseCreateSchema):
    """Approve multiple announcements"""
    announcement_ids: List[UUID] = Field(..., min_items=1)
    
    approved: bool
    approval_notes: Optional[str] = None
    
    # Publish immediately after approval
    publish_immediately: bool = Field(True)

# --- File: D:\hostel-management-saas\app\schemas\announcement\announcement_base.py ---
"""
Announcement base schemas
"""
from datetime import datetime
from typing import List, Optional
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import AnnouncementCategory, Priority, TargetAudience


class AnnouncementBase(BaseSchema):
    """Base announcement schema"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    
    title: str = Field(..., min_length=5, max_length=255, description="Announcement title")
    content: str = Field(..., min_length=10, max_length=5000, description="Announcement content")
    
    category: AnnouncementCategory = Field(..., description="Announcement category")
    priority: Priority = Field(Priority.MEDIUM, description="Priority level")
    
    # Visibility
    is_urgent: bool = Field(False, description="Mark as urgent")
    is_pinned: bool = Field(False, description="Pin to top")
    
    # Target audience
    target_audience: TargetAudience = Field(TargetAudience.ALL, description="Target audience")
    target_room_ids: List[UUID] = Field(default_factory=list, description="Specific rooms")
    target_student_ids: List[UUID] = Field(default_factory=list, description="Specific students")
    target_floor_numbers: List[int] = Field(default_factory=list, description="Specific floors")
    
    # Attachments
    attachments: List[HttpUrl] = Field(default_factory=list, description="Attachment URLs")
    
    # Expiry
    expires_at: Optional[datetime] = Field(None, description="When announcement expires")


class AnnouncementCreate(AnnouncementBase, BaseCreateSchema):
    """Create announcement"""
    created_by: UUID = Field(..., description="Creator (admin/supervisor)")
    
    # Delivery settings
    send_email: bool = Field(False, description="Send email notification")
    send_sms: bool = Field(False, description="Send SMS notification")
    send_push: bool = Field(True, description="Send push notification")


class AnnouncementUpdate(BaseUpdateSchema):
    """Update announcement"""
    title: Optional[str] = Field(None, min_length=5, max_length=255)
    content: Optional[str] = Field(None, min_length=10, max_length=5000)
    category: Optional[AnnouncementCategory] = None
    priority: Optional[Priority] = None
    
    is_urgent: Optional[bool] = None
    is_pinned: Optional[bool] = None
    
    expires_at: Optional[datetime] = None
    
    # Publication
    is_published: Optional[bool] = None

# --- File: D:\hostel-management-saas\app\schemas\announcement\announcement_delivery.py ---
"""
Announcement delivery schemas
"""
from datetime import datetime
from typing import List, Optional, Dict
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class DeliveryConfig(BaseSchema):
    """Delivery configuration"""
    announcement_id: UUID
    
    # Channels
    channels: "DeliveryChannels"
    
    # Delivery strategy
    delivery_strategy: str = Field(
        "immediate",
        pattern="^(immediate|scheduled|batched)$"
    )
    
    # Batch settings (if batched)
    batch_size: Optional[int] = Field(None, ge=10, le=1000)
    batch_interval_minutes: Optional[int] = Field(None, ge=1, le=60)


class DeliveryChannels(BaseSchema):
    """Delivery channel settings"""
    email: bool = Field(False)
    sms: bool = Field(False)
    push: bool = Field(True)
    in_app: bool = Field(True)
    
    # Channel priority (for fallback)
    primary_channel: str = Field("push", pattern="^(email|sms|push|in_app)$")
    fallback_channels: List[str] = Field(default_factory=list)


class DeliveryStatus(BaseSchema):
    """Delivery status for announcement"""
    announcement_id: UUID
    
    total_recipients: int
    
    # By channel
    email_sent: int
    email_delivered: int
    email_failed: int
    
    sms_sent: int
    sms_delivered: int
    sms_failed: int
    
    push_sent: int
    push_delivered: int
    push_failed: int
    
    # Overall
    total_delivered: int
    total_failed: int
    delivery_rate: Decimal = Field(..., description="% successfully delivered")
    
    # Timeline
    delivery_started_at: Optional[datetime]
    delivery_completed_at: Optional[datetime]


class DeliveryReport(BaseSchema):
    """Detailed delivery report"""
    announcement_id: UUID
    title: str
    
    # Recipients
    total_recipients: int
    
    # By channel
    channel_breakdown: Dict[str, "ChannelDeliveryStats"]
    
    # By status
    delivered_count: int
    failed_count: int
    pending_count: int
    
    # Failed recipients
    failed_recipients: List["FailedDelivery"] = Field(default_factory=list)
    
    # Timeline
    delivery_duration_minutes: Optional[int]
    
    generated_at: datetime


class ChannelDeliveryStats(BaseSchema):
    """Delivery stats for specific channel"""
    channel: str
    
    sent: int
    delivered: int
    failed: int
    pending: int
    
    delivery_rate: Decimal
    average_delivery_time_seconds: Optional[Decimal]


class FailedDelivery(BaseSchema):
    """Failed delivery record"""
    recipient_id: UUID
    recipient_name: str
    recipient_contact: str
    
    channel: str
    failure_reason: str
    failed_at: datetime
    
    retry_attempted: bool
    retry_successful: Optional[bool]


class BatchDelivery(BaseSchema):
    """Batch delivery progress"""
    announcement_id: UUID
    
    total_batches: int
    completed_batches: int
    current_batch: int
    
    total_recipients: int
    processed_recipients: int
    
    estimated_completion: datetime
    
    status: str = Field(..., pattern="^(processing|completed|failed|paused)$")


class RetryDelivery(BaseCreateSchema):
    """Retry failed deliveries"""
    announcement_id: UUID
    
    # Retry options
    retry_failed_only: bool = Field(True)
    retry_channels: List[str] = Field(default_factory=list, description="Specific channels to retry")
    
    # Specific recipients
    recipient_ids: Optional[List[UUID]] = Field(None, description="Retry specific recipients only")

# --- File: D:\hostel-management-saas\app\schemas\announcement\announcement_filters.py ---
"""
Announcement filter schemas
"""
from datetime import date, datetime
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseFilterSchema
from app.schemas.common.enums import AnnouncementCategory, Priority


class AnnouncementFilterParams(BaseFilterSchema):
    """Announcement filter parameters"""
    # Text search
    search: Optional[str] = Field(None, description="Search in title, content")
    
    # Hostel filter
    hostel_id: Optional[UUID] = None
    hostel_ids: Optional[List[UUID]] = None
    
    # Category
    category: Optional[AnnouncementCategory] = None
    categories: Optional[List[AnnouncementCategory]] = None
    
    # Priority
    priority: Optional[Priority] = None
    priorities: Optional[List[Priority]] = None
    
    # Status
    is_published: Optional[bool] = None
    is_urgent: Optional[bool] = None
    is_pinned: Optional[bool] = None
    
    # Creator
    created_by: Optional[UUID] = None
    created_by_role: Optional[str] = None
    
    # Date filters
    published_date_from: Optional[date] = None
    published_date_to: Optional[date] = None
    created_date_from: Optional[date] = None
    created_date_to: Optional[date] = None
    
    # Expiry
    active_only: Optional[bool] = Field(None, description="Only non-expired announcements")
    expired_only: Optional[bool] = None
    
    # Approval
    approval_pending: Optional[bool] = None


class SearchRequest(BaseFilterSchema):
    """Announcement search"""
    query: str = Field(..., min_length=1)
    hostel_id: Optional[UUID] = None
    
    search_in_title: bool = Field(True)
    search_in_content: bool = Field(True)
    
    category: Optional[AnnouncementCategory] = None
    
    page: int = Field(1, ge=1)
    page_size: int = Field(20, ge=1, le=100)


class ArchiveRequest(BaseCreateSchema):
    """Archive old announcements"""
    hostel_id: UUID
    
    # Archive criteria
    archive_before_date: date = Field(..., description="Archive announcements before this date")
    
    # Options
    archive_expired_only: bool = Field(True)
    archive_read_only: bool = Field(False, description="Archive only if all recipients read")
    
    # Exclusions
    exclude_pinned: bool = Field(True)
    exclude_important: bool = Field(True)


class AnnouncementExportRequest(BaseFilterSchema):
    """Export announcements"""
    hostel_id: UUID
    filters: Optional[AnnouncementFilterParams] = None
    
    format: str = Field("pdf", pattern="^(pdf|excel|csv)$")
    
    include_engagement_metrics: bool = Field(True)
    include_recipient_list: bool = Field(False)

# --- File: D:\hostel-management-saas\app\schemas\announcement\announcement_response.py ---
"""
Announcement response schemas
"""
from datetime import datetime
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import AnnouncementCategory, Priority


class AnnouncementResponse(BaseResponseSchema):
    """Announcement response"""
    hostel_id: UUID
    hostel_name: str
    
    title: str
    content: str
    
    category: AnnouncementCategory
    priority: Priority
    
    is_urgent: bool
    is_pinned: bool
    
    created_by: UUID
    created_by_name: str
    
    is_published: bool
    published_at: Optional[datetime]
    
    total_recipients: int
    read_count: int


class AnnouncementDetail(BaseResponseSchema):
    """Detailed announcement"""
    hostel_id: UUID
    hostel_name: str
    
    title: str
    content: str
    category: AnnouncementCategory
    priority: Priority
    
    is_urgent: bool
    is_pinned: bool
    
    # Target audience
    target_audience: str
    target_room_ids: List[UUID]
    target_student_ids: List[UUID]
    target_floor_numbers: List[int]
    
    # Attachments
    attachments: List[str]
    
    # Schedule
    scheduled_publish_at: Optional[datetime]
    published_at: Optional[datetime]
    expires_at: Optional[datetime]
    is_published: bool
    
    # Creation and approval
    created_by: UUID
    created_by_name: str
    created_by_role: str
    
    approved_by: Optional[UUID]
    approved_by_name: Optional[str]
    approved_at: Optional[datetime]
    requires_approval: bool
    
    # Delivery
    send_email: bool
    send_sms: bool
    send_push: bool
    
    email_sent_at: Optional[datetime]
    sms_sent_at: Optional[datetime]
    push_sent_at: Optional[datetime]
    
    # Tracking
    total_recipients: int
    read_count: int
    acknowledged_count: int
    
    # Engagement
    engagement_rate: Decimal = Field(..., description="% who read the announcement")


class AnnouncementList(BaseSchema):
    """List of announcements"""
    hostel_id: Optional[UUID] = None
    
    total_announcements: int
    active_announcements: int
    pinned_announcements: int
    
    announcements: List["AnnouncementListItem"]


class AnnouncementListItem(BaseSchema):
    """Announcement list item"""
    id: UUID
    title: str
    category: str
    priority: str
    
    is_urgent: bool
    is_pinned: bool
    
    created_by_name: str
    published_at: Optional[datetime]
    
    read_count: int
    total_recipients: int
    
    is_read: bool = Field(False, description="For student view")

# --- File: D:\hostel-management-saas\app\schemas\announcement\announcement_scheduling.py ---
"""
Announcement scheduling schemas
"""
from datetime import datetime
from typing import Optional
from pydantic import Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class ScheduleRequest(BaseCreateSchema):
    """Schedule announcement for later"""
    announcement_id: UUID
    
    scheduled_publish_at: datetime = Field(..., description="When to publish")
    
    # Auto-expire
    auto_expire: bool = Field(False)
    expire_after_hours: Optional[int] = Field(None, ge=1, le=720, description="Expire after N hours")
    
    @field_validator('scheduled_publish_at')
    @classmethod
    def validate_future_time(cls, v: datetime) -> datetime:
        """Ensure scheduled time is in future"""
        from datetime import datetime as dt
        if v <= dt.now():
            raise ValueError('Scheduled time must be in the future')
        return v


class ScheduleConfig(BaseSchema):
    """Schedule configuration"""
    announcement_id: UUID
    
    is_scheduled: bool
    scheduled_publish_at: Optional[datetime]
    
    # Recurrence
    is_recurring: bool = Field(False)
    recurrence_pattern: Optional[str] = Field(None, description="daily, weekly, monthly")
    
    # End condition
    recurrence_end_date: Optional[datetime] = None
    max_occurrences: Optional[int] = Field(None, ge=1)


class RecurringAnnouncement(BaseCreateSchema):
    """Create recurring announcement"""
    hostel_id: UUID
    
    title: str = Field(..., min_length=5, max_length=255)
    content: str = Field(..., min_length=10, max_length=5000)
    
    # Recurrence
    recurrence_pattern: str = Field(..., pattern="^(daily|weekly|monthly)$")
    start_date: datetime
    
    # End condition
    end_date: Optional[datetime] = None
    max_occurrences: Optional[int] = None
    
    # Days (for weekly)
    weekdays: Optional[List[int]] = Field(None, description="0=Monday, 6=Sunday")
    
    # Time
    publish_time: str = Field(..., description="HH:MM format")
    
    # Targeting
    target_audience: str
    target_room_ids: List[UUID] = Field(default_factory=list)


class ScheduleUpdate(BaseCreateSchema):
    """Update scheduled announcement"""
    announcement_id: UUID
    
    new_scheduled_time: datetime
    
    reason: Optional[str] = Field(None, max_length=500, description="Reason for rescheduling")


class ScheduleCancel(BaseCreateSchema):
    """Cancel scheduled announcement"""
    announcement_id: UUID
    
    cancellation_reason: str = Field(..., min_length=10, max_length=500)
    
    # Whether to delete or just unpublish
    delete_announcement: bool = Field(False)


class PublishNow(BaseCreateSchema):
    """Publish scheduled announcement immediately"""
    announcement_id: UUID
    
    override_schedule: bool = Field(True)


class ScheduledAnnouncementsList(BaseSchema):
    """List of scheduled announcements"""
    hostel_id: UUID
    
    total_scheduled: int
    upcoming_24h: int
    
    announcements: List["ScheduledAnnouncementItem"]


class ScheduledAnnouncementItem(BaseSchema):
    """Scheduled announcement item"""
    announcement_id: UUID
    title: str
    scheduled_for: datetime
    
    is_recurring: bool
    next_occurrence: Optional[datetime]
    
    target_audience: str
    estimated_recipients: int

# --- File: D:\hostel-management-saas\app\schemas\announcement\announcement_targeting.py ---
"""
Announcement targeting schemas
"""
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class TargetingConfig(BaseSchema):
    """Targeting configuration for announcement"""
    target_type: str = Field(
        ...,
        pattern="^(all|specific_rooms|specific_floors|specific_students|custom)$",
        description="Targeting type"
    )
    
    # Specific targets
    room_ids: List[UUID] = Field(default_factory=list)
    floor_numbers: List[int] = Field(default_factory=list)
    student_ids: List[UUID] = Field(default_factory=list)
    
    # Exclude
    exclude_student_ids: List[UUID] = Field(default_factory=list, description="Students to exclude")


class AudienceSelection(BaseCreateSchema):
    """Audience selection for announcement"""
    announcement_id: UUID
    
    # Selection criteria
    include_all: bool = Field(False)
    include_active_students: bool = Field(True)
    include_inactive_students: bool = Field(False)
    
    # Filters
    room_types: Optional[List[str]] = Field(None, description="Filter by room types")
    floors: Optional[List[int]] = None
    
    # Specific selection
    specific_room_ids: List[UUID] = Field(default_factory=list)
    specific_student_ids: List[UUID] = Field(default_factory=list)
    
    # Exclusions
    exclude_student_ids: List[UUID] = Field(default_factory=list)


class TargetRooms(BaseCreateSchema):
    """Target specific rooms"""
    announcement_id: UUID
    room_ids: List[UUID] = Field(..., min_items=1, description="Room IDs to target")
    
    # Include all students in these rooms
    include_all_students: bool = Field(True)


class TargetFloors(BaseCreateSchema):
    """Target specific floors"""
    announcement_id: UUID
    floor_numbers: List[int] = Field(..., min_items=1, description="Floor numbers")
    
    # Options
    include_all_rooms: bool = Field(True)


class IndividualTargeting(BaseCreateSchema):
    """Target individual students"""
    announcement_id: UUID
    student_ids: List[UUID] = Field(..., min_items=1, max_items=100, description="Student IDs")


class TargetingSummary(BaseSchema):
    """Summary of who will receive announcement"""
    announcement_id: UUID
    
    targeting_type: str
    
    # Counts
    total_recipients: int
    students_count: int
    rooms_count: int
    floors_count: int
    
    # Breakdown
    recipients_by_room: dict = Field(default_factory=dict, description="Room ID -> student count")
    recipients_by_floor: dict = Field(default_factory=dict, description="Floor -> student count")


class BulkTargeting(BaseCreateSchema):
    """Add multiple targeting rules"""
    announcement_id: UUID
    
    targeting_rules: List[TargetingConfig] = Field(..., min_items=1)
    
    # How to combine rules
    combine_mode: str = Field("union", pattern="^(union|intersection)$")

# --- File: D:\hostel-management-saas\app\schemas\announcement\announcement_tracking.py ---
"""
Announcement tracking schemas
"""
from datetime import datetime
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema


class ReadReceipt(BaseCreateSchema):
    """Mark announcement as read"""
    announcement_id: UUID
    student_id: UUID
    
    read_at: datetime = Field(default_factory=datetime.now)
    
    # Reading context
    reading_time_seconds: Optional[int] = Field(None, ge=0, description="Time spent reading")
    device_type: Optional[str] = Field(None, pattern="^(mobile|web|tablet)$")


class ReadReceiptResponse(BaseResponseSchema):
    """Read receipt response"""
    announcement_id: UUID
    student_id: UUID
    read_at: datetime
    
    # If acknowledgment is required
    requires_acknowledgment: bool
    acknowledged: bool


class AcknowledgmentTracking(BaseSchema):
    """Track acknowledgments for announcement"""
    announcement_id: UUID
    
    requires_acknowledgment: bool
    
    total_recipients: int
    acknowledged_count: int
    pending_acknowledgments: int
    
    acknowledgment_rate: Decimal = Field(..., description="% who acknowledged")
    
    # Students pending acknowledgment
    pending_students: List["PendingAcknowledgment"] = Field(default_factory=list)


class PendingAcknowledgment(BaseSchema):
    """Pending acknowledgment"""
    student_id: UUID
    student_name: str
    room_number: Optional[str]
    
    delivered_at: datetime
    read: bool
    read_at: Optional[datetime]


class AcknowledgmentRequest(BaseCreateSchema):
    """Submit acknowledgment"""
    announcement_id: UUID
    student_id: UUID
    
    acknowledged: bool = Field(True)
    acknowledgment_note: Optional[str] = Field(None, max_length=500)


class EngagementMetrics(BaseSchema):
    """Engagement metrics for announcement"""
    announcement_id: UUID
    title: str
    
    # Delivery
    total_recipients: int
    delivered_count: int
    delivery_rate: Decimal
    
    # Reading
    read_count: int
    read_rate: Decimal = Field(..., description="% who read")
    
    average_reading_time_seconds: Optional[Decimal]
    
    # Acknowledgment
    acknowledged_count: int
    acknowledgment_rate: Decimal
    
    # Timing
    average_time_to_read_hours: Optional[Decimal] = Field(
        None,
        description="Average time between delivery and reading"
    )
    
    # Engagement score
    engagement_score: Decimal = Field(..., ge=0, le=100, description="Overall engagement score")


class ReadingTime(BaseSchema):
    """Reading time analytics"""
    announcement_id: UUID
    
    # Statistics
    average_reading_time_seconds: Decimal
    median_reading_time_seconds: Decimal
    min_reading_time_seconds: int
    max_reading_time_seconds: int
    
    # Distribution
    quick_readers: int = Field(..., description="< 30 seconds")
    normal_readers: int = Field(..., description="30-120 seconds")
    thorough_readers: int = Field(..., description="> 120 seconds")


class AnnouncementAnalytics(BaseSchema):
    """Complete announcement analytics"""
    announcement_id: UUID
    title: str
    published_at: datetime
    
    # Delivery metrics
    delivery_metrics: DeliveryStatus
    
    # Engagement metrics
    engagement_metrics: EngagementMetrics
    
    # Reading patterns
    reading_by_hour: dict = Field(..., description="Hour -> read count")
    reading_by_day: dict = Field(..., description="Day -> read count")
    
    # Device breakdown
    reads_by_device: dict = Field(..., description="Device type -> count")

# --- File: D:\hostel-management-saas\app\schemas\announcement\__init__.py ---
"""
Announcement schemas package
"""
from app.schemas.announcement.announcement_base import (
    AnnouncementBase,
    AnnouncementCreate,
    AnnouncementUpdate
)
from app.schemas.announcement.announcement_response import (
    AnnouncementResponse,
    AnnouncementDetail,
    AnnouncementList
)
from app.schemas.announcement.announcement_targeting import (
    TargetingConfig,
    AudienceSelection,
    TargetRooms,
    TargetFloors
)
from app.schemas.announcement.announcement_scheduling import (
    ScheduleRequest,
    ScheduleConfig,
    RecurringAnnouncement
)
from app.schemas.announcement.announcement_approval import (
    ApprovalRequest,
    ApprovalWorkflow,
    SupervisorApprovalQueue
)
from app.schemas.announcement.announcement_delivery import (
    DeliveryConfig,
    DeliveryChannels,
    DeliveryStatus,
    DeliveryReport
)
from app.schemas.announcement.announcement_tracking import (
    ReadReceipt,
    AcknowledgmentTracking,
    EngagementMetrics
)
from app.schemas.announcement.announcement_filters import (
    AnnouncementFilterParams,
    SearchRequest,
    ArchiveRequest
)

__all__ = [
    # Base
    "AnnouncementBase",
    "AnnouncementCreate",
    "AnnouncementUpdate",
    
    # Response
    "AnnouncementResponse",
    "AnnouncementDetail",
    "AnnouncementList",
    
    # Targeting
    "TargetingConfig",
    "AudienceSelection",
    "TargetRooms",
    "TargetFloors",
    
    # Scheduling
    "ScheduleRequest",
    "ScheduleConfig",
    "RecurringAnnouncement",
    
    # Approval
    "ApprovalRequest",
    "ApprovalWorkflow",
    "SupervisorApprovalQueue",
    
    # Delivery
    "DeliveryConfig",
    "DeliveryChannels",
    "DeliveryStatus",
    "DeliveryReport",
    
    # Tracking
    "ReadReceipt",
    "AcknowledgmentTracking",
    "EngagementMetrics",
    
    # Filters
    "AnnouncementFilterParams",
    "SearchRequest",
    "ArchiveRequest",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\attendance =====

# --- File: D:\hostel-management-saas\app\schemas\attendance\attendance_alert.py ---
"""
Attendance alert schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema


class AttendanceAlert(BaseResponseSchema):
    """Attendance alert"""
    alert_id: UUID
    hostel_id: UUID
    student_id: UUID
    student_name: str
    
    alert_type: str = Field(
        ...,
        pattern="^(low_attendance|consecutive_absences|late_entry|irregular_pattern)$"
    )
    
    severity: str = Field(..., pattern="^(low|medium|high|critical)$")
    
    # Alert details
    message: str
    details: dict = Field(..., description="Alert-specific details")
    
    # Triggered
    triggered_at: datetime
    triggered_by_rule: Optional[str] = None
    
    # Status
    acknowledged: bool = Field(False)
    acknowledged_by: Optional[UUID] = None
    acknowledged_at: Optional[datetime] = None
    
    # Actions taken
    actions_taken: List[str] = Field(default_factory=list)
    
    resolved: bool = Field(False)
    resolved_at: Optional[datetime] = None


class AlertConfig(BaseSchema):
    """Alert configuration"""
    hostel_id: UUID
    
    # Low attendance alerts
    enable_low_attendance_alerts: bool = Field(True)
    low_attendance_threshold: Decimal = Field(Decimal("75.00"), ge=0, le=100)
    
    # Consecutive absence alerts
    enable_consecutive_absence_alerts: bool = Field(True)
    consecutive_absence_threshold: int = Field(3, ge=1)
    
    # Late entry alerts
    enable_late_entry_alerts: bool = Field(True)
    late_entry_count_threshold: int = Field(5, description="Alert after N late entries in month")
    
    # Pattern detection
    enable_pattern_detection: bool = Field(False, description="Detect irregular patterns")
    
    # Notification settings
    notify_supervisor: bool = Field(True)
    notify_admin: bool = Field(True)
    notify_guardian: bool = Field(True)
    notify_student: bool = Field(True)
    
    # Escalation
    auto_escalate_after_days: int = Field(7, description="Auto-escalate unacknowledged alerts")


class AlertTrigger(BaseSchema):
    """Manual alert trigger"""
    student_id: UUID
    alert_type: str
    custom_message: str = Field(..., min_length=10, max_length=500)
    severity: str = Field("medium", pattern="^(low|medium|high|critical)$")


class AlertAcknowledgment(BaseCreateSchema):
    """Acknowledge alert"""
    alert_id: UUID
    acknowledged_by: UUID
    action_taken: str = Field(..., min_length=10, max_length=500)


class AlertList(BaseSchema):
    """List of alerts"""
    hostel_id: Optional[UUID] = None
    
    total_alerts: int
    unacknowledged_alerts: int
    critical_alerts: int
    
    alerts: List[AttendanceAlert]


class AlertSummary(BaseSchema):
    """Alert summary for dashboard"""
    hostel_id: UUID
    period_start: date
    period_end: date
    
    total_alerts: int
    
    # By type
    low_attendance_alerts: int
    consecutive_absence_alerts: int
    late_entry_alerts: int
    pattern_alerts: int
    
    # By severity
    critical_count: int
    high_count: int
    medium_count: int
    low_count: int
    
    # Resolution
    acknowledged_count: int
    resolved_count: int
    pending_count: int

# --- File: D:\hostel-management-saas\app\schemas\attendance\attendance_base.py ---
"""
Attendance base schemas
"""
from datetime import date, time
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import AttendanceStatus, AttendanceMode


class AttendanceBase(BaseSchema):
    """Base attendance schema"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    student_id: UUID = Field(..., description="Student ID")
    attendance_date: date = Field(..., description="Attendance date")
    
    check_in_time: Optional[time] = Field(None, description="Check-in time")
    check_out_time: Optional[time] = Field(None, description="Check-out time")
    
    status: AttendanceStatus = Field(AttendanceStatus.PRESENT, description="Attendance status")
    
    is_late: bool = Field(False, description="Late arrival")
    late_minutes: Optional[int] = Field(None, ge=0, description="Minutes late")
    
    attendance_mode: AttendanceMode = Field(AttendanceMode.MANUAL, description="How attendance was recorded")
    
    marked_by: UUID = Field(..., description="User who marked attendance (supervisor/admin)")
    supervisor_id: Optional[UUID] = Field(None, description="Supervisor who marked")
    
    notes: Optional[str] = Field(None, max_length=500, description="Additional notes")


class AttendanceCreate(AttendanceBase, BaseCreateSchema):
    """Create attendance record"""
    # Location data (for mobile app check-in)
    location_lat: Optional[Decimal] = Field(None, ge=-90, le=90)
    location_lng: Optional[Decimal] = Field(None, ge=-180, le=180)
    
    # Device info (for mobile app)
    device_info: Optional[dict] = None


class AttendanceUpdate(BaseUpdateSchema):
    """Update attendance record"""
    check_in_time: Optional[time] = None
    check_out_time: Optional[time] = None
    status: Optional[AttendanceStatus] = None
    is_late: Optional[bool] = None
    late_minutes: Optional[int] = None
    notes: Optional[str] = None


class BulkAttendanceCreate(BaseCreateSchema):
    """Bulk create attendance records"""
    hostel_id: UUID
    attendance_date: date
    
    records: List["SingleAttendanceRecord"] = Field(..., min_items=1, max_items=500)
    
    marked_by: UUID
    supervisor_id: Optional[UUID] = None


class SingleAttendanceRecord(BaseSchema):
    """Single attendance in bulk"""
    student_id: UUID
    status: AttendanceStatus = Field(AttendanceStatus.PRESENT)
    check_in_time: Optional[time] = None
    is_late: bool = Field(False)
    notes: Optional[str] = None

# --- File: D:\hostel-management-saas\app\schemas\attendance\attendance_filters.py ---
"""
Attendance filter schemas
"""
from datetime import date
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseFilterSchema
from app.schemas.common.enums import AttendanceStatus
from app.schemas.common.filters import DateRangeFilter


class AttendanceFilterParams(BaseFilterSchema):
    """Attendance filter parameters"""
    # Hostel filter
    hostel_id: Optional[UUID] = None
    hostel_ids: Optional[List[UUID]] = None
    
    # Student filter
    student_id: Optional[UUID] = None
    student_ids: Optional[List[UUID]] = None
    room_id: Optional[UUID] = None
    
    # Date range (required for most queries)
    date_from: Optional[date] = None
    date_to: Optional[date] = None
    
    # Status filter
    status: Optional[AttendanceStatus] = None
    statuses: Optional[List[AttendanceStatus]] = None
    
    # Late filter
    late_only: Optional[bool] = None
    
    # Marked by
    marked_by: Optional[UUID] = None
    supervisor_id: Optional[UUID] = None
    
    # Attendance mode
    attendance_mode: Optional[str] = None


class DateRangeRequest(BaseFilterSchema):
    """Simple date range request"""
    start_date: date = Field(..., description="Start date (inclusive)")
    end_date: date = Field(..., description="End date (inclusive)")
    
    @field_validator('end_date')
    @classmethod
    def validate_date_range(cls, v: date, info) -> date:
        if 'start_date' in info.data and v < info.data['start_date']:
            raise ValueError('end_date must be after or equal to start_date')
        return v


class AttendanceExportRequest(BaseFilterSchema):
    """Export attendance data"""
    hostel_id: UUID
    date_range: DateRangeFilter
    
    # Student filter
    student_ids: Optional[List[UUID]] = None
    
    # Format
    format: str = Field("csv", pattern="^(csv|excel|pdf)$")
    
    # Options
    include_summary: bool = Field(True)
    include_percentage: bool = Field(True)
    include_notes: bool = Field(False)
    group_by: str = Field("student", pattern="^(student|date|room)$")

# --- File: D:\hostel-management-saas\app\schemas\attendance\attendance_policy.py ---
"""
Attendance policy schemas
"""
from datetime import time
from decimal import Decimal
from typing import Optional
from pydantic import Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseUpdateSchema, BaseResponseSchema


class AttendancePolicy(BaseResponseSchema):
    """Attendance policy configuration"""
    hostel_id: UUID
    hostel_name: str
    
    # Minimum requirements
    minimum_attendance_percentage: Decimal = Field(..., ge=0, le=100)
    
    # Late entry
    late_entry_threshold_minutes: int = Field(..., ge=0, description="Minutes after which marked as late")
    grace_days_per_month: int = Field(..., ge=0, description="Allowed late entries per month")
    
    # Absence alerts
    consecutive_absence_alert_days: int = Field(..., description="Alert after N consecutive absences")
    
    # Notifications
    notify_guardian_on_absence: bool = Field(True)
    notify_admin_on_low_attendance: bool = Field(True)
    low_attendance_threshold: Decimal = Field(Decimal("75.00"), ge=0, le=100)
    
    # Auto-marking
    auto_mark_absent_after_time: Optional[time] = Field(None, description="Auto mark absent if not checked in by this time")
    
    is_active: bool = Field(True)


class PolicyConfig(BaseSchema):
    """Policy configuration details"""
    # Attendance calculation
    calculation_period: str = Field("monthly", pattern="^(weekly|monthly|semester|yearly)$")
    
    # Leave handling
    count_leave_as_absent: bool = Field(False, description="Count approved leaves as absent")
    max_leaves_per_month: int = Field(3, ge=0)
    
    # Weekends
    include_weekends: bool = Field(False, description="Track attendance on weekends")
    weekend_days: List[str] = Field(default_factory=lambda: ["Saturday", "Sunday"])
    
    # Holidays
    exclude_holidays: bool = Field(True)
    
    # Penalties
    low_attendance_penalty: Optional[str] = None


class PolicyUpdate(BaseUpdateSchema):
    """Update attendance policy"""
    minimum_attendance_percentage: Optional[Decimal] = Field(None, ge=0, le=100)
    late_entry_threshold_minutes: Optional[int] = Field(None, ge=0)
    grace_days_per_month: Optional[int] = Field(None, ge=0)
    consecutive_absence_alert_days: Optional[int] = None
    
    notify_guardian_on_absence: Optional[bool] = None
    notify_admin_on_low_attendance: Optional[bool] = None
    low_attendance_threshold: Optional[Decimal] = Field(None, ge=0, le=100)
    
    auto_mark_absent_after_time: Optional[time] = None
    is_active: Optional[bool] = None


class PolicyViolation(BaseSchema):
    """Policy violation record"""
    student_id: UUID
    student_name: str
    hostel_id: UUID
    
    violation_type: str = Field(
        ...,
        pattern="^(low_attendance|consecutive_absences|excessive_late_entries)$"
    )
    
    # Details
    current_attendance_percentage: Optional[Decimal] = None
    consecutive_absences: Optional[int] = None
    late_entries_this_month: Optional[int] = None
    
    violation_date: date
    
    # Actions taken
    guardian_notified: bool
    admin_notified: bool
    warning_issued: bool
    
    notes: Optional[str] = None

# --- File: D:\hostel-management-saas\app\schemas\attendance\attendance_record.py ---
"""
Attendance recording schemas
"""
from datetime import date, time
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.enums import AttendanceStatus


class AttendanceRecordRequest(BaseCreateSchema):
    """Record attendance for single student"""
    hostel_id: UUID
    student_id: UUID
    attendance_date: date
    
    status: AttendanceStatus = Field(AttendanceStatus.PRESENT)
    check_in_time: Optional[time] = None
    check_out_time: Optional[time] = None
    
    is_late: bool = Field(False)
    notes: Optional[str] = Field(None, max_length=500)


class BulkAttendanceRequest(BaseCreateSchema):
    """Mark attendance for multiple students at once"""
    hostel_id: UUID
    attendance_date: date
    
    # Default status for all (can be overridden per student)
    default_status: AttendanceStatus = Field(AttendanceStatus.PRESENT)
    
    # Student-specific records
    student_records: List["StudentAttendanceRecord"] = Field(..., min_items=1)
    
    # Metadata
    marked_by: UUID
    marking_mode: str = Field("manual", pattern="^(manual|biometric|qr_code|mobile_app)$")


class StudentAttendanceRecord(BaseSchema):
    """Individual student attendance in bulk operation"""
    student_id: UUID
    status: Optional[AttendanceStatus] = None  # If None, uses default_status
    check_in_time: Optional[time] = None
    is_late: Optional[bool] = None
    notes: Optional[str] = None


class AttendanceCorrection(BaseCreateSchema):
    """Correct previously marked attendance"""
    attendance_id: UUID
    
    # Corrected values
    corrected_status: AttendanceStatus
    corrected_check_in_time: Optional[time] = None
    corrected_check_out_time: Optional[time] = None
    
    correction_reason: str = Field(..., min_length=10, max_length=500)
    corrected_by: UUID


class QuickAttendanceMarkAll(BaseCreateSchema):
    """Quick mark all students as present"""
    hostel_id: UUID
    attendance_date: date
    
    # Exceptions
    absent_student_ids: List[UUID] = Field(default_factory=list)
    on_leave_student_ids: List[UUID] = Field(default_factory=list)
    
    marked_by: UUID

# --- File: D:\hostel-management-saas\app\schemas\attendance\attendance_report.py ---
"""
Attendance reporting schemas
"""
from datetime import date
from decimal import Decimal
from typing import List, Dict, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.filters import DateRangeFilter


class AttendanceReport(BaseSchema):
    """Comprehensive attendance report"""
    hostel_id: Optional[UUID] = None
    student_id: Optional[UUID] = None
    
    report_period: DateRangeFilter
    generated_at: datetime
    
    # Summary
    summary: "AttendanceSummary"
    
    # Detailed records
    daily_records: List["DailyAttendanceRecord"] = Field(default_factory=list)
    
    # Analysis
    trend_analysis: Optional["TrendAnalysis"] = None


class AttendanceSummary(BaseSchema):
    """Attendance summary statistics"""
    total_days: int
    total_present: int
    total_absent: int
    total_late: int
    total_on_leave: int
    total_half_day: int
    
    attendance_percentage: Decimal
    late_percentage: Decimal
    
    # Streaks
    current_present_streak: int
    longest_present_streak: int
    current_absent_streak: int
    
    # Status
    attendance_status: str = Field(
        ...,
        pattern="^(excellent|good|warning|critical)$",
        description="Based on attendance percentage"
    )
    
    meets_minimum_requirement: bool


class DailyAttendanceRecord(BaseSchema):
    """Daily attendance record for report"""
    date: date
    day_of_week: str
    
    status: str
    check_in_time: Optional[time]
    check_out_time: Optional[time]
    
    is_late: bool
    late_minutes: Optional[int]
    
    notes: Optional[str]


class TrendAnalysis(BaseSchema):
    """Attendance trend analysis"""
    period_start: date
    period_end: date
    
    # Weekly trend
    weekly_attendance: List["WeeklyAttendance"]
    
    # Monthly comparison
    monthly_comparison: Optional[List["MonthlyComparison"]] = None
    
    # Patterns
    most_absent_day: Optional[str] = Field(None, description="Day of week with most absences")
    attendance_improving: bool
    improvement_rate: Optional[Decimal] = None


class WeeklyAttendance(BaseSchema):
    """Weekly attendance summary"""
    week_number: int
    week_start_date: date
    week_end_date: date
    
    total_days: int
    present_days: int
    absent_days: int
    
    attendance_percentage: Decimal


class MonthlyComparison(BaseSchema):
    """Monthly attendance comparison"""
    month: str  # YYYY-MM format
    attendance_percentage: Decimal
    total_present: int
    total_absent: int


class MonthlyReport(BaseSchema):
    """Monthly attendance report"""
    hostel_id: UUID
    month: str  # YYYY-MM
    
    # Student-wise summary
    student_summaries: List["StudentMonthlySummary"]
    
    # Hostel-wide stats
    hostel_average_attendance: Decimal
    total_students: int
    students_meeting_requirement: int
    students_below_requirement: int


class StudentMonthlySummary(BaseSchema):
    """Monthly summary for individual student"""
    student_id: UUID
    student_name: str
    room_number: Optional[str]
    
    total_days: int
    present_days: int
    absent_days: int
    late_days: int
    on_leave_days: int
    
    attendance_percentage: Decimal
    meets_requirement: bool
    
    # Actions needed
    requires_attention: bool
    action_required: Optional[str] = None


class AttendanceComparison(BaseSchema):
    """Compare attendance across students/hostels"""
    comparison_type: str = Field(..., pattern="^(student|hostel|room)$")
    period: DateRangeFilter
    
    comparisons: List["ComparisonItem"]


class ComparisonItem(BaseSchema):
    """Individual comparison item"""
    entity_id: UUID
    entity_name: str
    
    attendance_percentage: Decimal
    total_present: int
    total_absent: int
    
    rank: int
    percentile: Decimal

# --- File: D:\hostel-management-saas\app\schemas\attendance\attendance_response.py ---
"""
Attendance response schemas
"""
from datetime import date, time, datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import AttendanceStatus, AttendanceMode


class AttendanceResponse(BaseResponseSchema):
    """Attendance response schema"""
    hostel_id: UUID
    hostel_name: str
    
    student_id: UUID
    student_name: str
    room_number: Optional[str]
    
    attendance_date: date
    check_in_time: Optional[time]
    check_out_time: Optional[time]
    
    status: AttendanceStatus
    is_late: bool
    late_minutes: Optional[int]
    
    marked_by: UUID
    marked_by_name: str


class AttendanceDetail(BaseResponseSchema):
    """Detailed attendance information"""
    hostel_id: UUID
    hostel_name: str
    
    student_id: UUID
    student_name: str
    student_email: str
    student_phone: str
    room_number: Optional[str]
    
    attendance_date: date
    check_in_time: Optional[time]
    check_out_time: Optional[time]
    
    status: AttendanceStatus
    is_late: bool
    late_minutes: Optional[int]
    
    attendance_mode: AttendanceMode
    
    marked_by: UUID
    marked_by_name: str
    supervisor_id: Optional[UUID]
    supervisor_name: Optional[str]
    
    notes: Optional[str]
    
    # Location (if mobile app)
    location_lat: Optional[Decimal]
    location_lng: Optional[Decimal]
    device_info: Optional[dict]
    
    # Metadata
    created_at: datetime
    updated_at: datetime


class AttendanceListItem(BaseSchema):
    """Attendance list item"""
    id: UUID
    student_name: str
    room_number: Optional[str]
    
    attendance_date: date
    status: AttendanceStatus
    
    check_in_time: Optional[time]
    is_late: bool
    
    marked_by_name: str


class DailyAttendanceSummary(BaseSchema):
    """Daily attendance summary"""
    hostel_id: UUID
    hostel_name: str
    date: date
    
    total_students: int
    total_present: int
    total_absent: int
    total_late: int
    total_on_leave: int
    
    attendance_percentage: Decimal
    
    marked_by: UUID
    marked_by_name: str
    marking_completed: bool
    marked_at: Optional[datetime]

# --- File: D:\hostel-management-saas\app\schemas\attendance\__init__.py ---
"""
Attendance schemas package
"""
from app.schemas.attendance.attendance_base import (
    AttendanceBase,
    AttendanceCreate,
    AttendanceUpdate,
    BulkAttendanceCreate
)
from app.schemas.attendance.attendance_response import (
    AttendanceResponse,
    AttendanceDetail,
    AttendanceListItem
)
from app.schemas.attendance.attendance_record import (
    AttendanceRecordRequest,
    BulkAttendanceRequest,
    AttendanceCorrection
)
from app.schemas.attendance.attendance_report import (
    AttendanceReport,
    AttendanceSummary,
    TrendAnalysis,
    MonthlyReport
)
from app.schemas.attendance.attendance_policy import (
    AttendancePolicy,
    PolicyConfig,
    PolicyUpdate
)
from app.schemas.attendance.attendance_alert import (
    AttendanceAlert,
    AlertConfig,
    AlertTrigger
)
from app.schemas.attendance.attendance_filters import (
    AttendanceFilterParams,
    DateRangeRequest,
    AttendanceExportRequest
)

__all__ = [
    # Base
    "AttendanceBase",
    "AttendanceCreate",
    "AttendanceUpdate",
    "BulkAttendanceCreate",
    
    # Response
    "AttendanceResponse",
    "AttendanceDetail",
    "AttendanceListItem",
    
    # Record
    "AttendanceRecordRequest",
    "BulkAttendanceRequest",
    "AttendanceCorrection",
    
    # Report
    "AttendanceReport",
    "AttendanceSummary",
    "TrendAnalysis",
    "MonthlyReport",
    
    # Policy
    "AttendancePolicy",
    "PolicyConfig",
    "PolicyUpdate",
    
    # Alert
    "AttendanceAlert",
    "AlertConfig",
    "AlertTrigger",
    
    # Filters
    "AttendanceFilterParams",
    "DateRangeRequest",
    "AttendanceExportRequest",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\audit =====

# --- File: D:\hostel-management-saas\app\schemas\audit\admin_override_log.py ---
"""
Admin override audit log schemas
"""
from datetime import datetime
from typing import Any, Dict, List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema


class AdminOverrideBase(BaseSchema):
    """
    Base admin override log fields.

    Mirrors `admin_override_logs` table:
    - admin_id
    - supervisor_id (optional)
    - hostel_id
    - override_type
    - entity_type
    - entity_id
    - reason
    - original_action
    - override_action
    - created_at
    """
    admin_id: UUID = Field(..., description="Admin who performed the override")
    supervisor_id: Optional[UUID] = Field(
        None,
        description="Supervisor whose decision was overridden (if applicable)",
    )
    hostel_id: UUID = Field(..., description="Hostel where the override occurred")

    override_type: str = Field(
        ...,
        max_length=100,
        description="Type of override, e.g. 'complaint_reassignment', 'maintenance_approval'",
    )

    entity_type: str = Field(
        ...,
        max_length=50,
        description="Entity type affected, e.g. 'complaint', 'maintenance_request'",
    )
    entity_id: UUID = Field(..., description="Primary key of affected entity")

    reason: str = Field(
        ...,
        min_length=10,
        max_length=2000,
        description="Why the admin override was performed",
    )

    original_action: Optional[Dict[str, Any]] = Field(
        None,
        description="Snapshot of supervisor's original action/decision",
    )
    override_action: Dict[str, Any] = Field(
        ...,
        description="Admin's override decision, details",
    )

    created_at: datetime = Field(
        default_factory=datetime.utcnow,
        description="Timestamp when override was recorded",
    )


class AdminOverrideCreate(AdminOverrideBase, BaseCreateSchema):
    """Payload used by services to record a new admin override."""
    pass


class AdminOverrideLogResponse(BaseResponseSchema):
    """
    List item representation of an admin override log.
    Useful for audit tables, supervisor performance review, etc.
    """
    admin_id: UUID
    admin_name: Optional[str] = Field(None, description="Admin display name")

    supervisor_id: Optional[UUID]
    supervisor_name: Optional[str] = Field(None, description="Supervisor display name")

    hostel_id: UUID
    hostel_name: Optional[str] = None

    override_type: str
    entity_type: str
    entity_id: UUID

    reason: str

    created_at: datetime


class AdminOverrideDetail(BaseResponseSchema):
    """
    Detailed view of a single admin override entry,
    including original and override actions.
    """
    admin_id: UUID
    admin_name: Optional[str] = None

    supervisor_id: Optional[UUID]
    supervisor_name: Optional[str] = None

    hostel_id: UUID
    hostel_name: Optional[str] = None

    override_type: str
    entity_type: str
    entity_id: UUID

    reason: str

    original_action: Optional[Dict[str, Any]]
    override_action: Dict[str, Any]

    created_at: datetime


class AdminOverrideSummary(BaseSchema):
    """
    Summary statistics for admin overrides,
    typically for supervisor performance/oversight dashboards.
    """
    period_start: datetime
    period_end: datetime

    # Scope
    supervisor_id: Optional[UUID] = Field(
        None, description="If summarizing overrides for specific supervisor"
    )
    hostel_id: Optional[UUID] = Field(
        None, description="If summarizing for specific hostel"
    )

    # Overall stats
    total_overrides: int = Field(..., ge=0)
    overrides_by_type: Dict[str, int] = Field(
        default_factory=dict,
        description="override_type -> count",
    )
    overrides_by_admin: Dict[UUID, int] = Field(
        default_factory=dict,
        description="admin_id -> count",
    )

    # For supervisor perspective
    override_rate_for_supervisor: Optional[float] = Field(
        None,
        description="For a given supervisor: overridden_actions / total_actions",
    )


class AdminOverrideTimelinePoint(BaseSchema):
    """Time-bucketed view of overrides (e.g., by day/week)."""
    bucket_label: str = Field(..., description="e.g. '2025-01-10' or 'Week 02'")
    override_count: int = Field(..., ge=0)

# --- File: D:\hostel-management-saas\app\schemas\audit\audit_filters.py ---
"""
Audit log filtering schemas
"""
from datetime import datetime
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseFilterSchema
from app.schemas.common.enums import AuditActionCategory, UserRole
from app.schemas.common.filters import DateTimeRangeFilter


class AuditFilterParams(BaseFilterSchema):
    """Filter criteria for querying audit logs"""
    # Actor
    user_id: Optional[UUID] = None
    user_role: Optional[UserRole] = None

    # Hostel
    hostel_id: Optional[UUID] = None

    # Entity
    entity_type: Optional[str] = Field(None, max_length=50)
    entity_id: Optional[UUID] = None

    # Action
    action_type: Optional[str] = Field(None, max_length=100)
    action_category: Optional[AuditActionCategory] = None

    # Time range
    datetime_range: Optional[DateTimeRangeFilter] = None

    # Request ID
    request_id: Optional[str] = None

    # Paging
    page: int = Field(1, ge=1)
    page_size: int = Field(50, ge=1, le=200)

# --- File: D:\hostel-management-saas\app\schemas\audit\audit_log_base.py ---
"""
Base schemas for audit log entries
"""
from datetime import datetime
from typing import Optional, Dict, Any
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.enums import AuditActionCategory, UserRole


class AuditLogBase(BaseSchema):
    """Base audit log entry schema (read model)"""
    user_id: Optional[UUID] = Field(None, description="Actor user ID (if any)")
    user_role: Optional[UserRole] = Field(None, description="Actor role (if known)")

    action_type: str = Field(..., max_length=100, description="Action type identifier")
    action_category: AuditActionCategory = Field(
        AuditActionCategory.OTHER, description="High-level action category"
    )

    entity_type: Optional[str] = Field(
        None, max_length=50, description="Entity type name (e.g. 'Booking', 'Payment')"
    )
    entity_id: Optional[UUID] = Field(None, description="Primary key of affected entity")

    hostel_id: Optional[UUID] = Field(
        None, description="Hostel context (if applicable)"
    )

    description: str = Field(
        ..., max_length=2000, description="Human-readable description of action"
    )

    old_values: Optional[Dict[str, Any]] = Field(
        None, description="Previous values (for update actions)"
    )
    new_values: Optional[Dict[str, Any]] = Field(
        None, description="New values (for update actions)"
    )

    ip_address: Optional[str] = Field(None, description="IP address (if web/API call)")
    user_agent: Optional[str] = Field(None, description="User-Agent string")
    request_id: Optional[str] = Field(
        None, max_length=100, description="Correlation/request ID (for tracing)"
    )

    created_at: datetime = Field(default_factory=datetime.utcnow)


class AuditLogCreate(AuditLogBase, BaseCreateSchema):
    """Payload used by services to create a new audit log entry"""
    pass

# --- File: D:\hostel-management-saas\app\schemas\audit\audit_log_response.py ---
"""
Audit log response schemas
"""
from typing import Optional, Dict, Any
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema
from app.schemas.common.enums import AuditActionCategory, UserRole


class AuditLogResponse(BaseResponseSchema):
    """Audit log list item"""
    user_id: Optional[UUID]
    user_role: Optional[UserRole]

    action_type: str
    action_category: AuditActionCategory

    entity_type: Optional[str]
    entity_id: Optional[UUID]
    hostel_id: Optional[UUID]

    description: str

    ip_address: Optional[str]
    created_at: datetime


class AuditLogDetail(BaseResponseSchema):
    """Detailed audit log with old/new values"""
    user_id: Optional[UUID]
    user_role: Optional[UserRole]

    action_type: str
    action_category: AuditActionCategory

    entity_type: Optional[str]
    entity_id: Optional[UUID]
    hostel_id: Optional[UUID]

    description: str

    old_values: Optional[Dict[str, Any]]
    new_values: Optional[Dict[str, Any]]

    ip_address: Optional[str]
    user_agent: Optional[str]
    request_id: Optional[str]

    created_at: datetime

# --- File: D:\hostel-management-saas\app\schemas\audit\audit_reports.py ---
"""
Audit reporting schemas
"""
from datetime import datetime, date
from typing import List, Dict, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.enums import AuditActionCategory, UserRole
from app.schemas.common.filters import DateRangeFilter


class AuditSummary(BaseSchema):
    """High-level summary for audit log report"""
    period: DateRangeFilter
    total_events: int

    # Distribution
    events_by_category: Dict[AuditActionCategory, int] = Field(default_factory=dict)
    events_by_user_role: Dict[UserRole, int] = Field(default_factory=dict)

    # Top actors
    top_users_by_events: List["UserActivitySummary"] = Field(default_factory=list)


class UserActivitySummary(BaseSchema):
    """Aggregate audit activity for one user"""
    user_id: UUID
    user_name: Optional[str] = None
    user_role: Optional[UserRole] = None

    total_events: int
    events_by_category: Dict[AuditActionCategory, int] = Field(default_factory=dict)


class EntityChangeSummary(BaseSchema):
    """Summary of changes for one entity type"""
    entity_type: str
    change_count: int
    last_change_at: datetime


class EntityChangeRecord(BaseSchema):
    """Single change record for history view"""
    log_id: UUID
    action_type: str
    description: str
    old_values: Optional[dict]
    new_values: Optional[dict]
    changed_by: Optional[UUID]
    changed_by_name: Optional[str]
    changed_at: datetime


class EntityChangeHistory(BaseSchema):
    """Complete change history for a specific entity instance"""
    entity_type: str
    entity_id: UUID
    changes: List[EntityChangeRecord] = Field(default_factory=list)


class AuditReport(BaseSchema):
    """Full audit report response"""
    generated_at: datetime = Field(default_factory=datetime.utcnow)
    period: DateRangeFilter

    summary: AuditSummary
    entity_summaries: List[EntityChangeSummary] = Field(default_factory=list)

# --- File: D:\hostel-management-saas\app\schemas\audit\supervisor_activity_log.py ---
"""
Supervisor activity audit log schemas
"""
from datetime import datetime
from typing import Any, Dict, List, Optional

from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema
from app.schemas.common.filters import DateTimeRangeFilter


class SupervisorActivityBase(BaseSchema):
    """
    Base fields for supervisor activity log.

    Mirrors the `supervisor_activity_logs` table:
    - supervisor_id
    - hostel_id
    - action_type
    - action_category
    - entity_type / entity_id
    - action_description
    - metadata
    - ip_address
    - user_agent
    - created_at
    """
    supervisor_id: UUID = Field(..., description="Supervisor performing the action")
    hostel_id: UUID = Field(..., description="Hostel where action occurred")

    action_type: str = Field(
        ...,
        max_length=100,
        description="Action identifier, e.g. 'complaint_resolved', 'attendance_marked'",
    )
    action_category: str = Field(
        ...,
        pattern=(
            r"^(complaint|attendance|maintenance|menu|announcement|"
            r"student_management|other)$"
        ),
        description="High-level category of action",
    )

    entity_type: Optional[str] = Field(
        None, max_length=50, description="Entity type, e.g. 'complaint', 'attendance'"
    )
    entity_id: Optional[UUID] = Field(
        None, description="ID of the entity affected (if applicable)"
    )

    action_description: str = Field(
        ...,
        max_length=2000,
        description="Human-readable description of the action",
    )

    metadata: Dict[str, Any] = Field(
        default_factory=dict,
        description="Extra details/context for the action (JSON)",
    )

    ip_address: Optional[str] = Field(
        None,
        description="IP address from which the action originated (if tracked)",
    )
    user_agent: Optional[str] = Field(
        None,
        description="User-Agent string from supervisor's device (if tracked)",
    )

    created_at: datetime = Field(
        default_factory=datetime.utcnow,
        description="Timestamp when the action was logged",
    )


class SupervisorActivityCreate(SupervisorActivityBase, BaseCreateSchema):
    """Used by services to record a new supervisor activity log entry."""
    pass


class SupervisorActivityLogResponse(BaseResponseSchema):
    """
    List item representation of supervisor activity log.
    Suitable for tables or basic activity feeds.
    """
    supervisor_id: UUID
    supervisor_name: Optional[str] = Field(
        None, description="Supervisor display name (if joined in query)"
    )
    hostel_id: UUID
    hostel_name: Optional[str] = Field(
        None, description="Hostel display name (if joined in query)"
    )

    action_type: str
    action_category: str

    entity_type: Optional[str]
    entity_id: Optional[UUID]

    action_description: str

    created_at: datetime
    ip_address: Optional[str]
    user_agent: Optional[str]


class SupervisorActivityDetail(BaseResponseSchema):
    """
    Detailed view of a single supervisor activity entry,
    including full metadata.
    """
    supervisor_id: UUID
    supervisor_name: Optional[str] = None
    hostel_id: UUID
    hostel_name: Optional[str] = None

    action_type: str
    action_category: str

    entity_type: Optional[str]
    entity_id: Optional[UUID]

    action_description: str
    metadata: Dict[str, Any]

    ip_address: Optional[str]
    user_agent: Optional[str]
    created_at: datetime


class SupervisorActivityFilter(BaseSchema):
    """
    Filter criteria for querying supervisor activity logs.
    Typically used as a body/query schema for list endpoints.
    """
    supervisor_id: Optional[UUID] = None
    hostel_id: Optional[UUID] = None

    action_type: Optional[str] = Field(None, max_length=100)
    action_category: Optional[str] = Field(
        None,
        pattern=(
            r"^(complaint|attendance|maintenance|menu|announcement|"
            r"student_management|other)$"
        ),
    )

    entity_type: Optional[str] = Field(None, max_length=50)
    entity_id: Optional[UUID] = None

    datetime_range: Optional[DateTimeRangeFilter] = None

    # Pagination
    page: int = Field(1, ge=1)
    page_size: int = Field(50, ge=1, le=200)


class SupervisorActivitySummary(BaseSchema):
    """
    Summary statistics for a supervisor's activity over a period.
    Useful for performance dashboards.
    """
    supervisor_id: UUID
    supervisor_name: Optional[str] = None
    hostel_id: UUID
    hostel_name: Optional[str] = None

    period_start: datetime
    period_end: datetime

    total_actions: int
    actions_by_category: Dict[str, int] = Field(
        default_factory=dict,
        description="Category -> count",
    )
    actions_by_type: Dict[str, int] = Field(
        default_factory=dict,
        description="Action type -> count",
    )

    # For trending / charts (optional)
    timeline: List["SupervisorActivityTimelinePoint"] = Field(
        default_factory=list,
        description="Activity over time",
    )


class SupervisorActivityTimelinePoint(BaseSchema):
    """Time-bucketed count of supervisor actions (e.g., daily/weekly)."""
    bucket_label: str = Field(
        ...,
        description="Label for the time bucket (e.g. '2025-01-15', 'Week 12')",
    )
    action_count: int = Field(..., ge=0)

# --- File: D:\hostel-management-saas\app\schemas\audit\__init__.py ---
"""
Audit & logging schemas package
"""

from app.schemas.audit.audit_log_base import (
    AuditLogBase,
    AuditLogCreate,
)
from app.schemas.audit.audit_log_response import (
    AuditLogResponse,
    AuditLogDetail,
)
from app.schemas.audit.audit_filters import (
    AuditFilterParams,
)
from app.schemas.audit.audit_reports import (
    AuditReport,
    AuditSummary,
    UserActivitySummary,
    EntityChangeHistory,
)
from app.schemas.audit.supervisor_activity_log import (
    SupervisorActivityBase,
    SupervisorActivityCreate,
    SupervisorActivityLogResponse,
    SupervisorActivityDetail,
    SupervisorActivityFilter,
    SupervisorActivitySummary,
    SupervisorActivityTimelinePoint,
)

from app.schemas.audit.admin_override_log import (
    AdminOverrideBase,
    AdminOverrideCreate,
    AdminOverrideLogResponse,
    AdminOverrideDetail,
    AdminOverrideSummary,
    AdminOverrideTimelinePoint,
)

__all__ = [
    # Base
    "AuditLogBase",
    "AuditLogCreate",
    # Response
    "AuditLogResponse",
    "AuditLogDetail",
    # Filters
    "AuditFilterParams",
    # Reports
    "AuditReport",
    "AuditSummary",
    "UserActivitySummary",
    "EntityChangeHistory",
    # Supervisor Activity
    "SupervisorActivityBase",
    "SupervisorActivityCreate",
    "SupervisorActivityLogResponse",
    "SupervisorActivityDetail",
    "SupervisorActivityFilter",
    "SupervisorActivitySummary",
    "SupervisorActivityTimelinePoint",
    # Admin Override
    "AdminOverrideBase",
    "AdminOverrideCreate",
    "AdminOverrideLogResponse",
    "AdminOverrideDetail",
    "AdminOverrideSummary",
    "AdminOverrideTimelinePoint",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\auth =====

# --- File: D:\hostel-management-saas\app\schemas\auth\login.py ---
"""
Login schemas
"""
from typing import Optional
from pydantic import EmailStr, Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.enums import UserRole


class LoginRequest(BaseCreateSchema):
    """Login request schema"""
    email: EmailStr = Field(..., description="User email address")
    password: str = Field(..., min_length=8, max_length=128, description="User password")
    remember_me: bool = Field(False, description="Remember user session")


class PhoneLoginRequest(BaseCreateSchema):
    """Phone-based login request"""
    phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$', description="Phone number")
    password: str = Field(..., min_length=8, max_length=128, description="User password")
    remember_me: bool = Field(False, description="Remember user session")


class TokenData(BaseSchema):
    """Token data embedded in JWT"""
    user_id: UUID = Field(..., description="User unique identifier")
    email: str = Field(..., description="User email")
    role: UserRole = Field(..., description="User role")
    hostel_id: Optional[UUID] = Field(None, description="Active hostel context (for multi-hostel admins)")


class LoginResponse(BaseSchema):
    """Login response schema"""
    access_token: str = Field(..., description="JWT access token")
    refresh_token: str = Field(..., description="JWT refresh token")
    token_type: str = Field("bearer", description="Token type")
    expires_in: int = Field(..., description="Token expiration time in seconds")
    user: "UserLoginInfo" = Field(..., description="User information")


class UserLoginInfo(BaseSchema):
    """User information in login response"""
    id: UUID = Field(..., description="User ID")
    email: str = Field(..., description="User email")
    full_name: str = Field(..., description="User full name")
    role: UserRole = Field(..., description="User role")
    is_email_verified: bool = Field(..., description="Email verification status")
    is_phone_verified: bool = Field(..., description="Phone verification status")
    profile_image_url: Optional[str] = Field(None, description="Profile image URL")

# --- File: D:\hostel-management-saas\app\schemas\auth\otp.py ---
"""
OTP (One-Time Password) schemas
"""
from typing import Optional
from pydantic import EmailStr, Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.enums import OTPType


class OTPGenerateRequest(BaseCreateSchema):
    """Generate OTP request"""
    user_id: Optional[UUID] = Field(None, description="User ID (if authenticated)")
    email: Optional[EmailStr] = Field(None, description="Email address")
    phone: Optional[str] = Field(None, pattern=r'^\+?[1-9]\d{9,14}$', description="Phone number")
    otp_type: OTPType = Field(..., description="OTP purpose")
    
    @field_validator('email', 'phone')
    @classmethod
    def at_least_one_contact(cls, v, info):
        """Ensure at least email or phone is provided"""
        email = info.data.get('email')
        phone = info.data.get('phone')
        if not email and not phone:
            raise ValueError('Either email or phone must be provided')
        return v


class OTPVerifyRequest(BaseCreateSchema):
    """Verify OTP request"""
    user_id: Optional[UUID] = Field(None, description="User ID")
    email: Optional[EmailStr] = Field(None, description="Email address")
    phone: Optional[str] = Field(None, pattern=r'^\+?[1-9]\d{9,14}$', description="Phone number")
    otp_code: str = Field(..., min_length=6, max_length=6, pattern=r'^\d{6}$', description="6-digit OTP code")
    otp_type: OTPType = Field(..., description="OTP purpose")


class OTPResponse(BaseSchema):
    """OTP generation response"""
    message: str = Field(..., description="Response message")
    expires_in: int = Field(..., description="OTP expiration time in seconds")
    sent_to: str = Field(..., description="Masked email/phone where OTP was sent")
    otp_type: OTPType = Field(..., description="OTP type")
    max_attempts: int = Field(3, description="Maximum verification attempts")


class OTPVerifyResponse(BaseSchema):
    """OTP verification response"""
    is_valid: bool = Field(..., description="Whether OTP is valid")
    message: str = Field(..., description="Response message")
    verified_at: Optional[datetime] = Field(None, description="Verification timestamp")
    user_id: Optional[UUID] = Field(None, description="User ID if applicable")


class ResendOTPRequest(BaseCreateSchema):
    """Resend OTP request"""
    user_id: Optional[UUID] = Field(None, description="User ID")
    email: Optional[EmailStr] = Field(None, description="Email address")
    phone: Optional[str] = Field(None, description="Phone number")
    otp_type: OTPType = Field(..., description="OTP purpose")

# --- File: D:\hostel-management-saas\app\schemas\auth\password.py ---
"""
Password management schemas
"""
from typing import Optional
from pydantic import EmailStr, Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class PasswordResetRequest(BaseCreateSchema):
    """Password reset request (forgot password)"""
    email: EmailStr = Field(..., description="User email address")


class PasswordResetConfirm(BaseCreateSchema):
    """Confirm password reset with token"""
    token: str = Field(..., description="Password reset token")
    new_password: str = Field(..., min_length=8, max_length=128, description="New password")
    confirm_password: str = Field(..., description="Confirm new password")
    
    @field_validator('confirm_password')
    @classmethod
    def passwords_match(cls, v: str, info) -> str:
        """Validate passwords match"""
        if 'new_password' in info.data and v != info.data['new_password']:
            raise ValueError('Passwords do not match')
        return v
    
    @field_validator('new_password')
    @classmethod
    def validate_password_strength(cls, v: str) -> str:
        """Validate password strength"""
        if len(v) < 8:
            raise ValueError('Password must be at least 8 characters long')
        if not any(char.isdigit() for char in v):
            raise ValueError('Password must contain at least one digit')
        if not any(char.isupper() for char in v):
            raise ValueError('Password must contain at least one uppercase letter')
        if not any(char.islower() for char in v):
            raise ValueError('Password must contain at least one lowercase letter')
        if not any(char in '!@#$%^&*()_+-=[]{}|;:,.<>?' for char in v):
            raise ValueError('Password must contain at least one special character')
        return v


class PasswordChangeRequest(BaseCreateSchema):
    """Change password (authenticated user)"""
    current_password: str = Field(..., description="Current password")
    new_password: str = Field(..., min_length=8, max_length=128, description="New password")
    confirm_password: str = Field(..., description="Confirm new password")
    
    @field_validator('confirm_password')
    @classmethod
    def passwords_match(cls, v: str, info) -> str:
        """Validate passwords match"""
        if 'new_password' in info.data and v != info.data['new_password']:
            raise ValueError('Passwords do not match')
        return v
    
    @field_validator('new_password')
    @classmethod
    def validate_password_different(cls, v: str, info) -> str:
        """Ensure new password is different from current"""
        if 'current_password' in info.data and v == info.data['current_password']:
            raise ValueError('New password must be different from current password')
        return v


class PasswordChangeResponse(BaseSchema):
    """Password change response"""
    message: str = Field(..., description="Success message")
    user_id: UUID = Field(..., description="User ID")


class PasswordStrengthCheck(BaseCreateSchema):
    """Check password strength"""
    password: str = Field(..., description="Password to check")


class PasswordStrengthResponse(BaseSchema):
    """Password strength response"""
    score: int = Field(..., ge=0, le=5, description="Strength score (0-5)")
    strength: str = Field(..., description="Strength label (weak/medium/strong/very_strong)")
    has_minimum_length: bool = Field(..., description="Has minimum 8 characters")
    has_uppercase: bool = Field(..., description="Has uppercase letter")
    has_lowercase: bool = Field(..., description="Has lowercase letter")
    has_digit: bool = Field(..., description="Has digit")
    has_special_char: bool = Field(..., description="Has special character")
    suggestions: list[str] = Field(default_factory=list, description="Improvement suggestions")

# --- File: D:\hostel-management-saas\app\schemas\auth\register.py ---
"""
Registration schemas
"""
from typing import Optional
from pydantic import EmailStr, Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.enums import UserRole, Gender


class RegisterRequest(BaseCreateSchema):
    """User registration request"""
    email: EmailStr = Field(..., description="Email address")
    phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$', description="Phone number")
    password: str = Field(..., min_length=8, max_length=128, description="Password")
    confirm_password: str = Field(..., description="Password confirmation")
    full_name: str = Field(..., min_length=2, max_length=255, description="Full name")
    role: UserRole = Field(UserRole.VISITOR, description="User role (defaults to visitor)")
    gender: Optional[Gender] = Field(None, description="Gender")
    date_of_birth: Optional[date] = Field(None, description="Date of birth")
    
    @field_validator('confirm_password')
    @classmethod
    def passwords_match(cls, v: str, info) -> str:
        """Validate passwords match"""
        if 'password' in info.data and v != info.data['password']:
            raise ValueError('Passwords do not match')
        return v
    
    @field_validator('password')
    @classmethod
    def validate_password_strength(cls, v: str) -> str:
        """Validate password strength"""
        if len(v) < 8:
            raise ValueError('Password must be at least 8 characters long')
        if not any(char.isdigit() for char in v):
            raise ValueError('Password must contain at least one digit')
        if not any(char.isupper() for char in v):
            raise ValueError('Password must contain at least one uppercase letter')
        if not any(char.islower() for char in v):
            raise ValueError('Password must contain at least one lowercase letter')
        return v


class RegisterResponse(BaseSchema):
    """Registration response"""
    user_id: UUID = Field(..., description="Created user ID")
    email: str = Field(..., description="User email")
    full_name: str = Field(..., description="User full name")
    role: UserRole = Field(..., description="User role")
    message: str = Field(..., description="Success message")
    verification_required: bool = Field(True, description="Whether email/phone verification is required")


class VerifyEmailRequest(BaseCreateSchema):
    """Email verification request"""
    user_id: UUID = Field(..., description="User ID")
    verification_code: str = Field(..., min_length=6, max_length=6, description="6-digit verification code")


class VerifyPhoneRequest(BaseCreateSchema):
    """Phone verification request"""
    user_id: UUID = Field(..., description="User ID")
    verification_code: str = Field(..., min_length=6, max_length=6, description="6-digit verification code")


class ResendVerificationRequest(BaseCreateSchema):
    """Resend verification code request"""
    user_id: UUID = Field(..., description="User ID")
    verification_type: str = Field(..., pattern="^(email|phone)$", description="Verification type")

# --- File: D:\hostel-management-saas\app\schemas\auth\social_auth.py ---
"""
Social authentication schemas (Google, Facebook OAuth)
"""
from typing import Optional
from pydantic import EmailStr, Field, HttpUrl

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.enums import UserRole, Gender


class SocialAuthRequest(BaseCreateSchema):
    """Base social authentication request"""
    access_token: str = Field(..., description="OAuth access token from provider")
    provider: str = Field(..., pattern="^(google|facebook)$", description="OAuth provider")


class GoogleAuthRequest(BaseCreateSchema):
    """Google OAuth authentication request"""
    id_token: str = Field(..., description="Google ID token")
    access_token: Optional[str] = Field(None, description="Google access token")


class FacebookAuthRequest(BaseCreateSchema):
    """Facebook OAuth authentication request"""
    access_token: str = Field(..., description="Facebook access token")
    user_id: str = Field(..., description="Facebook user ID")


class SocialAuthResponse(BaseSchema):
    """Social authentication response"""
    access_token: str = Field(..., description="JWT access token")
    refresh_token: str = Field(..., description="JWT refresh token")
    token_type: str = Field("bearer", description="Token type")
    expires_in: int = Field(..., description="Token expiration in seconds")
    user: "SocialUserInfo" = Field(..., description="User information")
    is_new_user: bool = Field(..., description="Whether this is a new user registration")


class SocialUserInfo(BaseSchema):
    """User information from social auth"""
    id: UUID = Field(..., description="User ID")
    email: str = Field(..., description="User email")
    full_name: str = Field(..., description="User full name")
    role: UserRole = Field(..., description="User role")
    profile_image_url: Optional[str] = Field(None, description="Profile image URL")
    is_email_verified: bool = Field(True, description="Email verification status")


class SocialProfileData(BaseSchema):
    """Profile data from social provider"""
    provider_user_id: str = Field(..., description="User ID from provider")
    email: EmailStr = Field(..., description="Email from provider")
    full_name: str = Field(..., description="Full name from provider")
    first_name: Optional[str] = Field(None, description="First name")
    last_name: Optional[str] = Field(None, description="Last name")
    profile_picture_url: Optional[HttpUrl] = Field(None, description="Profile picture URL")
    gender: Optional[Gender] = Field(None, description="Gender")
    locale: Optional[str] = Field(None, description="User locale")

# --- File: D:\hostel-management-saas\app\schemas\auth\token.py ---
"""
Token management schemas
"""
from datetime import datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.enums import UserRole


class Token(BaseSchema):
    """JWT token schema"""
    access_token: str = Field(..., description="JWT access token")
    refresh_token: str = Field(..., description="JWT refresh token")
    token_type: str = Field("bearer", description="Token type")
    expires_in: int = Field(..., description="Token expiration time in seconds")


class TokenPayload(BaseSchema):
    """JWT token payload"""
    sub: str = Field(..., description="Subject (user_id)")
    user_id: UUID = Field(..., description="User ID")
    email: str = Field(..., description="User email")
    role: UserRole = Field(..., description="User role")
    hostel_id: Optional[UUID] = Field(None, description="Active hostel context")
    exp: int = Field(..., description="Expiration timestamp")
    iat: int = Field(..., description="Issued at timestamp")
    jti: str = Field(..., description="JWT ID (unique token identifier)")


class RefreshTokenRequest(BaseCreateSchema):
    """Refresh token request"""
    refresh_token: str = Field(..., description="Refresh token")


class RefreshTokenResponse(BaseSchema):
    """Refresh token response"""
    access_token: str = Field(..., description="New JWT access token")
    refresh_token: str = Field(..., description="New refresh token")
    token_type: str = Field("bearer", description="Token type")
    expires_in: int = Field(..., description="Token expiration time in seconds")


class TokenValidationRequest(BaseCreateSchema):
    """Token validation request"""
    token: str = Field(..., description="Token to validate")


class TokenValidationResponse(BaseSchema):
    """Token validation response"""
    is_valid: bool = Field(..., description="Whether token is valid")
    user_id: Optional[UUID] = Field(None, description="User ID if valid")
    role: Optional[UserRole] = Field(None, description="User role if valid")
    expires_at: Optional[datetime] = Field(None, description="Token expiration datetime")


class RevokeTokenRequest(BaseCreateSchema):
    """Revoke token request"""
    token: str = Field(..., description="Token to revoke")
    revoke_all: bool = Field(False, description="Revoke all user tokens")


class LogoutRequest(BaseCreateSchema):
    """Logout request"""
    refresh_token: Optional[str] = Field(None, description="Refresh token to revoke")
    logout_all_devices: bool = Field(False, description="Logout from all devices")

# --- File: D:\hostel-management-saas\app\schemas\auth\__init__.py ---
"""
Authentication schemas package
"""
from app.schemas.auth.login import (
    LoginRequest,
    LoginResponse,
    TokenData
)
from app.schemas.auth.register import (
    RegisterRequest,
    RegisterResponse,
    VerifyEmailRequest,
    VerifyPhoneRequest
)
from app.schemas.auth.token import (
    Token,
    TokenPayload,
    RefreshTokenRequest,
    RefreshTokenResponse
)
from app.schemas.auth.password import (
    PasswordResetRequest,
    PasswordResetConfirm,
    PasswordChangeRequest,
    PasswordChangeResponse
)
from app.schemas.auth.otp import (
    OTPGenerateRequest,
    OTPVerifyRequest,
    OTPResponse
)
from app.schemas.auth.social_auth import (
    SocialAuthRequest,
    SocialAuthResponse,
    GoogleAuthRequest,
    FacebookAuthRequest
)

__all__ = [
    # Login
    "LoginRequest",
    "LoginResponse",
    "TokenData",
    
    # Register
    "RegisterRequest",
    "RegisterResponse",
    "VerifyEmailRequest",
    "VerifyPhoneRequest",
    
    # Token
    "Token",
    "TokenPayload",
    "RefreshTokenRequest",
    "RefreshTokenResponse",
    
    # Password
    "PasswordResetRequest",
    "PasswordResetConfirm",
    "PasswordChangeRequest",
    "PasswordChangeResponse",
    
    # OTP
    "OTPGenerateRequest",
    "OTPVerifyRequest",
    "OTPResponse",
    
    # Social Auth
    "SocialAuthRequest",
    "SocialAuthResponse",
    "GoogleAuthRequest",
    "FacebookAuthRequest",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\booking =====

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_approval.py ---
"""
Booking approval schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema


class BookingApprovalRequest(BaseCreateSchema):
    """Approve booking request"""
    booking_id: UUID = Field(..., description="Booking ID to approve")
    
    # Room assignment
    room_id: UUID = Field(..., description="Assigned room")
    bed_id: UUID = Field(..., description="Assigned bed")
    
    # Confirm or adjust dates
    approved_check_in_date: date = Field(..., description="Approved check-in date")
    
    # Confirm or adjust pricing
    final_rent_monthly: Decimal = Field(..., ge=0, description="Final monthly rent")
    final_security_deposit: Decimal = Field(..., ge=0, description="Final security deposit")
    
    # Additional charges
    processing_fee: Decimal = Field(Decimal("0.00"), ge=0, description="One-time processing fee")
    
    # Notes
    admin_notes: Optional[str] = Field(None, max_length=500, description="Internal notes")
    message_to_guest: Optional[str] = Field(None, max_length=1000, description="Message to guest")
    
    # Payment requirement
    advance_payment_required: bool = Field(True, description="Require advance payment")
    advance_payment_percentage: Decimal = Field(
        Decimal("20.00"),
        ge=0,
        le=100,
        description="Advance payment %"
    )


class ApprovalResponse(BaseSchema):
    """Booking approval response"""
    booking_id: UUID
    booking_reference: str
    
    status: str = Field("approved", description="New status")
    
    # Assignment details
    room_number: str
    bed_number: str
    
    # Final amounts
    monthly_rent: Decimal
    security_deposit: Decimal
    advance_amount: Decimal
    total_amount: Decimal
    
    # Dates
    approved_at: datetime
    check_in_date: date
    
    # Next steps
    payment_pending: bool
    payment_deadline: Optional[datetime]
    
    message: str


class RejectionRequest(BaseCreateSchema):
    """Reject booking request"""
    booking_id: UUID = Field(..., description="Booking ID to reject")
    rejection_reason: str = Field(..., min_length=10, max_length=500, description="Reason for rejection")
    
    # Suggest alternatives
    suggest_alternative_dates: bool = Field(False)
    alternative_check_in_dates: Optional[list[date]] = Field(None, max_items=3)
    
    suggest_alternative_room_types: bool = Field(False)
    alternative_room_types: Optional[list[str]] = None
    
    # Message to guest
    message_to_guest: Optional[str] = Field(None, max_length=1000)


class BulkApprovalRequest(BaseCreateSchema):
    """Approve multiple bookings"""
    booking_ids: list[UUID] = Field(..., min_items=1, description="Booking IDs to approve")
    
    # Common settings
    auto_assign_rooms: bool = Field(True, description="Auto-assign available rooms")
    send_notifications: bool = Field(True, description="Send approval notifications")


class ApprovalSettings(BaseSchema):
    """Hostel booking approval settings"""
    hostel_id: UUID
    
    auto_approve_enabled: bool = Field(False, description="Auto-approve bookings")
    auto_approve_conditions: dict = Field(
        default_factory=dict,
        description="Conditions for auto-approval"
    )
    
    approval_expiry_hours: int = Field(48, ge=1, le=168, description="Hours to respond to booking")
    
    require_advance_payment: bool = Field(True)
    advance_payment_percentage: Decimal = Field(Decimal("20.00"), ge=0, le=100)

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_assignment.py ---
"""
Booking room and bed assignment schemas
"""
from datetime import date
from typing import Optional, List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class RoomAssignment(BaseSchema):
    """Room assignment for booking"""
    booking_id: UUID
    booking_reference: str
    
    hostel_id: UUID
    room_id: UUID
    room_number: str
    room_type: str
    
    assigned_by: UUID
    assigned_by_name: str
    assigned_at: datetime
    
    check_in_date: date


class BedAssignment(BaseSchema):
    """Bed assignment for booking"""
    booking_id: UUID
    booking_reference: str
    
    room_id: UUID
    room_number: str
    bed_id: UUID
    bed_number: str
    
    assigned_by: UUID
    assigned_by_name: str
    assigned_at: datetime


class AssignmentRequest(BaseCreateSchema):
    """Assign room and bed to booking"""
    booking_id: UUID = Field(..., description="Booking ID")
    room_id: UUID = Field(..., description="Room to assign")
    bed_id: UUID = Field(..., description="Bed to assign")
    
    # Override check-in date if needed
    override_check_in_date: Optional[date] = Field(None, description="Override preferred check-in date")
    
    notes: Optional[str] = Field(None, max_length=500, description="Assignment notes")


class BulkAssignmentRequest(BaseCreateSchema):
    """Bulk assign rooms to multiple bookings"""
    assignments: List["SingleAssignment"] = Field(..., min_items=1, description="List of assignments")
    
    auto_approve: bool = Field(False, description="Auto-approve after assignment")


class SingleAssignment(BaseSchema):
    """Single assignment in bulk operation"""
    booking_id: UUID
    room_id: UUID
    bed_id: UUID


class AssignmentResponse(BaseSchema):
    """Assignment response"""
    booking_id: UUID
    booking_reference: str
    
    room_assigned: bool
    room_number: Optional[str]
    bed_number: Optional[str]
    
    message: str
    next_steps: List[str]


class ReassignmentRequest(BaseCreateSchema):
    """Reassign booking to different room/bed"""
    booking_id: UUID
    current_room_id: UUID
    new_room_id: UUID
    new_bed_id: UUID
    
    reason: str = Field(..., min_length=10, max_length=500)
    notify_guest: bool = Field(True)

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_base.py ---
"""
Booking base schemas
"""
from datetime import date
from decimal import Decimal
from typing import Optional
from pydantic import Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import BookingStatus, RoomType, BookingSource


class BookingBase(BaseSchema):
    """Base booking schema"""
    visitor_id: UUID = Field(..., description="Visitor/guest making booking")
    hostel_id: UUID = Field(..., description="Hostel being booked")
    
    # Booking details
    room_type_requested: RoomType = Field(..., description="Requested room type")
    preferred_check_in_date: date = Field(..., description="Preferred check-in date")
    stay_duration_months: int = Field(..., ge=1, le=24, description="Stay duration in months")
    
    # Pricing
    quoted_rent_monthly: Decimal = Field(..., ge=0, description="Quoted monthly rent")
    total_amount: Decimal = Field(..., ge=0, description="Total amount")
    security_deposit: Decimal = Field(Decimal("0.00"), ge=0, description="Security deposit")
    advance_amount: Decimal = Field(Decimal("0.00"), ge=0, description="Advance payment amount")
    
    # Special requests
    special_requests: Optional[str] = Field(None, max_length=1000, description="Special requests")
    dietary_preferences: Optional[str] = Field(None, max_length=255, description="Dietary preferences")
    has_vehicle: bool = Field(False, description="Has vehicle")
    vehicle_details: Optional[str] = Field(None, max_length=255, description="Vehicle details")
    
    # Source
    source: BookingSource = Field(BookingSource.WEBSITE, description="Booking source")
    referral_code: Optional[str] = Field(None, max_length=50, description="Referral code used")
    
    @field_validator('total_amount')
    @classmethod
    def validate_total_amount(cls, v: Decimal, info) -> Decimal:
        """Validate total amount calculation"""
        if 'quoted_rent_monthly' in info.data and 'stay_duration_months' in info.data:
            expected = info.data['quoted_rent_monthly'] * info.data['stay_duration_months']
            if abs(v - expected) > Decimal('0.01'):  # Allow small floating point differences
                raise ValueError(f'Total amount should be approximately {expected}')
        return v


class BookingCreate(BookingBase, BaseCreateSchema):
    """Create booking schema"""
    # Guest information embedded
    guest_name: str = Field(..., min_length=2, max_length=255)
    guest_email: str = Field(...)
    guest_phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$')
    
    # Optional ID proof
    guest_id_proof_type: Optional[str] = None
    guest_id_proof_number: Optional[str] = None
    
    # Emergency contact
    emergency_contact_name: Optional[str] = None
    emergency_contact_phone: Optional[str] = None
    emergency_contact_relation: Optional[str] = None
    
    # Institutional/employment
    institution_or_company: Optional[str] = None
    designation_or_course: Optional[str] = None


class BookingUpdate(BaseUpdateSchema):
    """Update booking schema"""
    room_type_requested: Optional[RoomType] = None
    preferred_check_in_date: Optional[date] = None
    stay_duration_months: Optional[int] = Field(None, ge=1, le=24)
    
    special_requests: Optional[str] = None
    dietary_preferences: Optional[str] = None
    has_vehicle: Optional[bool] = None
    vehicle_details: Optional[str] = None
    
    # Status updates (admin only)
    booking_status: Optional[BookingStatus] = None

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_calendar.py ---
"""
Booking calendar schemas
"""
from datetime import date, datetime
from typing import List, Dict, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.enums import BookingStatus


class CalendarView(BaseSchema):
    """Calendar view of bookings"""
    hostel_id: UUID
    month: str = Field(..., description="Month in YYYY-MM format")
    
    # Calendar data
    days: Dict[str, "DayBookings"] = Field(..., description="Bookings by date")
    
    # Summary
    total_check_ins: int
    total_check_outs: int
    peak_occupancy_date: Optional[date]
    
    # Room availability summary
    available_rooms_by_date: Dict[str, int]


class DayBookings(BaseSchema):
    """Bookings for a specific day"""
    date: date
    
    check_ins: List["BookingEvent"] = Field(default_factory=list)
    check_outs: List["BookingEvent"] = Field(default_factory=list)
    pending_bookings: List["BookingEvent"] = Field(default_factory=list)
    
    available_beds: int
    total_beds: int


class BookingEvent(BaseSchema):
    """Booking event for calendar"""
    booking_id: UUID
    booking_reference: str
    guest_name: str
    room_number: Optional[str]
    room_type: str
    status: BookingStatus
    
    # For check-in events
    is_check_in: bool = Field(False)
    # For check-out events  
    is_check_out: bool = Field(False)


class CalendarEvent(BaseSchema):
    """Generic calendar event"""
    event_id: UUID
    event_type: str = Field(..., pattern="^(check_in|check_out|booking_request|maintenance)$")
    title: str
    start_date: date
    end_date: Optional[date]
    
    # Related entities
    booking_id: Optional[UUID] = None
    room_id: Optional[UUID] = None
    
    # Display
    color: str = Field(..., description="Color code for event")
    is_all_day: bool = Field(True)


class AvailabilityCalendar(BaseSchema):
    """Room availability calendar"""
    hostel_id: UUID
    room_id: Optional[UUID] = Field(None, description="Specific room or all rooms")
    month: str = Field(..., description="YYYY-MM")
    
    availability: Dict[str, "DayAvailability"]


class DayAvailability(BaseSchema):
    """Availability for a specific day"""
    date: date
    total_beds: int
    available_beds: int
    booked_beds: int
    is_fully_booked: bool
    
    # Bookings for this day
    active_bookings: List[UUID] = Field(default_factory=list)

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_cancellation.py ---
"""
Booking cancellation schemas
"""
from datetime import datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class CancellationRequest(BaseCreateSchema):
    """Request to cancel booking"""
    booking_id: UUID = Field(..., description="Booking ID to cancel")
    cancelled_by_role: str = Field(
        ...,
        pattern="^(visitor|admin|system)$",
        description="Who is cancelling"
    )
    
    cancellation_reason: str = Field(
        ...,
        min_length=10,
        max_length=500,
        description="Reason for cancellation"
    )
    
    # Refund preference
    request_refund: bool = Field(True, description="Request refund of advance payment")
    
    # Additional details
    additional_comments: Optional[str] = Field(None, max_length=1000)


class CancellationResponse(BaseSchema):
    """Cancellation response"""
    booking_id: UUID
    booking_reference: str
    
    cancelled: bool
    cancelled_at: datetime
    
    # Refund information
    refund: "RefundCalculation"
    
    message: str
    confirmation_sent: bool


class RefundCalculation(BaseSchema):
    """Refund calculation details"""
    advance_paid: Decimal
    cancellation_charge: Decimal
    cancellation_charge_percentage: Decimal
    
    refundable_amount: Decimal
    refund_processing_time_days: int
    
    # Refund method
    refund_method: str = Field(..., description="How refund will be processed")
    
    # Breakdown
    breakdown: dict = Field(
        ...,
        description="Detailed refund breakdown"
    )


class CancellationPolicy(BaseSchema):
    """Hostel cancellation policy"""
    hostel_id: UUID
    
    # Charges based on timing
    cancellation_before_days: List["CancellationCharge"] = Field(
        ...,
        description="Cancellation charges based on days before check-in"
    )
    
    # Special conditions
    no_show_charge_percentage: Decimal = Field(
        Decimal("100.00"),
        description="Charge if guest doesn't show up"
    )
    
    refund_processing_days: int = Field(7, description="Days to process refund")
    
    policy_text: str = Field(..., description="Full policy text")


class CancellationCharge(BaseSchema):
    """Cancellation charge tier"""
    days_before_checkin: int = Field(..., description="Days before check-in")
    charge_percentage: Decimal = Field(..., ge=0, le=100, description="% of advance to charge")
    
    description: str


class BulkCancellation(BaseCreateSchema):
    """Cancel multiple bookings"""
    booking_ids: List[UUID] = Field(..., min_items=1)
    reason: str = Field(..., min_length=10)
    process_refunds: bool = Field(True)

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_conversion.py ---
"""
Booking to student conversion schemas
"""
from datetime import date
from typing import Optional, List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class ConvertToStudentRequest(BaseCreateSchema):
    """Convert confirmed booking to student profile"""
    booking_id: UUID = Field(..., description="Booking ID to convert")
    
    # Check-in details
    actual_check_in_date: date = Field(..., description="Actual check-in date")
    
    # Financial confirmation
    security_deposit_paid: bool = Field(..., description="Security deposit paid")
    first_month_rent_paid: bool = Field(..., description="First month rent paid")
    
    # Additional student details (if not in booking)
    student_id_number: Optional[str] = None
    guardian_address: Optional[str] = None
    
    # Documents uploaded
    id_proof_uploaded: bool = Field(False)
    photo_uploaded: bool = Field(False)
    
    notes: Optional[str] = Field(None, max_length=500, description="Conversion notes")


class ConversionResponse(BaseSchema):
    """Conversion response"""
    booking_id: UUID
    student_profile_id: UUID
    
    converted: bool
    conversion_date: date
    
    # Room assignment
    room_number: str
    bed_number: str
    
    # Financial setup
    monthly_rent: Decimal
    security_deposit: Decimal
    next_payment_due_date: date
    
    message: str
    next_steps: List[str]


class ConversionChecklist(BaseSchema):
    """Pre-conversion checklist"""
    booking_id: UUID
    booking_reference: str
    
    # Checklist items
    checks: List["ChecklistItem"]
    
    all_checks_passed: bool
    can_convert: bool
    
    missing_items: List[str]


class ChecklistItem(BaseSchema):
    """Individual checklist item"""
    item_name: str
    description: str
    is_completed: bool
    is_required: bool
    completed_at: Optional[datetime] = None
    notes: Optional[str] = None


class BulkConversion(BaseCreateSchema):
    """Convert multiple bookings to students"""
    booking_ids: List[UUID] = Field(..., min_items=1)
    conversion_date: date
    
    # Common financial confirmation
    all_deposits_paid: bool
    all_first_rents_paid: bool


class ConversionRollback(BaseCreateSchema):
    """Rollback conversion (emergency only)"""
    student_profile_id: UUID
    reason: str = Field(..., min_length=20, max_length=500)
    
    # What to do with data
    delete_student_profile: bool = Field(False)
    restore_booking: bool = Field(True)

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_filters.py ---
"""
Booking filter and search schemas
"""
from datetime import date
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseFilterSchema
from app.schemas.common.enums import BookingStatus, BookingSource, RoomType


class BookingFilterParams(BaseFilterSchema):
    """Booking filter parameters"""
    # Text search
    search: Optional[str] = Field(None, description="Search in reference, guest name, email, phone")
    
    # Hostel filter
    hostel_id: Optional[UUID] = None
    hostel_ids: Optional[List[UUID]] = None
    
    # Status filter
    status: Optional[BookingStatus] = None
    statuses: Optional[List[BookingStatus]] = None
    
    # Date filters
    booking_date_from: Optional[date] = None
    booking_date_to: Optional[date] = None
    check_in_date_from: Optional[date] = None
    check_in_date_to: Optional[date] = None
    
    # Room type
    room_type: Optional[RoomType] = None
    
    # Source
    source: Optional[BookingSource] = None
    
    # Payment status
    advance_paid: Optional[bool] = None
    
    # Conversion status
    converted_to_student: Optional[bool] = None
    
    # Expiry
    expiring_soon: Optional[bool] = Field(None, description="Bookings expiring in next 24 hours")
    expired: Optional[bool] = None


class BookingSearchRequest(BaseFilterSchema):
    """Booking search request"""
    query: str = Field(..., min_length=1, description="Search query")
    hostel_id: Optional[UUID] = None
    
    # Search fields
    search_in_reference: bool = Field(True)
    search_in_guest_name: bool = Field(True)
    search_in_email: bool = Field(True)
    search_in_phone: bool = Field(True)
    
    # Status filter
    status: Optional[BookingStatus] = None
    
    # Pagination
    page: int = Field(1, ge=1)
    page_size: int = Field(20, ge=1, le=100)


class BookingSortOptions(BaseFilterSchema):
    """Booking sorting options"""
    sort_by: str = Field(
        "booking_date",
        pattern="^(booking_date|check_in_date|guest_name|status|total_amount)$"
    )
    sort_order: str = Field("desc", pattern="^(asc|desc)$")


class BookingExportRequest(BaseFilterSchema):
    """Export bookings"""
    hostel_id: Optional[UUID] = None
    filters: Optional[BookingFilterParams] = None
    
    format: str = Field("csv", pattern="^(csv|excel|pdf)$")
    
    # Fields to include
    include_guest_details: bool = Field(True)
    include_payment_details: bool = Field(True)
    include_assignment_details: bool = Field(True)


class BookingAnalyticsRequest(BaseFilterSchema):
    """Booking analytics request"""
    hostel_id: Optional[UUID] = None
    date_from: date
    date_to: date
    
    group_by: str = Field("day", pattern="^(day|week|month)$")

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_modification.py ---
"""
Booking modification schemas
"""
from datetime import date
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.enums import RoomType


class ModificationRequest(BaseCreateSchema):
    """Request to modify booking"""
    booking_id: UUID = Field(..., description="Booking ID")
    
    # What to modify
    modify_check_in_date: bool = Field(False)
    new_check_in_date: Optional[date] = None
    
    modify_duration: bool = Field(False)
    new_duration_months: Optional[int] = Field(None, ge=1, le=24)
    
    modify_room_type: bool = Field(False)
    new_room_type: Optional[RoomType] = None
    
    # Reason
    modification_reason: str = Field(..., min_length=10, max_length=500)
    
    # Accept price difference
    accept_price_change: bool = Field(False, description="Accept if price changes")


class ModificationResponse(BaseSchema):
    """Modification response"""
    booking_id: UUID
    booking_reference: str
    
    # What changed
    modifications_applied: List[str]
    
    # Price impact
    original_total: Decimal
    new_total: Decimal
    price_difference: Decimal
    additional_payment_required: bool
    additional_amount: Decimal
    
    # Status
    requires_admin_approval: bool
    auto_approved: bool
    
    message: str


class DateChangeRequest(BaseCreateSchema):
    """Request to change check-in date"""
    booking_id: UUID
    new_check_in_date: date = Field(..., description="New desired check-in date")
    reason: str = Field(..., min_length=10, max_length=500)


class DurationChangeRequest(BaseCreateSchema):
    """Request to change stay duration"""
    booking_id: UUID
    new_duration_months: int = Field(..., ge=1, le=24)
    reason: str = Field(..., min_length=10, max_length=500)


class RoomTypeChangeRequest(BaseCreateSchema):
    """Request to change room type"""
    booking_id: UUID
    new_room_type: RoomType
    reason: str = Field(..., min_length=10, max_length=500)
    accept_price_difference: bool = Field(False)


class ModificationApproval(BaseCreateSchema):
    """Approve/reject modification request"""
    modification_request_id: UUID
    approved: bool
    
    # If approved
    adjusted_price: Optional[Decimal] = None
    
    # If rejected
    rejection_reason: Optional[str] = None
    
    admin_notes: Optional[str] = None

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_request.py ---
"""
Booking request schemas
"""
from datetime import date
from decimal import Decimal
from typing import Optional
from pydantic import EmailStr, Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema
from app.schemas.common.enums import RoomType


class GuestInformation(BaseSchema):
    """Guest information for booking"""
    guest_name: str = Field(..., min_length=2, max_length=255, description="Full name")
    guest_email: EmailStr = Field(..., description="Email address")
    guest_phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$', description="Phone number")
    
    # ID proof (optional at booking, required at check-in)
    guest_id_proof_type: Optional[str] = Field(
        None,
        pattern="^(aadhaar|passport|driving_license|voter_id|pan_card)$"
    )
    guest_id_proof_number: Optional[str] = Field(None, max_length=50)
    
    # Emergency contact
    emergency_contact_name: Optional[str] = Field(None, max_length=255)
    emergency_contact_phone: Optional[str] = Field(None, pattern=r'^\+?[1-9]\d{9,14}$')
    emergency_contact_relation: Optional[str] = Field(None, max_length=50)
    
    # Institutional/employment details
    institution_or_company: Optional[str] = Field(None, max_length=255)
    designation_or_course: Optional[str] = Field(None, max_length=255)


class BookingRequest(BaseCreateSchema):
    """Complete booking request"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    
    # Booking details
    room_type_requested: RoomType = Field(..., description="Desired room type")
    preferred_check_in_date: date = Field(..., description="Desired check-in date")
    stay_duration_months: int = Field(..., ge=1, le=24, description="Stay duration (1-24 months)")
    
    # Guest information
    guest_info: GuestInformation = Field(..., description="Guest details")
    
    # Special requests
    special_requests: Optional[str] = Field(None, max_length=1000)
    dietary_preferences: Optional[str] = Field(None, max_length=255)
    has_vehicle: bool = Field(False)
    vehicle_details: Optional[str] = Field(None, max_length=255)
    
    # Referral
    referral_code: Optional[str] = Field(None, max_length=50)
    
    @field_validator('preferred_check_in_date')
    @classmethod
    def validate_checkin_date(cls, v: date) -> date:
        """Validate check-in date is in future"""
        from datetime import date as date_type
        if v < date_type.today():
            raise ValueError('Check-in date must be in the future')
        return v


class BookingInquiry(BaseCreateSchema):
    """Simple inquiry (without full booking)"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    
    # Contact info
    visitor_name: str = Field(..., min_length=2, max_length=255)
    visitor_email: EmailStr = Field(...)
    visitor_phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$')
    
    # Interest details
    room_type_interest: Optional[RoomType] = None
    preferred_check_in_date: Optional[date] = None
    message: Optional[str] = Field(None, max_length=1000)


class QuickBookingRequest(BaseCreateSchema):
    """Quick booking (minimal information)"""
    hostel_id: UUID
    room_type_requested: RoomType
    check_in_date: date
    duration_months: int = Field(..., ge=1, le=24)
    
    # Minimal guest info (rest can be added later)
    name: str = Field(..., min_length=2, max_length=255)
    email: EmailStr
    phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$')

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_response.py ---
"""
Booking response schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import BookingStatus, RoomType, BookingSource


class BookingResponse(BaseResponseSchema):
    """Booking response schema"""
    booking_reference: str
    visitor_id: UUID
    hostel_id: UUID
    hostel_name: str
    
    room_type_requested: RoomType
    preferred_check_in_date: date
    stay_duration_months: int
    expected_check_out_date: date
    
    # Guest info
    guest_name: str
    guest_email: str
    guest_phone: str
    
    # Pricing
    quoted_rent_monthly: Decimal
    total_amount: Decimal
    security_deposit: Decimal
    advance_amount: Decimal
    advance_paid: bool
    
    # Status
    booking_status: BookingStatus
    
    # Dates
    booking_date: datetime
    expires_at: Optional[datetime]


class BookingDetail(BaseResponseSchema):
    """Detailed booking information"""
    booking_reference: str
    visitor_id: UUID
    visitor_name: str
    
    hostel_id: UUID
    hostel_name: str
    hostel_city: str
    hostel_address: str
    hostel_phone: str
    
    # Requested details
    room_type_requested: RoomType
    preferred_check_in_date: date
    stay_duration_months: int
    expected_check_out_date: date
    
    # Assignment (if approved)
    room_id: Optional[UUID]
    room_number: Optional[str]
    bed_id: Optional[UUID]
    bed_number: Optional[str]
    
    # Guest information
    guest_name: str
    guest_email: str
    guest_phone: str
    guest_id_proof_type: Optional[str]
    guest_id_proof_number: Optional[str]
    
    # Emergency contact
    emergency_contact_name: Optional[str]
    emergency_contact_phone: Optional[str]
    emergency_contact_relation: Optional[str]
    
    # Institutional/employment
    institution_or_company: Optional[str]
    designation_or_course: Optional[str]
    
    # Special requests
    special_requests: Optional[str]
    dietary_preferences: Optional[str]
    has_vehicle: bool
    vehicle_details: Optional[str]
    
    # Pricing
    quoted_rent_monthly: Decimal
    total_amount: Decimal
    security_deposit: Decimal
    advance_amount: Decimal
    advance_paid: bool
    advance_payment_id: Optional[UUID]
    
    # Status workflow
    booking_status: BookingStatus
    approved_by: Optional[UUID]
    approved_by_name: Optional[str]
    approved_at: Optional[datetime]
    rejected_by: Optional[UUID]
    rejected_at: Optional[datetime]
    rejection_reason: Optional[str]
    
    # Cancellation
    cancelled_by: Optional[UUID]
    cancelled_at: Optional[datetime]
    cancellation_reason: Optional[str]
    
    # Conversion
    converted_to_student: bool
    student_profile_id: Optional[UUID]
    conversion_date: Optional[date]
    
    # Source
    source: BookingSource
    referral_code: Optional[str]
    
    # Timestamps
    booking_date: datetime
    expires_at: Optional[datetime]


class BookingListItem(BaseSchema):
    """Booking list item"""
    id: UUID
    booking_reference: str
    guest_name: str
    guest_phone: str
    
    hostel_name: str
    room_type_requested: str
    
    preferred_check_in_date: date
    stay_duration_months: int
    
    total_amount: Decimal
    advance_paid: bool
    
    booking_status: BookingStatus
    booking_date: datetime
    
    # Quick indicators
    is_urgent: bool = Field(..., description="Expiring soon")
    days_until_checkin: Optional[int]


class BookingConfirmation(BaseSchema):
    """Booking confirmation response"""
    booking_id: UUID
    booking_reference: str
    
    hostel_name: str
    room_type: str
    check_in_date: date
    
    total_amount: Decimal
    advance_amount: Decimal
    balance_amount: Decimal
    
    confirmation_message: str
    next_steps: list[str]
    
    # Contact
    hostel_contact_phone: str
    hostel_contact_email: Optional[str]

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_waitlist.py ---
"""
Booking waitlist schemas
"""
from datetime import date, datetime
from typing import Optional
from pydantic import Field, EmailStr
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema
from app.schemas.common.enums import RoomType, WaitlistStatus


class WaitlistRequest(BaseCreateSchema):
    """Add to waitlist when hostel is full"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    visitor_id: UUID = Field(..., description="Visitor ID")
    
    room_type: RoomType = Field(..., description="Desired room type")
    preferred_check_in_date: date = Field(..., description="Desired check-in date")
    
    # Contact
    contact_email: EmailStr = Field(..., description="Email for notifications")
    contact_phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$')
    
    # Additional info
    notes: Optional[str] = Field(None, max_length=500)


class WaitlistResponse(BaseResponseSchema):
    """Waitlist entry response"""
    hostel_id: UUID
    hostel_name: str
    visitor_id: UUID
    
    room_type: RoomType
    preferred_check_in_date: date
    
    contact_email: str
    contact_phone: str
    
    priority: int = Field(..., description="Position in waitlist (1 = first)")
    status: WaitlistStatus
    
    estimated_availability_date: Optional[date] = Field(
        None,
        description="Estimated date when room might be available"
    )
    
    created_at: datetime


class WaitlistStatus(BaseSchema):
    """Waitlist status for visitor"""
    waitlist_id: UUID
    hostel_name: str
    room_type: str
    
    position: int = Field(..., description="Current position in queue")
    total_in_queue: int
    
    status: str = Field(..., pattern="^(waiting|notified|converted|expired|cancelled)$")
    
    # Notifications
    last_notification_sent: Optional[datetime]
    notification_count: int
    
    # Estimated wait
    estimated_wait_days: Optional[int]


class WaitlistNotification(BaseSchema):
    """Notification when room becomes available"""
    waitlist_id: UUID
    visitor_id: UUID
    hostel_id: UUID
    
    message: str
    available_room_id: UUID
    available_bed_id: UUID
    
    # Action required
    response_deadline: datetime = Field(..., description="Deadline to respond")
    
    # Booking link
    booking_link: str


class WaitlistConversion(BaseCreateSchema):
    """Convert waitlist to booking"""
    waitlist_id: UUID
    accept: bool = Field(..., description="Accept the available room")
    
    # If accepting
    proceed_with_booking: bool = Field(True)


class WaitlistCancellation(BaseCreateSchema):
    """Remove from waitlist"""
    waitlist_id: UUID
    cancellation_reason: Optional[str] = Field(None, max_length=500)


class WaitlistManagement(BaseSchema):
    """Manage waitlist (admin)"""
    hostel_id: UUID
    room_type: RoomType
    
    total_in_waitlist: int
    entries: List["WaitlistEntry"]


class WaitlistEntry(BaseSchema):
    """Individual waitlist entry"""
    waitlist_id: UUID
    visitor_name: str
    contact_email: str
    contact_phone: str
    
    preferred_check_in_date: date
    priority: int
    status: WaitlistStatus
    
    days_waiting: int
    created_at: datetime

# --- File: D:\hostel-management-saas\app\schemas\booking\__init__.py ---
"""
Booking schemas package
"""
from app.schemas.booking.booking_base import (
    BookingBase,
    BookingCreate,
    BookingUpdate
)
from app.schemas.booking.booking_response import (
    BookingResponse,
    BookingDetail,
    BookingListItem
)
from app.schemas.booking.booking_request import (
    BookingRequest,
    GuestInformation,
    BookingInquiry
)
from app.schemas.booking.booking_approval import (
    BookingApprovalRequest,
    ApprovalResponse,
    RejectionRequest
)
from app.schemas.booking.booking_calendar import (
    CalendarView,
    CalendarEvent,
    AvailabilityCalendar,
    DayBookings
)
from app.schemas.booking.booking_assignment import (
    RoomAssignment,
    BedAssignment,
    AssignmentRequest
)
from app.schemas.booking.booking_cancellation import (
    CancellationRequest,
    CancellationResponse,
    RefundCalculation
)
from app.schemas.booking.booking_modification import (
    ModificationRequest,
    ModificationResponse,
    DateChangeRequest
)
from app.schemas.booking.booking_waitlist import (
    WaitlistRequest,
    WaitlistResponse,
    WaitlistStatus,
    WaitlistNotification
)
from app.schemas.booking.booking_conversion import (
    ConvertToStudentRequest,
    ConversionResponse,
    ConversionChecklist
)
from app.schemas.booking.booking_filters import (
    BookingFilterParams,
    BookingSearchRequest,
    BookingSortOptions
)

__all__ = [
    # Base
    "BookingBase",
    "BookingCreate",
    "BookingUpdate",
    
    # Response
    "BookingResponse",
    "BookingDetail",
    "BookingListItem",
    
    # Request
    "BookingRequest",
    "GuestInformation",
    "BookingInquiry",
    
    # Approval
    "BookingApprovalRequest",
    "ApprovalResponse",
    "RejectionRequest",
    
    # Calendar
    "CalendarView",
    "CalendarEvent",
    "AvailabilityCalendar",
    "DayBookings",
    
    # Assignment
    "RoomAssignment",
    "BedAssignment",
    "AssignmentRequest",
    
    # Cancellation
    "CancellationRequest",
    "CancellationResponse",
    "RefundCalculation",
    
    # Modification
    "ModificationRequest",
    "ModificationResponse",
    "DateChangeRequest",
    
    # Waitlist
    "WaitlistRequest",
    "WaitlistResponse",
    "WaitlistStatus",
    "WaitlistNotification",
    
    # Conversion
    "ConvertToStudentRequest",
    "ConversionResponse",
    "ConversionChecklist",
    
    # Filters
    "BookingFilterParams",
    "BookingSearchRequest",
    "BookingSortOptions",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\common =====

# --- File: D:\hostel-management-saas\app\schemas\common\base.py ---
"""
Base schema classes with common fields and configurations
"""
from datetime import datetime
from typing import Optional
from pydantic import BaseModel, ConfigDict, Field
from uuid import UUID


class BaseSchema(BaseModel):
    """Base schema with common Pydantic configuration"""
    
    model_config = ConfigDict(
        from_attributes=True,
        populate_by_name=True,
        use_enum_values=False,  # Keep enums as enum objects
        arbitrary_types_allowed=True,
        str_strip_whitespace=True,
        validate_assignment=True,
        json_encoders={
            datetime: lambda v: v.isoformat(),
        }
    )


class TimestampMixin(BaseModel):
    """Mixin for timestamp fields"""
    created_at: datetime = Field(..., description="Creation timestamp")
    updated_at: datetime = Field(..., description="Last update timestamp")


class SoftDeleteMixin(BaseModel):
    """Mixin for soft delete support"""
    deleted_at: Optional[datetime] = Field(None, description="Deletion timestamp")
    is_deleted: bool = Field(False, description="Soft delete flag")


class UUIDMixin(BaseModel):
    """Mixin for UUID primary key"""
    id: UUID = Field(..., description="Unique identifier")


class BaseDBSchema(BaseSchema, UUIDMixin, TimestampMixin):
    """Base schema for database entities with ID and timestamps"""
    pass


class BaseCreateSchema(BaseSchema):
    """Base schema for create operations"""
    pass


class BaseUpdateSchema(BaseSchema):
    """Base schema for update operations (all fields optional)"""
    pass


class BaseResponseSchema(BaseDBSchema):
    """Base schema for API responses"""
    pass


class BaseFilterSchema(BaseSchema):
    """Base schema for filter parameters"""
    pass

# --- File: D:\hostel-management-saas\app\schemas\common\enums.py ---
"""
All enumeration types used across the application
"""
from enum import Enum


class UserRole(str, Enum):
    """User role enumeration"""
    SUPER_ADMIN = "super_admin"
    HOSTEL_ADMIN = "hostel_admin"
    SUPERVISOR = "supervisor"
    STUDENT = "student"
    VISITOR = "visitor"


class Gender(str, Enum):
    """Gender enumeration"""
    MALE = "male"
    FEMALE = "female"
    OTHER = "other"


class HostelType(str, Enum):
    """Hostel type enumeration"""
    BOYS = "boys"
    GIRLS = "girls"
    CO_ED = "co_ed"


class HostelStatus(str, Enum):
    """Hostel operational status"""
    ACTIVE = "active"
    INACTIVE = "inactive"
    UNDER_MAINTENANCE = "under_maintenance"
    CLOSED = "closed"


class RoomType(str, Enum):
    """Room type enumeration"""
    SINGLE = "single"
    DOUBLE = "double"
    TRIPLE = "triple"
    FOUR_SHARING = "four_sharing"
    DORMITORY = "dormitory"


class RoomStatus(str, Enum):
    """Room status enumeration"""
    ACTIVE = "active"
    INACTIVE = "inactive"
    MAINTENANCE = "maintenance"
    RESERVED = "reserved"


class BedStatus(str, Enum):
    """Bed status enumeration"""
    AVAILABLE = "available"
    OCCUPIED = "occupied"
    RESERVED = "reserved"
    MAINTENANCE = "maintenance"


class BookingStatus(str, Enum):
    """Booking status enumeration"""
    PENDING = "pending"
    APPROVED = "approved"
    REJECTED = "rejected"
    CANCELLED = "cancelled"
    EXPIRED = "expired"
    CONFIRMED = "confirmed"
    CHECKED_IN = "checked_in"
    COMPLETED = "completed"


class BookingSource(str, Enum):
    """Booking source enumeration"""
    WEBSITE = "website"
    MOBILE_APP = "mobile_app"
    REFERRAL = "referral"
    WALK_IN = "walk_in"
    AGENT = "agent"
    OTHER = "other"


class PaymentStatus(str, Enum):
    """Payment status enumeration"""
    PENDING = "pending"
    PROCESSING = "processing"
    COMPLETED = "completed"
    FAILED = "failed"
    REFUNDED = "refunded"
    PARTIALLY_REFUNDED = "partially_refunded"


class PaymentMethod(str, Enum):
    """Payment method enumeration"""
    CASH = "cash"
    UPI = "upi"
    CARD = "card"
    NET_BANKING = "net_banking"
    CHEQUE = "cheque"
    BANK_TRANSFER = "bank_transfer"
    PAYMENT_GATEWAY = "payment_gateway"


class PaymentType(str, Enum):
    """Payment type enumeration"""
    RENT = "rent"
    SECURITY_DEPOSIT = "security_deposit"
    MESS_CHARGES = "mess_charges"
    ELECTRICITY = "electricity"
    WATER = "water"
    MAINTENANCE = "maintenance"
    BOOKING_ADVANCE = "booking_advance"
    OTHER = "other"


class FeeType(str, Enum):
    """Fee type enumeration"""
    MONTHLY = "monthly"
    QUARTERLY = "quarterly"
    HALF_YEARLY = "half_yearly"
    YEARLY = "yearly"


class ComplaintCategory(str, Enum):
    """Complaint category enumeration"""
    ROOM_MAINTENANCE = "room_maintenance"
    PLUMBING = "plumbing"
    ELECTRICAL = "electrical"
    CLEANLINESS = "cleanliness"
    MESS_FOOD_QUALITY = "mess_food_quality"
    SECURITY = "security"
    NOISE = "noise"
    INTERNET = "internet"
    STAFF_BEHAVIOR = "staff_behavior"
    OTHER = "other"


class ComplaintStatus(str, Enum):
    """Complaint status enumeration"""
    OPEN = "open"
    ASSIGNED = "assigned"
    IN_PROGRESS = "in_progress"
    ON_HOLD = "on_hold"
    RESOLVED = "resolved"
    CLOSED = "closed"
    REOPENED = "reopened"


class Priority(str, Enum):
    """Priority level enumeration"""
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"
    URGENT = "urgent"
    CRITICAL = "critical"


class AttendanceStatus(str, Enum):
    """Attendance status enumeration"""
    PRESENT = "present"
    ABSENT = "absent"
    LATE = "late"
    ON_LEAVE = "on_leave"
    HALF_DAY = "half_day"


class AttendanceMode(str, Enum):
    """Attendance recording mode"""
    MANUAL = "manual"
    BIOMETRIC = "biometric"
    QR_CODE = "qr_code"
    MOBILE_APP = "mobile_app"


class LeaveType(str, Enum):
    """Leave type enumeration"""
    CASUAL = "casual"
    SICK = "sick"
    EMERGENCY = "emergency"
    VACATION = "vacation"
    OTHER = "other"


class LeaveStatus(str, Enum):
    """Leave application status"""
    PENDING = "pending"
    APPROVED = "approved"
    REJECTED = "rejected"
    CANCELLED = "cancelled"


class MaintenanceCategory(str, Enum):
    """Maintenance category enumeration"""
    ELECTRICAL = "electrical"
    PLUMBING = "plumbing"
    CARPENTRY = "carpentry"
    CLEANING = "cleaning"
    APPLIANCE_REPAIR = "appliance_repair"
    STRUCTURAL = "structural"
    PAINTING = "painting"
    OTHER = "other"


class MaintenanceStatus(str, Enum):
    """Maintenance request status"""
    PENDING = "pending"
    APPROVED = "approved"
    ASSIGNED = "assigned"
    IN_PROGRESS = "in_progress"
    ON_HOLD = "on_hold"
    COMPLETED = "completed"
    REJECTED = "rejected"
    CANCELLED = "cancelled"


class MaintenanceIssueType(str, Enum):
    """Maintenance issue type"""
    ROUTINE = "routine"
    PREVENTIVE = "preventive"
    EMERGENCY = "emergency"
    BREAKDOWN = "breakdown"


class MaintenanceRecurrence(str, Enum):
    """Preventive maintenance recurrence"""
    NONE = "none"
    WEEKLY = "weekly"
    MONTHLY = "monthly"
    QUARTERLY = "quarterly"
    HALF_YEARLY = "half_yearly"
    YEARLY = "yearly"


class NotificationType(str, Enum):
    """Notification type enumeration"""
    EMAIL = "email"
    SMS = "sms"
    PUSH = "push"


class NotificationStatus(str, Enum):
    """Notification delivery status"""
    QUEUED = "queued"
    PROCESSING = "processing"
    SENT = "sent"
    FAILED = "failed"
    CANCELLED = "cancelled"


class SubscriptionPlan(str, Enum):
    """Subscription plan types"""
    FREE = "free"
    BASIC = "basic"
    STANDARD = "standard"
    PREMIUM = "premium"
    ENTERPRISE = "enterprise"


class SubscriptionStatus(str, Enum):
    """Subscription status"""
    TRIAL = "trial"
    ACTIVE = "active"
    PAST_DUE = "past_due"
    CANCELLED = "cancelled"
    EXPIRED = "expired"


class BillingCycle(str, Enum):
    """Billing cycle"""
    MONTHLY = "monthly"
    YEARLY = "yearly"


class StudentStatus(str, Enum):
    """Student status enumeration"""
    ACTIVE = "active"
    INACTIVE = "inactive"
    NOTICE_PERIOD = "notice_period"
    ALUMNI = "alumni"
    SUSPENDED = "suspended"


class SupervisorStatus(str, Enum):
    """Supervisor status enumeration"""
    ACTIVE = "active"
    ON_LEAVE = "on_leave"
    SUSPENDED = "suspended"
    TERMINATED = "terminated"


class EmploymentType(str, Enum):
    """Employment type"""
    FULL_TIME = "full_time"
    PART_TIME = "part_time"
    CONTRACT = "contract"


class AnnouncementCategory(str, Enum):
    """Announcement category"""
    GENERAL = "general"
    URGENT = "urgent"
    MAINTENANCE = "maintenance"
    EVENT = "event"
    RULE_CHANGE = "rule_change"
    FEE_RELATED = "fee_related"
    SECURITY = "security"
    OTHER = "other"


class TargetAudience(str, Enum):
    """Target audience for announcements"""
    ALL = "all"
    STUDENTS_ONLY = "students_only"
    SPECIFIC_ROOMS = "specific_rooms"
    SPECIFIC_FLOORS = "specific_floors"
    INDIVIDUAL = "individual"


class MealType(str, Enum):
    """Meal type enumeration"""
    BREAKFAST = "breakfast"
    LUNCH = "lunch"
    SNACKS = "snacks"
    DINNER = "dinner"


class DietaryPreference(str, Enum):
    """Dietary preference"""
    VEGETARIAN = "vegetarian"
    NON_VEGETARIAN = "non_vegetarian"
    VEGAN = "vegan"
    JAIN = "jain"


class IDProofType(str, Enum):
    """ID proof type"""
    AADHAAR = "aadhaar"
    PASSPORT = "passport"
    DRIVING_LICENSE = "driving_license"
    VOTER_ID = "voter_id"
    PAN_CARD = "pan_card"


class PermissionLevel(str, Enum):
    """Permission level for admin-hostel assignments"""
    FULL_ACCESS = "full_access"
    LIMITED_ACCESS = "limited_access"
    VIEW_ONLY = "view_only"


class ReferralStatus(str, Enum):
    """Referral status"""
    PENDING = "pending"
    REGISTERED = "registered"
    BOOKING_MADE = "booking_made"
    COMPLETED = "completed"
    EXPIRED = "expired"
    CANCELLED = "cancelled"


class RewardStatus(str, Enum):
    """Reward payment status"""
    PENDING = "pending"
    APPROVED = "approved"
    PAID = "paid"
    CANCELLED = "cancelled"


class ReviewStatus(str, Enum):
    """Review moderation status"""
    PENDING = "pending"
    APPROVED = "approved"
    REJECTED = "rejected"
    FLAGGED = "flagged"


class VoteType(str, Enum):
    """Review vote type"""
    HELPFUL = "helpful"
    NOT_HELPFUL = "not_helpful"


class DeviceType(str, Enum):
    """Device type for push notifications"""
    IOS = "ios"
    ANDROID = "android"
    WEB = "web"


class SearchSource(str, Enum):
    """Search result source"""
    SEARCH_RESULTS = "search_results"
    DIRECT_LINK = "direct_link"
    FEATURED = "featured"
    COMPARISON = "comparison"
    REFERRAL = "referral"


class InquiryStatus(str, Enum):
    """Inquiry status"""
    NEW = "new"
    CONTACTED = "contacted"
    INTERESTED = "interested"
    NOT_INTERESTED = "not_interested"
    CONVERTED = "converted"


class InquirySource(str, Enum):
    """Inquiry source"""
    WEBSITE = "website"
    MOBILE_APP = "mobile_app"
    REFERRAL = "referral"
    SOCIAL_MEDIA = "social_media"
    OTHER = "other"


class WaitlistStatus(str, Enum):
    """Waitlist status"""
    WAITING = "waiting"
    NOTIFIED = "notified"
    CONVERTED = "converted"
    EXPIRED = "expired"
    CANCELLED = "cancelled"


class OTPType(str, Enum):
    """OTP type"""
    EMAIL_VERIFICATION = "email_verification"
    PHONE_VERIFICATION = "phone_verification"
    LOGIN = "login"
    PASSWORD_RESET = "password_reset"


class AuditActionCategory(str, Enum):
    """Audit action category"""
    AUTHENTICATION = "authentication"
    AUTHORIZATION = "authorization"
    USER_MANAGEMENT = "user_management"
    HOSTEL_MANAGEMENT = "hostel_management"
    BOOKING = "booking"
    PAYMENT = "payment"
    COMPLAINT = "complaint"
    ATTENDANCE = "attendance"
    MAINTENANCE = "maintenance"
    ANNOUNCEMENT = "announcement"
    STUDENT_MANAGEMENT = "student_management"
    SUPERVISOR_MANAGEMENT = "supervisor_management"
    CONFIGURATION = "configuration"
    OTHER = "other"


class ChargeType(str, Enum):
    """Utility charge type"""
    INCLUDED = "included"
    ACTUAL = "actual"
    FIXED_MONTHLY = "fixed_monthly"

# --- File: D:\hostel-management-saas\app\schemas\common\filters.py ---
"""
Common filter schemas
"""
from datetime import date, datetime, time
from typing import List, Optional
from pydantic import Field, field_validator

from app.schemas.common.base import BaseSchema, BaseFilterSchema


class DateRangeFilter(BaseFilterSchema):
    """Date range filter"""
    start_date: Optional[date] = Field(None, description="Start date (inclusive)")
    end_date: Optional[date] = Field(None, description="End date (inclusive)")
    
    @field_validator('end_date')
    @classmethod
    def validate_date_range(cls, v: Optional[date], info) -> Optional[date]:
        """Validate end_date is after start_date"""
        if v is not None and info.data.get('start_date') is not None:
            if v < info.data['start_date']:
                raise ValueError("end_date must be after or equal to start_date")
        return v


class DateTimeRangeFilter(BaseFilterSchema):
    """DateTime range filter"""
    start_datetime: Optional[datetime] = Field(None, description="Start datetime (inclusive)")
    end_datetime: Optional[datetime] = Field(None, description="End datetime (inclusive)")
    
    @field_validator('end_datetime')
    @classmethod
    def validate_datetime_range(cls, v: Optional[datetime], info) -> Optional[datetime]:
        """Validate end_datetime is after start_datetime"""
        if v is not None and info.data.get('start_datetime') is not None:
            if v < info.data['start_datetime']:
                raise ValueError("end_datetime must be after or equal to start_datetime")
        return v


class TimeRangeFilter(BaseFilterSchema):
    """Time range filter"""
    start_time: Optional[time] = Field(None, description="Start time")
    end_time: Optional[time] = Field(None, description="End time")


class PriceRangeFilter(BaseFilterSchema):
    """Price range filter"""
    min_price: Optional[float] = Field(None, ge=0, description="Minimum price")
    max_price: Optional[float] = Field(None, ge=0, description="Maximum price")
    
    @field_validator('max_price')
    @classmethod
    def validate_price_range(cls, v: Optional[float], info) -> Optional[float]:
        """Validate max_price is greater than min_price"""
        if v is not None and info.data.get('min_price') is not None:
            if v < info.data['min_price']:
                raise ValueError("max_price must be greater than or equal to min_price")
        return v


class SearchFilter(BaseFilterSchema):
    """Generic search filter"""
    search_query: Optional[str] = Field(
        None,
        min_length=1,
        max_length=255,
        description="Search query string"
    )


class SortOptions(BaseFilterSchema):
    """Sorting options"""
    sort_by: str = Field(..., description="Field to sort by")
    sort_order: str = Field(
        "asc",
        pattern="^(asc|desc)$",
        description="Sort order: asc or desc"
    )
    
    @field_validator('sort_order')
    @classmethod
    def validate_sort_order(cls, v: str) -> str:
        """Validate and normalize sort order"""
        return v.lower()


class StatusFilter(BaseFilterSchema):
    """Status filter"""
    statuses: Optional[List[str]] = Field(None, description="Filter by status values")
    exclude_statuses: Optional[List[str]] = Field(None, description="Exclude status values")


class NumericRangeFilter(BaseFilterSchema):
    """Generic numeric range filter"""
    min_value: Optional[float] = Field(None, description="Minimum value")
    max_value: Optional[float] = Field(None, description="Maximum value")
    
    @field_validator('max_value')
    @classmethod
    def validate_range(cls, v: Optional[float], info) -> Optional[float]:
        """Validate max_value is greater than min_value"""
        if v is not None and info.data.get('min_value') is not None:
            if v < info.data['min_value']:
                raise ValueError("max_value must be greater than or equal to min_value")
        return v


class LocationFilter(BaseFilterSchema):
    """Location-based filter"""
    latitude: Optional[float] = Field(None, ge=-90, le=90, description="Latitude")
    longitude: Optional[float] = Field(None, ge=-180, le=180, description="Longitude")
    radius_km: Optional[float] = Field(None, ge=0, le=100, description="Search radius in kilometers")
    city: Optional[str] = Field(None, description="City name")
    state: Optional[str] = Field(None, description="State name")
    pincode: Optional[str] = Field(None, pattern=r'^\d{6}$', description="Pincode")


class MultiSelectFilter(BaseFilterSchema):
    """Multi-select filter with include/exclude"""
    include: Optional[List[str]] = Field(None, description="Include these values")
    exclude: Optional[List[str]] = Field(None, description="Exclude these values")


class BooleanFilter(BaseFilterSchema):
    """Boolean filter (yes/no/all)"""
    value: Optional[bool] = Field(None, description="Boolean filter value")


class TextSearchFilter(BaseFilterSchema):
    """Full-text search filter"""
    query: str = Field(..., min_length=1, max_length=500, description="Search query")
    fields: Optional[List[str]] = Field(None, description="Fields to search in")
    fuzzy: bool = Field(False, description="Enable fuzzy search")
    boost: Optional[Dict[str, float]] = Field(None, description="Field boost weights")

# --- File: D:\hostel-management-saas\app\schemas\common\mixins.py ---
"""
Reusable schema mixins
"""
from typing import List, Optional
from pydantic import BaseModel, Field, HttpUrl
from uuid import UUID


class AddressMixin(BaseModel):
    """Address fields mixin"""
    address_line1: str = Field(..., min_length=5, max_length=255, description="Address line 1")
    address_line2: Optional[str] = Field(None, max_length=255, description="Address line 2")
    city: str = Field(..., min_length=2, max_length=100, description="City")
    state: str = Field(..., min_length=2, max_length=100, description="State")
    pincode: str = Field(..., pattern=r'^\d{6}$', description="6-digit pincode")
    country: str = Field("India", min_length=2, max_length=100, description="Country")


class ContactMixin(BaseModel):
    """Contact information mixin"""
    contact_phone: str = Field(
        ...,
        pattern=r'^\+?[1-9]\d{9,14}$',
        description="Primary contact phone"
    )
    alternate_phone: Optional[str] = Field(
        None,
        pattern=r'^\+?[1-9]\d{9,14}$',
        description="Alternate phone"
    )
    contact_email: Optional[str] = Field(None, description="Contact email")


class LocationMixin(BaseModel):
    """Geographic location mixin"""
    latitude: Optional[float] = Field(None, ge=-90, le=90, description="Latitude")
    longitude: Optional[float] = Field(None, ge=-180, le=180, description="Longitude")


class MediaMixin(BaseModel):
    """Media URLs mixin"""
    images: List[HttpUrl] = Field(default_factory=list, description="Image URLs")
    videos: List[HttpUrl] = Field(default_factory=list, description="Video URLs")
    documents: List[HttpUrl] = Field(default_factory=list, description="Document URLs")


class EmergencyContactMixin(BaseModel):
    """Emergency contact mixin"""
    emergency_contact_name: Optional[str] = Field(None, description="Emergency contact name")
    emergency_contact_phone: Optional[str] = Field(
        None,
        pattern=r'^\+?[1-9]\d{9,14}$',
        description="Emergency contact phone"
    )
    emergency_contact_relation: Optional[str] = Field(None, description="Relation to person")


class AuditMixin(BaseModel):
    """Audit trail mixin"""
    created_by: Optional[UUID] = Field(None, description="User who created the record")
    updated_by: Optional[UUID] = Field(None, description="User who last updated the record")


class ApprovalMixin(BaseModel):
    """Approval workflow mixin"""
    approved_by: Optional[UUID] = Field(None, description="User who approved")
    approved_at: Optional[datetime] = Field(None, description="Approval timestamp")
    rejection_reason: Optional[str] = Field(None, description="Reason for rejection")


class SEOMixin(BaseModel):
    """SEO fields mixin"""
    meta_title: Optional[str] = Field(None, max_length=255, description="SEO meta title")
    meta_description: Optional[str] = Field(None, max_length=500, description="SEO meta description")
    meta_keywords: Optional[str] = Field(None, max_length=500, description="SEO keywords")

# --- File: D:\hostel-management-saas\app\schemas\common\pagination.py ---
"""
Pagination schemas
"""
from typing import Generic, List, Optional, TypeVar
from pydantic import BaseModel, Field, field_validator

from app.schemas.common.base import BaseSchema

T = TypeVar('T')


class PaginationParams(BaseSchema):
    """Pagination query parameters"""
    page: int = Field(1, ge=1, description="Page number (1-indexed)")
    page_size: int = Field(20, ge=1, le=100, description="Items per page")
    
    @field_validator('page')
    @classmethod
    def validate_page(cls, v: int) -> int:
        """Validate page number"""
        if v < 1:
            raise ValueError("Page number must be >= 1")
        return v
    
    @field_validator('page_size')
    @classmethod
    def validate_page_size(cls, v: int) -> int:
        """Validate page size"""
        if v < 1 or v > 100:
            raise ValueError("Page size must be between 1 and 100")
        return v
    
    @property
    def offset(self) -> int:
        """Calculate offset for database queries"""
        return (self.page - 1) * self.page_size
    
    @property
    def limit(self) -> int:
        """Get limit for database queries"""
        return self.page_size


class PaginationMeta(BaseSchema):
    """Pagination metadata"""
    total_items: int = Field(..., ge=0, description="Total number of items")
    total_pages: int = Field(..., ge=0, description="Total number of pages")
    current_page: int = Field(..., ge=1, description="Current page number")
    page_size: int = Field(..., ge=1, description="Items per page")
    has_next: bool = Field(..., description="Has next page")
    has_previous: bool = Field(..., description="Has previous page")


class PaginatedResponse(BaseSchema, Generic[T]):
    """Generic paginated response"""
    items: List[T] = Field(..., description="List of items")
    meta: PaginationMeta = Field(..., description="Pagination metadata")
    
    @classmethod
    def create(
        cls,
        items: List[T],
        total_items: int,
        page: int,
        page_size: int
    ) -> "PaginatedResponse[T]":
        """
        Create paginated response with calculated metadata
        
        Args:
            items: List of items for current page
            total_items: Total number of items across all pages
            page: Current page number
            page_size: Number of items per page
            
        Returns:
            PaginatedResponse with items and metadata
        """
        # Calculate total pages (handle division by zero)
        total_pages = (total_items + page_size - 1) // page_size if page_size > 0 else 0
        
        # Ensure total_pages is at least 1 if there are items
        if total_items > 0 and total_pages == 0:
            total_pages = 1
        
        meta = PaginationMeta(
            total_items=total_items,
            total_pages=total_pages,
            current_page=page,
            page_size=page_size,
            has_next=page < total_pages,
            has_previous=page > 1
        )
        
        return cls(items=items, meta=meta)


class CursorPaginationParams(BaseSchema):
    """Cursor-based pagination parameters (for infinite scroll)"""
    cursor: Optional[str] = Field(None, description="Cursor for next page")
    limit: int = Field(20, ge=1, le=100, description="Number of items to fetch")


class CursorPaginationMeta(BaseSchema):
    """Cursor pagination metadata"""
    next_cursor: Optional[str] = Field(None, description="Cursor for next page")
    has_more: bool = Field(..., description="Whether more items exist")


class CursorPaginatedResponse(BaseSchema, Generic[T]):
    """Generic cursor-based paginated response"""
    items: List[T] = Field(..., description="List of items")
    meta: CursorPaginationMeta = Field(..., description="Cursor pagination metadata")

# --- File: D:\hostel-management-saas\app\schemas\common\response.py ---
"""
Standard API response wrappers
"""
from typing import Any, Dict, Generic, List, Optional, TypeVar
from pydantic import Field

from app.schemas.common.base import BaseSchema

T = TypeVar('T')


class SuccessResponse(BaseSchema, Generic[T]):
    """Standard success response"""
    success: bool = Field(True, description="Success flag")
    message: str = Field(..., description="Response message")
    data: Optional[T] = Field(None, description="Response data")
    
    @classmethod
    def create(cls, message: str, data: Optional[T] = None) -> "SuccessResponse[T]":
        """Create success response"""
        return cls(success=True, message=message, data=data)


class ErrorDetail(BaseSchema):
    """Error detail information"""
    field: Optional[str] = Field(None, description="Field name causing error")
    message: str = Field(..., description="Error message")
    code: Optional[str] = Field(None, description="Error code")
    location: Optional[List[str]] = Field(None, description="Error location in nested structure")


class ErrorResponse(BaseSchema):
    """Standard error response"""
    success: bool = Field(False, description="Success flag")
    message: str = Field(..., description="Error message")
    errors: Optional[List[ErrorDetail]] = Field(None, description="Detailed errors")
    error_code: Optional[str] = Field(None, description="Application error code")
    timestamp: Optional[str] = Field(None, description="Error timestamp")
    path: Optional[str] = Field(None, description="Request path that caused error")
    
    @classmethod
    def create(
        cls,
        message: str,
        errors: Optional[List[ErrorDetail]] = None,
        error_code: Optional[str] = None
    ) -> "ErrorResponse":
        """Create error response"""
        return cls(
            success=False,
            message=message,
            errors=errors,
            error_code=error_code
        )


class MessageResponse(BaseSchema):
    """Simple message response"""
    message: str = Field(..., description="Response message")
    
    @classmethod
    def create(cls, message: str) -> "MessageResponse":
        """Create message response"""
        return cls(message=message)


class BulkOperationResponse(BaseSchema):
    """Response for bulk operations"""
    total: int = Field(..., ge=0, description="Total items processed")
    successful: int = Field(..., ge=0, description="Successfully processed items")
    failed: int = Field(..., ge=0, description="Failed items")
    errors: Optional[List[Dict[str, Any]]] = Field(None, description="Errors for failed items")
    details: Optional[Dict[str, Any]] = Field(None, description="Additional operation details")
    
    @classmethod
    def create(
        cls,
        total: int,
        successful: int,
        failed: int,
        errors: Optional[List[Dict[str, Any]]] = None,
        details: Optional[Dict[str, Any]] = None
    ) -> "BulkOperationResponse":
        """Create bulk operation response"""
        return cls(
            total=total,
            successful=successful,
            failed=failed,
            errors=errors,
            details=details
        )


class ValidationErrorResponse(ErrorResponse):
    """Validation error response (422)"""
    validation_errors: List[ErrorDetail] = Field(..., description="Validation error details")


class NotFoundResponse(ErrorResponse):
    """Not found error response (404)"""
    resource_type: Optional[str] = Field(None, description="Type of resource not found")
    resource_id: Optional[str] = Field(None, description="ID of resource not found")


class UnauthorizedResponse(ErrorResponse):
    """Unauthorized error response (401)"""
    auth_scheme: Optional[str] = Field(None, description="Authentication scheme required")


class ForbiddenResponse(ErrorResponse):
    """Forbidden error response (403)"""
    required_permission: Optional[str] = Field(None, description="Required permission")
    user_permissions: Optional[List[str]] = Field(None, description="User's current permissions")


class ConflictResponse(ErrorResponse):
    """Conflict error response (409)"""
    conflicting_resource: Optional[str] = Field(None, description="Conflicting resource identifier")


class RateLimitResponse(ErrorResponse):
    """Rate limit exceeded response (429)"""
    retry_after: Optional[int] = Field(None, description="Seconds to wait before retry")
    limit: Optional[int] = Field(None, description="Rate limit")
    window: Optional[int] = Field(None, description="Time window in seconds")

# --- File: D:\hostel-management-saas\app\schemas\common\__init__.py ---
"""
Common schemas package
"""
from app.schemas.common.base import (
    BaseSchema,
    BaseCreateSchema,
    BaseUpdateSchema,
    BaseResponseSchema,
    BaseDBSchema,
    TimestampMixin,
    SoftDeleteMixin,
    UUIDMixin
)
from app.schemas.common.enums import (
    UserRole,
    Gender,
    HostelType,
    RoomType,
    BookingStatus,
    PaymentStatus,
    PaymentMethod,
    PaymentType,
    ComplaintCategory,
    ComplaintStatus,
    Priority,
    AttendanceStatus,
    LeaveType,
    MaintenanceCategory,
    MaintenanceStatus,
    NotificationType,
    SubscriptionPlan,
    StudentStatus,
    SupervisorStatus,
    AnnouncementCategory,
    TargetAudience,
    MealType,
    DietaryPreference,
    IDProofType,
    EmploymentType,
    BillingCycle,
    SubscriptionStatus,
    ReferralStatus,
    ReviewStatus,
    NotificationStatus,
    DeviceType,
    SearchSource,
    InquiryStatus
)
from app.schemas.common.pagination import (
    PaginationParams,
    PaginationMeta,
    PaginatedResponse
)
from app.schemas.common.response import (
    SuccessResponse,
    ErrorDetail,
    ErrorResponse,
    MessageResponse,
    BulkOperationResponse
)
from app.schemas.common.filters import (
    DateRangeFilter,
    DateTimeRangeFilter,
    PriceRangeFilter,
    SearchFilter,
    SortOptions,
    StatusFilter
)

__all__ = [
    # Base schemas
    "BaseSchema",
    "BaseCreateSchema",
    "BaseUpdateSchema",
    "BaseResponseSchema",
    "BaseDBSchema",
    "TimestampMixin",
    "SoftDeleteMixin",
    "UUIDMixin",
    
    # Enums
    "UserRole",
    "Gender",
    "HostelType",
    "RoomType",
    "BookingStatus",
    "PaymentStatus",
    "PaymentMethod",
    "PaymentType",
    "ComplaintCategory",
    "ComplaintStatus",
    "Priority",
    "AttendanceStatus",
    "LeaveType",
    "MaintenanceCategory",
    "MaintenanceStatus",
    "NotificationType",
    "SubscriptionPlan",
    "StudentStatus",
    "SupervisorStatus",
    "AnnouncementCategory",
    "TargetAudience",
    "MealType",
    "DietaryPreference",
    "IDProofType",
    "EmploymentType",
    "BillingCycle",
    "SubscriptionStatus",
    "ReferralStatus",
    "ReviewStatus",
    "NotificationStatus",
    "DeviceType",
    "SearchSource",
    "InquiryStatus",
    
    # Pagination
    "PaginationParams",
    "PaginationMeta",
    "PaginatedResponse",
    
    # Responses
    "SuccessResponse",
    "ErrorDetail",
    "ErrorResponse",
    "MessageResponse",
    "BulkOperationResponse",
    
    # Filters
    "DateRangeFilter",
    "DateTimeRangeFilter",
    "PriceRangeFilter",
    "SearchFilter",
    "SortOptions",
    "StatusFilter",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\complaint =====

# --- File: D:\hostel-management-saas\app\schemas\complaint\complaint_analytics.py ---
"""
Complaint analytics schemas
"""
from datetime import date
from decimal import Decimal
from typing import Dict, List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema


class ComplaintAnalytics(BaseSchema):
    """Comprehensive complaint analytics"""
    hostel_id: Optional[UUID] = None
    period_start: date
    period_end: date
    
    # Summary
    total_complaints: int
    open_complaints: int
    resolved_complaints: int
    closed_complaints: int
    
    # Resolution metrics
    resolution_metrics: "ResolutionMetrics"
    
    # Category analysis
    category_analysis: "CategoryAnalysis"
    
    # Priority distribution
    priority_distribution: Dict[str, int]
    
    # Trend
    complaint_trend: List["ComplaintTrendPoint"]
    
    # SLA performance
    sla_compliance_rate: Decimal
    sla_breached_count: int
    
    # Staff performance
    top_resolvers: List["StaffPerformance"]


class ResolutionMetrics(BaseSchema):
    """Resolution performance metrics"""
    total_resolved: int
    
    # Time metrics
    average_resolution_time_hours: Decimal
    median_resolution_time_hours: Decimal
    fastest_resolution_hours: Decimal
    slowest_resolution_hours: Decimal
    
    # Resolution rate
    resolution_rate: Decimal = Field(..., description="% of complaints resolved")
    same_day_resolution_rate: Decimal
    
    # Escalation
    escalation_rate: Decimal = Field(..., description="% of complaints escalated")
    
    # Reopened
    reopen_rate: Decimal = Field(..., description="% of resolved complaints reopened")


class CategoryAnalysis(BaseSchema):
    """Analysis by complaint category"""
    categories: List["CategoryMetrics"]
    
    most_common_category: str
    most_problematic_category: str = Field(..., description="Category with longest resolution time")


class CategoryMetrics(BaseSchema):
    """Metrics for single category"""
    category: str
    total_complaints: int
    open_complaints: int
    resolved_complaints: int
    
    average_resolution_time_hours: Decimal
    resolution_rate: Decimal
    
    percentage_of_total: Decimal


class ComplaintTrendPoint(BaseSchema):
    """Complaint trend data point"""
    period: str = Field(..., description="Date, week, or month")
    total_complaints: int
    open_complaints: int
    resolved_complaints: int
    
    # By priority
    urgent_count: int
    high_count: int
    medium_count: int
    low_count: int


class StaffPerformance(BaseSchema):
    """Staff complaint resolution performance"""
    staff_id: UUID
    staff_name: str
    staff_role: str
    
    complaints_assigned: int
    complaints_resolved: int
    
    average_resolution_time_hours: Decimal
    resolution_rate: Decimal
    
    average_rating: Optional[Decimal] = None


class ComplaintHeatmap(BaseSchema):
    """Complaint heatmap by time/location"""
    hostel_id: UUID
    
    # By hour of day
    complaints_by_hour: Dict[int, int] = Field(..., description="Hour (0-23) -> count")
    
    # By day of week
    complaints_by_day: Dict[str, int] = Field(..., description="Day -> count")
    
    # By room/floor
    complaints_by_room: List["RoomComplaintCount"]
    complaints_by_floor: Dict[int, int]


class RoomComplaintCount(BaseSchema):
    """Complaint count by room"""
    room_id: UUID
    room_number: str
    complaint_count: int
    
    most_common_category: str

# --- File: D:\hostel-management-saas\app\schemas\complaint\complaint_assignment.py ---
"""
Complaint assignment schemas
"""
from datetime import datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class AssignmentRequest(BaseCreateSchema):
    """Assign complaint to staff member"""
    complaint_id: UUID = Field(..., description="Complaint ID")
    assigned_to: UUID = Field(..., description="User ID to assign to (supervisor/staff)")
    
    # Optional
    estimated_resolution_time: Optional[datetime] = Field(
        None,
        description="Estimated resolution time"
    )
    
    assignment_notes: Optional[str] = Field(None, max_length=500)


class AssignmentResponse(BaseSchema):
    """Assignment response"""
    complaint_id: UUID
    complaint_number: str
    
    assigned_to: UUID
    assigned_to_name: str
    assigned_by: UUID
    assigned_by_name: str
    
    assigned_at: datetime
    
    message: str


class ReassignmentRequest(BaseCreateSchema):
    """Reassign complaint to different staff"""
    complaint_id: UUID
    new_assigned_to: UUID = Field(..., description="New assignee")
    
    reassignment_reason: str = Field(..., min_length=10, max_length=500)
    
    # Notify previous assignee
    notify_previous_assignee: bool = Field(True)


class BulkAssignment(BaseCreateSchema):
    """Assign multiple complaints"""
    complaint_ids: List[UUID] = Field(..., min_items=1)
    assigned_to: UUID
    
    assignment_notes: Optional[str] = None


class UnassignRequest(BaseCreateSchema):
    """Unassign complaint"""
    complaint_id: UUID
    reason: str = Field(..., min_length=10, max_length=500)

# --- File: D:\hostel-management-saas\app\schemas\complaint\complaint_base.py ---
"""
Complaint base schemas
"""
from typing import List, Optional
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import ComplaintCategory, ComplaintStatus, Priority


class ComplaintBase(BaseSchema):
    """Base complaint schema"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    raised_by: UUID = Field(..., description="User who raised complaint")
    student_id: Optional[UUID] = Field(None, description="Student ID if raised by student")
    
    # Complaint details
    title: str = Field(..., min_length=5, max_length=255, description="Complaint title")
    description: str = Field(..., min_length=20, max_length=2000, description="Detailed description")
    
    category: ComplaintCategory = Field(..., description="Complaint category")
    sub_category: Optional[str] = Field(None, max_length=100, description="Sub-category")
    
    priority: Priority = Field(Priority.MEDIUM, description="Priority level")
    
    # Location
    room_id: Optional[UUID] = Field(None, description="Related room")
    location_details: Optional[str] = Field(None, max_length=500, description="Specific location details")
    
    # Attachments
    attachments: List[HttpUrl] = Field(default_factory=list, description="Photo/document URLs")


class ComplaintCreate(ComplaintBase, BaseCreateSchema):
    """Create complaint schema"""
    pass


class ComplaintUpdate(BaseUpdateSchema):
    """Update complaint schema"""
    title: Optional[str] = Field(None, min_length=5, max_length=255)
    description: Optional[str] = Field(None, min_length=20, max_length=2000)
    category: Optional[ComplaintCategory] = None
    sub_category: Optional[str] = None
    priority: Optional[Priority] = None
    location_details: Optional[str] = None
    attachments: Optional[List[HttpUrl]] = None
    
    # Status updates
    status: Optional[ComplaintStatus] = None


class ComplaintStatusUpdate(BaseUpdateSchema):
    """Update complaint status"""
    status: ComplaintStatus = Field(..., description="New status")
    notes: Optional[str] = Field(None, max_length=500, description="Status change notes")

# --- File: D:\hostel-management-saas\app\schemas\complaint\complaint_comments.py ---
"""
Complaint comments/discussion schemas
"""
from datetime import datetime
from typing import List, Optional
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema


class CommentCreate(BaseCreateSchema):
    """Create comment on complaint"""
    complaint_id: UUID = Field(..., description="Complaint ID")
    
    comment_text: str = Field(..., min_length=5, max_length=1000, description="Comment text")
    
    # Internal or public
    is_internal: bool = Field(False, description="Internal note vs public comment")
    
    # Attachments
    attachments: List[HttpUrl] = Field(default_factory=list)


class CommentResponse(BaseResponseSchema):
    """Comment response"""
    complaint_id: UUID
    
    commented_by: UUID
    commented_by_name: str
    commented_by_role: str
    
    comment_text: str
    is_internal: bool
    
    attachments: List[str]
    
    created_at: datetime
    updated_at: datetime


class CommentList(BaseSchema):
    """List of comments for complaint"""
    complaint_id: UUID
    complaint_number: str
    
    total_comments: int
    public_comments: int
    internal_notes: int
    
    comments: List[CommentResponse]


class CommentUpdate(BaseCreateSchema):
    """Update comment"""
    comment_id: UUID
    comment_text: str = Field(..., min_length=5, max_length=1000)


class CommentDelete(BaseCreateSchema):
    """Delete comment"""
    comment_id: UUID
    reason: Optional[str] = Field(None, max_length=200)


class MentionNotification(BaseSchema):
    """Notification when mentioned in comment"""
    comment_id: UUID
    complaint_id: UUID
    complaint_number: str
    
    mentioned_by: UUID
    mentioned_by_name: str
    
    comment_excerpt: str
    
    comment_url: str

# --- File: D:\hostel-management-saas\app\schemas\complaint\complaint_escalation.py ---
"""
Complaint escalation schemas
"""
from datetime import datetime
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema


class EscalationRequest(BaseCreateSchema):
    """Escalate complaint"""
    complaint_id: UUID = Field(..., description="Complaint ID")
    escalate_to: UUID = Field(..., description="User to escalate to (admin/supervisor)")
    
    escalation_reason: str = Field(
        ...,
        min_length=20,
        max_length=500,
        description="Reason for escalation"
    )
    
    # Priority increase
    increase_priority: bool = Field(True, description="Increase priority level")
    
    # Urgency
    is_urgent: bool = Field(False)


class EscalationResponse(BaseSchema):
    """Escalation response"""
    complaint_id: UUID
    complaint_number: str
    
    escalated: bool
    escalated_to: UUID
    escalated_to_name: str
    escalated_by: UUID
    escalated_by_name: str
    escalated_at: datetime
    
    new_priority: str
    
    message: str


class EscalationHistory(BaseSchema):
    """Escalation history for complaint"""
    complaint_id: UUID
    complaint_number: str
    
    escalations: List["EscalationEntry"]
    total_escalations: int


class EscalationEntry(BaseResponseSchema):
    """Individual escalation entry"""
    escalated_to: UUID
    escalated_to_name: str
    escalated_by: UUID
    escalated_by_name: str
    escalated_at: datetime
    
    reason: str
    
    # Status at time of escalation
    status_before: str
    priority_before: str
    priority_after: str
    
    # Response time
    response_time_hours: Optional[int] = None
    resolved_after_escalation: bool


class AutoEscalationRule(BaseSchema):
    """Auto-escalation rule configuration"""
    hostel_id: UUID
    
    # Trigger conditions
    escalate_after_hours: int = Field(24, description="Hours before auto-escalation")
    escalate_on_sla_breach: bool = Field(True)
    
    # Priority-based rules
    urgent_escalation_hours: int = Field(4)
    high_escalation_hours: int = Field(12)
    medium_escalation_hours: int = Field(24)
    
    # Escalation chain
    first_escalation_to: UUID = Field(..., description="First level escalation")
    second_escalation_to: Optional[UUID] = Field(None, description="Second level if not resolved")
    
    is_active: bool = Field(True)

# --- File: D:\hostel-management-saas\app\schemas\complaint\complaint_feedback.py ---
"""
Complaint feedback schemas
"""
from datetime import datetime
from typing import Optional
from pydantic import Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema


class FeedbackRequest(BaseCreateSchema):
    """Submit feedback on resolved complaint"""
    complaint_id: UUID = Field(..., description="Complaint ID")
    
    rating: int = Field(..., ge=1, le=5, description="Rating 1-5")
    
    feedback: Optional[str] = Field(None, max_length=1000, description="Detailed feedback")
    
    # Satisfaction questions
    issue_resolved_satisfactorily: bool = Field(..., description="Was issue resolved well?")
    response_time_satisfactory: bool = Field(..., description="Was response time good?")
    staff_helpful: bool = Field(..., description="Was staff helpful?")
    
    # Would recommend
    would_recommend: Optional[bool] = Field(None, description="Would recommend complaint system")


class FeedbackResponse(BaseResponseSchema):
    """Feedback response"""
    complaint_id: UUID
    complaint_number: str
    
    rating: int
    feedback: Optional[str]
    
    submitted_by: UUID
    submitted_at: datetime
    
    message: str


class FeedbackSummary(BaseSchema):
    """Feedback summary for hostel/supervisor"""
    entity_id: UUID
    entity_type: str = Field(..., pattern="^(hostel|supervisor)$")
    
    # Period
    period_start: date
    period_end: date
    
    # Overall stats
    total_feedbacks: int
    average_rating: Decimal
    
    # Rating distribution
    rating_5_count: int
    rating_4_count: int
    rating_3_count: int
    rating_2_count: int
    rating_1_count: int
    
    # Satisfaction metrics
    resolution_satisfaction_rate: Decimal = Field(..., description="% satisfied with resolution")
    response_time_satisfaction_rate: Decimal
    staff_helpfulness_rate: Decimal
    
    # Recommendation
    recommendation_rate: Decimal = Field(..., description="% who would recommend")
    
    # Comments analysis
    positive_feedback_count: int
    negative_feedback_count: int
    common_themes: List[str] = Field(default_factory=list)


class FeedbackAnalysis(BaseSchema):
    """Detailed feedback analysis"""
    hostel_id: UUID
    period_start: date
    period_end: date
    
    # Trend
    rating_trend: List["RatingTrendPoint"]
    
    # By category
    feedback_by_category: dict = Field(..., description="Average rating by complaint category")
    
    # By priority
    feedback_by_priority: dict
    
    # Response time impact
    avg_rating_quick_response: Decimal
    avg_rating_slow_response: Decimal


class RatingTrendPoint(BaseSchema):
    """Rating trend data point"""
    period: str = Field(..., description="Date or week")
    average_rating: Decimal
    feedback_count: int

# --- File: D:\hostel-management-saas\app\schemas\complaint\complaint_filters.py ---
"""
Complaint filter and search schemas
"""
from datetime import date, datetime
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseFilterSchema
from app.schemas.common.enums import ComplaintCategory, ComplaintStatus, Priority


class ComplaintFilterParams(BaseFilterSchema):
    """Complaint filter parameters"""
    # Text search
    search: Optional[str] = Field(None, description="Search in title, description, number")
    
    # Hostel filter
    hostel_id: Optional[UUID] = None
    hostel_ids: Optional[List[UUID]] = None
    
    # Raised by
    raised_by: Optional[UUID] = None
    student_id: Optional[UUID] = None
    
    # Assignment
    assigned_to: Optional[UUID] = None
    unassigned_only: Optional[bool] = None
    
    # Category
    category: Optional[ComplaintCategory] = None
    categories: Optional[List[ComplaintCategory]] = None
    
    # Priority
    priority: Optional[Priority] = None
    priorities: Optional[List[Priority]] = None
    
    # Status
    status: Optional[ComplaintStatus] = None
    statuses: Optional[List[ComplaintStatus]] = None
    
    # Date filters
    opened_date_from: Optional[date] = None
    opened_date_to: Optional[date] = None
    resolved_date_from: Optional[date] = None
    resolved_date_to: Optional[date] = None
    
    # SLA
    sla_breached_only: Optional[bool] = None
    
    # Escalation
    escalated_only: Optional[bool] = None
    
    # Room
    room_id: Optional[UUID] = None
    
    # Age
    age_hours_min: Optional[int] = Field(None, ge=0)
    age_hours_max: Optional[int] = Field(None, ge=0)


class ComplaintSearchRequest(BaseFilterSchema):
    """Complaint search request"""
    query: str = Field(..., min_length=1, description="Search query")
    hostel_id: Optional[UUID] = None
    
    # Search fields
    search_in_title: bool = Field(True)
    search_in_description: bool = Field(True)
    search_in_number: bool = Field(True)
    
    # Filters
    status: Optional[ComplaintStatus] = None
    priority: Optional[Priority] = None
    
    # Pagination
    page: int = Field(1, ge=1)
    page_size: int = Field(20, ge=1, le=100)


class ComplaintSortOptions(BaseFilterSchema):
    """Complaint sorting options"""
    sort_by: str = Field(
        "opened_at",
        pattern="^(opened_at|priority|status|category|age)$"
    )
    sort_order: str = Field("desc", pattern="^(asc|desc)$")


class ComplaintExportRequest(BaseFilterSchema):
    """Export complaints"""
    hostel_id: Optional[UUID] = None
    filters: Optional[ComplaintFilterParams] = None
    
    format: str = Field("csv", pattern="^(csv|excel|pdf)$")
    
    # Fields to include
    include_comments: bool = Field(False)
    include_resolution_details: bool = Field(True)
    include_feedback: bool = Field(True)

# --- File: D:\hostel-management-saas\app\schemas\complaint\complaint_resolution.py ---
"""
Complaint resolution schemas
"""
from datetime import datetime
from typing import List, Optional
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class ResolutionRequest(BaseCreateSchema):
    """Mark complaint as resolved"""
    complaint_id: UUID = Field(..., description="Complaint ID")
    
    resolution_notes: str = Field(
        ...,
        min_length=20,
        max_length=2000,
        description="Resolution details"
    )
    
    # Attachments (proof of resolution)
    resolution_attachments: List[HttpUrl] = Field(
        default_factory=list,
        description="Photos/documents of resolved issue"
    )
    
    # Time tracking
    actual_resolution_time: Optional[datetime] = Field(
        None,
        description="Actual time taken to resolve"
    )
    
    # Follow-up required
    follow_up_required: bool = Field(False)
    follow_up_date: Optional[date] = None
    follow_up_notes: Optional[str] = None


class ResolutionResponse(BaseSchema):
    """Resolution response"""
    complaint_id: UUID
    complaint_number: str
    
    resolved: bool
    resolved_at: datetime
    resolved_by: UUID
    resolved_by_name: str
    
    resolution_notes: str
    
    # Time taken
    time_to_resolve_hours: int
    sla_met: bool
    
    message: str


class ResolutionUpdate(BaseCreateSchema):
    """Update resolution details"""
    complaint_id: UUID
    
    resolution_notes: Optional[str] = Field(None, min_length=20, max_length=2000)
    resolution_attachments: Optional[List[HttpUrl]] = None
    follow_up_notes: Optional[str] = None


class ReopenRequest(BaseCreateSchema):
    """Reopen resolved complaint"""
    complaint_id: UUID
    
    reopen_reason: str = Field(..., min_length=20, max_length=500)
    
    # Additional details
    additional_issues: Optional[str] = Field(None, max_length=1000)
    new_attachments: List[HttpUrl] = Field(default_factory=list)


class CloseRequest(BaseCreateSchema):
    """Close complaint (final)"""
    complaint_id: UUID
    
    closure_notes: Optional[str] = Field(None, max_length=500)
    
    # Require student confirmation
    student_confirmed: bool = Field(False, description="Student confirmed resolution")

# --- File: D:\hostel-management-saas\app\schemas\complaint\complaint_response.py ---
"""
Complaint response schemas
"""
from datetime import datetime
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import ComplaintCategory, ComplaintStatus, Priority


class ComplaintResponse(BaseResponseSchema):
    """Complaint response schema"""
    complaint_number: str
    hostel_id: UUID
    hostel_name: str
    
    raised_by: UUID
    raised_by_name: str
    student_id: Optional[UUID]
    
    title: str
    category: ComplaintCategory
    priority: Priority
    status: ComplaintStatus
    
    assigned_to: Optional[UUID]
    assigned_to_name: Optional[str]
    
    opened_at: datetime
    resolved_at: Optional[datetime]
    
    # SLA
    sla_breach: bool
    age_hours: int


class ComplaintDetail(BaseResponseSchema):
    """Detailed complaint information"""
    complaint_number: str
    
    # Hostel
    hostel_id: UUID
    hostel_name: str
    
    # Raised by
    raised_by: UUID
    raised_by_name: str
    raised_by_email: str
    raised_by_phone: str
    
    student_id: Optional[UUID]
    student_name: Optional[str]
    room_number: Optional[str]
    
    # Complaint details
    title: str
    description: str
    category: ComplaintCategory
    sub_category: Optional[str]
    priority: Priority
    
    # Location
    room_id: Optional[UUID]
    location_details: Optional[str]
    
    # Attachments
    attachments: List[str]
    
    # Assignment
    assigned_to: Optional[UUID]
    assigned_to_name: Optional[str]
    assigned_by: Optional[UUID]
    assigned_by_name: Optional[str]
    assigned_at: Optional[datetime]
    reassigned_count: int
    
    # Status workflow
    status: ComplaintStatus
    opened_at: datetime
    in_progress_at: Optional[datetime]
    resolved_at: Optional[datetime]
    closed_at: Optional[datetime]
    closed_by: Optional[UUID]
    closed_by_name: Optional[str]
    
    # Resolution
    resolution_notes: Optional[str]
    resolution_attachments: List[str]
    estimated_resolution_time: Optional[datetime]
    actual_resolution_time: Optional[datetime]
    
    # Feedback
    student_feedback: Optional[str]
    student_rating: Optional[int]
    feedback_submitted_at: Optional[datetime]
    
    # SLA
    sla_breach: bool
    sla_breach_reason: Optional[str]
    
    # Escalation
    escalated: bool
    escalated_to: Optional[UUID]
    escalated_to_name: Optional[str]
    escalated_at: Optional[datetime]
    escalation_reason: Optional[str]
    
    # Admin override
    overridden_by_admin: bool
    override_admin_id: Optional[UUID]
    override_timestamp: Optional[datetime]
    override_reason: Optional[str]
    
    # Comments count
    total_comments: int
    
    # Time tracking
    age_hours: int
    time_to_resolve_hours: Optional[int]


class ComplaintListItem(BaseSchema):
    """Complaint list item"""
    id: UUID
    complaint_number: str
    title: str
    
    category: str
    priority: str
    status: ComplaintStatus
    
    raised_by_name: str
    room_number: Optional[str]
    
    assigned_to_name: Optional[str]
    
    opened_at: datetime
    age_hours: int
    
    sla_breach: bool


class ComplaintSummary(BaseSchema):
    """Complaint summary for dashboard"""
    hostel_id: UUID
    
    total_complaints: int
    open_complaints: int
    in_progress_complaints: int
    resolved_complaints: int
    
    high_priority_count: int
    urgent_priority_count: int
    
    sla_breached_count: int
    
    average_resolution_time_hours: Decimal

# --- File: D:\hostel-management-saas\app\schemas\complaint\__init__.py ---
"""
Complaint schemas package
"""
from app.schemas.complaint.complaint_base import (
    ComplaintBase,
    ComplaintCreate,
    ComplaintUpdate
)
from app.schemas.complaint.complaint_response import (
    ComplaintResponse,
    ComplaintDetail,
    ComplaintListItem
)
from app.schemas.complaint.complaint_assignment import (
    AssignmentRequest,
    AssignmentResponse,
    ReassignmentRequest
)
from app.schemas.complaint.complaint_resolution import (
    ResolutionRequest,
    ResolutionResponse,
    ResolutionUpdate
)
from app.schemas.complaint.complaint_escalation import (
    EscalationRequest,
    EscalationResponse,
    EscalationHistory
)
from app.schemas.complaint.complaint_feedback import (
    FeedbackRequest,
    FeedbackResponse,
    FeedbackSummary
)
from app.schemas.complaint.complaint_comments import (
    CommentCreate,
    CommentResponse,
    CommentList
)
from app.schemas.complaint.complaint_filters import (
    ComplaintFilterParams,
    ComplaintSearchRequest,
    ComplaintSortOptions
)
from app.schemas.complaint.complaint_analytics import (
    ComplaintAnalytics,
    ResolutionMetrics,
    CategoryAnalysis
)

__all__ = [
    # Base
    "ComplaintBase",
    "ComplaintCreate",
    "ComplaintUpdate",
    
    # Response
    "ComplaintResponse",
    "ComplaintDetail",
    "ComplaintListItem",
    
    # Assignment
    "AssignmentRequest",
    "AssignmentResponse",
    "ReassignmentRequest",
    
    # Resolution
    "ResolutionRequest",
    "ResolutionResponse",
    "ResolutionUpdate",
    
    # Escalation
    "EscalationRequest",
    "EscalationResponse",
    "EscalationHistory",
    
    # Feedback
    "FeedbackRequest",
    "FeedbackResponse",
    "FeedbackSummary",
    
    # Comments
    "CommentCreate",
    "CommentResponse",
    "CommentList",
    
    # Filters
    "ComplaintFilterParams",
    "ComplaintSearchRequest",
    "ComplaintSortOptions",
    
    # Analytics
    "ComplaintAnalytics",
    "ResolutionMetrics",
    "CategoryAnalysis",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\fee_structure =====

# --- File: D:\hostel-management-saas\app\schemas\fee_structure\fee_base.py ---
"""
Base fee structure schemas
"""
from datetime import date
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseUpdateSchema
from app.schemas.common.enums import RoomType, FeeType, ChargeType


class FeeStructureBase(BaseSchema):
    """Base fee structure per hostel & room type"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    room_type: RoomType = Field(..., description="Room type to which this fee applies")
    fee_type: FeeType = Field(..., description="Billing frequency")

    amount: Decimal = Field(..., ge=0, description="Base rent amount per period")
    security_deposit: Decimal = Field(Decimal("0.00"), ge=0)

    includes_mess: bool = Field(False, description="Whether mess is included")
    mess_charges_monthly: Decimal = Field(Decimal("0.00"), ge=0)

    # Utility charges
    electricity_charges: ChargeType = Field(
        ChargeType.INCLUDED, description="How electricity is billed"
    )
    electricity_fixed_amount: Optional[Decimal] = Field(None, ge=0)

    water_charges: ChargeType = Field(
        ChargeType.INCLUDED, description="How water is billed"
    )
    water_fixed_amount: Optional[Decimal] = Field(None, ge=0)

    effective_from: date = Field(..., description="Fee effective start date")
    effective_to: Optional[date] = Field(None, description="End date (if any)")

    is_active: bool = Field(True)


class FeeStructureCreate(FeeStructureBase, BaseCreateSchema):
    """Create fee structure entry"""
    pass


class FeeStructureUpdate(BaseUpdateSchema):
    """Update fee structure"""
    amount: Optional[Decimal] = Field(None, ge=0)
    security_deposit: Optional[Decimal] = Field(None, ge=0)
    includes_mess: Optional[bool] = None
    mess_charges_monthly: Optional[Decimal] = Field(None, ge=0)
    electricity_charges: Optional[ChargeType] = None
    electricity_fixed_amount: Optional[Decimal] = Field(None, ge=0)
    water_charges: Optional[ChargeType] = None
    water_fixed_amount: Optional[Decimal] = Field(None, ge=0)
    effective_from: Optional[date] = None
    effective_to: Optional[date] = None
    is_active: Optional[bool] = None

# --- File: D:\hostel-management-saas\app\schemas\fee_structure\fee_config.py ---
"""
Fee configuration & breakdown schemas
"""
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.enums import RoomType, FeeType, ChargeType


class ChargesBreakdown(BaseSchema):
    """Breakdown of all components of a fee"""
    base_rent: Decimal
    mess_charges: Decimal
    electricity_charges: Decimal
    water_charges: Decimal
    other_charges: Decimal = Field(Decimal("0.00"))

    total_monthly: Decimal
    total_first_month: Decimal
    security_deposit: Decimal


class FeeConfiguration(BaseSchema):
    """Configuration for calculating total fees for a given booking/student"""
    hostel_id: UUID
    room_type: RoomType
    fee_type: FeeType

    # Components
    base_amount: Decimal
    security_deposit: Decimal
    includes_mess: bool
    mess_charges_monthly: Decimal

    electricity_charges: ChargeType
    electricity_fixed_amount: Optional[Decimal]
    water_charges: ChargeType
    water_fixed_amount: Optional[Decimal]

    # Derived breakdown
    breakdown: ChargesBreakdown

# --- File: D:\hostel-management-saas\app\schemas\fee_structure\fee_response.py ---
"""
Fee structure response schemas
"""
from datetime import date
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import RoomType, FeeType, ChargeType


class FeeStructureResponse(BaseResponseSchema):
    """Fee structure response"""
    hostel_id: UUID
    hostel_name: str

    room_type: RoomType
    fee_type: FeeType

    amount: Decimal
    security_deposit: Decimal

    includes_mess: bool
    mess_charges_monthly: Decimal

    electricity_charges: ChargeType
    electricity_fixed_amount: Optional[Decimal]

    water_charges: ChargeType
    water_fixed_amount: Optional[Decimal]

    effective_from: date
    effective_to: Optional[date]
    is_active: bool


class FeeDetail(BaseSchema):
    """Full fee detail for a room type (assembled for UI)"""
    room_type: RoomType
    fee_type: FeeType
    amount: Decimal
    security_deposit: Decimal
    includes_mess: bool
    mess_charges_monthly: Decimal
    total_first_month_payable: Decimal
    total_recurring_monthly: Decimal


class FeeStructureList(BaseSchema):
    """List of fee structures for a hostel"""
    hostel_id: UUID
    hostel_name: str
    items: List[FeeStructureResponse] = Field(default_factory=list)

# --- File: D:\hostel-management-saas\app\schemas\fee_structure\__init__.py ---
"""
Fee structure & configuration schemas package
"""

from app.schemas.fee_structure.fee_base import (
    FeeStructureBase,
    FeeStructureCreate,
    FeeStructureUpdate,
)
from app.schemas.fee_structure.fee_response import (
    FeeStructureResponse,
    FeeDetail,
    FeeStructureList,
)
from app.schemas.fee_structure.fee_config import (
    FeeConfiguration,
    ChargesBreakdown,
)

__all__ = [
    # Base
    "FeeStructureBase",
    "FeeStructureCreate",
    "FeeStructureUpdate",
    # Response
    "FeeStructureResponse",
    "FeeDetail",
    "FeeStructureList",
    # Config
    "FeeConfiguration",
    "ChargesBreakdown",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\file =====

# --- File: D:\hostel-management-saas\app\schemas\file\document_upload.py ---
"""
Document upload-specific schemas
"""
from datetime import date
from typing import Optional, List
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema
from app.schemas.file.file_upload import FileUploadInitResponse


class DocumentUploadInitRequest(BaseCreateSchema):
    """
    Initialize a document upload.

    For ID proofs, agreements, invoices, etc.
    """
    filename: str = Field(..., min_length=1, max_length=255)
    content_type: str = Field(
        ...,
        pattern=r"^(application\/pdf|image\/[a-zA-Z0-9.+-]+)$",
        description="Allowed: PDF or image formats",
    )
    size_bytes: int = Field(
        ...,
        ge=1,
        le=25 * 1024 * 1024,
        description="Max 25MB for documents",
    )

    uploaded_by_user_id: UUID
    student_id: Optional[UUID] = None
    hostel_id: Optional[UUID] = None

    document_type: str = Field(
        ...,
        pattern=(
            r"^(id_proof|address_proof|agreement|invoice|receipt|"
            r"medical_certificate|other)$"
        ),
        description="Type of document",
    )

    # Additional classification
    description: Optional[str] = Field(None, max_length=255)


class DocumentUploadInitResponse(FileUploadInitResponse):
    """Document-specific init response (same as generic for now)"""
    # Can be extended with OCR flags, etc.
    pass


class DocumentValidationResult(BaseSchema):
    """
    Result of backend-side document validation
    (e.g. mime, size, simple content checks).
    """
    storage_key: str
    is_valid: bool
    reason: Optional[str] = Field(None, description="Why invalid, if false")

    # Optional extracted info (non-PII summary)
    extracted_metadata: Optional[dict] = Field(
        None,
        description="e.g. issue_date, expiry_date (if parsed)",
    )


class DocumentInfo(BaseSchema):
    """Document info for student/admin views"""
    id: UUID
    storage_key: str
    url: HttpUrl

    document_type: str
    description: Optional[str]

    uploaded_by_user_id: UUID
    uploaded_by_name: Optional[str]

    uploaded_at: date
    verified: bool
    verified_by: Optional[UUID]
    verified_at: Optional[date]
    verification_notes: Optional[str]


class DocumentList(BaseSchema):
    """List of documents for a student/hostel"""
    owner_type: str = Field(..., pattern="^(student|hostel|system)$")
    owner_id: UUID

    documents: List[DocumentInfo] = Field(default_factory=list)
    total_documents: int

# --- File: D:\hostel-management-saas\app\schemas\file\file_response.py ---
"""
File information and listing schemas
"""
from datetime import datetime
from typing import List, Optional, Dict
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema


class FileMetadata(BaseSchema):
    """Additional metadata attached to a file"""
    content_type: str = Field(..., description="MIME type")
    size_bytes: int = Field(..., ge=0, description="File size in bytes")

    # Optional metadata
    original_filename: Optional[str] = Field(None, description="Original filename")
    tags: List[str] = Field(default_factory=list)
    category: Optional[str] = Field(None, description="Logical category")
    custom_metadata: Dict[str, str] = Field(
        default_factory=dict,
        description="Free-form key/value metadata (e.g. 'room_id', 'hostel_id')",
    )


class FileInfo(BaseResponseSchema):
    """Full file information as stored in the system"""
    storage_key: str = Field(..., description="Storage path/key (unique)")

    # Ownership / context
    uploaded_by_user_id: UUID
    hostel_id: Optional[UUID] = None

    # Access
    is_public: bool = Field(False, description="Publicly accessible or not")
    public_url: Optional[HttpUrl] = Field(None, description="Public CDN URL if is_public=True")
    signed_url: Optional[HttpUrl] = Field(
        None,
        description="Signed temporary URL for private access (optional)",
    )

    # Metadata
    metadata: FileMetadata

    # Audit
    created_at: datetime
    updated_at: datetime


class FileURL(BaseSchema):
    """Simple container for a file URL"""
    url: HttpUrl
    expires_at: Optional[datetime] = Field(
        None,
        description="If signed URL, when it will expire",
    )


class FileListResponse(BaseSchema):
    """Paginated list of files"""
    items: List[FileInfo] = Field(default_factory=list)
    total_items: int
    page: int
    page_size: int

# --- File: D:\hostel-management-saas\app\schemas\file\file_upload.py ---
"""
Generic file upload schemas (pre-signed URL / direct upload)
"""
from datetime import datetime
from typing import List, Optional, Dict
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema


class FileUploadInitRequest(BaseCreateSchema):
    """
    Request to initialize a file upload.

    Typically used to generate a pre-signed URL or
    register a file before multipart upload.
    """
    filename: str = Field(..., min_length=1, max_length=255)
    content_type: str = Field(
        ...,
        max_length=255,
        description="MIME type, e.g. 'image/jpeg', 'application/pdf'",
    )
    size_bytes: int = Field(
        ...,
        ge=1,
        le=50 * 1024 * 1024,
        description="Expected file size in bytes (max 50MB by default)",
    )

    # Logical location
    folder: Optional[str] = Field(
        None,
        max_length=255,
        description="Logical folder/path (e.g. 'hostels/123/photos')",
    )

    # Ownership / context
    uploaded_by_user_id: UUID = Field(..., description="User initiating upload")
    hostel_id: Optional[UUID] = Field(
        None,
        description="Hostel context (if file is hostel-specific)",
    )

    # Metadata / classification
    category: Optional[str] = Field(
        None,
        max_length=50,
        description="Category, e.g. 'hostel_photo', 'document', 'avatar'",
    )
    tags: List[str] = Field(
        default_factory=list,
        description="Free-form tags for search/filtering",
    )

    # Access control
    is_public: bool = Field(
        False,
        description="If true, file will be publicly accessible (CDN/public URL)",
    )


class FileUploadInitResponse(BaseResponseSchema):
    """
    Response for upload initialization.

    Either returns a direct upload URL (pre-signed) or
    indicates that the client should upload via the API.
    """
    filename: str
    content_type: str
    size_bytes: int

    storage_key: str = Field(
        ...,
        description="Internal storage key/path for this file",
    )

    # Pre-signed URL (for direct S3/GCS upload)
    upload_url: Optional[str] = Field(
        None,
        description="Pre-signed URL for direct upload to object storage",
    )
    upload_method: str = Field(
        "PUT",
        description="HTTP method to use with upload_url (PUT/POST)",
    )
    upload_headers: Dict[str, str] = Field(
        default_factory=dict,
        description="Any headers that must be included when uploading",
    )

    # Access information
    is_public: bool
    public_url: Optional[str] = Field(
        None,
        description="Public URL if file is/will be public",
    )


class FileUploadCompleteRequest(BaseCreateSchema):
    """
    Notify backend that the client finished uploading the file
    to the storage using the pre-signed URL.
    """
    storage_key: str = Field(..., description="Storage key returned in init response")
    uploaded_by_user_id: UUID = Field(..., description="User who uploaded")
    checksum: Optional[str] = Field(
        None,
        description="Optional checksum/ETag from storage to verify integrity",
    )

# --- File: D:\hostel-management-saas\app\schemas\file\image_upload.py ---
"""
Image upload-specific schemas
"""
from typing import List, Optional
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema
from app.schemas.file.file_upload import FileUploadInitResponse


class ImageUploadInitRequest(BaseCreateSchema):
    """
    Initialize an image upload.

    Used for hostel photos, room photos, avatars, etc.
    """
    filename: str = Field(..., min_length=1, max_length=255)
    content_type: str = Field(
        ...,
        pattern=r"^image\/[a-zA-Z0-9.+-]+$",
        description="Image MIME type, e.g. 'image/jpeg', 'image/png'",
    )
    size_bytes: int = Field(
        ...,
        ge=1,
        le=20 * 1024 * 1024,
        description="Max 20MB for images",
    )

    uploaded_by_user_id: UUID
    hostel_id: Optional[UUID] = None

    # Usage context
    usage: str = Field(
        ...,
        pattern=r"^(hostel_cover|hostel_gallery|room_photo|avatar|document_scan)$",
        description="Intended usage of the image",
    )

    # Optional transformations
    generate_variants: bool = Field(
        True,
        description="If true, system may generate resized variants",
    )


class ImageVariant(BaseSchema):
    """Information about an image variant (thumbnail, medium, etc.)"""
    name: str = Field(..., description="Variant name, e.g. 'thumbnail', 'medium'")
    url: HttpUrl = Field(..., description="URL for this variant")
    width: Optional[int] = Field(None, ge=1)
    height: Optional[int] = Field(None, ge=1)
    size_bytes: Optional[int] = Field(None, ge=0)


class ImageUploadInitResponse(FileUploadInitResponse):
    """
    Image-specific upload init response.

    Extends generic file upload init response with image-specific hints.
    """
    variants_planned: List[str] = Field(
        default_factory=lambda: ["thumbnail", "medium"],
        description="Variants the system will generate after upload (for reference)",
    )


class ImageProcessingResult(BaseSchema):
    """Result of post-upload image processing"""
    storage_key: str
    original_url: HttpUrl
    variants: List[ImageVariant] = Field(default_factory=list)

# --- File: D:\hostel-management-saas\app\schemas\file\__init__.py ---
"""
File management schemas package
"""

from app.schemas.file.file_upload import (
    FileUploadInitRequest,
    FileUploadInitResponse,
    FileUploadCompleteRequest,
)
from app.schemas.file.file_response import (
    FileInfo,
    FileMetadata,
    FileURL,
    FileListResponse,
)
from app.schemas.file.image_upload import (
    ImageUploadInitRequest,
    ImageUploadInitResponse,
    ImageVariant,
)
from app.schemas.file.document_upload import (
    DocumentUploadInitRequest,
    DocumentUploadInitResponse,
    DocumentValidationResult,
)

__all__ = [
    # Generic file
    "FileUploadInitRequest",
    "FileUploadInitResponse",
    "FileUploadCompleteRequest",
    "FileInfo",
    "FileMetadata",
    "FileURL",
    "FileListResponse",
    # Images
    "ImageUploadInitRequest",
    "ImageUploadInitResponse",
    "ImageVariant",
    # Documents
    "DocumentUploadInitRequest",
    "DocumentUploadInitResponse",
    "DocumentValidationResult",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\hostel =====

# --- File: D:\hostel-management-saas\app\schemas\hostel\hostel_admin.py ---
"""
Hostel admin view schemas
"""
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseUpdateSchema
from app.schemas.common.enums import HostelStatus, SubscriptionPlan


class HostelAdminView(BaseSchema):
    """Hostel view for administrators"""
    id: UUID
    name: str
    slug: str
    
    # Status
    status: HostelStatus
    is_active: bool
    is_public: bool
    is_featured: bool
    is_verified: bool
    
    # Stats
    total_rooms: int
    total_beds: int
    occupied_beds: int
    available_beds: int
    occupancy_percentage: Decimal
    
    # Students
    total_students: int
    active_students: int
    
    # Financial
    total_revenue_this_month: Decimal
    outstanding_payments: Decimal
    
    # Pending items
    pending_bookings: int
    pending_complaints: int
    pending_maintenance: int
    
    # Subscription
    subscription_plan: Optional[SubscriptionPlan]
    subscription_expires_at: Optional[datetime]
    
    # Performance
    average_rating: Decimal
    total_reviews: int


class HostelSettings(BaseUpdateSchema):
    """Hostel configuration settings"""
    # Visibility
    is_public: Optional[bool] = Field(None, description="Public listing visibility")
    is_active: Optional[bool] = Field(None, description="Hostel active status")
    
    # Booking settings
    auto_approve_bookings: bool = Field(False, description="Auto-approve booking requests")
    booking_advance_percentage: Decimal = Field(
        Decimal("20.00"),
        ge=0,
        le=100,
        description="Advance payment percentage"
    )
    max_booking_duration_months: int = Field(12, ge=1, le=24, description="Max booking duration")
    
    # Payment settings
    payment_due_day: int = Field(5, ge=1, le=28, description="Monthly payment due day")
    late_payment_grace_days: int = Field(3, ge=0, le=10, description="Grace period for late payments")
    
    # Attendance settings
    enable_attendance_tracking: bool = Field(True, description="Enable attendance system")
    minimum_attendance_percentage: Decimal = Field(
        Decimal("75.00"),
        ge=0,
        le=100,
        description="Minimum required attendance %"
    )
    
    # Notification settings
    notify_on_booking: bool = Field(True, description="Notify on new bookings")
    notify_on_complaint: bool = Field(True, description="Notify on complaints")
    notify_on_payment: bool = Field(True, description="Notify on payments")
    
    # Mess settings
    mess_included: bool = Field(False, description="Mess facility included")
    mess_charges_monthly: Optional[Decimal] = Field(None, ge=0, description="Monthly mess charges")


class HostelVisibilityUpdate(BaseUpdateSchema):
    """Update hostel visibility settings"""
    is_public: bool = Field(..., description="Make hostel publicly visible")
    is_featured: bool = Field(False, description="Feature hostel in search results")


class HostelCapacityUpdate(BaseUpdateSchema):
    """Update hostel capacity (admin only)"""
    total_rooms: int = Field(..., ge=1, description="Total number of rooms")
    total_beds: int = Field(..., ge=1, description="Total number of beds")


class HostelStatusUpdate(BaseUpdateSchema):
    """Update hostel operational status"""
    status: HostelStatus = Field(..., description="Hostel status")
    is_active: bool = Field(..., description="Active status")
    reason: Optional[str] = Field(None, description="Reason for status change")

# --- File: D:\hostel-management-saas\app\schemas\hostel\hostel_analytics.py ---
"""
Hostel analytics and reporting schemas
"""
from decimal import Decimal
from datetime import date, datetime
from typing import List, Optional, Dict
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.filters import DateRangeFilter


class HostelAnalytics(BaseSchema):
    """Comprehensive hostel analytics"""
    hostel_id: UUID
    hostel_name: str
    period_start: date
    period_end: date
    
    occupancy: "OccupancyAnalytics"
    revenue: "RevenueAnalytics"
    bookings: "BookingAnalytics"
    complaints: "ComplaintAnalytics"
    reviews: "ReviewAnalytics"
    generated_at: datetime


class OccupancyAnalytics(BaseSchema):
    """Occupancy analytics"""
    current_occupancy_rate: Decimal = Field(..., description="Current occupancy %")
    average_occupancy_rate: Decimal = Field(..., description="Average for period")
    peak_occupancy_rate: Decimal = Field(..., description="Peak occupancy")
    lowest_occupancy_rate: Decimal = Field(..., description="Lowest occupancy")
    
    total_beds: int
    occupied_beds: int
    available_beds: int
    
    # Trends
    occupancy_trend: List["OccupancyDataPoint"] = Field(default_factory=list)
    
    # Predictions
    predicted_occupancy_next_month: Optional[Decimal] = None


class OccupancyDataPoint(BaseSchema):
    """Occupancy data point for trends"""
    date: date
    occupancy_rate: Decimal
    occupied_beds: int
    total_beds: int


class RevenueAnalytics(BaseSchema):
    """Revenue analytics"""
    total_revenue: Decimal = Field(..., description="Total revenue for period")
    rent_revenue: Decimal
    mess_revenue: Decimal
    other_revenue: Decimal
    
    total_collected: Decimal
    total_pending: Decimal
    total_overdue: Decimal
    
    collection_rate: Decimal = Field(..., description="Payment collection rate %")
    
    # Trends
    revenue_trend: List["RevenueDataPoint"] = Field(default_factory=list)
    
    # Comparison
    revenue_vs_last_period: Decimal = Field(..., description="% change from last period")
    revenue_vs_last_year: Optional[Decimal] = None


class RevenueDataPoint(BaseSchema):
    """Revenue data point"""
    date: date
    revenue: Decimal
    collected: Decimal
    pending: Decimal


class BookingAnalytics(BaseSchema):
    """Booking analytics"""
    total_bookings: int
    approved_bookings: int
    pending_bookings: int
    rejected_bookings: int
    cancelled_bookings: int
    
    conversion_rate: Decimal = Field(..., description="Booking approval rate %")
    cancellation_rate: Decimal = Field(..., description="Cancellation rate %")
    
    # Sources
    booking_sources: Dict[str, int] = Field(default_factory=dict)
    
    # Trends
    booking_trend: List["BookingDataPoint"] = Field(default_factory=list)


class BookingDataPoint(BaseSchema):
    """Booking data point"""
    date: date
    total_bookings: int
    approved: int
    rejected: int


class ComplaintAnalytics(BaseSchema):
    """Complaint analytics"""
    total_complaints: int
    open_complaints: int
    resolved_complaints: int
    closed_complaints: int
    
    average_resolution_time_hours: Decimal
    resolution_rate: Decimal = Field(..., description="% of resolved complaints")
    
    # By category
    complaints_by_category: Dict[str, int] = Field(default_factory=dict)
    
    # By priority
    complaints_by_priority: Dict[str, int] = Field(default_factory=dict)
    
    # SLA compliance
    sla_compliance_rate: Decimal = Field(..., description="% meeting SLA")


class ReviewAnalytics(BaseSchema):
    """Review analytics"""
    total_reviews: int
    average_rating: Decimal
    
    # Rating distribution
    rating_distribution: Dict[str, int] = Field(
        default_factory=dict,
        description="Count of ratings by star (1-5)"
    )
    
    # Detailed ratings
    average_cleanliness_rating: Optional[Decimal] = None
    average_food_quality_rating: Optional[Decimal] = None
    average_staff_behavior_rating: Optional[Decimal] = None
    average_security_rating: Optional[Decimal] = None
    average_value_rating: Optional[Decimal] = None
    
    # Trends
    rating_trend: List["RatingDataPoint"] = Field(default_factory=list)


class RatingDataPoint(BaseSchema):
    """Rating data point"""
    month: str
    average_rating: Decimal
    review_count: int


class HostelOccupancyStats(BaseSchema):
    """Detailed occupancy statistics"""
    hostel_id: UUID
    
    # Current status
    total_rooms: int
    total_beds: int
    occupied_beds: int
    available_beds: int
    occupancy_percentage: Decimal
    
    # By room type
    occupancy_by_room_type: List["RoomTypeOccupancy"] = Field(default_factory=list)
    
    # Historical
    occupancy_history: List[OccupancyDataPoint] = Field(default_factory=list)
    
    # Projections
    projected_occupancy_30_days: Optional[Decimal] = None
    projected_occupancy_90_days: Optional[Decimal] = None


class RoomTypeOccupancy(BaseSchema):
    """Occupancy by room type"""
    room_type: str
    total_beds: int
    occupied_beds: int
    available_beds: int
    occupancy_percentage: Decimal


class HostelRevenueStats(BaseSchema):
    """Detailed revenue statistics"""
    hostel_id: UUID
    period: DateRangeFilter
    
    # Totals
    total_revenue: Decimal
    total_expenses: Decimal
    net_profit: Decimal
    profit_margin: Decimal
    
    # Revenue breakdown
    revenue_by_type: Dict[str, Decimal] = Field(default_factory=dict)
    
    # Collection
    total_collected: Decimal
    total_pending: Decimal
    total_overdue: Decimal
    collection_efficiency: Decimal
    
    # Monthly breakdown
    monthly_revenue: List["MonthlyRevenue"] = Field(default_factory=list)
    
    # Comparison
    revenue_growth_mom: Decimal = Field(..., description="Month-over-month growth %")
    revenue_growth_yoy: Optional[Decimal] = Field(None, description="Year-over-year growth %")


class MonthlyRevenue(BaseSchema):
    """Monthly revenue breakdown"""
    month: str  # YYYY-MM format
    revenue: Decimal
    collected: Decimal
    pending: Decimal
    student_count: int
    average_revenue_per_student: Decimal


class AnalyticsRequest(BaseSchema):
    """Analytics generation request"""
    hostel_id: UUID
    start_date: date
    end_date: date
    include_predictions: bool = Field(False, description="Include predictive analytics")
    granularity: str = Field("daily", pattern="^(daily|weekly|monthly)$")

# --- File: D:\hostel-management-saas\app\schemas\hostel\hostel_base.py ---
"""
Hostel base schemas
"""
from decimal import Decimal
from datetime import time
from typing import List, Optional
from pydantic import Field, HttpUrl, field_validator
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import HostelType, HostelStatus
from app.schemas.common.mixins import AddressMixin, ContactMixin, LocationMixin


class HostelBase(BaseSchema, AddressMixin, ContactMixin, LocationMixin):
    """Base hostel schema with common fields"""
    name: str = Field(..., min_length=3, max_length=255, description="Hostel name")
    slug: str = Field(..., min_length=3, max_length=255, pattern=r'^[a-z0-9-]+$', description="URL-friendly slug")
    description: Optional[str] = Field(None, max_length=2000, description="Hostel description")
    
    # Type
    hostel_type: HostelType = Field(..., description="Hostel type (boys/girls/co-ed)")
    
    # Website
    website_url: Optional[HttpUrl] = Field(None, description="Hostel website URL")
    
    # Pricing
    starting_price_monthly: Optional[Decimal] = Field(
        None,
        ge=0,
        max_digits=10,
        decimal_places=2,
        description="Starting monthly price"
    )
    currency: str = Field("INR", min_length=3, max_length=3, description="Currency code")
    
    # Amenities and facilities (JSON arrays)
    amenities: List[str] = Field(default_factory=list, description="List of amenities")
    facilities: List[str] = Field(default_factory=list, description="List of facilities")
    security_features: List[str] = Field(default_factory=list, description="Security features")
    
    # Policies
    rules: Optional[str] = Field(None, max_length=5000, description="Hostel rules and regulations")
    check_in_time: Optional[time] = Field(None, description="Standard check-in time")
    check_out_time: Optional[time] = Field(None, description="Standard check-out time")
    visitor_policy: Optional[str] = Field(None, max_length=1000, description="Visitor policy")
    late_entry_policy: Optional[str] = Field(None, max_length=1000, description="Late entry policy")
    
    # Location info
    nearby_landmarks: List[dict] = Field(
        default_factory=list,
        description="Nearby landmarks with name and distance"
    )
    connectivity_info: Optional[str] = Field(None, max_length=1000, description="Connectivity information")
    
    @field_validator('slug')
    @classmethod
    def validate_slug(cls, v: str) -> str:
        """Validate slug format"""
        if not v.replace('-', '').replace('_', '').isalnum():
            raise ValueError('Slug can only contain lowercase letters, numbers, and hyphens')
        return v.lower()
    
    @field_validator('amenities', 'facilities', 'security_features')
    @classmethod
    def validate_lists_not_empty(cls, v: List[str]) -> List[str]:
        """Remove empty strings from lists"""
        return [item.strip() for item in v if item.strip()]


class HostelCreate(HostelBase, BaseCreateSchema):
    """Schema for creating a hostel"""
    # Override to make certain fields required
    name: str = Field(..., min_length=3, max_length=255)
    hostel_type: HostelType = Field(...)
    contact_phone: str = Field(...)


class HostelUpdate(BaseUpdateSchema):
    """Schema for updating a hostel (all fields optional)"""
    name: Optional[str] = Field(None, min_length=3, max_length=255)
    slug: Optional[str] = Field(None, min_length=3, max_length=255)
    description: Optional[str] = Field(None, max_length=2000)
    hostel_type: Optional[HostelType] = None
    
    # Address fields
    address_line1: Optional[str] = None
    address_line2: Optional[str] = None
    city: Optional[str] = None
    state: Optional[str] = None
    pincode: Optional[str] = None
    country: Optional[str] = None
    
    # Contact
    contact_phone: Optional[str] = None
    alternate_phone: Optional[str] = None
    contact_email: Optional[str] = None
    
    # Location
    latitude: Optional[Decimal] = Field(None, ge=-90, le=90)
    longitude: Optional[Decimal] = Field(None, ge=-180, le=180)
    
    # Pricing
    starting_price_monthly: Optional[Decimal] = Field(None, ge=0)
    
    # Lists
    amenities: Optional[List[str]] = None
    facilities: Optional[List[str]] = None
    security_features: Optional[List[str]] = None
    
    # Policies
    rules: Optional[str] = None
    check_in_time: Optional[time] = None
    check_out_time: Optional[time] = None
    
    # Media
    cover_image_url: Optional[str] = None
    gallery_images: Optional[List[str]] = None
    virtual_tour_url: Optional[str] = None
    
    # Status
    status: Optional[HostelStatus] = None
    is_active: Optional[bool] = None


class HostelMediaUpdate(BaseUpdateSchema):
    """Update hostel media (images, videos)"""
    cover_image_url: Optional[str] = Field(None, description="Cover image URL")
    gallery_images: List[str] = Field(default_factory=list, description="Gallery image URLs")
    virtual_tour_url: Optional[HttpUrl] = Field(None, description="Virtual tour URL")


class HostelSEOUpdate(BaseUpdateSchema):
    """Update hostel SEO metadata"""
    meta_title: Optional[str] = Field(None, max_length=255, description="SEO meta title")
    meta_description: Optional[str] = Field(None, max_length=500, description="SEO meta description")
    meta_keywords: Optional[str] = Field(None, max_length=500, description="SEO keywords (comma-separated)")

# --- File: D:\hostel-management-saas\app\schemas\hostel\hostel_comparison.py ---
"""
Hostel comparison schemas
"""
from decimal import Decimal
from typing import List, Optional
from pydantic import Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.enums import HostelType


class HostelComparisonRequest(BaseCreateSchema):
    """Request to compare hostels"""
    hostel_ids: List[UUID] = Field(..., min_items=2, max_items=4, description="2-4 hostel IDs to compare")
    
    @field_validator('hostel_ids')
    @classmethod
    def validate_unique_ids(cls, v: List[UUID]) -> List[UUID]:
        """Ensure hostel IDs are unique"""
        if len(v) != len(set(v)):
            raise ValueError('Hostel IDs must be unique')
        return v


class ComparisonResult(BaseSchema):
    """Comparison result with all hostels"""
    hostels: List["ComparisonItem"] = Field(..., description="Hostels being compared")
    comparison_criteria: List[str] = Field(..., description="Criteria included in comparison")
    generated_at: datetime = Field(..., description="Comparison generation timestamp")


class ComparisonItem(BaseSchema):
    """Individual hostel comparison data"""
    id: UUID
    name: str
    slug: str
    hostel_type: HostelType
    
    # Location
    city: str
    state: str
    address: str
    distance_from_center_km: Optional[Decimal] = None
    
    # Pricing
    starting_price_monthly: Decimal
    price_range_monthly: str = Field(..., description="e.g., '₹5,000 - ₹15,000'")
    security_deposit: Optional[Decimal] = None
    
    # Capacity
    total_beds: int
    available_beds: int
    
    # Ratings
    average_rating: Decimal
    total_reviews: int
    rating_breakdown: Dict[str, int]
    
    # Amenities
    amenities: List[str]
    facilities: List[str]
    security_features: List[str]
    
    # Room types
    room_types_available: List[str]
    room_type_details: List["RoomTypeComparison"]
    
    # Policies
    check_in_time: Optional[str]
    check_out_time: Optional[str]
    visitor_allowed: bool
    
    # Media
    cover_image_url: Optional[str]
    total_images: int
    has_virtual_tour: bool
    
    # Highlights
    unique_features: List[str] = Field(default_factory=list)
    pros: List[str] = Field(default_factory=list)
    cons: List[str] = Field(default_factory=list)


class RoomTypeComparison(BaseSchema):
    """Room type details for comparison"""
    room_type: str
    price_monthly: Decimal
    available_beds: int
    total_beds: int
    amenities: List[str]


class ComparisonSummary(BaseSchema):
    """Comparison summary with recommendations"""
    best_for_budget: UUID = Field(..., description="Best value for money")
    best_rated: UUID = Field(..., description="Highest rated")
    best_location: Optional[UUID] = Field(None, description="Best location")
    most_amenities: UUID = Field(..., description="Most amenities")
    best_availability: UUID = Field(..., description="Best availability")
    
    price_comparison: "PriceComparison"
    amenity_comparison: "AmenityComparison"


class PriceComparison(BaseSchema):
    """Price comparison summary"""
    lowest_price: Decimal
    highest_price: Decimal
    average_price: Decimal
    price_difference_percentage: Decimal


class AmenityComparison(BaseSchema):
    """Amenity comparison summary"""
    common_amenities: List[str] = Field(..., description="Amenities all hostels have")
    unique_to_hostel: Dict[UUID, List[str]] = Field(..., description="Unique amenities per hostel")
    total_unique_amenities: int

# --- File: D:\hostel-management-saas\app\schemas\hostel\hostel_filter.py ---
"""
Hostel filter and sort schemas
"""
from decimal import Decimal
from typing import List, Optional
from pydantic import Field

from app.schemas.common.base import BaseFilterSchema
from app.schemas.common.enums import HostelType, HostelStatus


class HostelFilterParams(BaseFilterSchema):
    """Hostel listing filter parameters"""
    # Text search
    search: Optional[str] = Field(None, description="Search in name, description")
    
    # Location
    city: Optional[str] = None
    state: Optional[str] = None
    cities: Optional[List[str]] = Field(None, description="Filter by multiple cities")
    
    # Type
    hostel_type: Optional[HostelType] = None
    hostel_types: Optional[List[HostelType]] = None
    
    # Status
    status: Optional[HostelStatus] = None
    is_active: Optional[bool] = None
    is_public: Optional[bool] = None
    is_featured: Optional[bool] = None
    is_verified: Optional[bool] = None
    
    # Price range
    price_min: Optional[Decimal] = Field(None, ge=0)
    price_max: Optional[Decimal] = Field(None, ge=0)
    
    # Rating
    min_rating: Optional[Decimal] = Field(None, ge=0, le=5)
    
    # Availability
    has_availability: Optional[bool] = None
    min_available_beds: Optional[int] = Field(None, ge=0)
    
    # Amenities
    amenities: Optional[List[str]] = None
    
    # Admin filters
    admin_id: Optional[UUID] = Field(None, description="Filter by assigned admin")
    has_subscription: Optional[bool] = None


class HostelSortOptions(BaseFilterSchema):
    """Hostel sorting options"""
    sort_by: str = Field(
        "created_at",
        pattern="^(name|city|price|rating|occupancy|created_at|updated_at)$"
    )
    sort_order: str = Field("desc", pattern="^(asc|desc)$")


class AdvancedFilters(BaseFilterSchema):
    """Advanced filtering options"""
    # Date filters
    created_after: Optional[date] = None
    created_before: Optional[date] = None
    
    # Occupancy
    occupancy_min: Optional[Decimal] = Field(None, ge=0, le=100)
    occupancy_max: Optional[Decimal] = Field(None, ge=0, le=100)
    
    # Reviews
    min_reviews: Optional[int] = Field(None, ge=0)
    
    # Rooms
    min_rooms: Optional[int] = Field(None, ge=0)
    max_rooms: Optional[int] = Field(None, ge=0)
    
    # Revenue (admin only)
    revenue_min: Optional[Decimal] = Field(None, ge=0)
    revenue_max: Optional[Decimal] = Field(None, ge=0)


class BulkFilterParams(BaseFilterSchema):
    """Bulk operation filter parameters"""
    hostel_ids: List[UUID] = Field(..., min_items=1, description="List of hostel IDs")
    
    # Or use filters
    use_filters: bool = Field(False, description="Use filter criteria instead of IDs")
    filters: Optional[HostelFilterParams] = None

# --- File: D:\hostel-management-saas\app\schemas\hostel\hostel_public.py ---
"""
Public hostel profile schemas (for visitors)
"""
from decimal import Decimal
from datetime import time
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.enums import HostelType


class PublicHostelCard(BaseSchema):
    """Hostel card for public listing"""
    id: UUID
    name: str
    slug: str
    hostel_type: HostelType
    city: str
    state: str
    starting_price_monthly: Decimal
    currency: str
    average_rating: Decimal
    total_reviews: int
    available_beds: int
    cover_image_url: Optional[str]
    is_featured: bool
    amenities: List[str] = Field(default_factory=list, max_items=5, description="Top 5 amenities")
    distance_km: Optional[Decimal] = Field(None, description="Distance from search location")


class PublicHostelProfile(BaseSchema):
    """Complete public hostel profile"""
    id: UUID
    name: str
    slug: str
    description: Optional[str]
    hostel_type: HostelType
    
    # Contact (public)
    contact_phone: str
    contact_email: Optional[str]
    website_url: Optional[str]
    
    # Address
    address_line1: str
    address_line2: Optional[str]
    city: str
    state: str
    pincode: str
    latitude: Optional[Decimal]
    longitude: Optional[Decimal]
    
    # Pricing
    starting_price_monthly: Decimal
    currency: str
    
    # Availability
    available_beds: int
    
    # Ratings
    average_rating: Decimal
    total_reviews: int
    rating_breakdown: dict = Field(
        ...,
        description="Rating distribution {1: count, 2: count, ...}"
    )
    
    # Features
    amenities: List[str]
    facilities: List[str]
    security_features: List[str]
    
    # Policies
    rules: Optional[str]
    check_in_time: Optional[time]
    check_out_time: Optional[time]
    visitor_policy: Optional[str]
    
    # Location
    nearby_landmarks: List[dict]
    connectivity_info: Optional[str]
    
    # Media
    cover_image_url: Optional[str]
    gallery_images: List[str]
    virtual_tour_url: Optional[str]
    
    # Room types available
    room_types: List["PublicRoomType"]


class PublicRoomType(BaseSchema):
    """Public room type information"""
    room_type: str
    price_monthly: Decimal
    price_quarterly: Optional[Decimal]
    price_yearly: Optional[Decimal]
    available_beds: int
    total_beds: int
    room_amenities: List[str]
    room_images: List[str]


class PublicHostelList(BaseSchema):
    """List of public hostels"""
    hostels: List[PublicHostelCard]
    total_count: int
    filters_applied: dict

# --- File: D:\hostel-management-saas\app\schemas\hostel\hostel_response.py ---
"""
Hostel response schemas
"""
from decimal import Decimal
from datetime import datetime, time
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import HostelType, HostelStatus


class HostelResponse(BaseResponseSchema):
    """Basic hostel response"""
    name: str = Field(..., description="Hostel name")
    slug: str = Field(..., description="URL slug")
    hostel_type: HostelType = Field(..., description="Hostel type")
    city: str = Field(..., description="City")
    state: str = Field(..., description="State")
    starting_price_monthly: Optional[Decimal] = Field(None, description="Starting price")
    average_rating: Decimal = Field(..., description="Average rating")
    total_reviews: int = Field(..., description="Total reviews")
    total_rooms: int = Field(..., description="Total rooms")
    available_beds: int = Field(..., description="Available beds")
    is_public: bool = Field(..., description="Public visibility")
    is_featured: bool = Field(..., description="Featured status")
    cover_image_url: Optional[str] = Field(None, description="Cover image")
    status: HostelStatus = Field(..., description="Operational status")


class HostelDetail(BaseResponseSchema):
    """Detailed hostel information"""
    name: str
    slug: str
    description: Optional[str]
    
    # Type and contact
    hostel_type: HostelType
    contact_email: Optional[str]
    contact_phone: str
    alternate_phone: Optional[str]
    website_url: Optional[str]
    
    # Address
    address_line1: str
    address_line2: Optional[str]
    city: str
    state: str
    pincode: str
    country: str
    latitude: Optional[Decimal]
    longitude: Optional[Decimal]
    
    # Pricing
    starting_price_monthly: Optional[Decimal]
    currency: str
    
    # Capacity
    total_rooms: int
    total_beds: int
    occupied_beds: int
    available_beds: int
    
    # Ratings
    average_rating: Decimal
    total_reviews: int
    
    # Features
    amenities: List[str]
    facilities: List[str]
    security_features: List[str]
    
    # Policies
    rules: Optional[str]
    check_in_time: Optional[time]
    check_out_time: Optional[time]
    visitor_policy: Optional[str]
    late_entry_policy: Optional[str]
    
    # Location info
    nearby_landmarks: List[dict]
    connectivity_info: Optional[str]
    
    # Media
    cover_image_url: Optional[str]
    gallery_images: List[str]
    virtual_tour_url: Optional[str]
    
    # Status
    is_public: bool
    is_featured: bool
    is_verified: bool
    status: HostelStatus
    is_active: bool
    
    # SEO
    meta_title: Optional[str]
    meta_description: Optional[str]


class HostelListItem(BaseSchema):
    """Hostel list item (minimal info for lists)"""
    id: UUID
    name: str
    slug: str
    hostel_type: HostelType
    city: str
    state: str
    starting_price_monthly: Optional[Decimal]
    average_rating: Decimal
    total_reviews: int
    available_beds: int
    cover_image_url: Optional[str]
    is_featured: bool
    distance_km: Optional[Decimal] = Field(None, description="Distance from search location")


class HostelStats(BaseSchema):
    """Hostel statistics"""
    hostel_id: UUID
    
    # Occupancy
    total_rooms: int
    total_beds: int
    occupied_beds: int
    available_beds: int
    occupancy_percentage: Decimal
    
    # Revenue
    total_revenue_monthly: Decimal
    total_outstanding: Decimal
    
    # Students
    total_students: int
    active_students: int
    
    # Complaints
    open_complaints: int
    resolved_complaints: int
    
    # Bookings
    pending_bookings: int
    confirmed_bookings: int
    
    # Reviews
    average_rating: Decimal
    total_reviews: int
    
    # Last updated
    updated_at: datetime

# --- File: D:\hostel-management-saas\app\schemas\hostel\hostel_search.py ---
"""
Hostel search schemas
"""
from decimal import Decimal
from typing import List, Optional
from pydantic import Field

from app.schemas.common.base import BaseSchema, BaseFilterSchema
from app.schemas.common.enums import HostelType, RoomType
from app.schemas.hostel.hostel_public import PublicHostelCard


class HostelSearchRequest(BaseFilterSchema):
    """Hostel search request"""
    # Text search
    query: Optional[str] = Field(None, min_length=1, max_length=255, description="Search query")
    
    # Location filters
    city: Optional[str] = Field(None, description="City name")
    state: Optional[str] = Field(None, description="State name")
    pincode: Optional[str] = Field(None, pattern=r'^\d{6}$', description="Pincode")
    
    # Location-based search
    latitude: Optional[Decimal] = Field(None, ge=-90, le=90, description="Latitude for radius search")
    longitude: Optional[Decimal] = Field(None, ge=-180, le=180, description="Longitude for radius search")
    radius_km: Optional[Decimal] = Field(None, ge=0, le=50, description="Search radius in km")
    
    # Type filter
    hostel_type: Optional[HostelType] = Field(None, description="Hostel type filter")
    
    # Price filter
    min_price: Optional[Decimal] = Field(None, ge=0, description="Minimum monthly price")
    max_price: Optional[Decimal] = Field(None, ge=0, description="Maximum monthly price")
    
    # Room type
    room_type: Optional[RoomType] = Field(None, description="Preferred room type")
    
    # Amenities filter
    amenities: Optional[List[str]] = Field(None, description="Required amenities")
    
    # Availability
    available_beds_min: Optional[int] = Field(None, ge=0, description="Minimum available beds")
    
    # Rating filter
    min_rating: Optional[Decimal] = Field(None, ge=0, le=5, description="Minimum rating")
    
    # Features
    verified_only: bool = Field(False, description="Show only verified hostels")
    featured_only: bool = Field(False, description="Show only featured hostels")
    
    # Sort
    sort_by: str = Field(
        "relevance",
        pattern="^(relevance|price_low|price_high|rating|distance|newest)$",
        description="Sort criteria"
    )
    
    # Pagination
    page: int = Field(1, ge=1, description="Page number")
    page_size: int = Field(20, ge=1, le=100, description="Results per page")


class HostelSearchResponse(BaseSchema):
    """Hostel search response"""
    results: List[PublicHostelCard] = Field(..., description="Search results")
    total_results: int = Field(..., description="Total matching hostels")
    total_pages: int = Field(..., description="Total pages")
    current_page: int = Field(..., description="Current page")
    filters_applied: dict = Field(..., description="Applied filters summary")
    facets: "SearchFacets" = Field(..., description="Available filter facets")


class SearchFacets(BaseSchema):
    """Search facets for filtering"""
    cities: List["FacetItem"] = Field(default_factory=list, description="Available cities with counts")
    hostel_types: List["FacetItem"] = Field(default_factory=list, description="Hostel types with counts")
    price_ranges: List["PriceRangeFacet"] = Field(default_factory=list, description="Price ranges")
    amenities: List["FacetItem"] = Field(default_factory=list, description="Available amenities")
    ratings: List["RatingFacet"] = Field(default_factory=list, description="Rating distribution")


class FacetItem(BaseSchema):
    """Facet item with count"""
    value: str = Field(..., description="Facet value")
    label: str = Field(..., description="Display label")
    count: int = Field(..., description="Number of results")


class PriceRangeFacet(BaseSchema):
    """Price range facet"""
    min_price: Decimal
    max_price: Decimal
    label: str
    count: int


class RatingFacet(BaseSchema):
    """Rating facet"""
    min_rating: Decimal
    label: str
    count: int


class HostelSearchFilters(BaseFilterSchema):
    """Advanced search filters"""
    # Gender
    gender: Optional[str] = Field(None, pattern="^(boys|girls|co_ed)$", description="Gender preference")
    
    # Facilities
    has_wifi: Optional[bool] = None
    has_ac: Optional[bool] = None
    has_laundry: Optional[bool] = None
    has_parking: Optional[bool] = None
    has_gym: Optional[bool] = None
    has_mess: Optional[bool] = None
    
    # Security
    has_cctv: Optional[bool] = None
    has_security_guard: Optional[bool] = None
    
    # Rules
    allow_visitors: Optional[bool] = None
    
    # Availability
    check_in_date: Optional[date] = Field(None, description="Desired check-in date")

# --- File: D:\hostel-management-saas\app\schemas\hostel\__init__.py ---
"""
Hostel schemas package
"""
from app.schemas.hostel.hostel_base import (
    HostelBase,
    HostelCreate,
    HostelUpdate
)
from app.schemas.hostel.hostel_response import (
    HostelResponse,
    HostelDetail,
    HostelListItem,
    HostelStats
)
from app.schemas.hostel.hostel_public import (
    PublicHostelProfile,
    PublicHostelList,
    PublicHostelCard
)
from app.schemas.hostel.hostel_admin import (
    HostelAdminView,
    HostelSettings,
    HostelVisibilityUpdate
)
from app.schemas.hostel.hostel_search import (
    HostelSearchRequest,
    HostelSearchResponse,
    HostelSearchFilters
)
from app.schemas.hostel.hostel_filter import (
    HostelFilterParams,
    HostelSortOptions,
    AdvancedFilters
)
from app.schemas.hostel.hostel_analytics import (
    HostelAnalytics,
    HostelOccupancyStats,
    HostelRevenueStats
)
from app.schemas.hostel.hostel_comparison import (
    HostelComparisonRequest,
    ComparisonResult,
    ComparisonItem
)

__all__ = [
    # Base
    "HostelBase",
    "HostelCreate",
    "HostelUpdate",
    
    # Response
    "HostelResponse",
    "HostelDetail",
    "HostelListItem",
    "HostelStats",
    
    # Public
    "PublicHostelProfile",
    "PublicHostelList",
    "PublicHostelCard",
    
    # Admin
    "HostelAdminView",
    "HostelSettings",
    "HostelVisibilityUpdate",
    
    # Search
    "HostelSearchRequest",
    "HostelSearchResponse",
    "HostelSearchFilters",
    
    # Filter
    "HostelFilterParams",
    "HostelSortOptions",
    "AdvancedFilters",
    
    # Analytics
    "HostelAnalytics",
    "HostelOccupancyStats",
    "HostelRevenueStats",
    
    # Comparison
    "HostelComparisonRequest",
    "ComparisonResult",
    "ComparisonItem",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\inquiry =====

# --- File: D:\hostel-management-saas\app\schemas\inquiry\inquiry_base.py ---
"""
Base visitor inquiry schemas
"""
from datetime import date, datetime
from typing import Optional
from pydantic import Field, EmailStr
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.enums import InquiryStatus, RoomType


class InquiryBase(BaseSchema):
    """Base visitor inquiry fields"""
    hostel_id: UUID = Field(..., description="Hostel being inquired about")

    visitor_name: str = Field(..., min_length=2, max_length=255)
    visitor_email: EmailStr = Field(..., description="Visitor email")
    visitor_phone: str = Field(..., pattern=r"^\+?[1-9]\d{9,14}$")

    preferred_check_in_date: Optional[date] = None
    stay_duration_months: Optional[int] = Field(None, ge=1, le=36)
    room_type_preference: Optional[RoomType] = None

    message: Optional[str] = Field(None, max_length=2000)

    inquiry_source: str = Field(
        "website",
        pattern=r"^(website|mobile_app|referral|social_media|other)$",
        description="Source of inquiry",
    )

    status: InquiryStatus = Field(InquiryStatus.NEW)


class InquiryCreate(InquiryBase, BaseCreateSchema):
    """Create visitor inquiry"""
    pass

# --- File: D:\hostel-management-saas\app\schemas\inquiry\inquiry_response.py ---
"""
Inquiry response schemas
"""
from datetime import datetime, date
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import InquiryStatus, RoomType


class InquiryResponse(BaseResponseSchema):
    """Basic inquiry response"""
    hostel_id: UUID
    hostel_name: str

    visitor_name: str
    visitor_email: str
    visitor_phone: str

    preferred_check_in_date: Optional[date]
    stay_duration_months: Optional[int]
    room_type_preference: Optional[RoomType]

    status: InquiryStatus
    created_at: datetime


class InquiryDetail(BaseResponseSchema):
    """Detailed inquiry view"""
    hostel_id: UUID
    hostel_name: str

    visitor_name: str
    visitor_email: str
    visitor_phone: str

    preferred_check_in_date: Optional[date]
    stay_duration_months: Optional[int]
    room_type_preference: Optional[RoomType]

    message: Optional[str]

    inquiry_source: str
    status: InquiryStatus

    contacted_by: Optional[UUID]
    contacted_by_name: Optional[str]
    contacted_at: Optional[datetime]

    notes: Optional[str]

    created_at: datetime
    updated_at: datetime


class InquiryListItem(BaseSchema):
    """List item for inquiries"""
    id: UUID
    hostel_name: str
    visitor_name: str
    visitor_phone: str
    preferred_check_in_date: Optional[date]
    stay_duration_months: Optional[int]
    room_type_preference: Optional[RoomType]
    status: InquiryStatus
    created_at: datetime

# --- File: D:\hostel-management-saas\app\schemas\inquiry\inquiry_status.py ---
"""
Inquiry status change & assignment schemas
"""
from datetime import datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema
from app.schemas.common.enums import InquiryStatus


class InquiryStatusUpdate(BaseCreateSchema):
    """Update inquiry status"""
    inquiry_id: UUID
    new_status: InquiryStatus
    notes: Optional[str] = Field(None, max_length=500)


class InquiryAssignment(BaseCreateSchema):
    """Assign inquiry to an admin/staff"""
    inquiry_id: UUID
    assigned_to: UUID
    assigned_by: UUID

    assignment_notes: Optional[str] = Field(None, max_length=500)


class InquiryTimelineEntry(BaseSchema):
    """Timeline record for inquiry lifetime"""
    status: InquiryStatus
    timestamp: datetime
    changed_by: Optional[UUID]
    notes: Optional[str]

# --- File: D:\hostel-management-saas\app\schemas\inquiry\__init__.py ---
"""
Visitor inquiry & contact schemas package
"""

from app.schemas.inquiry.inquiry_base import (
    InquiryBase,
    InquiryCreate,
)
from app.schemas.inquiry.inquiry_response import (
    InquiryResponse,
    InquiryDetail,
    InquiryListItem,
)
from app.schemas.inquiry.inquiry_status import (
    InquiryStatusUpdate,
    InquiryAssignment,
)

__all__ = [
    # Base
    "InquiryBase",
    "InquiryCreate",
    # Response
    "InquiryResponse",
    "InquiryDetail",
    "InquiryListItem",
    # Status/assignment
    "InquiryStatusUpdate",
    "InquiryAssignment",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\leave =====

# --- File: D:\hostel-management-saas\app\schemas\leave\leave_application.py ---
"""
Leave application & cancellation request schemas
"""
from datetime import date
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema
from app.schemas.common.enums import LeaveType


class LeaveApplicationRequest(BaseCreateSchema):
    """Student-sent leave application request"""
    student_id: UUID
    hostel_id: UUID

    leave_type: LeaveType
    from_date: date
    to_date: date
    reason: str = Field(..., min_length=10, max_length=1000)

    contact_during_leave: Optional[str] = Field(None, max_length=20)
    emergency_contact: Optional[str] = Field(None, max_length=20)

    supporting_document_url: Optional[str] = None


class LeaveCancellationRequest(BaseCreateSchema):
    """Student request to cancel an already approved/pending leave"""
    leave_id: UUID
    student_id: UUID

    cancellation_reason: str = Field(..., min_length=10, max_length=500)

# --- File: D:\hostel-management-saas\app\schemas\leave\leave_approval.py ---
"""
Leave approval & workflow schemas
"""
from datetime import datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema
from app.schemas.common.enums import LeaveStatus


class LeaveApprovalRequest(BaseCreateSchema):
    """Supervisor/admin leave approval/rejection"""
    leave_id: UUID
    approver_id: UUID

    approve: bool
    approval_notes: Optional[str] = Field(
        None, max_length=500, description="Additional notes"
    )

    # If rejecting
    rejection_reason: Optional[str] = Field(None, max_length=500)


class LeaveApprovalResponse(BaseSchema):
    """Approval outcome"""
    leave_id: UUID
    status: LeaveStatus

    approved_by: Optional[UUID]
    approved_by_name: Optional[str]
    approved_at: Optional[datetime]

    rejected_by: Optional[UUID]
    rejected_by_name: Optional[str]
    rejected_at: Optional[datetime]

    message: str

# --- File: D:\hostel-management-saas\app\schemas\leave\leave_balance.py ---
"""
Leave balance schemas
"""
from datetime import date
from typing import List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.enums import LeaveType


class LeaveBalance(BaseSchema):
    """Leave balance for a single leave type"""
    leave_type: LeaveType
    allocated_per_year: int = Field(..., ge=0)
    used_days: int = Field(..., ge=0)
    remaining_days: int = Field(..., ge=0)


class LeaveBalanceSummary(BaseSchema):
    """Overall leave balance for a student"""
    student_id: UUID
    student_name: str
    hostel_id: UUID
    hostel_name: str

    academic_year_start: date
    academic_year_end: date

    balances: List[LeaveBalance] = Field(default_factory=list)

# --- File: D:\hostel-management-saas\app\schemas\leave\leave_base.py ---
"""
Base leave schemas
"""
from datetime import date
from typing import Optional
from pydantic import Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseUpdateSchema
from app.schemas.common.enums import LeaveType, LeaveStatus


class LeaveBase(BaseSchema):
    """Base leave application fields"""
    student_id: UUID = Field(..., description="Student requesting leave")
    hostel_id: UUID = Field(..., description="Hostel context")

    leave_type: LeaveType = Field(..., description="Type of leave")
    from_date: date = Field(..., description="Start of leave")
    to_date: date = Field(..., description="End of leave")
    total_days: int = Field(..., ge=1, description="Computed total leave days")

    reason: str = Field(..., min_length=10, max_length=1000, description="Leave reason")

    contact_during_leave: Optional[str] = Field(
        None, max_length=20, description="Contact phone during leave"
    )
    emergency_contact: Optional[str] = Field(
        None, max_length=20, description="Emergency contact during leave"
    )

    supporting_document_url: Optional[str] = Field(
        None, description="Document URL (e.g. medical certificate)"
    )

    @field_validator("total_days")
    @classmethod
    def validate_total_days(cls, v: int, info):
        if "from_date" in info.data and "to_date" in info.data:
            fd = info.data["from_date"]
            td = info.data["to_date"]
            days = (td - fd).days + 1
            if days != v:
                raise ValueError("total_days must equal (to_date - from_date + 1)")
        return v


class LeaveCreate(LeaveBase, BaseCreateSchema):
    """Create leave application"""
    pass


class LeaveUpdate(BaseUpdateSchema):
    """Update leave application (typically before approval)"""
    leave_type: Optional[LeaveType] = None
    from_date: Optional[date] = None
    to_date: Optional[date] = None
    total_days: Optional[int] = Field(None, ge=1)
    reason: Optional[str] = None
    contact_during_leave: Optional[str] = None
    emergency_contact: Optional[str] = None
    supporting_document_url: Optional[str] = None
    status: Optional[LeaveStatus] = None

# --- File: D:\hostel-management-saas\app\schemas\leave\leave_response.py ---
"""
Leave response schemas
"""
from datetime import date, datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import LeaveType, LeaveStatus


class LeaveResponse(BaseResponseSchema):
    """Leave list item for basic display"""
    student_id: UUID
    student_name: str
    hostel_id: UUID
    hostel_name: str

    leave_type: LeaveType
    from_date: date
    to_date: date
    total_days: int

    status: LeaveStatus
    applied_at: datetime


class LeaveDetail(BaseResponseSchema):
    """Detailed leave view"""
    student_id: UUID
    student_name: str
    student_room: Optional[str]

    hostel_id: UUID
    hostel_name: str

    leave_type: LeaveType
    from_date: date
    to_date: date
    total_days: int
    reason: str

    contact_during_leave: Optional[str]
    emergency_contact: Optional[str]
    supporting_document_url: Optional[str]

    status: LeaveStatus
    applied_at: datetime
    approved_at: Optional[datetime]
    rejected_at: Optional[datetime]
    cancelled_at: Optional[datetime]

    approved_by: Optional[UUID]
    approved_by_name: Optional[str]
    rejected_by: Optional[UUID]
    rejected_by_name: Optional[str]

    rejection_reason: Optional[str]
    cancellation_reason: Optional[str]


class LeaveListItem(BaseSchema):
    """List row for leave applications"""
    id: UUID
    student_name: str
    room_number: Optional[str]
    leave_type: LeaveType
    from_date: date
    to_date: date
    total_days: int
    status: LeaveStatus
    applied_at: datetime

# --- File: D:\hostel-management-saas\app\schemas\leave\__init__.py ---
"""
Leave management schemas package
"""

from app.schemas.leave.leave_base import (
    LeaveBase,
    LeaveCreate,
    LeaveUpdate,
)
from app.schemas.leave.leave_response import (
    LeaveResponse,
    LeaveDetail,
    LeaveListItem,
)
from app.schemas.leave.leave_application import (
    LeaveApplicationRequest,
    LeaveCancellationRequest,
)
from app.schemas.leave.leave_approval import (
    LeaveApprovalRequest,
    LeaveApprovalResponse,
)
from app.schemas.leave.leave_balance import (
    LeaveBalance,
    LeaveBalanceSummary,
)

__all__ = [
    # Base
    "LeaveBase",
    "LeaveCreate",
    "LeaveUpdate",
    # Response
    "LeaveResponse",
    "LeaveDetail",
    "LeaveListItem",
    # Application
    "LeaveApplicationRequest",
    "LeaveCancellationRequest",
    # Approval
    "LeaveApprovalRequest",
    "LeaveApprovalResponse",
    # Balance
    "LeaveBalance",
    "LeaveBalanceSummary",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\maintenance =====

# --- File: D:\hostel-management-saas\app\schemas\maintenance\maintenance_analytics.py ---
"""
Maintenance analytics schemas
"""
from datetime import date
from decimal import Decimal
from typing import Dict, List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.filters import DateRangeFilter


class MaintenanceAnalytics(BaseSchema):
    """Comprehensive maintenance analytics"""
    hostel_id: Optional[UUID] = None
    period: DateRangeFilter
    generated_at: datetime
    
    # Summary
    total_requests: int
    completed_requests: int
    pending_requests: int
    
    # Cost
    total_cost: Decimal
    average_cost: Decimal
    
    # Performance
    average_completion_time_hours: Decimal
    completion_rate: Decimal
    
    # Category breakdown
    requests_by_category: Dict[str, int]
    cost_by_category: Dict[str, Decimal]
    
    # Trends
    request_trend: List["TrendPoint"]
    cost_trend: List["CostTrendPoint"]


class TrendPoint(BaseSchema):
    """Trend data point"""
    period: str
    request_count: int
    completed_count: int


class CostTrendPoint(BaseSchema):
    """Cost trend point"""
    period: str
    total_cost: Decimal
    request_count: int
    average_cost: Decimal


class CategoryBreakdown(BaseSchema):
    """Breakdown by category"""
    category: str
    total_requests: int
    completed_requests: int
    total_cost: Decimal
    average_cost: Decimal
    average_completion_time_hours: Decimal


class VendorPerformance(BaseSchema):
    """Vendor performance metrics"""
    vendor_name: str
    
    total_jobs: int
    completed_jobs: int
    on_time_completion_rate: Decimal
    
    average_cost: Decimal
    cost_competitiveness: str  # low/medium/high
    
    quality_rating: Optional[Decimal]
    
    total_spent: Decimal

# --- File: D:\hostel-management-saas\app\schemas\maintenance\maintenance_approval.py ---
"""
Maintenance approval schemas
"""
from decimal import Decimal
from datetime import datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class ApprovalRequest(BaseCreateSchema):
    """Request approval for maintenance (supervisor to admin)"""
    maintenance_id: UUID
    
    # Cost details
    estimated_cost: Decimal = Field(..., ge=0)
    cost_breakdown: Optional[dict] = Field(None, description="Detailed cost breakdown")
    
    # Justification
    approval_reason: str = Field(..., min_length=20, max_length=500)
    
    # Urgency
    urgent: bool = Field(False)
    
    # Preferred vendor
    preferred_vendor: Optional[str] = None
    vendor_quote: Optional[str] = None


class ApprovalResponse(BaseSchema):
    """Approval response"""
    maintenance_id: UUID
    request_number: str
    
    approved: bool
    approved_by: UUID
    approved_by_name: str
    approved_at: datetime
    
    # Approved amount (may differ from requested)
    approved_amount: Decimal
    
    # Conditions
    approval_conditions: Optional[str] = None
    
    message: str


class ThresholdConfig(BaseSchema):
    """Approval threshold configuration"""
    hostel_id: UUID
    
    # Supervisor threshold
    supervisor_approval_limit: Decimal = Field(
        Decimal("5000.00"),
        ge=0,
        description="Amount supervisor can approve independently"
    )
    
    # Admin required above this
    admin_approval_required_above: Decimal = Field(Decimal("5000.00"), ge=0)
    
    # Auto-approve below threshold
    auto_approve_below: Decimal = Field(Decimal("1000.00"), ge=0)
    
    # Emergency handling
    emergency_bypass_threshold: bool = Field(
        True,
        description="Allow emergency requests to bypass threshold"
    )


class ApprovalWorkflow(BaseSchema):
    """Approval workflow status"""
    maintenance_id: UUID
    request_number: str
    
    estimated_cost: Decimal
    threshold_exceeded: bool
    
    requires_approval: bool
    approval_pending: bool
    
    # Current approver
    pending_with: Optional[UUID] = None
    pending_with_name: Optional[str] = None
    
    # Timeline
    submitted_for_approval_at: Optional[datetime] = None
    approval_deadline: Optional[datetime] = None


class RejectionRequest(BaseCreateSchema):
    """Reject approval request"""
    maintenance_id: UUID
    rejection_reason: str = Field(..., min_length=20, max_length=500)
    
    # Suggestions
    suggested_alternative: Optional[str] = None
    suggested_cost_reduction: Optional[Decimal] = None

# --- File: D:\hostel-management-saas\app\schemas\maintenance\maintenance_assignment.py ---
"""
Maintenance assignment schemas
"""
from datetime import datetime, date
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class TaskAssignment(BaseSchema):
    """Assign maintenance task to staff/vendor"""
    maintenance_id: UUID
    request_number: str
    
    assigned_to: UUID
    assigned_to_name: str
    assigned_by: UUID
    assigned_by_name: str
    
    assigned_at: datetime
    
    # Deadline
    deadline: Optional[date] = None
    
    # Instructions
    instructions: Optional[str] = None


class VendorAssignment(BaseCreateSchema):
    """Assign to external vendor"""
    maintenance_id: UUID
    
    vendor_name: str = Field(..., min_length=2, max_length=255)
    vendor_contact: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$')
    vendor_email: Optional[str] = None
    
    # Quote
    quoted_amount: Decimal = Field(..., ge=0)
    payment_terms: Optional[str] = None
    
    # Timeline
    estimated_completion_date: date
    
    # Contract
    work_order_number: Optional[str] = None
    contract_details: Optional[str] = None


class AssignmentUpdate(BaseCreateSchema):
    """Update assignment"""
    maintenance_id: UUID
    
    # Reassignment
    new_assigned_to: Optional[UUID] = None
    reassignment_reason: Optional[str] = None
    
    # Deadline change
    new_deadline: Optional[date] = None
    
    # Additional instructions
    additional_instructions: Optional[str] = None


class BulkAssignment(BaseCreateSchema):
    """Assign multiple requests to same person"""
    maintenance_ids: List[UUID] = Field(..., min_items=1)
    assigned_to: UUID
    
    common_deadline: Optional[date] = None
    instructions: Optional[str] = None


class AssignmentHistory(BaseSchema):
    """Assignment history for request"""
    maintenance_id: UUID
    assignments: List["AssignmentEntry"]


class AssignmentEntry(BaseSchema):
    """Individual assignment entry"""
    assigned_to: UUID
    assigned_to_name: str
    assigned_by: UUID
    assigned_by_name: str
    assigned_at: datetime
    
    # Completion
    completed: bool = Field(False)
    completed_at: Optional[datetime] = None
    
    # If reassigned
    reassigned: bool = Field(False)
    reassignment_reason: Optional[str] = None

# --- File: D:\hostel-management-saas\app\schemas\maintenance\maintenance_base.py ---
"""
Maintenance base schemas
"""
from datetime import date
from decimal import Decimal
from typing import List, Optional
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import MaintenanceCategory, MaintenanceStatus, MaintenanceIssueType, Priority


class MaintenanceBase(BaseSchema):
    """Base maintenance schema"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    requested_by: UUID = Field(..., description="User who requested")
    room_id: Optional[UUID] = Field(None, description="Room where issue exists")
    
    # Request details
    title: str = Field(..., min_length=5, max_length=255, description="Issue title")
    description: str = Field(..., min_length=20, max_length=2000, description="Detailed description")
    
    category: MaintenanceCategory = Field(..., description="Maintenance category")
    priority: Priority = Field(Priority.MEDIUM, description="Priority level")
    issue_type: MaintenanceIssueType = Field(MaintenanceIssueType.ROUTINE, description="Issue type")
    
    # Location
    location: Optional[str] = Field(None, max_length=500, description="Location details")
    floor: Optional[int] = Field(None, ge=0, description="Floor number")
    specific_area: Optional[str] = Field(None, max_length=255, description="Specific area")
    
    # Attachments
    issue_photos: List[HttpUrl] = Field(default_factory=list, description="Issue photos")


class MaintenanceCreate(MaintenanceBase, BaseCreateSchema):
    """Create maintenance request"""
    pass


class MaintenanceUpdate(BaseUpdateSchema):
    """Update maintenance request"""
    title: Optional[str] = Field(None, min_length=5, max_length=255)
    description: Optional[str] = Field(None, min_length=20, max_length=2000)
    category: Optional[MaintenanceCategory] = None
    priority: Optional[Priority] = None
    location: Optional[str] = None
    
    # Status
    status: Optional[MaintenanceStatus] = None
    
    # Cost
    estimated_cost: Optional[Decimal] = Field(None, ge=0)
    actual_cost: Optional[Decimal] = Field(None, ge=0)


class MaintenanceStatusUpdate(BaseUpdateSchema):
    """Update maintenance status"""
    status: MaintenanceStatus = Field(..., description="New status")
    notes: Optional[str] = Field(None, max_length=500)

# --- File: D:\hostel-management-saas\app\schemas\maintenance\maintenance_completion.py ---
"""
Maintenance completion schemas
"""
from datetime import datetime, date
from decimal import Decimal
from typing import List, Optional
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class CompletionRequest(BaseCreateSchema):
    """Mark maintenance as completed"""
    maintenance_id: UUID
    
    # Completion details
    work_notes: str = Field(..., min_length=20, max_length=2000, description="Work performed")
    
    # Materials used
    materials_used: List["MaterialItem"] = Field(default_factory=list)
    
    # Labor
    labor_hours: Decimal = Field(..., ge=0, description="Labor hours spent")
    
    # Cost
    actual_cost: Decimal = Field(..., ge=0, description="Actual cost incurred")
    cost_breakdown: Optional[dict] = None
    
    # Photos
    completion_photos: List[HttpUrl] = Field(default_factory=list, description="After photos")
    
    # Timeline
    actual_completion_date: date = Field(..., description="Actual completion date")
    
    # Follow-up
    follow_up_required: bool = Field(False)
    follow_up_notes: Optional[str] = None


class MaterialItem(BaseSchema):
    """Material used in maintenance"""
    material_name: str = Field(..., min_length=2, max_length=255)
    quantity: Decimal = Field(..., ge=0)
    unit: str = Field(..., description="Unit of measurement (pcs, kg, liters, etc.)")
    unit_cost: Decimal = Field(..., ge=0)
    total_cost: Decimal = Field(..., ge=0)
    
    supplier: Optional[str] = None


class QualityCheck(BaseCreateSchema):
    """Quality check for completed work"""
    maintenance_id: UUID
    
    # Inspection
    quality_check_passed: bool = Field(..., description="Quality check result")
    
    # Checklist
    checklist_items: List["ChecklistItem"] = Field(default_factory=list)
    
    # Notes
    quality_check_notes: Optional[str] = Field(None, max_length=1000)
    
    # Inspector
    checked_by: UUID
    
    # Follow-up actions
    rework_required: bool = Field(False)
    rework_details: Optional[str] = None


class ChecklistItem(BaseSchema):
    """Quality check checklist item"""
    item_description: str
    status: str = Field(..., pattern="^(pass|fail|na)$")
    notes: Optional[str] = None


class CompletionResponse(BaseSchema):
    """Completion response"""
    maintenance_id: UUID
    request_number: str
    
    completed: bool
    completed_at: datetime
    completed_by: UUID
    completed_by_name: str
    
    # Cost summary
    estimated_cost: Decimal
    actual_cost: Decimal
    cost_variance: Decimal
    within_budget: bool
    
    # Quality
    quality_checked: bool
    quality_check_passed: Optional[bool]
    
    message: str


class CompletionCertificate(BaseSchema):
    """Work completion certificate"""
    maintenance_id: UUID
    request_number: str
    certificate_number: str
    
    # Work details
    work_description: str
    materials_used: List[MaterialItem]
    labor_hours: Decimal
    
    # Cost
    total_cost: Decimal
    
    # Parties
    completed_by: str
    verified_by: str
    approved_by: str
    
    # Dates
    completion_date: date
    verification_date: date
    certificate_issue_date: date
    
    # Warranty
    warranty_period_months: Optional[int] = None
    warranty_terms: Optional[str] = None

# --- File: D:\hostel-management-saas\app\schemas\maintenance\maintenance_cost.py ---
"""
Maintenance cost tracking schemas
"""
from datetime import date
from decimal import Decimal
from typing import List, Optional, Dict
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.filters import DateRangeFilter


class CostTracking(BaseSchema):
    """Cost tracking for maintenance request"""
    maintenance_id: UUID
    request_number: str
    
    estimated_cost: Decimal
    approved_cost: Decimal
    actual_cost: Decimal
    
    variance: Decimal
    variance_percentage: Decimal
    
    within_budget: bool
    
    # Breakdown
    materials_cost: Decimal
    labor_cost: Decimal
    vendor_charges: Decimal
    other_costs: Decimal


class BudgetAllocation(BaseSchema):
    """Budget allocation for hostel maintenance"""
    hostel_id: UUID
    hostel_name: str
    
    fiscal_year: str  # YYYY format
    
    # Budget
    total_budget: Decimal
    allocated_budget: Decimal
    spent_amount: Decimal
    remaining_budget: Decimal
    
    utilization_percentage: Decimal
    
    # By category
    budget_by_category: Dict[str, "CategoryBudget"]


class CategoryBudget(BaseSchema):
    """Budget for maintenance category"""
    category: str
    allocated: Decimal
    spent: Decimal
    remaining: Decimal
    utilization_percentage: Decimal


class ExpenseReport(BaseSchema):
    """Maintenance expense report"""
    hostel_id: Optional[UUID] = None
    report_period: DateRangeFilter
    generated_at: datetime
    
    # Summary
    total_expenses: Decimal
    total_requests: int
    average_cost_per_request: Decimal
    
    # By category
    expenses_by_category: Dict[str, Decimal]
    
    # By month
    monthly_expenses: List["MonthlyExpense"]
    
    # By priority
    expenses_by_priority: Dict[str, Decimal]
    
    # Top expenses
    top_expensive_requests: List["ExpenseItem"]


class MonthlyExpense(BaseSchema):
    """Monthly expense summary"""
    month: str  # YYYY-MM
    total_expenses: Decimal
    request_count: int
    average_cost: Decimal


class ExpenseItem(BaseSchema):
    """Individual expense item"""
    maintenance_id: UUID
    request_number: str
    title: str
    category: str
    actual_cost: Decimal
    completion_date: date


class VendorInvoice(BaseCreateSchema):
    """Vendor invoice for maintenance"""
    maintenance_id: UUID
    
    vendor_name: str
    invoice_number: str
    invoice_date: date
    
    # Items
    line_items: List["InvoiceLineItem"]
    
    # Amounts
    subtotal: Decimal
    tax_amount: Decimal
    total_amount: Decimal
    
    # Payment
    payment_terms: str
    due_date: date
    
    # Attachments
    invoice_document_url: Optional[str] = None


class InvoiceLineItem(BaseSchema):
    """Invoice line item"""
    description: str
    quantity: Decimal
    unit_price: Decimal
    total_price: Decimal


class CostAnalysis(BaseSchema):
    """Cost analysis and trends"""
    hostel_id: UUID
    analysis_period: DateRangeFilter
    
    # Trends
    cost_trend: str = Field(..., pattern="^(increasing|decreasing|stable)$")
    trend_percentage: Decimal
    
    # Cost drivers
    highest_cost_category: str
    most_frequent_category: str
    
    # Efficiency
    cost_per_student: Decimal
    cost_per_room: Decimal
    
    # Benchmarks
    comparison_to_previous_period: Decimal

# --- File: D:\hostel-management-saas\app\schemas\maintenance\maintenance_filters.py ---
"""
Maintenance filter schemas
"""
from datetime import date
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseFilterSchema
from app.schemas.common.enums import MaintenanceCategory, MaintenanceStatus, Priority


class MaintenanceFilterParams(BaseFilterSchema):
    """Maintenance filter parameters"""
    # Text search
    search: Optional[str] = Field(None, description="Search in title, description, request number")
    
    # Hostel filter
    hostel_id: Optional[UUID] = None
    hostel_ids: Optional[List[UUID]] = None
    
    # Requested by
    requested_by: Optional[UUID] = None
    
    # Assignment
    assigned_to: Optional[UUID] = None
    unassigned_only: Optional[bool] = None
    
    # Room
    room_id: Optional[UUID] = None
    
    # Category
    category: Optional[MaintenanceCategory] = None
    categories: Optional[List[MaintenanceCategory]] = None
    
    # Priority
    priority: Optional[Priority] = None
    priorities: Optional[List[Priority]] = None
    
    # Status
    status: Optional[MaintenanceStatus] = None
    statuses: Optional[List[MaintenanceStatus]] = None
    
    # Date filters
    created_date_from: Optional[date] = None
    created_date_to: Optional[date] = None
    completion_date_from: Optional[date] = None
    completion_date_to: Optional[date] = None
    
    # Cost filters
    estimated_cost_min: Optional[Decimal] = None
    estimated_cost_max: Optional[Decimal] = None
    actual_cost_min: Optional[Decimal] = None
    actual_cost_max: Optional[Decimal] = None
    
    # Approval
    approval_pending: Optional[bool] = None
    
    # Preventive
    is_preventive: Optional[bool] = None


class SearchRequest(BaseFilterSchema):
    """Maintenance search request"""
    query: str = Field(..., min_length=1)
    hostel_id: Optional[UUID] = None
    
    search_in_title: bool = Field(True)
    search_in_description: bool = Field(True)
    search_in_number: bool = Field(True)
    
    status: Optional[MaintenanceStatus] = None
    
    page: int = Field(1, ge=1)
    page_size: int = Field(20, ge=1, le=100)


class MaintenanceExportRequest(BaseFilterSchema):
    """Export maintenance data"""
    hostel_id: Optional[UUID] = None
    filters: Optional[MaintenanceFilterParams] = None
    
    format: str = Field("csv", pattern="^(csv|excel|pdf)$")
    
    include_cost_details: bool = Field(True)
    include_assignment_details: bool = Field(True)
    include_completion_details: bool = Field(True)

# --- File: D:\hostel-management-saas\app\schemas\maintenance\maintenance_request.py ---
"""
Maintenance request submission schemas
"""
from datetime import date
from typing import List, Optional
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema
from app.schemas.common.enums import MaintenanceCategory, Priority


class MaintenanceRequest(BaseCreateSchema):
    """Submit maintenance request"""
    hostel_id: UUID
    room_id: Optional[UUID] = None
    
    title: str = Field(..., min_length=5, max_length=255)
    description: str = Field(..., min_length=20, max_length=2000)
    
    category: MaintenanceCategory
    priority: Priority = Field(Priority.MEDIUM)
    
    location: Optional[str] = None
    issue_photos: List[HttpUrl] = Field(default_factory=list)


class RequestSubmission(BaseCreateSchema):
    """Detailed request submission with supervisor context"""
    hostel_id: UUID
    room_id: Optional[UUID] = None
    
    title: str = Field(..., min_length=5, max_length=255)
    description: str = Field(..., min_length=20, max_length=2000)
    
    category: MaintenanceCategory
    priority: Priority
    
    # Cost estimation (supervisor)
    estimated_cost: Optional[Decimal] = Field(None, ge=0, description="Estimated repair cost")
    
    # Preferred vendor
    preferred_vendor: Optional[str] = None
    
    # Timeline
    estimated_days: Optional[int] = Field(None, ge=1, description="Estimated days to complete")
    
    # Urgency
    requires_immediate_attention: bool = Field(False)


class EmergencyRequest(BaseCreateSchema):
    """Emergency maintenance request"""
    hostel_id: UUID
    
    emergency_type: str = Field(
        ...,
        pattern="^(fire|flood|electrical_hazard|gas_leak|structural_damage|other)$"
    )
    
    description: str = Field(..., min_length=20)
    location: str = Field(..., description="Exact location of emergency")
    
    # Immediate actions taken
    immediate_actions_taken: Optional[str] = None
    
    # Safety
    evacuated: bool = Field(False, description="Area evacuated")
    authorities_notified: bool = Field(False, description="Emergency services notified")
    
    contact_person: str
    contact_phone: str

# --- File: D:\hostel-management-saas\app\schemas\maintenance\maintenance_response.py ---
"""
Maintenance response schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import MaintenanceCategory, MaintenanceStatus, Priority


class MaintenanceResponse(BaseResponseSchema):
    """Maintenance response schema"""
    request_number: str
    hostel_id: UUID
    hostel_name: str
    
    requested_by: UUID
    requested_by_name: str
    
    title: str
    category: MaintenanceCategory
    priority: Priority
    status: MaintenanceStatus
    
    assigned_to: Optional[UUID]
    assigned_to_name: Optional[str]
    
    estimated_cost: Optional[Decimal]
    actual_cost: Optional[Decimal]
    
    created_at: datetime
    estimated_completion_date: Optional[date]
    completed_at: Optional[datetime]


class MaintenanceDetail(BaseResponseSchema):
    """Detailed maintenance information"""
    request_number: str
    
    # Hostel
    hostel_id: UUID
    hostel_name: str
    
    # Requester
    requested_by: UUID
    requested_by_name: str
    room_id: Optional[UUID]
    room_number: Optional[str]
    
    # Request details
    title: str
    description: str
    category: MaintenanceCategory
    priority: Priority
    issue_type: str
    
    # Location
    location: Optional[str]
    floor: Optional[int]
    specific_area: Optional[str]
    
    # Photos
    issue_photos: List[str]
    completion_photos: List[str]
    
    # Assignment
    assigned_to: Optional[UUID]
    assigned_to_name: Optional[str]
    assigned_by: Optional[UUID]
    assigned_by_name: Optional[str]
    assigned_at: Optional[datetime]
    
    vendor_name: Optional[str]
    vendor_contact: Optional[str]
    
    # Status workflow
    status: MaintenanceStatus
    approved_by: Optional[UUID]
    approved_by_name: Optional[str]
    approved_at: Optional[datetime]
    
    rejected_by: Optional[UUID]
    rejected_at: Optional[datetime]
    rejection_reason: Optional[str]
    
    started_at: Optional[datetime]
    completed_at: Optional[datetime]
    
    # Cost
    estimated_cost: Optional[Decimal]
    actual_cost: Optional[Decimal]
    cost_approved: bool
    approval_threshold_exceeded: bool
    
    # Timeline
    estimated_completion_date: Optional[date]
    actual_completion_date: Optional[date]
    
    # Work details
    work_notes: Optional[str]
    materials_used: List[dict] = Field(default_factory=list)
    labor_hours: Optional[Decimal]
    
    # Quality check
    quality_checked_by: Optional[UUID]
    quality_check_passed: Optional[bool]
    quality_check_notes: Optional[str]
    quality_checked_at: Optional[datetime]
    
    # Preventive
    is_preventive: bool
    next_scheduled_date: Optional[date]
    recurrence: str


class RequestListItem(BaseSchema):
    """Maintenance request list item"""
    id: UUID
    request_number: str
    title: str
    
    category: str
    priority: str
    status: MaintenanceStatus
    
    room_number: Optional[str]
    
    estimated_cost: Optional[Decimal]
    
    assigned_to_name: Optional[str]
    
    created_at: datetime
    estimated_completion_date: Optional[date]


class MaintenanceSummary(BaseSchema):
    """Maintenance summary for hostel"""
    hostel_id: UUID
    
    total_requests: int
    pending_requests: int
    in_progress_requests: int
    completed_requests: int
    
    high_priority_count: int
    urgent_priority_count: int
    
    total_estimated_cost: Decimal
    total_actual_cost: Decimal
    
    average_completion_time_hours: Decimal

# --- File: D:\hostel-management-saas\app\schemas\maintenance\maintenance_schedule.py ---
"""
Preventive maintenance schedule schemas
"""
from datetime import date
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseUpdateSchema, BaseResponseSchema
from app.schemas.common.enums import MaintenanceCategory, MaintenanceRecurrence


class PreventiveSchedule(BaseResponseSchema):
    """Preventive maintenance schedule"""
    hostel_id: UUID
    hostel_name: str
    
    title: str
    description: Optional[str]
    category: MaintenanceCategory
    
    recurrence: MaintenanceRecurrence
    next_due_date: date
    
    assigned_to: Optional[UUID]
    assigned_to_name: Optional[str]
    
    estimated_cost: Optional[Decimal]
    
    is_active: bool
    last_completed_date: Optional[date]


class ScheduleCreate(BaseCreateSchema):
    """Create preventive maintenance schedule"""
    hostel_id: UUID
    
    title: str = Field(..., min_length=5, max_length=255)
    description: Optional[str] = Field(None, max_length=1000)
    
    category: MaintenanceCategory
    recurrence: MaintenanceRecurrence
    
    # First occurrence
    start_date: date = Field(..., description="First scheduled date")
    
    # Assignment
    assigned_to: Optional[UUID] = None
    
    # Cost
    estimated_cost: Optional[Decimal] = Field(None, ge=0)
    
    # Checklist
    checklist: List["ScheduleChecklistItem"] = Field(default_factory=list)


class ScheduleChecklistItem(BaseSchema):
    """Checklist item for scheduled maintenance"""
    item_description: str = Field(..., min_length=5, max_length=500)
    is_required: bool = Field(True)
    item_order: int = Field(..., ge=1)


class RecurrenceConfig(BaseSchema):
    """Recurrence configuration details"""
    recurrence_type: MaintenanceRecurrence
    
    # Interval (for custom recurrence)
    interval_days: Optional[int] = Field(None, ge=1, description="Interval for custom recurrence")
    
    # Day of week (for weekly)
    day_of_week: Optional[int] = Field(None, ge=0, le=6, description="0=Monday, 6=Sunday")
    
    # Day of month (for monthly)
    day_of_month: Optional[int] = Field(None, ge=1, le=31)
    
    # End condition
    end_date: Optional[date] = Field(None, description="When to stop recurring")
    max_occurrences: Optional[int] = Field(None, ge=1, description="Max number of occurrences")


class ScheduleExecution(BaseCreateSchema):
    """Execute scheduled maintenance"""
    schedule_id: UUID
    execution_date: date
    
    # Was it completed?
    completed: bool
    
    # If completed
    completion_notes: Optional[str] = None
    actual_cost: Optional[Decimal] = Field(None, ge=0)
    
    # Checklist results
    checklist_results: List["ChecklistResult"] = Field(default_factory=list)
    
    # Next occurrence
    skip_next_occurrence: bool = Field(False)
    reschedule_next_to: Optional[date] = None


class ChecklistResult(BaseSchema):
    """Checklist item result"""
    item_description: str
    completed: bool
    notes: Optional[str] = None


class ScheduleUpdate(BaseUpdateSchema):
    """Update schedule"""
    title: Optional[str] = Field(None, min_length=5, max_length=255)
    description: Optional[str] = None
    recurrence: Optional[MaintenanceRecurrence] = None
    next_due_date: Optional[date] = None
    assigned_to: Optional[UUID] = None
    estimated_cost: Optional[Decimal] = None
    is_active: Optional[bool] = None


class ScheduleHistory(BaseSchema):
    """Schedule execution history"""
    schedule_id: UUID
    title: str
    
    total_executions: int
    completed_executions: int
    skipped_executions: int
    
    executions: List["ExecutionHistoryItem"]


class ExecutionHistoryItem(BaseSchema):
    """Individual execution history"""
    execution_date: date
    completed: bool
    actual_cost: Optional[Decimal]
    completion_notes: Optional[str]
    completed_by: Optional[UUID]
    completed_by_name: Optional[str]

# --- File: D:\hostel-management-saas\app\schemas\maintenance\__init__.py ---
"""
Maintenance schemas package
"""
from app.schemas.maintenance.maintenance_base import (
    MaintenanceBase,
    MaintenanceCreate,
    MaintenanceUpdate
)
from app.schemas.maintenance.maintenance_response import (
    MaintenanceResponse,
    MaintenanceDetail,
    RequestListItem
)
from app.schemas.maintenance.maintenance_request import (
    MaintenanceRequest,
    RequestSubmission,
    EmergencyRequest
)
from app.schemas.maintenance.maintenance_assignment import (
    TaskAssignment,
    VendorAssignment,
    AssignmentUpdate
)
from app.schemas.maintenance.maintenance_approval import (
    ApprovalRequest,
    ApprovalResponse,
    ThresholdConfig
)
from app.schemas.maintenance.maintenance_completion import (
    CompletionRequest,
    QualityCheck,
    CompletionResponse
)
from app.schemas.maintenance.maintenance_schedule import (
    PreventiveSchedule,
    ScheduleCreate,
    RecurrenceConfig,
    ScheduleExecution
)
from app.schemas.maintenance.maintenance_cost import (
    CostTracking,
    BudgetAllocation,
    ExpenseReport
)
from app.schemas.maintenance.maintenance_filters import (
    MaintenanceFilterParams,
    SearchRequest,
    MaintenanceExportRequest
)
from app.schemas.maintenance.maintenance_analytics import (
    MaintenanceAnalytics,
    CostAnalysis,
    PerformanceMetrics
)

__all__ = [
    # Base
    "MaintenanceBase",
    "MaintenanceCreate",
    "MaintenanceUpdate",
    
    # Response
    "MaintenanceResponse",
    "MaintenanceDetail",
    "RequestListItem",
    
    # Request
    "MaintenanceRequest",
    "RequestSubmission",
    "EmergencyRequest",
    
    # Assignment
    "TaskAssignment",
    "VendorAssignment",
    "AssignmentUpdate",
    
    # Approval
    "ApprovalRequest",
    "ApprovalResponse",
    "ThresholdConfig",
    
    # Completion
    "CompletionRequest",
    "QualityCheck",
    "CompletionResponse",
    
    # Schedule
    "PreventiveSchedule",
    "ScheduleCreate",
    "RecurrenceConfig",
    "ScheduleExecution",
    
    # Cost
    "CostTracking",
    "BudgetAllocation",
    "ExpenseReport",
    
    # Filters
    "MaintenanceFilterParams",
    "SearchRequest",
    "MaintenanceExportRequest",
    
    # Analytics
    "MaintenanceAnalytics",
    "CostAnalysis",
    "PerformanceMetrics",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\mess =====

# --- File: D:\hostel-management-saas\app\schemas\mess\meal_items.py ---
"""
Meal items and dietary schemas
"""
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class MealItems(BaseSchema):
    """Meal items definition"""
    meal_type: str = Field(..., pattern="^(breakfast|lunch|snacks|dinner)$")
    items: List["MenuItem"]


class MenuItem(BaseSchema):
    """Individual menu item"""
    item_name: str = Field(..., min_length=2, max_length=100)
    item_description: Optional[str] = Field(None, max_length=255)
    
    # Dietary classification
    is_vegetarian: bool = Field(True)
    is_vegan: bool = Field(False)
    is_jain: bool = Field(False)
    is_gluten_free: bool = Field(False)
    
    # Allergens
    contains_dairy: bool = Field(False)
    contains_nuts: bool = Field(False)
    contains_soy: bool = Field(False)
    
    # Category
    category: str = Field(..., description="main_course, side_dish, dessert, beverage")


class DietaryOptions(BaseSchema):
    """Dietary options configuration"""
    hostel_id: UUID
    
    # Available options
    vegetarian_menu: bool = Field(True)
    non_vegetarian_menu: bool = Field(False)
    vegan_menu: bool = Field(False)
    jain_menu: bool = Field(False)
    gluten_free_options: bool = Field(False)
    
    # Customization allowed
    allow_meal_customization: bool = Field(False)
    
    # Allergen warnings
    display_allergen_warnings: bool = Field(True)


class NutritionalInfo(BaseSchema):
    """Nutritional information for menu item"""
    item_name: str
    
    # Per serving
    serving_size: str
    calories: Optional[int] = Field(None, ge=0)
    
    # Macros (grams)
    protein: Optional[Decimal] = Field(None, ge=0)
    carbohydrates: Optional[Decimal] = Field(None, ge=0)
    fat: Optional[Decimal] = Field(None, ge=0)
    fiber: Optional[Decimal] = Field(None, ge=0)
    
    # Micros
    sodium_mg: Optional[Decimal] = Field(None, ge=0)
    sugar_g: Optional[Decimal] = Field(None, ge=0)


class ItemMasterList(BaseSchema):
    """Master list of menu items"""
    hostel_id: UUID
    
    categories: List["ItemCategory"]


class ItemCategory(BaseSchema):
    """Category of menu items"""
    category_name: str
    items: List[str]

# --- File: D:\hostel-management-saas\app\schemas\mess\menu_approval.py ---
"""
Menu approval schemas
"""
from datetime import datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class MenuApprovalRequest(BaseCreateSchema):
    """Request menu approval (supervisor to admin)"""
    menu_id: UUID
    
    # Submission notes
    submission_notes: Optional[str] = Field(None, max_length=500)
    
    # Budget info
    estimated_cost_per_person: Optional[Decimal] = None


class MenuApprovalResponse(BaseSchema):
    """Menu approval response"""
    menu_id: UUID
    menu_date: date
    
    approved: bool
    approved_by: UUID
    approved_by_name: str
    approved_at: datetime
    
    # Feedback
    approval_notes: Optional[str]
    
    message: str


class ApprovalWorkflow(BaseSchema):
    """Menu approval workflow status"""
    menu_id: UUID
    menu_date: date
    
    requires_approval: bool
    approval_status: str = Field(
        ...,
        pattern="^(pending|approved|rejected|not_required)$"
    )
    
    # Timeline
    submitted_for_approval_at: Optional[datetime]
    approved_at: Optional[datetime]
    rejected_at: Optional[datetime]
    
    # Approver
    pending_with: Optional[UUID]
    pending_with_name: Optional[str]


class BulkApproval(BaseCreateSchema):
    """Approve multiple menus"""
    menu_ids: List[UUID] = Field(..., min_items=1)
    
    approved: bool
    approval_notes: Optional[str] = None

# --- File: D:\hostel-management-saas\app\schemas\mess\menu_duplication.py ---
"""
Menu duplication schemas
"""
from datetime import date
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class DuplicateMenuRequest(BaseCreateSchema):
    """Duplicate menu to another date"""
    source_menu_id: UUID = Field(..., description="Menu to duplicate")
    target_date: date = Field(..., description="Date for duplicated menu")
    
    # Modifications
    modify_items: bool = Field(False, description="Allow modifications during duplication")
    modifications: Optional[dict] = None


class BulkMenuCreate(BaseCreateSchema):
    """Create menus for multiple dates using template"""
    hostel_id: UUID
    
    # Date range
    start_date: date
    end_date: date
    
    # Source
    source_type: str = Field(..., pattern="^(template|existing_menu|weekly_pattern)$")
    
    # If using template
    template_id: Optional[UUID] = None
    
    # If using existing menu
    source_menu_id: Optional[UUID] = None
    
    # If using weekly pattern
    weekly_pattern: Optional[dict] = Field(
        None,
        description="Day of week -> menu items mapping"
    )
    
    # Options
    skip_existing: bool = Field(True, description="Skip dates that already have menus")
    override_existing: bool = Field(False, description="Override existing menus")


class DuplicateResponse(BaseSchema):
    """Duplication response"""
    source_menu_id: UUID
    created_menus: List[UUID]
    
    total_created: int
    skipped: int
    
    message: str


class CrossHostelDuplication(BaseCreateSchema):
    """Duplicate menu to other hostels"""
    source_menu_id: UUID
    source_hostel_id: UUID
    
    target_hostel_ids: List[UUID] = Field(..., min_items=1)
    target_date: date
    
    # Adjust for hostel-specific preferences
    adapt_to_hostel_preferences: bool = Field(True)

# --- File: D:\hostel-management-saas\app\schemas\mess\menu_feedback.py ---
"""
Mess menu feedback schemas
"""
from datetime import datetime, date
from decimal import Decimal
from typing import List, Optional, Dict
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema
from app.schemas.common.enums import MealType


class FeedbackRequest(BaseCreateSchema):
    """Submit menu feedback"""
    menu_id: UUID = Field(..., description="Menu ID")
    student_id: UUID = Field(..., description="Student ID")
    
    meal_type: MealType = Field(..., description="Which meal")
    rating: int = Field(..., ge=1, le=5, description="Rating 1-5")
    
    comments: Optional[str] = Field(None, max_length=1000)
    
    # Specific aspects
    taste_rating: Optional[int] = Field(None, ge=1, le=5)
    quantity_rating: Optional[int] = Field(None, ge=1, le=5)
    quality_rating: Optional[int] = Field(None, ge=1, le=5)
    hygiene_rating: Optional[int] = Field(None, ge=1, le=5)


class FeedbackResponse(BaseResponseSchema):
    """Feedback response"""
    menu_id: UUID
    student_id: UUID
    student_name: str
    
    meal_type: MealType
    rating: int
    comments: Optional[str]
    
    submitted_at: datetime


class RatingsSummary(BaseSchema):
    """Ratings summary for menu"""
    menu_id: UUID
    menu_date: date
    
    total_feedbacks: int
    average_rating: Decimal
    
    # By meal
    breakfast_rating: Optional[Decimal]
    lunch_rating: Optional[Decimal]
    snacks_rating: Optional[Decimal]
    dinner_rating: Optional[Decimal]
    
    # Rating distribution
    rating_5_count: int
    rating_4_count: int
    rating_3_count: int
    rating_2_count: int
    rating_1_count: int
    
    # Aspect ratings
    average_taste_rating: Decimal
    average_quantity_rating: Decimal
    average_quality_rating: Decimal
    average_hygiene_rating: Decimal


class QualityMetrics(BaseSchema):
    """Menu quality metrics"""
    hostel_id: UUID
    period_start: date
    period_end: date
    
    # Overall
    overall_average_rating: Decimal
    total_feedbacks: int
    
    # Trends
    rating_trend: str = Field(..., pattern="^(improving|declining|stable)$")
    trend_percentage: Optional[Decimal]
    
    # Best and worst
    best_rated_items: List["ItemRating"]
    worst_rated_items: List["ItemRating"]
    
    # By day of week
    ratings_by_day: Dict[str, Decimal]


class ItemRating(BaseSchema):
    """Rating for specific menu item"""
    item_name: str
    average_rating: Decimal
    feedback_count: int


class FeedbackAnalysis(BaseSchema):
    """Feedback analysis and insights"""
    hostel_id: UUID
    analysis_period: DateRangeFilter
    
    # Sentiment
    positive_feedback_percentage: Decimal
    negative_feedback_percentage: Decimal
    
    # Common themes
    common_complaints: List[str]
    common_compliments: List[str]
    
    # Recommendations
    items_to_keep: List[str]
    items_to_improve: List[str]
    items_to_remove: List[str]

# --- File: D:\hostel-management-saas\app\schemas\mess\menu_planning.py ---
"""
Menu planning schemas
"""
from datetime import date
from typing import List, Optional, Dict
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class MenuPlanRequest(BaseCreateSchema):
    """Request to create menu plan"""
    hostel_id: UUID
    
    # Planning period
    start_date: date
    end_date: date
    
    # Template to use (if any)
    use_template: bool = Field(False)
    template_id: Optional[UUID] = None
    
    # Variety preferences
    ensure_variety: bool = Field(True, description="Avoid repeating items too often")
    min_days_between_repeat: int = Field(3, ge=1, le=7)
    
    # Dietary requirements
    vegetarian_days_per_week: int = Field(7, ge=0, le=7)
    
    # Budget
    target_cost_per_day: Optional[Decimal] = None


class WeeklyPlan(BaseCreateSchema):
    """Weekly menu plan"""
    hostel_id: UUID
    week_start_date: date
    
    # Daily menus
    monday: "DailyMenuPlan"
    tuesday: "DailyMenuPlan"
    wednesday: "DailyMenuPlan"
    thursday: "DailyMenuPlan"
    friday: "DailyMenuPlan"
    saturday: "DailyMenuPlan"
    sunday: "DailyMenuPlan"
    
    # Metadata
    created_by: UUID
    notes: Optional[str] = None


class DailyMenuPlan(BaseSchema):
    """Daily menu plan"""
    breakfast: List[str]
    lunch: List[str]
    snacks: List[str]
    dinner: List[str]
    
    is_special: bool = Field(False)
    special_occasion: Optional[str] = None


class MonthlyPlan(BaseCreateSchema):
    """Monthly menu plan"""
    hostel_id: UUID
    month: str  # YYYY-MM format
    
    # Weekly plans
    weeks: List[WeeklyPlan]
    
    # Special days
    special_days: List["SpecialDayMenu"] = Field(default_factory=list)


class SpecialMenu(BaseCreateSchema):
    """Special occasion menu"""
    hostel_id: UUID
    occasion_date: date
    occasion_name: str = Field(..., min_length=3, max_length=255)
    
    # Enhanced menu
    breakfast: List[str]
    lunch: List[str]
    snacks: List[str]
    dinner: List[str]
    
    # Additional items
    special_items: List[str] = Field(default_factory=list, description="Extra special items")
    
    # Budget
    budget: Optional[Decimal] = None


class SpecialDayMenu(BaseSchema):
    """Special day in monthly plan"""
    date: date
    occasion: str
    menu: DailyMenuPlan


class MenuTemplate(BaseCreateSchema):
    """Reusable menu template"""
    hostel_id: UUID
    template_name: str = Field(..., min_length=3, max_length=100)
    description: Optional[str] = None
    
    # Template type
    template_type: str = Field(..., pattern="^(weekly|festival|summer|winter)$")
    
    # Menu structure
    daily_menus: Dict[str, DailyMenuPlan] = Field(
        ...,
        description="Day name -> menu plan"
    )


class MenuSuggestion(BaseSchema):
    """AI/System generated menu suggestions"""
    hostel_id: UUID
    date: date
    
    suggested_breakfast: List[str]
    suggested_lunch: List[str]
    suggested_dinner: List[str]
    
    reason: str = Field(..., description="Why these items are suggested")
    
    # Scores
    variety_score: Decimal = Field(..., ge=0, le=10)
    nutrition_score: Decimal = Field(..., ge=0, le=10)
    cost_score: Decimal = Field(..., ge=0, le=10)

# --- File: D:\hostel-management-saas\app\schemas\mess\mess_menu_base.py ---
"""
Mess menu base schemas
"""
from datetime import date, time
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema


class MessMenuBase(BaseSchema):
    """Base mess menu schema"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    menu_date: date = Field(..., description="Menu date")
    day_of_week: str = Field(..., description="Day of week")
    
    # Meals
    breakfast_items: List[str] = Field(default_factory=list, description="Breakfast items")
    lunch_items: List[str] = Field(default_factory=list, description="Lunch items")
    snacks_items: List[str] = Field(default_factory=list, description="Snacks items")
    dinner_items: List[str] = Field(default_factory=list, description="Dinner items")
    
    # Timings
    breakfast_time: Optional[time] = Field(None, description="Breakfast serving time")
    lunch_time: Optional[time] = Field(None, description="Lunch serving time")
    snacks_time: Optional[time] = Field(None, description="Snacks serving time")
    dinner_time: Optional[time] = Field(None, description="Dinner serving time")
    
    # Special
    is_special_menu: bool = Field(False, description="Special occasion menu")
    special_occasion: Optional[str] = Field(None, max_length=255, description="Occasion name")
    
    # Dietary options
    vegetarian_available: bool = Field(True)
    non_vegetarian_available: bool = Field(False)
    vegan_available: bool = Field(False)
    jain_available: bool = Field(False)


class MessMenuCreate(MessMenuBase, BaseCreateSchema):
    """Create mess menu"""
    created_by: UUID = Field(..., description="Supervisor/Admin who created")


class MessMenuUpdate(BaseUpdateSchema):
    """Update mess menu"""
    breakfast_items: Optional[List[str]] = None
    lunch_items: Optional[List[str]] = None
    snacks_items: Optional[List[str]] = None
    dinner_items: Optional[List[str]] = None
    
    breakfast_time: Optional[time] = None
    lunch_time: Optional[time] = None
    snacks_time: Optional[time] = None
    dinner_time: Optional[time] = None
    
    is_special_menu: Optional[bool] = None
    special_occasion: Optional[str] = None
    
    vegetarian_available: Optional[bool] = None
    non_vegetarian_available: Optional[bool] = None

# --- File: D:\hostel-management-saas\app\schemas\mess\mess_menu_response.py ---
"""
Mess menu response schemas
"""
from datetime import date, time, datetime
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema


class MenuResponse(BaseResponseSchema):
    """Mess menu response"""
    hostel_id: UUID
    hostel_name: str
    menu_date: date
    day_of_week: str
    
    breakfast_items: List[str]
    lunch_items: List[str]
    snacks_items: List[str]
    dinner_items: List[str]
    
    is_special_menu: bool
    special_occasion: Optional[str]
    
    is_published: bool
    average_rating: Decimal


class MenuDetail(BaseResponseSchema):
    """Detailed menu information"""
    hostel_id: UUID
    hostel_name: str
    menu_date: date
    day_of_week: str
    
    # Meals with timings
    breakfast_items: List[str]
    breakfast_time: Optional[time]
    
    lunch_items: List[str]
    lunch_time: Optional[time]
    
    snacks_items: List[str]
    snacks_time: Optional[time]
    
    dinner_items: List[str]
    dinner_time: Optional[time]
    
    # Dietary options
    vegetarian_available: bool
    non_vegetarian_available: bool
    vegan_available: bool
    jain_available: bool
    
    # Special
    is_special_menu: bool
    special_occasion: Optional[str]
    
    # Management
    created_by: UUID
    created_by_name: str
    approved_by: Optional[UUID]
    approved_by_name: Optional[str]
    approved_at: Optional[datetime]
    
    is_published: bool
    published_at: Optional[datetime]
    
    # Feedback
    average_rating: Decimal
    total_feedback_count: int


class WeeklyMenu(BaseSchema):
    """Weekly menu display"""
    hostel_id: UUID
    hostel_name: str
    week_start_date: date
    week_end_date: date
    
    menus: List["DailyMenuSummary"]


class DailyMenuSummary(BaseSchema):
    """Daily menu summary for weekly view"""
    menu_id: UUID
    date: date
    day_of_week: str
    
    breakfast: List[str]
    lunch: List[str]
    dinner: List[str]
    
    is_special: bool
    average_rating: Optional[Decimal]


class MonthlyMenu(BaseSchema):
    """Monthly menu calendar"""
    hostel_id: UUID
    hostel_name: str
    month: str  # YYYY-MM format
    
    menus_by_date: dict = Field(..., description="Date -> DailyMenuSummary")
    
    # Summary
    total_days: int
    special_days: int
    average_rating: Decimal


class TodayMenu(BaseSchema):
    """Today's menu for student view"""
    hostel_id: UUID
    hostel_name: str
    date: date
    day_of_week: str
    
    breakfast: List[str]
    breakfast_time: str
    
    lunch: List[str]
    lunch_time: str
    
    snacks: List[str]
    snacks_time: str
    
    dinner: List[str]
    dinner_time: str
    
    is_special: bool
    special_occasion: Optional[str]
    
    dietary_note: Optional[str]

# --- File: D:\hostel-management-saas\app\schemas\mess\__init__.py ---
"""
Mess menu schemas package
"""
from app.schemas.mess.mess_menu_base import (
    MessMenuBase,
    MessMenuCreate,
    MessMenuUpdate
)
from app.schemas.mess.mess_menu_response import (
    MenuResponse,
    MenuDetail,
    WeeklyMenu,
    MonthlyMenu
)
from app.schemas.mess.meal_items import (
    MealItems,
    DietaryOptions,
    NutritionalInfo
)
from app.schemas.mess.menu_planning import (
    MenuPlanRequest,
    WeeklyPlan,
    MonthlyPlan,
    SpecialMenu
)
from app.schemas.mess.menu_feedback import (
    FeedbackRequest,
    FeedbackResponse,
    RatingsSummary,
    QualityMetrics
)
from app.schemas.mess.menu_approval import (
    MenuApprovalRequest,
    ApprovalWorkflow
)
from app.schemas.mess.menu_duplication import (
    DuplicateMenuRequest,
    BulkMenuCreate
)

__all__ = [
    # Base
    "MessMenuBase",
    "MessMenuCreate",
    "MessMenuUpdate",
    
    # Response
    "MenuResponse",
    "MenuDetail",
    "WeeklyMenu",
    "MonthlyMenu",
    
    # Meal Items
    "MealItems",
    "DietaryOptions",
    "NutritionalInfo",
    
    # Planning
    "MenuPlanRequest",
    "WeeklyPlan",
    "MonthlyPlan",
    "SpecialMenu",
    
    # Feedback
    "FeedbackRequest",
    "FeedbackResponse",
    "RatingsSummary",
    "QualityMetrics",
    
    # Approval
    "MenuApprovalRequest",
    "ApprovalWorkflow",
    
    # Duplication
    "DuplicateMenuRequest",
    "BulkMenuCreate",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\notification =====

# --- File: D:\hostel-management-saas\app\schemas\notification\email_notification.py ---
"""
Email notification schemas
"""
from datetime import datetime
from typing import List, Optional, Dict
from pydantic import EmailStr, Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class EmailRequest(BaseCreateSchema):
    """Send email notification"""
    recipient_email: EmailStr = Field(..., description="Recipient email address")
    
    # CC and BCC
    cc_emails: List[EmailStr] = Field(default_factory=list)
    bcc_emails: List[EmailStr] = Field(default_factory=list)
    
    # Content
    subject: str = Field(..., min_length=1, max_length=255)
    body_html: str = Field(..., description="HTML email body")
    body_text: Optional[str] = Field(None, description="Plain text fallback")
    
    # Attachments
    attachments: List[HttpUrl] = Field(default_factory=list, description="Attachment URLs")
    
    # Template
    template_code: Optional[str] = None
    template_variables: Optional[Dict[str, str]] = None
    
    # Settings
    reply_to: Optional[EmailStr] = None
    from_name: Optional[str] = Field(None, description="Sender name")
    
    # Tracking
    track_opens: bool = Field(True)
    track_clicks: bool = Field(True)
    
    # Priority
    priority: str = Field("normal", pattern="^(low|normal|high)$")


class EmailConfig(BaseSchema):
    """Email configuration"""
    # SMTP/Service settings
    service_provider: str = Field(..., pattern="^(sendgrid|ses|smtp)$")
    
    smtp_host: Optional[str] = None
    smtp_port: Optional[int] = None
    smtp_username: Optional[str] = None
    
    # From address
    from_email: EmailStr
    from_name: str
    
    # Reply-to
    reply_to_email: Optional[EmailStr] = None
    
    # Rate limiting
    max_emails_per_hour: int = Field(100, ge=1)
    
    # Tracking
    enable_open_tracking: bool = Field(True)
    enable_click_tracking: bool = Field(True)


class EmailTracking(BaseSchema):
    """Email tracking information"""
    email_id: UUID
    recipient_email: str
    
    # Delivery
    sent_at: datetime
    delivered_at: Optional[datetime]
    bounced_at: Optional[datetime]
    
    delivery_status: str = Field(
        ...,
        pattern="^(sent|delivered|bounced|failed|spam)$"
    )
    
    # Engagement
    opened: bool = Field(False)
    first_opened_at: Optional[datetime]
    open_count: int = Field(0)
    
    clicked: bool = Field(False)
    first_clicked_at: Optional[datetime]
    click_count: int = Field(0)
    
    # Errors
    bounce_type: Optional[str] = Field(None, description="hard/soft bounce")
    error_message: Optional[str]


class EmailTemplate(BaseSchema):
    """Email-specific template"""
    template_code: str
    
    subject: str
    html_body: str
    text_body: Optional[str]
    
    # Styling
    header_image_url: Optional[HttpUrl]
    footer_text: Optional[str]
    
    # Variables
    required_variables: List[str]
    optional_variables: List[str] = Field(default_factory=list)


class BulkEmailRequest(BaseCreateSchema):
    """Send bulk emails"""
    recipients: List[EmailStr] = Field(..., min_items=1, max_items=1000)
    
    subject: str
    body_html: str
    
    # Template
    template_code: Optional[str] = None
    
    # Per-recipient variables
    recipient_variables: Optional[Dict[str, Dict[str, str]]] = Field(
        None,
        description="Email -> variable mapping"
    )
    
    # Batch settings
    batch_size: int = Field(100, ge=10, le=1000)
    delay_between_batches_seconds: int = Field(5, ge=1, le=60)


class EmailStats(BaseSchema):
    """Email statistics"""
    total_sent: int
    total_delivered: int
    total_bounced: int
    total_failed: int
    
    delivery_rate: Decimal
    bounce_rate: Decimal
    
    total_opened: int
    open_rate: Decimal
    
    total_clicked: int
    click_rate: Decimal
    
    # By period
    period_start: date
    period_end: date

# --- File: D:\hostel-management-saas\app\schemas\notification\notification_base.py ---
"""
Notification base schemas
"""
from datetime import datetime
from typing import Dict, Any, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import NotificationType, Priority


class NotificationBase(BaseSchema):
    """Base notification schema"""
    recipient_user_id: Optional[UUID] = Field(None, description="Recipient user ID")
    recipient_email: Optional[str] = Field(None, description="Recipient email")
    recipient_phone: Optional[str] = Field(None, description="Recipient phone")
    
    notification_type: NotificationType = Field(..., description="Notification channel")
    
    # Template
    template_code: Optional[str] = Field(None, description="Template code to use")
    
    # Content
    subject: Optional[str] = Field(None, max_length=255, description="Subject/Title")
    message_body: str = Field(..., description="Message content")
    
    # Priority
    priority: Priority = Field(Priority.MEDIUM, description="Delivery priority")
    
    # Schedule
    scheduled_at: Optional[datetime] = Field(None, description="When to send (null = immediate)")
    
    # Metadata
    metadata: Dict[str, Any] = Field(default_factory=dict, description="Additional context data")
    
    # Related entity
    hostel_id: Optional[UUID] = Field(None, description="Related hostel")


class NotificationCreate(NotificationBase, BaseCreateSchema):
    """Create notification"""
    pass


class NotificationUpdate(BaseUpdateSchema):
    """Update notification (limited fields)"""
    scheduled_at: Optional[datetime] = None
    priority: Optional[Priority] = None
    status: Optional[str] = None


class MarkAsRead(BaseCreateSchema):
    """Mark notification as read"""
    notification_id: UUID
    user_id: UUID


class BulkMarkAsRead(BaseCreateSchema):
    """Mark multiple notifications as read"""
    notification_ids: List[UUID] = Field(..., min_items=1)
    user_id: UUID


class NotificationDelete(BaseCreateSchema):
    """Delete notification"""
    notification_id: UUID
    user_id: UUID
    
    # Soft delete
    permanent: bool = Field(False, description="Permanently delete vs soft delete")

# --- File: D:\hostel-management-saas\app\schemas\notification\notification_preferences.py ---
"""
Notification preferences schemas
"""
from typing import Dict, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseUpdateSchema


class UserPreferences(BaseSchema):
    """User notification preferences"""
    user_id: UUID
    
    # Global settings
    notifications_enabled: bool = Field(True)
    
    # Channel preferences
    email_enabled: bool = Field(True)
    sms_enabled: bool = Field(True)
    push_enabled: bool = Field(True)
    
    # Frequency
    frequency_settings: "FrequencySettings"
    
    # Quiet hours
    quiet_hours_enabled: bool = Field(False)
    quiet_hours_start: Optional[str] = Field(None, description="HH:MM format")
    quiet_hours_end: Optional[str] = Field(None, description="HH:MM format")
    
    # Category preferences
    payment_notifications: bool = Field(True)
    booking_notifications: bool = Field(True)
    complaint_notifications: bool = Field(True)
    announcement_notifications: bool = Field(True)
    maintenance_notifications: bool = Field(True)
    attendance_notifications: bool = Field(True)
    marketing_notifications: bool = Field(False)


class ChannelPreferences(BaseSchema):
    """Channel-specific preferences"""
    user_id: UUID
    
    # Email preferences
    email: "EmailPreferences"
    
    # SMS preferences
    sms: "SMSPreferences"
    
    # Push preferences
    push: "PushPreferences"


class EmailPreferences(BaseSchema):
    """Email notification preferences"""
    enabled: bool = Field(True)
    
    # Digest settings
    daily_digest: bool = Field(False)
    weekly_digest: bool = Field(False)
    
    # Categories
    receive_payment_emails: bool = Field(True)
    receive_booking_emails: bool = Field(True)
    receive_announcement_emails: bool = Field(True)
    receive_marketing_emails: bool = Field(False)


class SMSPreferences(BaseSchema):
    """SMS notification preferences"""
    enabled: bool = Field(True)
    
    # Only critical by default
    urgent_only: bool = Field(True)
    
    # Categories
    receive_payment_sms: bool = Field(True)
    receive_booking_sms: bool = Field(True)
    receive_emergency_sms: bool = Field(True)


class PushPreferences(BaseSchema):
    """Push notification preferences"""
    enabled: bool = Field(True)
    
    # Sound
    sound_enabled: bool = Field(True)
    
    # Badge
    badge_enabled: bool = Field(True)
    
    # Preview
    show_preview: bool = Field(True, description="Show message preview on lock screen")


class FrequencySettings(BaseSchema):
    """Notification frequency settings"""
    # Immediate
    immediate_notifications: bool = Field(True)
    
    # Batching
    batch_notifications: bool = Field(False)
    batch_interval_hours: int = Field(4, ge=1, le=24)
    
    # Digest
    daily_digest_time: Optional[str] = Field(None, description="HH:MM format")
    weekly_digest_day: Optional[str] = Field(None, description="Monday, Tuesday, etc.")


class PreferenceUpdate(BaseUpdateSchema):
    """Update notification preferences"""
    notifications_enabled: Optional[bool] = None
    email_enabled: Optional[bool] = None
    sms_enabled: Optional[bool] = None
    push_enabled: Optional[bool] = None
    
    quiet_hours_enabled: Optional[bool] = None
    quiet_hours_start: Optional[str] = None
    quiet_hours_end: Optional[str] = None
    
    # Category toggles
    payment_notifications: Optional[bool] = None
    booking_notifications: Optional[bool] = None
    complaint_notifications: Optional[bool] = None
    announcement_notifications: Optional[bool] = None
    marketing_notifications: Optional[bool] = None


class UnsubscribeRequest(BaseSchema):
    """Unsubscribe from notifications"""
    user_id: UUID
    unsubscribe_token: str
    
    # What to unsubscribe from
    unsubscribe_type: str = Field(
        ...,
        pattern="^(all|email|sms|marketing|specific_category)$"
    )
    
    category: Optional[str] = None

# --- File: D:\hostel-management-saas\app\schemas\notification\notification_queue.py ---
"""
Notification queue schemas
"""
from datetime import datetime
from typing import Optional, List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.enums import NotificationType, NotificationStatus, Priority


class QueueStatus(BaseSchema):
    """Notification queue status"""
    total_queued: int
    total_processing: int
    total_failed: int
    
    # By priority
    urgent_queued: int
    high_queued: int
    medium_queued: int
    low_queued: int
    
    # By type
    email_queued: int
    sms_queued: int
    push_queued: int
    
    # Processing rate
    avg_processing_time_seconds: Decimal
    throughput_per_minute: Decimal


class QueuedNotification(BaseSchema):
    """Queued notification details"""
    notification_id: UUID
    
    notification_type: NotificationType
    priority: Priority
    status: NotificationStatus
    
    recipient: str = Field(..., description="Email/phone/user_id")
    
    scheduled_at: Optional[datetime]
    queued_at: datetime
    
    retry_count: int
    max_retries: int
    
    estimated_send_time: Optional[datetime]


class BatchProcessing(BaseSchema):
    """Batch processing status"""
    batch_id: UUID
    
    total_notifications: int
    processed: int
    successful: int
    failed: int
    
    status: str = Field(..., pattern="^(queued|processing|completed|failed)$")
    
    started_at: Optional[datetime]
    completed_at: Optional[datetime]
    
    estimated_completion: Optional[datetime]


class QueueStats(BaseSchema):
    """Queue statistics"""
    # Current state
    current_queue_size: int
    oldest_queued_age_minutes: Optional[int]
    
    # Today's stats
    today_processed: int
    today_successful: int
    today_failed: int
    
    # Rates
    success_rate: Decimal
    failure_rate: Decimal
    
    # Performance
    average_queue_time_minutes: Decimal
    average_processing_time_seconds: Decimal

# --- File: D:\hostel-management-saas\app\schemas\notification\notification_response.py ---
"""
Notification response schemas
"""
from datetime import datetime
from typing import Dict, Any, List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import NotificationType, NotificationStatus


class NotificationResponse(BaseResponseSchema):
    """Notification response"""
    recipient_user_id: Optional[UUID]
    recipient_email: Optional[str]
    recipient_phone: Optional[str]
    
    notification_type: NotificationType
    
    subject: Optional[str]
    message_body: str
    
    priority: str
    status: NotificationStatus
    
    scheduled_at: Optional[datetime]
    sent_at: Optional[datetime]
    
    created_at: datetime


class NotificationDetail(BaseResponseSchema):
    """Detailed notification information"""
    recipient_user_id: Optional[UUID]
    recipient_email: Optional[str]
    recipient_phone: Optional[str]
    
    notification_type: NotificationType
    template_code: Optional[str]
    
    subject: Optional[str]
    message_body: str
    
    priority: str
    status: NotificationStatus
    
    # Schedule
    scheduled_at: Optional[datetime]
    sent_at: Optional[datetime]
    failed_at: Optional[datetime]
    
    # Delivery
    failure_reason: Optional[str]
    retry_count: int
    max_retries: int
    
    # Metadata
    metadata: Dict[str, Any]
    
    # Related
    hostel_id: Optional[UUID]
    
    # Timestamps
    created_at: datetime
    updated_at: datetime


class NotificationList(BaseSchema):
    """List of notifications for user"""
    user_id: UUID
    
    total_notifications: int
    unread_count: int
    
    notifications: List["NotificationListItem"]


class NotificationListItem(BaseSchema):
    """Notification list item"""
    id: UUID
    notification_type: NotificationType
    
    subject: Optional[str]
    message_preview: str = Field(..., description="First 100 characters")
    
    priority: str
    
    is_read: bool = Field(False)
    read_at: Optional[datetime]
    
    created_at: datetime
    
    # Quick actions
    action_url: Optional[str] = Field(None, description="URL to navigate to")
    icon: Optional[str] = Field(None, description="Icon identifier")


class UnreadCount(BaseSchema):
    """Unread notification count"""
    user_id: UUID
    
    total_unread: int
    
    # By type
    email_unread: int
    sms_unread: int
    push_unread: int
    in_app_unread: int
    
    # By priority
    urgent_unread: int
    high_unread: int


class NotificationSummary(BaseSchema):
    """Notification summary for user"""
    user_id: UUID
    
    # Counts
    total_notifications: int
    unread_notifications: int
    
    # Recent
    last_notification_at: Optional[datetime]
    
    # By type
    notifications_by_type: Dict[str, int]
    
    # By status
    notifications_by_status: Dict[str, int]

# --- File: D:\hostel-management-saas\app\schemas\notification\notification_routing.py ---
"""
Notification routing schemas
"""
from typing import List, Optional, Dict
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.enums import UserRole, Priority


class RoutingConfig(BaseSchema):
    """Notification routing configuration"""
    hostel_id: UUID
    
    # Routing rules
    rules: List["RoutingRule"]
    
    # Escalation settings
    enable_escalation: bool = Field(True)
    escalation_timeout_hours: int = Field(24, ge=1, le=168)


class RoutingRule(BaseSchema):
    """Individual routing rule"""
    rule_name: str
    
    # Condition
    event_type: str = Field(..., description="complaint, payment, maintenance, etc.")
    priority: Optional[Priority] = None
    
    # Recipients
    recipient_roles: List[UserRole]
    specific_users: List[UUID] = Field(default_factory=list)
    
    # Channels
    channels: List[str] = Field(..., description="email, sms, push")
    
    # Active
    is_active: bool = Field(True)


class HierarchicalRouting(BaseSchema):
    """Hierarchical notification routing"""
    hostel_id: UUID
    event_type: str
    
    # Routing chain
    primary_recipients: List[UUID] = Field(..., description="Supervisors")
    secondary_recipients: List[UUID] = Field(default_factory=list, description="Admins")
    tertiary_recipients: List[UUID] = Field(default_factory=list, description="Super admin")
    
    # Escalation timing
    escalate_to_secondary_after_hours: int = Field(24)
    escalate_to_tertiary_after_hours: int = Field(48)


class EscalationRouting(BaseCreateSchema):
    """Escalation routing configuration"""
    notification_id: UUID
    
    # Escalation path
    escalation_chain: List["EscalationLevel"]
    
    # Current level
    current_level: int = Field(0)
    
    # Auto-escalate
    auto_escalate: bool = Field(True)


class EscalationLevel(BaseSchema):
    """Single level in escalation chain"""
    level: int
    recipients: List[UUID]
    escalate_after_hours: int
    channels: List[str]


class NotificationRoute(BaseSchema):
    """Determined notification route"""
    notification_id: UUID
    
    # Recipients
    primary_recipients: List[UUID]
    cc_recipients: List[UUID] = Field(default_factory=list)
    
    # Channels by recipient
    recipient_channels: Dict[UUID, List[str]]
    
    # Escalation
    escalation_enabled: bool
    escalation_path: Optional[List[EscalationLevel]]

# --- File: D:\hostel-management-saas\app\schemas\notification\notification_template.py ---
"""
Notification template schemas
"""
from typing import Dict, List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseResponseSchema, BaseSchema
from app.schemas.common.enums import NotificationType


class TemplateCreate(BaseCreateSchema):
    """Create notification template"""
    template_code: str = Field(..., min_length=3, max_length=100, description="Unique template code")
    template_name: str = Field(..., min_length=3, max_length=255, description="Template name")
    
    template_type: NotificationType = Field(..., description="Email, SMS, or Push")
    
    # Content
    subject: Optional[str] = Field(None, max_length=255, description="Subject (for email/push)")
    body_template: str = Field(..., description="Template with {{variable}} placeholders")
    
    # Variables
    variables: List[str] = Field(..., description="List of required variables")
    
    # Settings
    is_active: bool = Field(True)
    
    # Description
    description: Optional[str] = Field(None, max_length=500)


class TemplateUpdate(BaseUpdateSchema):
    """Update template"""
    template_name: Optional[str] = Field(None, min_length=3, max_length=255)
    subject: Optional[str] = None
    body_template: Optional[str] = None
    variables: Optional[List[str]] = None
    is_active: Optional[bool] = None
    description: Optional[str] = None


class TemplateResponse(BaseResponseSchema):
    """Template response"""
    template_code: str
    template_name: str
    template_type: NotificationType
    
    subject: Optional[str]
    body_template: str
    
    variables: List[str]
    
    is_active: bool
    description: Optional[str]
    
    # Usage stats
    usage_count: int = Field(0, description="Times this template has been used")
    last_used_at: Optional[datetime]


class VariableMapping(BaseSchema):
    """Variable mapping for template rendering"""
    template_code: str
    variables: Dict[str, str] = Field(..., description="Variable name -> value mapping")


class TemplatePreview(BaseCreateSchema):
    """Preview rendered template"""
    template_code: str
    variables: Dict[str, str]


class TemplatePreviewResponse(BaseSchema):
    """Rendered template preview"""
    subject: Optional[str]
    rendered_body: str
    
    # Validation
    all_variables_provided: bool
    missing_variables: List[str] = Field(default_factory=list)


class TemplateList(BaseSchema):
    """List of templates"""
    total_templates: int
    active_templates: int
    
    templates: List[TemplateResponse]


class TemplateCategory(BaseSchema):
    """Template category/group"""
    category_name: str
    templates: List[TemplateResponse]

# --- File: D:\hostel-management-saas\app\schemas\notification\push_notification.py ---
"""
Push notification schemas
"""
from datetime import datetime
from typing import Dict, Optional, List, Any
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema
from app.schemas.common.enums import DeviceType


class PushRequest(BaseCreateSchema):
    """Send push notification"""
    # Recipients
    user_id: Optional[UUID] = Field(None, description="Send to all devices of this user")
    device_token: Optional[str] = Field(None, description="Send to specific device")
    device_tokens: Optional[List[str]] = Field(None, description="Send to multiple devices")
    
    # Content
    title: str = Field(..., min_length=1, max_length=100)
    body: str = Field(..., min_length=1, max_length=500)
    
    # Additional data
    data: Dict[str, Any] = Field(default_factory=dict, description="Custom data payload")
    
    # Action
    action_url: Optional[str] = Field(None, description="Deep link or URL to open")
    
    # Appearance
    icon: Optional[str] = None
    image_url: Optional[str] = None
    badge_count: Optional[int] = Field(None, ge=0)
    
    # Sound
    sound: Optional[str] = Field("default", description="Notification sound")
    
    # Priority
    priority: str = Field("normal", pattern="^(low|normal|high)$")
    
    # Time to live
    ttl: int = Field(86400, ge=0, description="Time to live in seconds")


class PushConfig(BaseSchema):
    """Push notification configuration"""
    # Firebase
    firebase_project_id: str
    firebase_server_key: str
    
    # APNs (iOS)
    apns_key_id: Optional[str]
    apns_team_id: Optional[str]
    apns_bundle_id: Optional[str]
    
    # Settings
    collapse_key: Optional[str] = Field(None, description="Notification grouping")
    
    # Badge management
    auto_increment_badge: bool = Field(True)


class DeviceToken(BaseResponseSchema):
    """Device token registration"""
    user_id: UUID
    device_token: str
    device_type: DeviceType
    
    device_name: Optional[str]
    device_model: Optional[str]
    os_version: Optional[str]
    app_version: Optional[str]
    
    is_active: bool
    last_used_at: datetime
    registered_at: datetime


class DeviceRegistration(BaseCreateSchema):
    """Register device for push notifications"""
    user_id: UUID
    device_token: str = Field(..., min_length=10)
    device_type: DeviceType
    
    # Device details
    device_name: Optional[str] = None
    device_model: Optional[str] = None
    os_version: Optional[str] = None
    app_version: Optional[str] = None
    
    # Timezone
    timezone: Optional[str] = Field(None, description="Device timezone")


class DeviceUnregistration(BaseCreateSchema):
    """Unregister device"""
    device_token: str
    user_id: Optional[UUID] = None


class PushTemplate(BaseSchema):
    """Push notification template"""
    template_code: str
    
    title: str
    body: str
    
    # Default settings
    default_icon: Optional[str]
    default_sound: str = Field("default")
    
    # Variables
    required_variables: List[str]
    
    # Actions
    default_action_url: Optional[str]


class PushDeliveryStatus(BaseSchema):
    """Push notification delivery status"""
    notification_id: UUID
    device_token: str
    
    status: str = Field(
        ...,
        pattern="^(queued|sent|delivered|failed|expired)$"
    )
    
    sent_at: Optional[datetime]
    delivered_at: Optional[datetime]
    failed_at: Optional[datetime]
    
    error_code: Optional[str]
    error_message: Optional[str]
    
    # Provider details
    provider_message_id: Optional[str]


class PushStats(BaseSchema):
    """Push notification statistics"""
    total_sent: int
    total_delivered: int
    total_failed: int
    
    delivery_rate: Decimal
    
    # By platform
    ios_sent: int
    android_sent: int
    web_sent: int
    
    # Engagement
    total_opened: int
    open_rate: Decimal
    
    period_start: date
    period_end: date

# --- File: D:\hostel-management-saas\app\schemas\notification\sms_notification.py ---
"""
SMS notification schemas
"""
from datetime import datetime
from typing import Optional, Dict, List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class SMSRequest(BaseCreateSchema):
    """Send SMS notification"""
    recipient_phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$', description="Phone number")
    
    message: str = Field(..., min_length=1, max_length=160, description="SMS message (160 chars)")
    
    # Template
    template_code: Optional[str] = None
    template_variables: Optional[Dict[str, str]] = None
    
    # Settings
    sender_id: Optional[str] = Field(None, max_length=11, description="Sender ID/Name")
    
    # Priority
    priority: str = Field("normal", pattern="^(low|normal|high)$")
    
    # DLT (India-specific)
    dlt_template_id: Optional[str] = Field(None, description="DLT template ID for India")


class SMSConfig(BaseSchema):
    """SMS configuration"""
    # Service provider
    service_provider: str = Field(..., pattern="^(twilio|aws_sns|msg91|custom)$")
    
    # Credentials
    account_sid: Optional[str] = None
    auth_token: Optional[str] = None
    
    # Sender
    default_sender_id: str = Field(..., max_length=11)
    
    # Rate limiting
    max_sms_per_hour: int = Field(100, ge=1)
    max_sms_per_day: int = Field(1000, ge=1)
    
    # Country settings
    default_country_code: str = Field("+91", description="Default country code")


class DeliveryStatus(BaseSchema):
    """SMS delivery status"""
    sms_id: UUID
    recipient_phone: str
    
    # Status
    status: str = Field(
        ...,
        pattern="^(queued|sent|delivered|failed|undelivered)$"
    )
    
    # Timeline
    queued_at: datetime
    sent_at: Optional[datetime]
    delivered_at: Optional[datetime]
    failed_at: Optional[datetime]
    
    # Error
    error_code: Optional[str]
    error_message: Optional[str]
    
    # Provider details
    provider_message_id: Optional[str]
    segments_count: int = Field(1, description="Number of SMS segments")
    
    # Cost
    cost: Optional[Decimal] = Field(None, description="Cost per SMS")


class SMSTemplate(BaseSchema):
    """SMS template"""
    template_code: str
    message_template: str = Field(..., max_length=160)
    
    # Variables
    required_variables: List[str]
    
    # DLT (India)
    dlt_template_id: Optional[str]
    dlt_approved: bool = Field(False)


class BulkSMSRequest(BaseCreateSchema):
    """Send bulk SMS"""
    recipients: List[str] = Field(
        ...,
        min_items=1,
        max_items=10000,
        description="List of phone numbers"
    )
    
    message: str = Field(..., max_length=160)
    
    # Template
    template_code: Optional[str] = None
    
    # Per-recipient variables
    recipient_variables: Optional[Dict[str, Dict[str, str]]] = None
    
    # Batch settings
    batch_size: int = Field(100, ge=10, le=1000)
    delay_between_batches_seconds: int = Field(2, ge=1, le=10)


class SMSStats(BaseSchema):
    """SMS statistics"""
    total_sent: int
    total_delivered: int
    total_failed: int
    
    delivery_rate: Decimal
    failure_rate: Decimal
    
    # Cost
    total_cost: Decimal
    average_cost_per_sms: Decimal
    
    # Segments
    total_segments: int
    average_segments_per_sms: Decimal
    
    period_start: date
    period_end: date

# --- File: D:\hostel-management-saas\app\schemas\notification\__init__.py ---
"""
Notification schemas package
"""
from app.schemas.notification.notification_base import (
    NotificationBase,
    NotificationCreate,
    NotificationUpdate
)
from app.schemas.notification.notification_response import (
    NotificationResponse,
    NotificationList,
    UnreadCount,
    NotificationDetail
)
from app.schemas.notification.notification_template import (
    TemplateCreate,
    TemplateUpdate,
    TemplateResponse,
    VariableMapping
)
from app.schemas.notification.email_notification import (
    EmailRequest,
    EmailConfig,
    EmailTracking,
    EmailTemplate
)
from app.schemas.notification.sms_notification import (
    SMSRequest,
    SMSConfig,
    DeliveryStatus,
    SMSTemplate
)
from app.schemas.notification.push_notification import (
    PushRequest,
    PushConfig,
    DeviceToken,
    DeviceRegistration,
    PushTemplate
)
from app.schemas.notification.notification_queue import (
    QueueStatus,
    QueuedNotification,
    BatchProcessing,
    QueueStats
)
from app.schemas.notification.notification_preferences import (
    UserPreferences,
    ChannelPreferences,
    FrequencySettings,
    PreferenceUpdate
)
from app.schemas.notification.notification_routing import (
    RoutingConfig,
    HierarchicalRouting,
    EscalationRouting,
    RoutingRule
)

__all__ = [
    # Base
    "NotificationBase",
    "NotificationCreate",
    "NotificationUpdate",
    
    # Response
    "NotificationResponse",
    "NotificationList",
    "UnreadCount",
    "NotificationDetail",
    
    # Template
    "TemplateCreate",
    "TemplateUpdate",
    "TemplateResponse",
    "VariableMapping",
    
    # Email
    "EmailRequest",
    "EmailConfig",
    "EmailTracking",
    "EmailTemplate",
    
    # SMS
    "SMSRequest",
    "SMSConfig",
    "DeliveryStatus",
    "SMSTemplate",
    
    # Push
    "PushRequest",
    "PushConfig",
    "DeviceToken",
    "DeviceRegistration",
    "PushTemplate",
    
    # Queue
    "QueueStatus",
    "QueuedNotification",
    "BatchProcessing",
    "QueueStats",
    
    # Preferences
    "UserPreferences",
    "ChannelPreferences",
    "FrequencySettings",
    "PreferenceUpdate",
    
    # Routing
    "RoutingConfig",
    "HierarchicalRouting",
    "EscalationRouting",
    "RoutingRule",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\payment =====

# --- File: D:\hostel-management-saas\app\schemas\payment\payment_base.py ---
"""
Payment base schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import PaymentType, PaymentMethod, PaymentStatus


class PaymentBase(BaseSchema):
    """Base payment schema"""
    payer_id: UUID = Field(..., description="User making payment")
    hostel_id: UUID = Field(..., description="Hostel receiving payment")
    student_id: Optional[UUID] = Field(None, description="Student profile (for recurring fees)")
    booking_id: Optional[UUID] = Field(None, description="Booking (for booking payments)")
    
    # Payment details
    payment_type: PaymentType = Field(..., description="Type of payment")
    amount: Decimal = Field(..., ge=0, max_digits=10, decimal_places=2, description="Payment amount")
    currency: str = Field("INR", min_length=3, max_length=3, description="Currency code")
    
    # Period covered (for recurring fees)
    payment_period_start: Optional[date] = Field(None, description="Period start date")
    payment_period_end: Optional[date] = Field(None, description="Period end date")
    
    # Payment method
    payment_method: PaymentMethod = Field(..., description="Payment method")
    payment_gateway: Optional[str] = Field(None, description="Gateway used (razorpay/stripe/paytm)")
    
    # Due date (for scheduled payments)
    due_date: Optional[date] = Field(None, description="Payment due date")


class PaymentCreate(PaymentBase, BaseCreateSchema):
    """Create payment schema"""
    # Additional creation fields
    transaction_id: Optional[str] = Field(None, description="External transaction ID")
    collected_by: Optional[UUID] = Field(None, description="Staff who collected (for cash/cheque)")


class PaymentUpdate(BaseUpdateSchema):
    """Update payment schema"""
    payment_status: Optional[PaymentStatus] = None
    transaction_id: Optional[str] = None
    paid_at: Optional[datetime] = None
    failed_at: Optional[datetime] = None
    failure_reason: Optional[str] = None
    
    # Receipt
    receipt_number: Optional[str] = None
    receipt_url: Optional[str] = None

# --- File: D:\hostel-management-saas\app\schemas\payment\payment_filters.py ---
"""
Payment filter and search schemas
"""
from datetime import date
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseFilterSchema
from app.schemas.common.enums import PaymentType, PaymentMethod, PaymentStatus


class PaymentFilterParams(BaseFilterSchema):
    """Payment filter parameters"""
    # Text search
    search: Optional[str] = Field(None, description="Search in reference, payer name, transaction ID")
    
    # Entity filters
    hostel_id: Optional[UUID] = None
    hostel_ids: Optional[List[UUID]] = None
    student_id: Optional[UUID] = None
    payer_id: Optional[UUID] = None
    
    # Payment type
    payment_type: Optional[PaymentType] = None
    payment_types: Optional[List[PaymentType]] = None
    
    # Payment method
    payment_method: Optional[PaymentMethod] = None
    payment_methods: Optional[List[PaymentMethod]] = None
    
    # Status
    payment_status: Optional[PaymentStatus] = None
    payment_statuses: Optional[List[PaymentStatus]] = None
    
    # Amount range
    amount_min: Optional[Decimal] = Field(None, ge=0)
    amount_max: Optional[Decimal] = Field(None, ge=0)
    
    # Date filters
    paid_date_from: Optional[date] = None
    paid_date_to: Optional[date] = None
    due_date_from: Optional[date] = None
    due_date_to: Optional[date] = None
    created_date_from: Optional[date] = None
    created_date_to: Optional[date] = None
    
    # Overdue filter
    overdue_only: Optional[bool] = None
    
    # Gateway
    payment_gateway: Optional[str] = None


class PaymentSearchRequest(BaseFilterSchema):
    """Payment search request"""
    query: str = Field(..., min_length=1, description="Search query")
    hostel_id: Optional[UUID] = None
    
    # Search fields
    search_in_reference: bool = Field(True)
    search_in_payer_name: bool = Field(True)
    search_in_transaction_id: bool = Field(True)
    
    # Filters
    payment_status: Optional[PaymentStatus] = None
    
    # Pagination
    page: int = Field(1, ge=1)
    page_size: int = Field(20, ge=1, le=100)


class PaymentReportRequest(BaseFilterSchema):
    """Payment report generation request"""
    hostel_id: Optional[UUID] = None
    
    # Date range (required)
    date_from: date = Field(..., description="Report start date")
    date_to: date = Field(..., description="Report end date")
    
    # Filters
    payment_types: Optional[List[PaymentType]] = None
    payment_methods: Optional[List[PaymentMethod]] = None
    
    # Grouping
    group_by: str = Field("day", pattern="^(day|week|month|payment_type|payment_method)$")
    
    # Format
    format: str = Field("pdf", pattern="^(pdf|excel|csv)$")
    
    # Include details
    include_transaction_details: bool = Field(True)
    include_student_details: bool = Field(True)
    include_charts: bool = Field(True, description="Include charts/graphs")


class PaymentExportRequest(BaseFilterSchema):
    """Export payments data"""
    filters: PaymentFilterParams = Field(..., description="Filter criteria")
    
    format: str = Field("csv", pattern="^(csv|excel|pdf)$")
    
    # Fields to include
    include_payer_details: bool = Field(True)
    include_gateway_details: bool = Field(False)
    include_refund_details: bool = Field(True)

# --- File: D:\hostel-management-saas\app\schemas\payment\payment_gateway.py ---
"""
Payment gateway integration schemas
"""
from datetime import datetime
from decimal import Decimal
from typing import Optional, Dict, Any
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class GatewayRequest(BaseSchema):
    """Payment gateway request"""
    payment_id: UUID
    amount: Decimal
    currency: str
    
    # Customer details
    customer_name: str
    customer_email: str
    customer_phone: str
    
    # Order details
    order_id: str
    description: str
    
    # Callback URLs
    callback_url: str
    success_url: Optional[str]
    failure_url: Optional[str]
    
    # Additional metadata
    metadata: Dict[str, Any] = Field(default_factory=dict)


class GatewayResponse(BaseSchema):
    """Payment gateway response"""
    payment_id: UUID
    gateway_order_id: str
    gateway_payment_id: Optional[str]
    
    status: str = Field(..., pattern="^(created|pending|authorized|captured|failed)$")
    
    amount: Decimal
    currency: str
    
    # Gateway-specific data
    gateway_response: Dict[str, Any]
    
    # Timestamps
    created_at: datetime
    updated_at: datetime


class GatewayWebhook(BaseCreateSchema):
    """Payment gateway webhook payload"""
    event_type: str = Field(..., description="Event type from gateway")
    
    # Gateway identifiers
    gateway_order_id: str
    gateway_payment_id: Optional[str]
    
    # Payment details
    amount: Decimal
    currency: str
    status: str
    
    # Full webhook payload
    raw_payload: Dict[str, Any] = Field(..., description="Complete webhook payload")
    
    # Signature verification
    signature: str = Field(..., description="Webhook signature")
    
    # Timestamp
    event_timestamp: datetime


class GatewayCallback(BaseSchema):
    """Payment gateway callback processing"""
    payment_id: UUID
    gateway_payment_id: str
    
    success: bool
    status: str
    
    amount_paid: Decimal
    
    # Error details (if failed)
    error_code: Optional[str] = None
    error_message: Optional[str] = None
    
    # Additional data
    callback_data: Dict[str, Any]


class GatewayRefundRequest(BaseCreateSchema):
    """Refund request to gateway"""
    payment_id: UUID
    gateway_payment_id: str
    
    refund_amount: Decimal
    reason: str = Field(..., min_length=10, max_length=500)
    
    # Speed
    refund_speed: str = Field("normal", pattern="^(normal|instant)$")


class GatewayRefundResponse(BaseSchema):
    """Refund response from gateway"""
    refund_id: str
    gateway_refund_id: str
    
    status: str
    amount: Decimal
    
    # Estimated timeline
    estimated_completion_date: Optional[date]
    
    gateway_response: Dict[str, Any]

# --- File: D:\hostel-management-saas\app\schemas\payment\payment_ledger.py ---
"""
Payment ledger and account statement schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseResponseSchema


class LedgerEntry(BaseResponseSchema):
    """Individual ledger entry"""
    student_id: UUID
    hostel_id: UUID
    
    entry_date: date
    entry_type: str = Field(..., pattern="^(debit|credit)$")
    
    # Transaction details
    transaction_type: str = Field(..., description="Type of transaction")
    amount: Decimal
    
    # Running balance
    balance_before: Decimal
    balance_after: Decimal
    
    # Reference
    payment_id: Optional[UUID] = None
    payment_reference: Optional[str] = None
    
    description: str
    
    # Metadata
    created_by: Optional[UUID] = None
    notes: Optional[str] = None


class LedgerSummary(BaseSchema):
    """Ledger summary for student"""
    student_id: UUID
    student_name: str
    hostel_id: UUID
    
    # Current balance
    current_balance: Decimal
    
    # Breakdown
    total_charges: Decimal
    total_payments: Decimal
    total_refunds: Decimal
    
    # Outstanding
    total_due: Decimal
    overdue_amount: Decimal
    
    # Last transaction
    last_transaction_date: Optional[date]
    last_payment_date: Optional[date]


class AccountStatement(BaseSchema):
    """Account statement for period"""
    student_id: UUID
    student_name: str
    hostel_id: UUID
    hostel_name: str
    
    statement_period_start: date
    statement_period_end: date
    generated_at: datetime
    
    # Opening balance
    opening_balance: Decimal
    
    # Transactions
    entries: List[LedgerEntry]
    
    # Summary
    total_debits: Decimal
    total_credits: Decimal
    
    # Closing balance
    closing_balance: Decimal
    
    # Download link
    pdf_url: Optional[str] = None


class TransactionHistory(BaseSchema):
    """Transaction history"""
    student_id: UUID
    
    transactions: List["TransactionItem"]
    
    # Pagination
    total_transactions: int
    page: int
    page_size: int


class TransactionItem(BaseSchema):
    """Individual transaction in history"""
    transaction_id: UUID
    transaction_date: datetime
    transaction_type: str
    
    amount: Decimal
    balance_after: Decimal
    
    description: str
    payment_reference: Optional[str]
    
    status: str


class BalanceAdjustment(BaseSchema):
    """Manual balance adjustment (admin only)"""
    student_id: UUID
    hostel_id: UUID
    
    adjustment_type: str = Field(..., pattern="^(debit|credit)$")
    amount: Decimal = Field(..., ge=0)
    
    reason: str = Field(..., min_length=20, max_length=500)
    
    adjusted_by: UUID
    adjustment_date: date
    
    notes: Optional[str] = None


class WriteOff(BaseSchema):
    """Write off outstanding amount"""
    student_id: UUID
    amount: Decimal = Field(..., ge=0)
    
    reason: str = Field(..., min_length=20, max_length=500)
    
    approved_by: UUID
    approval_date: date
    
    # Documentation
    supporting_documents: List[str] = Field(default_factory=list)

# --- File: D:\hostel-management-saas\app\schemas\payment\payment_refund.py ---
"""
Payment refund schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema


class RefundRequest(BaseCreateSchema):
    """Request payment refund"""
    payment_id: UUID = Field(..., description="Payment ID to refund")
    refund_amount: Decimal = Field(..., ge=0, description="Amount to refund")
    
    refund_reason: str = Field(..., min_length=10, max_length=500, description="Reason for refund")
    
    # Refund type
    refund_type: str = Field(
        "full",
        pattern="^(full|partial)$",
        description="Full or partial refund"
    )
    
    # Processing
    refund_method: str = Field(
        "original_source",
        pattern="^(original_source|bank_transfer|cash|cheque)$",
        description="How to refund"
    )
    
    # Bank details (if bank_transfer)
    bank_account_number: Optional[str] = Field(None, description="Bank account number")
    bank_ifsc_code: Optional[str] = Field(None, description="IFSC code")
    account_holder_name: Optional[str] = Field(None, description="Account holder name")
    
    # Additional details
    admin_notes: Optional[str] = Field(None, max_length=500)


class RefundResponse(BaseResponseSchema):
    """Refund response"""
    refund_id: UUID
    payment_id: UUID
    payment_reference: str
    
    refund_amount: Decimal
    refund_status: str = Field(..., pattern="^(pending|processing|completed|failed)$")
    
    # Processing details
    refund_method: str
    refund_reference: Optional[str] = Field(None, description="Refund transaction reference")
    
    # Timeline
    requested_at: datetime
    processed_at: Optional[datetime]
    completed_at: Optional[datetime]
    estimated_completion_date: Optional[date]
    
    # Refund to
    refunded_to: str = Field(..., description="Destination of refund")
    
    message: str


class RefundStatus(BaseSchema):
    """Refund status tracking"""
    refund_id: UUID
    payment_reference: str
    
    refund_amount: Decimal
    currency: str
    
    status: str = Field(..., pattern="^(pending|processing|completed|failed|cancelled)$")
    
    # Timeline
    requested_at: datetime
    processing_started_at: Optional[datetime]
    completed_at: Optional[datetime]
    
    # Days elapsed
    days_since_request: int
    
    # Failure details
    failure_reason: Optional[str] = None
    
    # Next steps
    next_action: Optional[str] = None
    expected_completion_date: Optional[date] = None


class RefundApproval(BaseCreateSchema):
    """Approve refund request (admin)"""
    refund_id: UUID
    approved: bool
    
    # If approved
    processing_notes: Optional[str] = None
    
    # If rejected
    rejection_reason: Optional[str] = None


class RefundList(BaseSchema):
    """List of refunds"""
    total_refunds: int
    total_amount_refunded: Decimal
    
    refunds: List["RefundListItem"]


class RefundListItem(BaseSchema):
    """Refund list item"""
    refund_id: UUID
    payment_reference: str
    student_name: str
    
    refund_amount: Decimal
    status: str
    
    requested_at: datetime
    completed_at: Optional[datetime]

# --- File: D:\hostel-management-saas\app\schemas\payment\payment_reminder.py ---
"""
Payment reminder schemas
"""
from datetime import datetime, date
from typing import Optional, List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema


class ReminderConfig(BaseSchema):
    """Payment reminder configuration"""
    hostel_id: UUID
    
    # Reminder timing
    days_before_due: List[int] = Field(
        default_factory=lambda: [7, 3, 1],
        description="Days before due date to send reminders"
    )
    days_after_due: List[int] = Field(
        default_factory=lambda: [1, 3, 7, 15],
        description="Days after due date for overdue reminders"
    )
    
    # Channels
    send_email: bool = Field(True)
    send_sms: bool = Field(True)
    send_push: bool = Field(True)
    
    # Escalation
    escalate_after_days: int = Field(15, description="Escalate to admin after days")
    
    # Template
    email_template_id: Optional[UUID] = None
    sms_template_id: Optional[UUID] = None
    
    is_active: bool = Field(True)


class ReminderLog(BaseResponseSchema):
    """Payment reminder log entry"""
    payment_id: UUID
    payment_reference: str
    
    student_id: UUID
    student_name: str
    student_email: str
    student_phone: str
    
    # Reminder details
    reminder_type: str = Field(..., pattern="^(due_soon|overdue|final_notice)$")
    reminder_channel: str = Field(..., pattern="^(email|sms|push)$")
    
    # Status
    sent_at: datetime
    delivery_status: str = Field(..., pattern="^(sent|delivered|failed|bounced)$")
    
    # Content
    subject: Optional[str] = None
    message_preview: str
    
    # Response
    opened: bool = Field(False, description="Email opened")
    clicked: bool = Field(False, description="Link clicked")


class SendReminderRequest(BaseCreateSchema):
    """Send payment reminder manually"""
    payment_id: Optional[UUID] = Field(None, description="Specific payment")
    student_id: Optional[UUID] = Field(None, description="All due payments for student")
    hostel_id: Optional[UUID] = Field(None, description="All due payments for hostel")
    
    # Reminder settings
    reminder_type: str = Field("overdue", pattern="^(due_soon|overdue|final_notice)$")
    
    channels: List[str] = Field(
        default_factory=lambda: ["email", "sms"],
        description="Channels to use"
    )
    
    # Custom message
    custom_message: Optional[str] = Field(None, max_length=500)


class ReminderBatch(BaseSchema):
    """Batch reminder sending"""
    batch_id: UUID
    
    total_payments: int
    reminders_sent: int
    reminders_failed: int
    
    # Breakdown by channel
    email_sent: int
    sms_sent: int
    push_sent: int
    
    started_at: datetime
    completed_at: Optional[datetime]
    
    status: str = Field(..., pattern="^(processing|completed|failed)$")


class ReminderStats(BaseSchema):
    """Reminder statistics"""
    hostel_id: UUID
    period_start: date
    period_end: date
    
    total_reminders_sent: int
    
    # By type
    due_soon_reminders: int
    overdue_reminders: int
    final_notices: int
    
    # By channel
    email_reminders: int
    sms_reminders: int
    push_reminders: int
    
    # Effectiveness
    payment_rate_after_reminder: Decimal = Field(..., description="% who paid after reminder")
    average_days_to_payment: Decimal

# --- File: D:\hostel-management-saas\app\schemas\payment\payment_request.py ---
"""
Payment request schemas
"""
from datetime import date
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema
from app.schemas.common.enums import PaymentType, PaymentMethod


class PaymentRequest(BaseCreateSchema):
    """Online payment request"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    student_id: Optional[UUID] = Field(None, description="Student ID (for recurring fees)")
    booking_id: Optional[UUID] = Field(None, description="Booking ID (for booking payment)")
    
    payment_type: PaymentType = Field(..., description="Type of payment")
    amount: Decimal = Field(..., ge=0, description="Amount to pay")
    
    # For recurring fees
    payment_period_start: Optional[date] = None
    payment_period_end: Optional[date] = None
    
    # Payment method
    payment_method: PaymentMethod = Field(PaymentMethod.PAYMENT_GATEWAY, description="Payment method")
    payment_gateway: str = Field("razorpay", pattern="^(razorpay|stripe|paytm)$")
    
    # Return URLs
    success_url: Optional[str] = Field(None, description="URL to redirect on success")
    failure_url: Optional[str] = Field(None, description="URL to redirect on failure")
    cancel_url: Optional[str] = Field(None, description="URL if payment cancelled")


class PaymentInitiation(BaseSchema):
    """Payment initiation response"""
    payment_id: UUID
    payment_reference: str
    
    amount: Decimal
    currency: str
    
    # Gateway details
    gateway: str
    gateway_order_id: str
    gateway_key: str
    
    # Checkout info
    checkout_url: Optional[str] = None
    checkout_token: Optional[str] = None
    
    # For client-side integration
    gateway_options: dict = Field(..., description="Gateway-specific options")


class ManualPaymentRequest(BaseCreateSchema):
    """Manual payment recording (cash/cheque)"""
    hostel_id: UUID
    student_id: UUID
    
    payment_type: PaymentType
    amount: Decimal = Field(..., ge=0)
    
    payment_method: PaymentMethod = Field(..., pattern="^(cash|cheque|bank_transfer)$")
    
    # For cheque
    cheque_number: Optional[str] = None
    cheque_date: Optional[date] = None
    bank_name: Optional[str] = None
    
    # For bank transfer
    transaction_reference: Optional[str] = None
    transfer_date: Optional[date] = None
    
    # Period
    payment_period_start: Optional[date] = None
    payment_period_end: Optional[date] = None
    
    # Collection details
    collected_by: UUID = Field(..., description="Staff member who collected")
    collection_date: date = Field(..., description="Date of collection")
    
    notes: Optional[str] = Field(None, max_length=500)


class BulkPaymentRequest(BaseCreateSchema):
    """Record multiple payments"""
    hostel_id: UUID
    payments: List["SinglePaymentRecord"] = Field(..., min_items=1, max_items=100)
    
    collected_by: UUID
    collection_date: date


class SinglePaymentRecord(BaseSchema):
    """Single payment in bulk"""
    student_id: UUID
    payment_type: PaymentType
    amount: Decimal
    payment_method: PaymentMethod
    
    # Optional fields
    transaction_reference: Optional[str] = None
    notes: Optional[str] = None

# --- File: D:\hostel-management-saas\app\schemas\payment\payment_response.py ---
"""
Payment response schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import PaymentType, PaymentMethod, PaymentStatus


class PaymentResponse(BaseResponseSchema):
    """Payment response schema"""
    payment_reference: str
    transaction_id: Optional[str]
    
    payer_id: UUID
    payer_name: str
    hostel_id: UUID
    hostel_name: str
    
    payment_type: PaymentType
    amount: Decimal
    currency: str
    
    payment_method: PaymentMethod
    payment_status: PaymentStatus
    
    paid_at: Optional[datetime]
    due_date: Optional[date]
    is_overdue: bool
    
    receipt_number: Optional[str]
    receipt_url: Optional[str]


class PaymentDetail(BaseResponseSchema):
    """Detailed payment information"""
    payment_reference: str
    transaction_id: Optional[str]
    
    # Payer details
    payer_id: UUID
    payer_name: str
    payer_email: str
    payer_phone: str
    
    # Payee details
    hostel_id: UUID
    hostel_name: str
    
    # Related entities
    student_id: Optional[UUID]
    student_name: Optional[str]
    booking_id: Optional[UUID]
    booking_reference: Optional[str]
    
    # Payment details
    payment_type: PaymentType
    amount: Decimal
    currency: str
    
    # Period
    payment_period_start: Optional[date]
    payment_period_end: Optional[date]
    
    # Method
    payment_method: PaymentMethod
    payment_gateway: Optional[str]
    
    # Status
    payment_status: PaymentStatus
    paid_at: Optional[datetime]
    failed_at: Optional[datetime]
    failure_reason: Optional[str]
    
    # Gateway response
    gateway_response: Optional[dict]
    
    # Receipt
    receipt_number: Optional[str]
    receipt_url: Optional[str]
    receipt_generated_at: Optional[datetime]
    
    # Refund
    refund_amount: Decimal
    refund_status: str
    refunded_at: Optional[datetime]
    refund_transaction_id: Optional[str]
    refund_reason: Optional[str]
    
    # Collection
    collected_by: Optional[UUID]
    collected_by_name: Optional[str]
    collected_at: Optional[datetime]
    
    # Due date
    due_date: Optional[date]
    is_overdue: bool
    
    # Reminders
    reminder_sent_count: int
    last_reminder_sent_at: Optional[datetime]


class PaymentReceipt(BaseSchema):
    """Payment receipt"""
    receipt_number: str
    payment_reference: str
    
    # Payer
    payer_name: str
    payer_email: str
    payer_phone: str
    
    # Hostel
    hostel_name: str
    hostel_address: str
    hostel_phone: str
    
    # Payment details
    payment_type: str
    amount: Decimal
    amount_in_words: str
    currency: str
    
    payment_method: str
    transaction_id: Optional[str]
    
    # Period
    payment_for_period: Optional[str] = Field(None, description="e.g., 'January 2024'")
    
    # Dates
    payment_date: datetime
    due_date: Optional[date]
    
    # Receipt metadata
    receipt_generated_at: datetime
    receipt_url: str
    
    # Tax/GST details (if applicable)
    tax_details: Optional[dict] = None


class PaymentListItem(BaseSchema):
    """Payment list item"""
    id: UUID
    payment_reference: str
    payer_name: str
    hostel_name: str
    
    payment_type: str
    amount: Decimal
    
    payment_method: str
    payment_status: PaymentStatus
    
    paid_at: Optional[datetime]
    due_date: Optional[date]
    is_overdue: bool
    
    created_at: datetime


class PaymentSummary(BaseSchema):
    """Payment summary for student/hostel"""
    entity_id: UUID
    entity_type: str = Field(..., pattern="^(student|hostel)$")
    
    # Totals
    total_paid: Decimal
    total_pending: Decimal
    total_overdue: Decimal
    
    # Last payment
    last_payment_date: Optional[date]
    last_payment_amount: Optional[Decimal]
    
    # Next payment
    next_payment_due_date: Optional[date]
    next_payment_amount: Optional[Decimal]
    
    # Count
    total_payments: int
    completed_payments: int
    pending_payments: int

# --- File: D:\hostel-management-saas\app\schemas\payment\payment_schedule.py ---
"""
Payment schedule schemas
"""
from datetime import date
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseUpdateSchema, BaseResponseSchema
from app.schemas.common.enums import FeeType, PaymentType


class PaymentSchedule(BaseResponseSchema):
    """Payment schedule"""
    student_id: UUID
    student_name: str
    hostel_id: UUID
    hostel_name: str
    
    fee_type: FeeType
    amount: Decimal
    
    start_date: date
    end_date: Optional[date]
    next_due_date: date
    
    auto_generate_invoice: bool
    is_active: bool


class ScheduleCreate(BaseCreateSchema):
    """Create payment schedule"""
    student_id: UUID = Field(..., description="Student ID")
    hostel_id: UUID = Field(..., description="Hostel ID")
    
    fee_type: FeeType = Field(..., description="Fee type (monthly/quarterly/etc)")
    amount: Decimal = Field(..., ge=0, description="Amount per period")
    
    start_date: date = Field(..., description="Schedule start date")
    end_date: Optional[date] = Field(None, description="Schedule end date (null for indefinite)")
    
    # First due date
    first_due_date: date = Field(..., description="First payment due date")
    
    # Settings
    auto_generate_invoice: bool = Field(True, description="Auto-generate invoices")
    send_reminders: bool = Field(True, description="Send payment reminders")


class ScheduleUpdate(BaseUpdateSchema):
    """Update payment schedule"""
    amount: Optional[Decimal] = Field(None, ge=0)
    next_due_date: Optional[date] = None
    end_date: Optional[date] = None
    auto_generate_invoice: Optional[bool] = None
    is_active: Optional[bool] = None


class ScheduleGeneration(BaseSchema):
    """Generate scheduled payments"""
    schedule_id: UUID
    
    # Generate for period
    generate_from_date: date
    generate_to_date: date
    
    # Options
    skip_if_already_paid: bool = Field(True)
    send_notifications: bool = Field(True)


class ScheduledPaymentGenerated(BaseSchema):
    """Result of schedule generation"""
    schedule_id: UUID
    
    payments_generated: int
    payments_skipped: int
    
    generated_payment_ids: List[UUID]
    
    next_generation_date: date


class BulkScheduleCreate(BaseCreateSchema):
    """Create schedules for multiple students"""
    hostel_id: UUID
    student_ids: List[UUID] = Field(..., min_items=1)
    
    fee_type: FeeType
    amount: Decimal = Field(..., ge=0)
    
    start_date: date
    first_due_date: date


class ScheduleSuspension(BaseCreateSchema):
    """Suspend payment schedule temporarily"""
    schedule_id: UUID
    suspension_reason: str = Field(..., min_length=10, max_length=500)
    
    suspend_from_date: date
    suspend_to_date: date
    
    skip_dues_during_suspension: bool = Field(True, description="Skip generating dues during suspension")

# --- File: D:\hostel-management-saas\app\schemas\payment\__init__.py ---
"""
Payment schemas package
"""
from app.schemas.payment.payment_base import (
    PaymentBase,
    PaymentCreate,
    PaymentUpdate
)
from app.schemas.payment.payment_response import (
    PaymentResponse,
    PaymentDetail,
    PaymentReceipt,
    PaymentListItem
)
from app.schemas.payment.payment_request import (
    PaymentRequest,
    PaymentInitiation,
    ManualPaymentRequest
)
from app.schemas.payment.payment_gateway import (
    GatewayRequest,
    GatewayResponse,
    GatewayWebhook,
    GatewayCallback
)
from app.schemas.payment.payment_refund import (
    RefundRequest,
    RefundResponse,
    RefundStatus
)
from app.schemas.payment.payment_schedule import (
    PaymentSchedule,
    ScheduleCreate,
    ScheduleUpdate,
    ScheduleGeneration
)
from app.schemas.payment.payment_reminder import (
    ReminderConfig,
    ReminderLog,
    SendReminderRequest
)
from app.schemas.payment.payment_ledger import (
    LedgerEntry,
    LedgerSummary,
    AccountStatement
)
from app.schemas.payment.payment_filters import (
    PaymentFilterParams,
    PaymentSearchRequest,
    PaymentReportRequest
)

__all__ = [
    # Base
    "PaymentBase",
    "PaymentCreate",
    "PaymentUpdate",
    
    # Response
    "PaymentResponse",
    "PaymentDetail",
    "PaymentReceipt",
    "PaymentListItem",
    
    # Request
    "PaymentRequest",
    "PaymentInitiation",
    "ManualPaymentRequest",
    
    # Gateway
    "GatewayRequest",
    "GatewayResponse",
    "GatewayWebhook",
    "GatewayCallback",
    
    # Refund
    "RefundRequest",
    "RefundResponse",
    "RefundStatus",
    
    # Schedule
    "PaymentSchedule",
    "ScheduleCreate",
    "ScheduleUpdate",
    "ScheduleGeneration",
    
    # Reminder
    "ReminderConfig",
    "ReminderLog",
    "SendReminderRequest",
    
    # Ledger
    "LedgerEntry",
    "LedgerSummary",
    "AccountStatement",
    
    # Filters
    "PaymentFilterParams",
    "PaymentSearchRequest",
    "PaymentReportRequest",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\referral =====

# --- File: D:\hostel-management-saas\app\schemas\referral\referral_base.py ---
"""
Referral tracking schemas
"""
from datetime import datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseResponseSchema, BaseSchema
from app.schemas.common.enums import ReferralStatus, RewardStatus


class ReferralBase(BaseSchema):
    """Base referral record"""
    program_id: UUID
    referrer_id: UUID

    referee_email: Optional[str] = None
    referee_phone: Optional[str] = None
    referee_user_id: Optional[UUID] = None

    referral_code: str = Field(..., max_length=50)
    status: ReferralStatus = Field(ReferralStatus.PENDING)


class ReferralCreate(ReferralBase, BaseCreateSchema):
    """Create referral (generate code or track share)"""
    pass

# --- File: D:\hostel-management-saas\app\schemas\referral\referral_code.py ---
"""
Referral code generation/validation schemas
"""
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema


class ReferralCodeGenerate(BaseCreateSchema):
    """Generate referral code for user"""
    user_id: UUID
    program_id: UUID

    # Optional custom prefix
    prefix: str = Field("HOSTEL", max_length=10)


class ReferralCodeResponse(BaseSchema):
    """Referral code response"""
    user_id: UUID
    program_id: UUID
    referral_code: str


class CodeValidationRequest(BaseCreateSchema):
    """Validate referral code"""
    referral_code: str = Field(..., max_length=50)


class CodeValidationResponse(BaseSchema):
    """Validation result"""
    referral_code: str
    is_valid: bool
    program_id: Optional[UUID]
    referrer_id: Optional[UUID]
    message: str

# --- File: D:\hostel-management-saas\app\schemas\referral\referral_program_base.py ---
"""
Referral program definition schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Optional, List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseUpdateSchema, BaseResponseSchema
from app.schemas.common.enums import PaymentType


class ReferralProgramBase(BaseSchema):
    """Base referral program schema"""
    program_name: str = Field(..., min_length=3, max_length=100)
    program_type: str = Field(
        ...,
        pattern="^(student_referral|visitor_referral|affiliate)$",
    )

    reward_type: str = Field(
        ...,
        pattern="^(cash|discount|voucher|free_month)$",
    )
    referrer_reward_amount: Optional[Decimal] = Field(None, ge=0)
    referee_reward_amount: Optional[Decimal] = Field(None, ge=0)
    currency: str = Field("INR", min_length=3, max_length=3)

    min_booking_amount: Optional[Decimal] = Field(None, ge=0)
    min_stay_months: Optional[int] = Field(None, ge=1)

    terms_and_conditions: Optional[str] = Field(None, max_length=5000)

    is_active: bool = Field(True)
    valid_from: Optional[date] = None
    valid_to: Optional[date] = None


class ProgramCreate(ReferralProgramBase, BaseCreateSchema):
    """Create referral program"""
    pass


class ProgramUpdate(BaseUpdateSchema):
    """Update referral program"""
    program_name: Optional[str] = None
    reward_type: Optional[str] = None
    referrer_reward_amount: Optional[Decimal] = Field(None, ge=0)
    referee_reward_amount: Optional[Decimal] = Field(None, ge=0)
    min_booking_amount: Optional[Decimal] = Field(None, ge=0)
    min_stay_months: Optional[int] = Field(None, ge=1)
    terms_and_conditions: Optional[str] = None
    is_active: Optional[bool] = None
    valid_from: Optional[date] = None
    valid_to: Optional[date] = None

# --- File: D:\hostel-management-saas\app\schemas\referral\referral_program_response.py ---
"""
Referral program response schemas
"""
from datetime import date
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema


class ProgramResponse(BaseResponseSchema):
    """Referral program response"""
    program_name: str
    program_type: str
    reward_type: str
    referrer_reward_amount: Optional[Decimal]
    referee_reward_amount: Optional[Decimal]
    currency: str

    min_booking_amount: Optional[Decimal]
    min_stay_months: Optional[int]

    is_active: bool
    valid_from: Optional[date]
    valid_to: Optional[date]

    terms_and_conditions: Optional[str]


class ProgramList(BaseSchema):
    """List of active programs"""
    programs: List[ProgramResponse]

# --- File: D:\hostel-management-saas\app\schemas\referral\referral_response.py ---
"""
Referral record response schemas
"""
from datetime import datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import ReferralStatus, RewardStatus


class ReferralResponse(BaseResponseSchema):
    """Referral record response"""
    program_id: UUID
    program_name: str

    referrer_id: UUID
    referrer_name: str

    referee_email: Optional[str]
    referee_phone: Optional[str]
    referee_user_id: Optional[UUID]

    referral_code: str
    status: ReferralStatus

    booking_id: Optional[UUID]
    completed_at: Optional[datetime]

    referrer_reward_amount: Optional[Decimal]
    referee_reward_amount: Optional[Decimal]
    currency: str

    referrer_reward_status: RewardStatus
    referee_reward_status: RewardStatus


class ReferralStats(BaseSchema):
    """Referral statistics for a user"""
    user_id: UUID

    total_referrals: int
    successful_referrals: int
    pending_referrals: int

    total_earned: Decimal
    total_paid_out: Decimal
    total_pending_rewards: Decimal

# --- File: D:\hostel-management-saas\app\schemas\referral\referral_rewards.py ---
"""
Referral reward tracking schemas
"""
from datetime import datetime
from decimal import Decimal
from typing import Optional, List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema
from app.schemas.common.enums import RewardStatus, PaymentMethod


class RewardConfig(BaseSchema):
    """Global referral reward config (for payouts)"""
    min_payout_amount: Decimal = Field(
        Decimal("100.00"), ge=0, description="Minimum amount before payout"
    )
    payout_methods: List[PaymentMethod] = Field(
        default_factory=lambda: [PaymentMethod.BANK_TRANSFER, PaymentMethod.UPI]
    )


class RewardTracking(BaseSchema):
    """Track rewards for user"""
    user_id: UUID

    total_rewards_earned: Decimal
    total_rewards_paid: Decimal
    pending_rewards: Decimal

    # Breakdown
    rewards_by_program: dict[str, Decimal]


class PayoutRequest(BaseCreateSchema):
    """Request payout of referral rewards"""
    user_id: UUID
    amount: Decimal = Field(..., ge=0)

    payout_method: PaymentMethod
    payout_details: dict = Field(
        ..., description="Method-specific details (UPI ID, bank account, etc.)"
    )


class PayoutRequestResponse(BaseSchema):
    """Payout request status"""
    payout_request_id: UUID
    user_id: UUID
    amount: Decimal
    payout_method: PaymentMethod

    status: RewardStatus
    requested_at: datetime
    processed_at: Optional[datetime]
    failure_reason: Optional[str] = None

# --- File: D:\hostel-management-saas\app\schemas\referral\__init__.py ---



# ===== Folder: D:\hostel-management-saas\app\schemas\review =====

# --- File: D:\hostel-management-saas\app\schemas\review\review_analytics.py ---
"""
Review analytics schemas
"""
from datetime import date
from decimal import Decimal
from typing import Dict, List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.filters import DateRangeFilter


class ReviewAnalytics(BaseSchema):
    """Comprehensive review analytics"""
    hostel_id: UUID
    hostel_name: str
    
    analysis_period: Optional[DateRangeFilter] = None
    generated_at: datetime
    
    # Summary
    total_reviews: int
    average_rating: Decimal
    
    # Rating distribution
    rating_distribution: "RatingDistribution"
    
    # Detailed ratings
    detailed_ratings_average: Dict[str, Decimal] = Field(
        ...,
        description="Aspect -> average rating"
    )
    
    # Trends
    rating_trend: "TrendAnalysis"
    
    # Sentiment
    sentiment_analysis: Optional["SentimentAnalysis"] = None
    
    # Verification
    verified_reviews_count: int
    verification_rate: Decimal
    
    # Engagement
    average_helpful_votes: Decimal
    response_rate: Decimal


class RatingDistribution(BaseSchema):
    """Rating distribution breakdown"""
    rating_5_count: int
    rating_4_count: int
    rating_3_count: int
    rating_2_count: int
    rating_1_count: int
    
    rating_5_percentage: Decimal
    rating_4_percentage: Decimal
    rating_3_percentage: Decimal
    rating_2_percentage: Decimal
    rating_1_percentage: Decimal
    
    # Aggregated
    positive_reviews: int = Field(..., description="4-5 star reviews")
    neutral_reviews: int = Field(..., description="3 star reviews")
    negative_reviews: int = Field(..., description="1-2 star reviews")
    
    positive_percentage: Decimal
    neutral_percentage: Decimal
    negative_percentage: Decimal


class TrendAnalysis(BaseSchema):
    """Rating trend analysis"""
    trend_direction: str = Field(..., pattern="^(improving|declining|stable)$")
    trend_percentage: Optional[Decimal] = Field(None, description="% change")
    
    # Monthly trend
    monthly_ratings: List["MonthlyRating"] = Field(default_factory=list)
    
    # Recent vs older
    last_30_days_rating: Decimal
    last_90_days_rating: Decimal
    all_time_rating: Decimal


class MonthlyRating(BaseSchema):
    """Monthly rating data"""
    month: str  # YYYY-MM
    average_rating: Decimal
    review_count: int


class SentimentAnalysis(BaseSchema):
    """Sentiment analysis of reviews"""
    overall_sentiment: str = Field(..., pattern="^(positive|neutral|negative)$")
    
    sentiment_score: Decimal = Field(..., ge=-1, le=1, description="Sentiment score")
    
    # Distribution
    positive_count: int
    neutral_count: int
    negative_count: int
    
    # Common themes
    positive_themes: List[str] = Field(default_factory=list, description="Common positive mentions")
    negative_themes: List[str] = Field(default_factory=list, description="Common complaints")
    
    # Keywords
    most_mentioned_positive: List[str] = Field(default_factory=list)
    most_mentioned_negative: List[str] = Field(default_factory=list)


class AspectAnalysis(BaseSchema):
    """Analysis by specific aspects"""
    aspect: str = Field(..., description="cleanliness, food, staff, etc.")
    
    average_rating: Decimal
    total_ratings: int
    
    # Distribution
    rating_distribution: Dict[int, int] = Field(..., description="Rating -> count")
    
    # Trend
    trend: str = Field(..., pattern="^(improving|declining|stable)$")
    
    # Mentions
    mention_count: int
    positive_mentions: int
    negative_mentions: int
    
    # Top comments
    top_positive_comments: List[str] = Field(default_factory=list, max_items=5)
    top_negative_comments: List[str] = Field(default_factory=list, max_items=5)


class CompetitorComparison(BaseSchema):
    """Compare reviews with competitors (if data available)"""
    hostel_id: UUID
    hostel_name: str
    
    this_hostel_rating: Decimal
    competitor_average_rating: Decimal
    
    rating_difference: Decimal
    percentile_rank: Decimal = Field(..., description="Percentile among competitors")
    
    # Strengths
    competitive_advantages: List[str] = Field(
        default_factory=list,
        description="Aspects rated higher than competitors"
    )
    
    # Weaknesses
    improvement_areas: List[str] = Field(
        default_factory=list,
        description="Aspects rated lower than competitors"
    )

# --- File: D:\hostel-management-saas\app\schemas\review\review_base.py ---
"""
Review base schemas
"""
from decimal import Decimal
from typing import List, Optional
from pydantic import Field, HttpUrl, field_validator
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema


class ReviewBase(BaseSchema):
    """Base review schema"""
    hostel_id: UUID = Field(..., description="Hostel being reviewed")
    reviewer_id: UUID = Field(..., description="User writing review")
    student_id: Optional[UUID] = Field(None, description="Student profile (if verified stay)")
    booking_id: Optional[UUID] = Field(None, description="Related booking")
    
    # Overall rating
    overall_rating: Decimal = Field(..., ge=1, le=5, description="Overall rating 1-5")
    
    # Review content
    title: str = Field(..., min_length=5, max_length=255, description="Review title")
    review_text: str = Field(..., min_length=50, max_length=5000, description="Review text")
    
    # Detailed ratings
    cleanliness_rating: Optional[int] = Field(None, ge=1, le=5)
    food_quality_rating: Optional[int] = Field(None, ge=1, le=5)
    staff_behavior_rating: Optional[int] = Field(None, ge=1, le=5)
    security_rating: Optional[int] = Field(None, ge=1, le=5)
    value_for_money_rating: Optional[int] = Field(None, ge=1, le=5)
    amenities_rating: Optional[int] = Field(None, ge=1, le=5)
    
    # Photos
    photos: List[HttpUrl] = Field(default_factory=list, max_items=10, description="Review photos")
    
    @field_validator('overall_rating')
    @classmethod
    def round_rating(cls, v: Decimal) -> Decimal:
        """Round rating to 0.5"""
        return round(v * 2) / 2


class ReviewCreate(ReviewBase, BaseCreateSchema):
    """Create review"""
    pass


class ReviewUpdate(BaseUpdateSchema):
    """Update review (limited time after posting)"""
    title: Optional[str] = Field(None, min_length=5, max_length=255)
    review_text: Optional[str] = Field(None, min_length=50, max_length=5000)
    
    overall_rating: Optional[Decimal] = Field(None, ge=1, le=5)
    
    cleanliness_rating: Optional[int] = Field(None, ge=1, le=5)
    food_quality_rating: Optional[int] = Field(None, ge=1, le=5)
    staff_behavior_rating: Optional[int] = Field(None, ge=1, le=5)
    security_rating: Optional[int] = Field(None, ge=1, le=5)
    value_for_money_rating: Optional[int] = Field(None, ge=1, le=5)
    amenities_rating: Optional[int] = Field(None, ge=1, le=5)
    
    photos: Optional[List[HttpUrl]] = None

# --- File: D:\hostel-management-saas\app\schemas\review\review_filters.py ---
"""
Review filter schemas
"""
from datetime import date
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseFilterSchema


class ReviewFilterParams(BaseFilterSchema):
    """Review filter parameters"""
    # Hostel filter
    hostel_id: Optional[UUID] = None
    hostel_ids: Optional[List[UUID]] = None
    
    # Rating filter
    min_rating: Optional[Decimal] = Field(None, ge=1, le=5)
    max_rating: Optional[Decimal] = Field(None, ge=1, le=5)
    rating: Optional[int] = Field(None, ge=1, le=5, description="Exact rating")
    
    # Verification
    verified_only: Optional[bool] = None
    
    # Date filter
    posted_date_from: Optional[date] = None
    posted_date_to: Optional[date] = None
    
    # Status
    approved_only: bool = Field(True, description="Show only approved reviews")
    flagged_only: Optional[bool] = None
    
    # Response
    with_hostel_response: Optional[bool] = None
    
    # Helpfulness
    min_helpful_count: Optional[int] = Field(None, ge=0)
    
    # Photos
    with_photos_only: Optional[bool] = None


class SearchRequest(BaseFilterSchema):
    """Search reviews"""
    query: str = Field(..., min_length=1)
    hostel_id: Optional[UUID] = None
    
    search_in_title: bool = Field(True)
    search_in_content: bool = Field(True)
    
    min_rating: Optional[Decimal] = None
    
    page: int = Field(1, ge=1)
    page_size: int = Field(20, ge=1, le=100)


class SortOptions(BaseFilterSchema):
    """Review sorting options"""
    sort_by: str = Field(
        "helpful",
        pattern="^(helpful|recent|rating_high|rating_low|verified)$"
    )
    
    # Additional sort logic
    verified_first: bool = Field(True, description="Show verified reviews first")
    with_photos_first: bool = Field(False, description="Prioritize reviews with photos")


class ReviewExportRequest(BaseFilterSchema):
    """Export reviews"""
    hostel_id: UUID
    filters: Optional[ReviewFilterParams] = None
    
    format: str = Field("csv", pattern="^(csv|excel|pdf)$")
    
    include_detailed_ratings: bool = Field(True)
    include_hostel_responses: bool = Field(True)
    include_voter_stats: bool = Field(False)

# --- File: D:\hostel-management-saas\app\schemas\review\review_moderation.py ---
"""
Review moderation schemas
"""
from datetime import datetime
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class ModerationRequest(BaseCreateSchema):
    """Submit review for moderation"""
    review_id: UUID
    
    action: str = Field(..., pattern="^(approve|reject|flag|unflag)$")
    
    # If rejecting
    rejection_reason: Optional[str] = Field(None, min_length=20, max_length=500)
    
    # If flagging
    flag_reason: Optional[str] = Field(
        None,
        pattern="^(inappropriate|spam|fake|offensive|other)$"
    )
    flag_details: Optional[str] = Field(None, max_length=1000)
    
    # Moderator notes (internal)
    moderator_notes: Optional[str] = Field(None, max_length=500)


class ModerationResponse(BaseSchema):
    """Moderation response"""
    review_id: UUID
    
    action_taken: str
    moderated_by: UUID
    moderated_by_name: str
    moderated_at: datetime
    
    # Notification sent
    reviewer_notified: bool
    
    message: str


class ModerationQueue(BaseSchema):
    """Moderation queue for reviews"""
    hostel_id: Optional[UUID] = None
    
    total_pending: int
    flagged_reviews: int
    auto_approved: int
    
    pending_reviews: List["PendingReview"]


class PendingReview(BaseSchema):
    """Pending review in moderation queue"""
    review_id: UUID
    hostel_id: UUID
    hostel_name: str
    
    reviewer_name: str
    overall_rating: Decimal
    
    title: str
    review_excerpt: str
    
    is_verified_stay: bool
    
    # Flags
    is_flagged: bool
    flag_count: int
    
    submitted_at: datetime
    
    # Auto-moderation score
    spam_score: Optional[Decimal] = Field(None, ge=0, le=1, description="AI spam detection score")
    sentiment_score: Optional[Decimal] = Field(None, ge=-1, le=1, description="Sentiment analysis")


class ApprovalWorkflow(BaseSchema):
    """Review approval workflow"""
    review_id: UUID
    
    requires_moderation: bool
    moderation_status: str = Field(
        ...,
        pattern="^(pending|approved|rejected|flagged)$"
    )
    
    # Timeline
    submitted_at: datetime
    moderated_at: Optional[datetime]
    
    # Moderator
    moderated_by: Optional[UUID]
    moderated_by_name: Optional[str]
    
    # Reason (if rejected)
    rejection_reason: Optional[str]


class BulkModeration(BaseCreateSchema):
    """Moderate multiple reviews"""
    review_ids: List[UUID] = Field(..., min_items=1, max_items=50)
    
    action: str = Field(..., pattern="^(approve|reject)$")
    
    # Common reason
    reason: Optional[str] = None


class ModerationStats(BaseSchema):
    """Moderation statistics"""
    hostel_id: Optional[UUID]
    period_start: date
    period_end: date
    
    total_reviews: int
    auto_approved: int
    manually_approved: int
    rejected: int
    flagged: int
    
    average_moderation_time_hours: Decimal
    
    # By moderator
    moderations_by_user: dict = Field(default_factory=dict)

# --- File: D:\hostel-management-saas\app\schemas\review\review_response.py ---
"""
Review response schemas
"""
from datetime import datetime
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema


class ReviewResponse(BaseResponseSchema):
    """Review response"""
    hostel_id: UUID
    hostel_name: str
    
    reviewer_id: UUID
    reviewer_name: str
    
    overall_rating: Decimal
    title: str
    review_text: str
    
    is_verified_stay: bool
    verified_at: Optional[datetime]
    
    is_approved: bool
    
    helpful_count: int
    not_helpful_count: int
    
    created_at: datetime


class ReviewDetail(BaseResponseSchema):
    """Detailed review information"""
    hostel_id: UUID
    hostel_name: str
    
    # Reviewer
    reviewer_id: UUID
    reviewer_name: str
    reviewer_profile_image: Optional[str]
    
    student_id: Optional[UUID]
    booking_id: Optional[UUID]
    
    # Ratings
    overall_rating: Decimal
    cleanliness_rating: Optional[int]
    food_quality_rating: Optional[int]
    staff_behavior_rating: Optional[int]
    security_rating: Optional[int]
    value_for_money_rating: Optional[int]
    amenities_rating: Optional[int]
    
    # Content
    title: str
    review_text: str
    
    # Photos
    photos: List[str]
    
    # Verification
    is_verified_stay: bool
    verified_at: Optional[datetime]
    
    # Moderation
    is_approved: bool
    approved_by: Optional[UUID]
    approved_at: Optional[datetime]
    
    is_flagged: bool
    flag_reason: Optional[str]
    flagged_by: Optional[UUID]
    flagged_at: Optional[datetime]
    
    # Engagement
    helpful_count: int
    not_helpful_count: int
    report_count: int
    
    # Hostel response
    hostel_response: Optional["HostelResponseDetail"]
    
    # Dates
    created_at: datetime
    updated_at: datetime
    
    # Visibility
    is_published: bool


class HostelResponseDetail(BaseSchema):
    """Hostel's response to review"""
    response_text: str
    responded_by: UUID
    responded_by_name: str
    responded_at: datetime


class ReviewListItem(BaseSchema):
    """Review list item"""
    id: UUID
    reviewer_name: str
    overall_rating: Decimal
    title: str
    review_excerpt: str = Field(..., description="First 150 characters")
    
    is_verified_stay: bool
    helpful_count: int
    
    created_at: datetime
    
    has_hostel_response: bool


class ReviewSummary(BaseSchema):
    """Review summary for hostel"""
    hostel_id: UUID
    hostel_name: str
    
    total_reviews: int
    average_rating: Decimal
    
    # Rating distribution
    rating_5_count: int
    rating_4_count: int
    rating_3_count: int
    rating_2_count: int
    rating_1_count: int
    
    # Verified reviews
    verified_reviews_count: int
    verified_reviews_percentage: Decimal
    
    # Recent reviews
    recent_reviews: List[ReviewListItem] = Field(default_factory=list, max_items=5)
    
    # Recommendation
    would_recommend_percentage: Decimal = Field(
        ...,
        description="% of reviewers who would recommend"
    )

# --- File: D:\hostel-management-saas\app\schemas\review\review_response_schema.py ---
"""
Hostel response to review schemas
"""
from datetime import datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema


class HostelResponseCreate(BaseCreateSchema):
    """Create hostel response to review"""
    review_id: UUID = Field(..., description="Review being responded to")
    
    response_text: str = Field(
        ...,
        min_length=20,
        max_length=2000,
        description="Response text"
    )
    
    responded_by: UUID = Field(..., description="Admin/owner responding")


class OwnerResponse(BaseResponseSchema):
    """Owner/hostel response to review"""
    review_id: UUID
    
    response_text: str
    
    responded_by: UUID
    responded_by_name: str
    responded_by_role: str
    
    responded_at: datetime


class ResponseUpdate(BaseCreateSchema):
    """Update hostel response"""
    response_id: UUID
    
    response_text: str = Field(..., min_length=20, max_length=2000)


class ResponseGuidelines(BaseSchema):
    """Guidelines for hostel responses"""
    guidelines: List[str] = Field(
        default_factory=lambda: [
            "Thank the reviewer for their feedback",
            "Address specific concerns mentioned",
            "Be professional and courteous",
            "Explain any misunderstandings",
            "Mention improvements made",
            "Invite them to connect directly if needed"
        ]
    )
    
    best_practices: List[str] = Field(
        default_factory=lambda: [
            "Respond within 48 hours",
            "Personalize your response",
            "Acknowledge both positive and negative points",
            "Don't be defensive or argumentative",
            "Keep it concise and relevant"
        ]
    )


class ResponseStats(BaseSchema):
    """Hostel response statistics"""
    hostel_id: UUID
    
    total_reviews: int
    total_responses: int
    response_rate: Decimal = Field(..., description="% of reviews with responses")
    
    average_response_time_hours: Decimal
    
    # By rating
    response_rate_5_star: Decimal
    response_rate_4_star: Decimal
    response_rate_3_star: Decimal
    response_rate_2_star: Decimal
    response_rate_1_star: Decimal

# --- File: D:\hostel-management-saas\app\schemas\review\review_submission.py ---
"""
Review submission schemas
"""
from decimal import Decimal
from typing import List, Optional
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema


class ReviewSubmissionRequest(BaseCreateSchema):
    """Submit review request"""
    hostel_id: UUID = Field(..., description="Hostel to review")
    
    # Verification (optional, helps verify stay)
    booking_id: Optional[UUID] = Field(None, description="Related booking ID")
    student_id: Optional[UUID] = Field(None, description="Student profile ID")
    
    # Basic review
    overall_rating: Decimal = Field(..., ge=1, le=5, description="Overall rating")
    title: str = Field(..., min_length=5, max_length=255)
    review_text: str = Field(..., min_length=50, max_length=5000)
    
    # Detailed ratings
    detailed_ratings: "DetailedRatings"
    
    # Media
    photos: List[HttpUrl] = Field(default_factory=list, max_items=10)
    
    # Recommendations
    would_recommend: bool = Field(..., description="Would recommend this hostel?")
    
    # Stay details (helps verification)
    stay_duration_months: Optional[int] = Field(None, ge=1, le=24)
    check_in_date: Optional[date] = None
    
    # Terms
    agree_to_guidelines: bool = Field(..., description="Agrees to review guidelines")


class DetailedRatings(BaseSchema):
    """Detailed aspect ratings"""
    cleanliness: int = Field(..., ge=1, le=5, description="Cleanliness rating")
    food_quality: Optional[int] = Field(None, ge=1, le=5, description="Food quality (if applicable)")
    staff_behavior: int = Field(..., ge=1, le=5, description="Staff behavior")
    security: int = Field(..., ge=1, le=5, description="Security")
    value_for_money: int = Field(..., ge=1, le=5, description="Value for money")
    amenities: int = Field(..., ge=1, le=5, description="Amenities quality")
    location: Optional[int] = Field(None, ge=1, le=5, description="Location convenience")
    wifi_quality: Optional[int] = Field(None, ge=1, le=5, description="WiFi quality")
    maintenance: Optional[int] = Field(None, ge=1, le=5, description="Maintenance responsiveness")


class VerifiedReview(BaseSchema):
    """Verified review marker"""
    review_id: UUID
    
    is_verified: bool
    verification_method: str = Field(
        ...,
        pattern="^(booking_verified|student_verified|admin_verified|auto_verified)$"
    )
    
    verified_by: Optional[UUID] = None
    verified_at: datetime
    
    verification_details: Optional[dict] = Field(
        None,
        description="Additional verification information"
    )


class ReviewGuidelines(BaseSchema):
    """Review guidelines"""
    guidelines: List[str] = Field(
        default_factory=lambda: [
            "Be honest and fair",
            "Focus on your experience",
            "Avoid offensive language",
            "Don't include personal information",
            "Be specific and constructive",
            "Reviews are public and visible to all"
        ]
    )
    
    prohibited_content: List[str] = Field(
        default_factory=lambda: [
            "Offensive or abusive language",
            "Personal attacks",
            "Spam or promotional content",
            "Fake or fraudulent reviews",
            "Reviews for competing businesses"
        ]
    )


class ReviewEligibility(BaseSchema):
    """Check if user can review hostel"""
    user_id: UUID
    hostel_id: UUID
    
    can_review: bool
    reason: str
    
    # Details
    has_stayed: bool
    has_booking: bool
    already_reviewed: bool
    
    # If already reviewed
    existing_review_id: Optional[UUID] = None
    can_edit: bool = Field(False, description="Can edit existing review")

# --- File: D:\hostel-management-saas\app\schemas\review\review_voting.py ---
"""
Review voting (helpful/not helpful) schemas
"""
from datetime import datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema
from app.schemas.common.enums import VoteType


class VoteRequest(BaseCreateSchema):
    """Vote on review helpfulness"""
    review_id: UUID = Field(..., description="Review ID")
    voter_id: UUID = Field(..., description="User voting")
    
    vote_type: VoteType = Field(..., description="helpful or not_helpful")


class VoteResponse(BaseSchema):
    """Vote response"""
    review_id: UUID
    vote_type: VoteType
    
    # Updated counts
    helpful_count: int
    not_helpful_count: int
    
    message: str


class HelpfulnessScore(BaseSchema):
    """Helpfulness score for review"""
    review_id: UUID
    
    helpful_count: int
    not_helpful_count: int
    total_votes: int
    
    helpfulness_percentage: Decimal = Field(
        ...,
        description="% of voters who found it helpful"
    )
    
    helpfulness_score: Decimal = Field(
        ...,
        ge=0,
        le=1,
        description="Wilson score for ranking"
    )


class VoteHistory(BaseSchema):
    """User's voting history"""
    user_id: UUID
    
    total_votes: int
    helpful_votes: int
    not_helpful_votes: int
    
    recent_votes: List["VoteHistoryItem"] = Field(default_factory=list, max_items=10)


class VoteHistoryItem(BaseSchema):
    """Individual vote in history"""
    review_id: UUID
    hostel_name: str
    vote_type: VoteType
    voted_at: datetime


class RemoveVote(BaseCreateSchema):
    """Remove vote (change mind)"""
    review_id: UUID
    voter_id: UUID

# --- File: D:\hostel-management-saas\app\schemas\review\__init__.py ---
"""
Review schemas package
"""
from app.schemas.review.review_base import (
    ReviewBase,
    ReviewCreate,
    ReviewUpdate
)
from app.schemas.review.review_response import (
    ReviewResponse,
    ReviewDetail,
    ReviewListItem
)
from app.schemas.review.review_submission import (
    ReviewSubmissionRequest,
    DetailedRatings,
    VerifiedReview
)
from app.schemas.review.review_moderation import (
    ModerationRequest,
    ModerationQueue,
    ApprovalWorkflow
)
from app.schemas.review.review_voting import (
    VoteRequest,
    VoteResponse,
    HelpfulnessScore
)
from app.schemas.review.review_response_schema import (
    HostelResponseCreate,
    OwnerResponse
)
from app.schemas.review.review_filters import (
    ReviewFilterParams,
    SearchRequest,
    SortOptions
)
from app.schemas.review.review_analytics import (
    ReviewAnalytics,
    RatingDistribution,
    SentimentAnalysis,
    TrendAnalysis
)

__all__ = [
    # Base
    "ReviewBase",
    "ReviewCreate",
    "ReviewUpdate",
    
    # Response
    "ReviewResponse",
    "ReviewDetail",
    "ReviewListItem",
    
    # Submission
    "ReviewSubmissionRequest",
    "DetailedRatings",
    "VerifiedReview",
    
    # Moderation
    "ModerationRequest",
    "ModerationQueue",
    "ApprovalWorkflow",
    
    # Voting
    "VoteRequest",
    "VoteResponse",
    "HelpfulnessScore",
    
    # Hostel Response
    "HostelResponseCreate",
    "OwnerResponse",
    
    # Filters
    "ReviewFilterParams",
    "SearchRequest",
    "SortOptions",
    
    # Analytics
    "ReviewAnalytics",
    "RatingDistribution",
    "SentimentAnalysis",
    "TrendAnalysis",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\room =====

# --- File: D:\hostel-management-saas\app\schemas\room\bed_base.py ---
"""
Bed base schemas
"""
from datetime import date
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import BedStatus


class BedBase(BaseSchema):
    """Base bed schema"""
    room_id: UUID = Field(..., description="Room ID")
    bed_number: str = Field(..., min_length=1, max_length=10, description="Bed identifier (A1, B2, etc.)")
    status: BedStatus = Field(BedStatus.AVAILABLE, description="Bed status")


class BedCreate(BedBase, BaseCreateSchema):
    """Create bed schema"""
    pass


class BedUpdate(BaseUpdateSchema):
    """Update bed schema"""
    bed_number: Optional[str] = Field(None, min_length=1, max_length=10)
    status: Optional[BedStatus] = None
    is_occupied: Optional[bool] = None


class BulkBedCreate(BaseCreateSchema):
    """Bulk create beds for a room"""
    room_id: UUID = Field(..., description="Room ID")
    bed_count: int = Field(..., ge=1, le=20, description="Number of beds to create")
    bed_prefix: str = Field("B", description="Bed number prefix")
    start_number: int = Field(1, ge=1, description="Starting number for beds")


class BedAssignmentRequest(BaseCreateSchema):
    """Assign bed to student"""
    bed_id: UUID = Field(..., description="Bed ID to assign")
    student_id: UUID = Field(..., description="Student ID")
    occupied_from: date = Field(..., description="Occupancy start date")


class BedReleaseRequest(BaseCreateSchema):
    """Release bed from student"""
    bed_id: UUID = Field(..., description="Bed ID to release")
    release_date: date = Field(..., description="Release date")
    reason: Optional[str] = Field(None, description="Release reason")

# --- File: D:\hostel-management-saas\app\schemas\room\bed_response.py ---
"""
Bed response schemas
"""
from datetime import date
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import BedStatus


class BedResponse(BaseResponseSchema):
    """Bed response schema"""
    room_id: UUID
    bed_number: str
    is_occupied: bool
    status: BedStatus
    current_student_id: Optional[UUID]
    occupied_from: Optional[date]


class BedAvailability(BaseSchema):
    """Bed availability information"""
    bed_id: UUID
    room_id: UUID
    room_number: str
    bed_number: str
    is_available: bool
    status: BedStatus
    available_from: Optional[date] = Field(None, description="Date when bed becomes available")
    current_student_name: Optional[str] = None


class BedAssignment(BaseResponseSchema):
    """Bed assignment details"""
    bed_id: UUID
    room_id: UUID
    room_number: str
    bed_number: str
    student_id: UUID
    student_name: str
    occupied_from: date
    expected_vacate_date: Optional[date]
    monthly_rent: Decimal


class BedHistory(BaseSchema):
    """Bed occupancy history"""
    bed_id: UUID
    room_number: str
    bed_number: str
    assignments: List["BedAssignmentHistory"]


class BedAssignmentHistory(BaseSchema):
    """Individual bed assignment history"""
    student_id: UUID
    student_name: str
    move_in_date: date
    move_out_date: Optional[date]
    duration_days: Optional[int]

# --- File: D:\hostel-management-saas\app\schemas\room\room_availability.py ---
"""
Room availability schemas
"""
from datetime import date
from typing import List, Optional, Dict
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.enums import RoomType


class RoomAvailabilityRequest(BaseCreateSchema):
    """Check room availability"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    check_in_date: date = Field(..., description="Desired check-in date")
    duration_months: int = Field(..., ge=1, le=24, description="Stay duration")
    room_type: Optional[RoomType] = Field(None, description="Preferred room type")


class AvailabilityResponse(BaseSchema):
    """Room availability response"""
    hostel_id: UUID
    check_in_date: date
    check_out_date: date
    available_rooms: List["AvailableRoom"]
    total_available_beds: int
    has_availability: bool


class AvailableRoom(BaseSchema):
    """Available room details"""
    room_id: UUID
    room_number: str
    room_type: RoomType
    floor_number: Optional[int]
    available_beds: int
    total_beds: int
    price_monthly: Decimal
    is_ac: bool
    has_attached_bathroom: bool
    amenities: List[str]
    room_images: List[str]


class AvailabilityCalendar(BaseSchema):
    """Availability calendar for a room"""
    room_id: UUID
    room_number: str
    month: str = Field(..., description="Month in YYYY-MM format")
    availability: Dict[str, "DayAvailability"] = Field(
        ...,
        description="Availability by date (date string as key)"
    )


class DayAvailability(BaseSchema):
    """Availability for a specific day"""
    date: date
    available_beds: int
    total_beds: int
    is_available: bool
    bookings: List["BookingInfo"] = Field(default_factory=list)


class BookingInfo(BaseSchema):
    """Booking information for calendar"""
    booking_id: UUID
    student_name: str
    check_in_date: date
    check_out_date: date

# --- File: D:\hostel-management-saas\app\schemas\room\room_base.py ---
"""
Room base schemas
"""
from decimal import Decimal
from typing import List, Optional
from pydantic import Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import RoomType, RoomStatus


class RoomBase(BaseSchema):
    """Base room schema"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    room_number: str = Field(..., min_length=1, max_length=50, description="Room number/identifier")
    floor_number: Optional[int] = Field(None, ge=0, le=50, description="Floor number")
    wing: Optional[str] = Field(None, max_length=50, description="Wing/Block (A, B, North, etc.)")
    
    # Type and capacity
    room_type: RoomType = Field(..., description="Room type")
    total_beds: int = Field(..., ge=1, le=20, description="Total beds in room")
    
    # Pricing
    price_monthly: Decimal = Field(..., ge=0, max_digits=10, decimal_places=2, description="Monthly rent")
    price_quarterly: Optional[Decimal] = Field(None, ge=0, max_digits=10, decimal_places=2)
    price_half_yearly: Optional[Decimal] = Field(None, ge=0, max_digits=10, decimal_places=2)
    price_yearly: Optional[Decimal] = Field(None, ge=0, max_digits=10, decimal_places=2)
    
    # Specifications
    room_size_sqft: Optional[int] = Field(None, ge=50, le=1000, description="Room size in sq ft")
    is_ac: bool = Field(False, description="Air conditioned")
    has_attached_bathroom: bool = Field(False, description="Attached bathroom")
    has_balcony: bool = Field(False, description="Has balcony")
    has_wifi: bool = Field(True, description="WiFi available")
    
    # Amenities
    amenities: List[str] = Field(default_factory=list, description="Room amenities")
    furnishing: List[str] = Field(default_factory=list, description="Furniture items")
    
    # Availability
    is_available_for_booking: bool = Field(True, description="Available for online booking")
    is_under_maintenance: bool = Field(False, description="Under maintenance")
    
    # Media
    room_images: List[str] = Field(default_factory=list, description="Room image URLs")


class RoomCreate(RoomBase, BaseCreateSchema):
    """Create room schema"""
    pass


class RoomUpdate(BaseUpdateSchema):
    """Update room schema"""
    room_number: Optional[str] = Field(None, min_length=1, max_length=50)
    floor_number: Optional[int] = Field(None, ge=0, le=50)
    wing: Optional[str] = None
    room_type: Optional[RoomType] = None
    
    # Pricing updates
    price_monthly: Optional[Decimal] = Field(None, ge=0)
    price_quarterly: Optional[Decimal] = Field(None, ge=0)
    price_half_yearly: Optional[Decimal] = Field(None, ge=0)
    price_yearly: Optional[Decimal] = Field(None, ge=0)
    
    # Features
    is_ac: Optional[bool] = None
    has_attached_bathroom: Optional[bool] = None
    has_balcony: Optional[bool] = None
    has_wifi: Optional[bool] = None
    
    # Lists
    amenities: Optional[List[str]] = None
    furnishing: Optional[List[str]] = None
    room_images: Optional[List[str]] = None
    
    # Status
    is_available_for_booking: Optional[bool] = None
    is_under_maintenance: Optional[bool] = None
    status: Optional[RoomStatus] = None


class BulkRoomCreate(BaseCreateSchema):
    """Bulk create rooms"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    rooms: List[RoomCreate] = Field(..., min_items=1, max_items=100, description="List of rooms to create")


class RoomPricingUpdate(BaseUpdateSchema):
    """Update room pricing"""
    price_monthly: Decimal = Field(..., ge=0, description="Monthly rent")
    price_quarterly: Optional[Decimal] = Field(None, ge=0)
    price_half_yearly: Optional[Decimal] = Field(None, ge=0)
    price_yearly: Optional[Decimal] = Field(None, ge=0)


class RoomStatusUpdate(BaseUpdateSchema):
    """Update room status"""
    status: RoomStatus = Field(..., description="Room status")
    is_available_for_booking: bool = Field(..., description="Booking availability")
    is_under_maintenance: bool = Field(False, description="Maintenance flag")
    maintenance_notes: Optional[str] = Field(None, description="Maintenance details")

# --- File: D:\hostel-management-saas\app\schemas\room\room_response.py ---
"""
Room response schemas
"""
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import RoomType, RoomStatus


class RoomResponse(BaseResponseSchema):
    """Room response schema"""
    hostel_id: UUID
    room_number: str
    floor_number: Optional[int]
    wing: Optional[str]
    room_type: RoomType
    total_beds: int
    occupied_beds: int
    available_beds: int
    price_monthly: Decimal
    is_ac: bool
    has_attached_bathroom: bool
    status: RoomStatus
    is_available_for_booking: bool


class RoomDetail(BaseResponseSchema):
    """Detailed room information"""
    hostel_id: UUID
    hostel_name: str
    room_number: str
    floor_number: Optional[int]
    wing: Optional[str]
    
    # Type and capacity
    room_type: RoomType
    total_beds: int
    occupied_beds: int
    available_beds: int
    
    # Pricing
    price_monthly: Decimal
    price_quarterly: Optional[Decimal]
    price_half_yearly: Optional[Decimal]
    price_yearly: Optional[Decimal]
    
    # Specifications
    room_size_sqft: Optional[int]
    is_ac: bool
    has_attached_bathroom: bool
    has_balcony: bool
    has_wifi: bool
    
    # Amenities
    amenities: List[str]
    furnishing: List[str]
    
    # Status
    status: RoomStatus
    is_available_for_booking: bool
    is_under_maintenance: bool
    maintenance_start_date: Optional[date]
    maintenance_end_date: Optional[date]
    
    # Media
    room_images: List[str]
    
    # Beds detail
    beds: List["BedDetail"] = Field(default_factory=list)


class BedDetail(BaseSchema):
    """Bed detail in room"""
    id: UUID
    bed_number: str
    is_occupied: bool
    status: str
    current_student_id: Optional[UUID]
    current_student_name: Optional[str]
    occupied_from: Optional[date]


class RoomListItem(BaseSchema):
    """Room list item"""
    id: UUID
    room_number: str
    floor_number: Optional[int]
    wing: Optional[str]
    room_type: RoomType
    total_beds: int
    available_beds: int
    price_monthly: Decimal
    is_ac: bool
    status: RoomStatus
    is_available_for_booking: bool


class RoomWithBeds(BaseResponseSchema):
    """Room with bed information"""
    hostel_id: UUID
    room_number: str
    room_type: RoomType
    total_beds: int
    occupied_beds: int
    available_beds: int
    beds: List["BedInfo"]


class BedInfo(BaseSchema):
    """Bed information"""
    id: UUID
    bed_number: str
    is_occupied: bool
    status: str
    student_name: Optional[str] = None


class RoomOccupancyStats(BaseSchema):
    """Room occupancy statistics"""
    room_id: UUID
    room_number: str
    total_beds: int
    occupied_beds: int
    available_beds: int
    occupancy_percentage: Decimal
    current_revenue: Decimal
    potential_revenue: Decimal

# --- File: D:\hostel-management-saas\app\schemas\room\__init__.py ---
"""
Room schemas package
"""
from app.schemas.room.room_base import (
    RoomBase,
    RoomCreate,
    RoomUpdate,
    BulkRoomCreate
)
from app.schemas.room.room_response import (
    RoomResponse,
    RoomDetail,
    RoomListItem,
    RoomWithBeds
)
from app.schemas.room.bed_base import (
    BedBase,
    BedCreate,
    BedUpdate,
    BulkBedCreate
)
from app.schemas.room.bed_response import (
    BedResponse,
    BedAvailability,
    BedAssignment
)
from app.schemas.room.room_availability import (
    RoomAvailabilityRequest,
    AvailabilityResponse,
    AvailabilityCalendar
)

__all__ = [
    # Room base
    "RoomBase",
    "RoomCreate",
    "RoomUpdate",
    "BulkRoomCreate",
    
    # Room response
    "RoomResponse",
    "RoomDetail",
    "RoomListItem",
    "RoomWithBeds",
    
    # Bed base
    "BedBase",
    "BedCreate",
    "BedUpdate",
    "BulkBedCreate",
    
    # Bed response
    "BedResponse",
    "BedAvailability",
    "BedAssignment",
    
    # Availability
    "RoomAvailabilityRequest",
    "AvailabilityResponse",
    "AvailabilityCalendar",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\search =====

# --- File: D:\hostel-management-saas\app\schemas\search\search_analytics.py ---
"""
Search analytics & popular queries schemas
"""
from datetime import date, datetime
from typing import List, Dict
from pydantic import Field

from app.schemas.common.base import BaseSchema
from app.schemas.common.filters import DateRangeFilter


class SearchTermStats(BaseSchema):
    """Statistics for a single search term"""
    term: str
    search_count: int
    avg_results: float
    zero_result_count: int
    last_searched_at: datetime


class SearchAnalytics(BaseSchema):
    """Search analytics summary"""
    period: DateRangeFilter

    total_searches: int
    unique_terms: int
    zero_result_searches: int

    top_terms: List[SearchTermStats] = Field(default_factory=list)
    zero_result_terms: List[SearchTermStats] = Field(default_factory=list)

    # Aggregated metrics
    avg_results_per_search: float

# --- File: D:\hostel-management-saas\app\schemas\search\search_autocomplete.py ---
"""
Autocomplete / suggestion schemas
"""
from typing import List
from pydantic import Field

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class AutocompleteRequest(BaseCreateSchema):
    """Request for autocomplete suggestions"""
    prefix: str = Field(..., min_length=1, max_length=100)
    type: str = Field(
        "hostel",
        pattern="^(hostel|city|area)$",
        description="What to autocomplete",
    )
    limit: int = Field(10, ge=1, le=20)


class Suggestion(BaseSchema):
    """Single suggestion"""
    value: str
    label: str
    type: str
    extra: dict = Field(default_factory=dict)


class AutocompleteResponse(BaseSchema):
    """Autocomplete result set"""
    suggestions: List[Suggestion]

# --- File: D:\hostel-management-saas\app\schemas\search\search_filters.py ---
"""
Reusable search filter schemas (common for advanced search)
"""
from typing import List, Optional
from pydantic import Field
from decimal import Decimal

from app.schemas.common.base import BaseFilterSchema


class PriceFilter(BaseFilterSchema):
    min_price: Optional[Decimal] = Field(None, ge=0)
    max_price: Optional[Decimal] = Field(None, ge=0)


class RatingFilter(BaseFilterSchema):
    min_rating: Optional[Decimal] = Field(None, ge=0, le=5)
    max_rating: Optional[Decimal] = Field(None, ge=0, le=5)


class AmenityFilter(BaseFilterSchema):
    amenities: Optional[List[str]] = Field(None)

# --- File: D:\hostel-management-saas\app\schemas\search\search_request.py ---
"""
Search request schemas (hostels, rooms, etc.)
"""
from typing import List, Optional
from pydantic import Field
from uuid import UUID
from decimal import Decimal

from app.schemas.common.base import BaseSchema, BaseFilterSchema
from app.schemas.common.enums import HostelType, RoomType


class BasicSearchRequest(BaseFilterSchema):
    """Simple keyword search"""
    query: str = Field(..., min_length=1, max_length=255)


class AdvancedSearchRequest(BaseFilterSchema):
    """Advanced hostel search request (public)"""
    query: Optional[str] = Field(None, max_length=255)

    # Location
    city: Optional[str] = None
    state: Optional[str] = None
    pincode: Optional[str] = Field(None, pattern=r"^\d{6}$")

    latitude: Optional[Decimal] = Field(None, ge=-90, le=90)
    longitude: Optional[Decimal] = Field(None, ge=-180, le=180)
    radius_km: Optional[Decimal] = Field(None, ge=0, le=100)

    # Filters
    hostel_type: Optional[HostelType] = None
    room_type: Optional[RoomType] = None

    min_price: Optional[Decimal] = Field(None, ge=0)
    max_price: Optional[Decimal] = Field(None, ge=0)

    amenities: Optional[List[str]] = None
    min_rating: Optional[Decimal] = Field(None, ge=0, le=5)

    verified_only: bool = Field(False)
    available_only: bool = Field(False)

    # Sorting
    sort_by: str = Field(
        "relevance",
        pattern="^(relevance|price_asc|price_desc|rating_desc|distance_asc|newest)$",
    )
    page: int = Field(1, ge=1)
    page_size: int = Field(20, ge=1, le=100)

# --- File: D:\hostel-management-saas\app\schemas\search\search_response.py ---
"""
Search response schemas
"""
from typing import List, Dict, Any
from pydantic import Field
from decimal import Decimal
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.hostel.hostel_public import PublicHostelCard


class SearchResultItem(BaseSchema):
    """Generic search result wrapper (for hostels now, extensible later)"""
    hostel: PublicHostelCard
    score: Decimal = Field(..., description="Relevance score from search engine")


class FacetBucket(BaseSchema):
    """Facet value & count"""
    value: str
    count: int
    label: str


class FacetedSearchResponse(BaseSchema):
    """Response for advanced faceted search"""
    results: List[SearchResultItem]
    total_results: int
    page: int
    page_size: int
    total_pages: int

    # Facets
    facets: Dict[str, List[FacetBucket]] = Field(
        default_factory=dict, description="FacetName -> bucket list"
    )

    # Debug / meta
    query_time_ms: int = Field(..., description="Search execution time (ms)")
    raw_query: Dict[str, Any] = Field(
        default_factory=dict,
        description="Raw search engine query (optional, for debugging)",
    )

# --- File: D:\hostel-management-saas\app\schemas\search\search_sort.py ---
"""
Search sort option schemas
"""
from pydantic import Field

from app.schemas.common.base import BaseSchema


class SortCriteria(BaseSchema):
    """Sort criteria used by search"""
    sort_by: str = Field(
        ...,
        pattern="^(relevance|price|rating|distance|created_at)$",
        description="Field to sort by",
    )
    sort_order: str = Field(
        "asc",
        pattern="^(asc|desc)$",
        description="Sort direction",
    )

# --- File: D:\hostel-management-saas\app\schemas\search\__init__.py ---



# ===== Folder: D:\hostel-management-saas\app\schemas\student =====

# --- File: D:\hostel-management-saas\app\schemas\student\student_base.py ---
"""
Student base schemas
"""
from datetime import date
from typing import Optional
from pydantic import Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import StudentStatus, IDProofType, DietaryPreference


class StudentBase(BaseSchema):
    """Base student schema"""
    user_id: UUID = Field(..., description="Associated user ID")
    hostel_id: UUID = Field(..., description="Current hostel ID")
    room_id: Optional[UUID] = Field(None, description="Assigned room ID")
    bed_id: Optional[UUID] = Field(None, description="Assigned bed ID")
    
    # Identification
    id_proof_type: Optional[IDProofType] = Field(None, description="ID proof type")
    id_proof_number: Optional[str] = Field(None, max_length=50, description="ID proof number")
    
    # Guardian information
    guardian_name: str = Field(..., min_length=2, max_length=255, description="Guardian name")
    guardian_phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$', description="Guardian phone")
    guardian_email: Optional[str] = Field(None, description="Guardian email")
    guardian_relation: Optional[str] = Field(None, max_length=50, description="Relation to student")
    guardian_address: Optional[str] = Field(None, max_length=500, description="Guardian address")
    
    # Institutional information (for students)
    institution_name: Optional[str] = Field(None, max_length=255, description="College/University name")
    course: Optional[str] = Field(None, max_length=255, description="Course name")
    year_of_study: Optional[str] = Field(None, max_length=50, description="Year/Semester")
    student_id_number: Optional[str] = Field(None, max_length=100, description="College ID number")
    
    # Employment information (for working professionals)
    company_name: Optional[str] = Field(None, max_length=255, description="Company name")
    designation: Optional[str] = Field(None, max_length=255, description="Job designation")
    
    # Check-in/Check-out dates
    check_in_date: Optional[date] = Field(None, description="Check-in date")
    expected_checkout_date: Optional[date] = Field(None, description="Expected checkout date")
    
    # Financial
    security_deposit_amount: Decimal = Field(Decimal("0.00"), ge=0, description="Security deposit amount")
    monthly_rent_amount: Optional[Decimal] = Field(None, ge=0, description="Monthly rent")
    
    # Meal preferences
    mess_subscribed: bool = Field(False, description="Subscribed to mess facility")
    dietary_preference: Optional[DietaryPreference] = Field(None, description="Dietary preference")
    food_allergies: Optional[str] = Field(None, max_length=500, description="Food allergies")
    
    @field_validator('expected_checkout_date')
    @classmethod
    def validate_checkout_after_checkin(cls, v: Optional[date], info) -> Optional[date]:
        """Validate checkout date is after check-in"""
        if v and info.data.get('check_in_date'):
            if v <= info.data['check_in_date']:
                raise ValueError('Checkout date must be after check-in date')
        return v


class StudentCreate(StudentBase, BaseCreateSchema):
    """Create student schema"""
    # Optionally link to booking
    booking_id: Optional[UUID] = Field(None, description="Source booking ID if from booking conversion")


class StudentUpdate(BaseUpdateSchema):
    """Update student schema"""
    room_id: Optional[UUID] = None
    bed_id: Optional[UUID] = None
    
    # Guardian updates
    guardian_name: Optional[str] = Field(None, min_length=2, max_length=255)
    guardian_phone: Optional[str] = Field(None, pattern=r'^\+?[1-9]\d{9,14}$')
    guardian_email: Optional[str] = None
    
    # Institutional updates
    institution_name: Optional[str] = None
    course: Optional[str] = None
    year_of_study: Optional[str] = None
    
    # Employment updates
    company_name: Optional[str] = None
    designation: Optional[str] = None
    
    # Dates
    check_in_date: Optional[date] = None
    expected_checkout_date: Optional[date] = None
    actual_checkout_date: Optional[date] = None
    
    # Financial
    security_deposit_amount: Optional[Decimal] = Field(None, ge=0)
    monthly_rent_amount: Optional[Decimal] = Field(None, ge=0)
    
    # Meal
    mess_subscribed: Optional[bool] = None
    dietary_preference: Optional[DietaryPreference] = None
    food_allergies: Optional[str] = None
    
    # Status
    student_status: Optional[StudentStatus] = None


class StudentCheckInRequest(BaseCreateSchema):
    """Check-in student request"""
    student_id: UUID = Field(..., description="Student ID")
    check_in_date: date = Field(..., description="Check-in date")
    room_id: UUID = Field(..., description="Assigned room")
    bed_id: UUID = Field(..., description="Assigned bed")
    security_deposit_paid: bool = Field(False, description="Security deposit payment status")
    initial_rent_paid: bool = Field(False, description="Initial rent payment status")


class StudentCheckOutRequest(BaseCreateSchema):
    """Check-out student request"""
    student_id: UUID = Field(..., description="Student ID")
    checkout_date: date = Field(..., description="Checkout date")
    reason: Optional[str] = Field(None, description="Checkout reason")
    refund_security_deposit: bool = Field(True, description="Refund security deposit")
    final_dues_cleared: bool = Field(False, description="All dues cleared")

# --- File: D:\hostel-management-saas\app\schemas\student\student_dashboard.py ---
"""
Student dashboard schemas
"""
from decimal import Decimal
from datetime import date, datetime
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema


class StudentDashboard(BaseSchema):
    """Student dashboard overview"""
    student_id: UUID
    student_name: str
    
    # Hostel info
    hostel_name: str
    room_number: str
    bed_number: str
    
    # Financial summary
    financial_summary: "StudentFinancialSummary"
    
    # Attendance summary
    attendance_summary: "AttendanceSummary"
    
    # Recent activity
    recent_payments: List["RecentPayment"] = Field(default_factory=list, max_items=5)
    recent_complaints: List["RecentComplaint"] = Field(default_factory=list, max_items=5)
    pending_leave_applications: List["PendingLeave"] = Field(default_factory=list)
    
    # Announcements
    recent_announcements: List["RecentAnnouncement"] = Field(default_factory=list, max_items=5)
    
    # Mess menu
    today_mess_menu: Optional["TodayMessMenu"] = None
    
    # Quick stats
    stats: "StudentStats"


class StudentFinancialSummary(BaseSchema):
    """Financial summary for student"""
    monthly_rent: Decimal
    next_due_date: date
    amount_due: Decimal
    amount_overdue: Decimal
    advance_balance: Decimal
    security_deposit: Decimal
    
    # Mess
    mess_charges: Decimal
    mess_balance: Decimal
    
    # Payment status
    payment_status: str = Field(..., pattern="^(current|due_soon|overdue)$")
    days_until_due: Optional[int]


class AttendanceSummary(BaseSchema):
    """Attendance summary"""
    current_month_percentage: Decimal
    current_month_present: int
    current_month_absent: int
    current_month_leaves: int
    
    last_30_days_percentage: Decimal
    
    # Status
    attendance_status: str = Field(
        ...,
        pattern="^(good|warning|critical)$",
        description="Based on minimum required %"
    )
    
    # Leaves
    leave_balance: int
    pending_leave_requests: int


class StudentStats(BaseSchema):
    """Quick statistics for student"""
    days_in_hostel: int
    total_payments_made: int
    total_amount_paid: Decimal
    complaints_raised: int
    complaints_resolved: int
    current_attendance_percentage: Decimal


class RecentPayment(BaseSchema):
    """Recent payment item"""
    payment_id: UUID
    amount: Decimal
    payment_type: str
    payment_date: date
    status: str
    receipt_url: Optional[str]


class RecentComplaint(BaseSchema):
    """Recent complaint item"""
    complaint_id: UUID
    title: str
    category: str
    status: str
    priority: str
    created_at: datetime
    updated_at: datetime


class PendingLeave(BaseSchema):
    """Pending leave application"""
    leave_id: UUID
    leave_type: str
    from_date: date
    to_date: date
    total_days: int
    status: str
    applied_at: datetime


class RecentAnnouncement(BaseSchema):
    """Recent announcement"""
    announcement_id: UUID
    title: str
    category: str
    priority: str
    published_at: datetime
    is_read: bool


class TodayMessMenu(BaseSchema):
    """Today's mess menu"""
    date: date
    breakfast: List[str]
    lunch: List[str]
    snacks: List[str]
    dinner: List[str]
    is_special: bool

# --- File: D:\hostel-management-saas\app\schemas\student\student_filters.py ---
"""
Student filter and search schemas
"""
from datetime import date
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseFilterSchema
from app.schemas.common.enums import StudentStatus


class StudentFilterParams(BaseFilterSchema):
    """Student filter parameters"""
    # Text search
    search: Optional[str] = Field(None, description="Search in name, email, phone, room number")
    
    # Hostel filter
    hostel_id: Optional[UUID] = None
    hostel_ids: Optional[List[UUID]] = None
    
    # Room filter
    room_id: Optional[UUID] = None
    room_number: Optional[str] = None
    room_type: Optional[str] = None
    floor_number: Optional[int] = None
    
    # Status filter
    status: Optional[StudentStatus] = None
    statuses: Optional[List[StudentStatus]] = None
    is_active: Optional[bool] = None
    
    # Date filters
    checked_in_after: Optional[date] = None
    checked_in_before: Optional[date] = None
    expected_checkout_after: Optional[date] = None
    expected_checkout_before: Optional[date] = None
    
    # Financial filters
    has_overdue_payments: Optional[bool] = None
    security_deposit_paid: Optional[bool] = None
    
    # Meal filter
    mess_subscribed: Optional[bool] = None
    
    # Institutional
    institution_name: Optional[str] = None
    course: Optional[str] = None
    
    # Company
    company_name: Optional[str] = None


class StudentSearchRequest(BaseFilterSchema):
    """Student search request"""
    query: str = Field(..., min_length=1, description="Search query")
    hostel_id: Optional[UUID] = Field(None, description="Limit search to hostel")
    
    # Search fields
    search_in_name: bool = Field(True)
    search_in_email: bool = Field(True)
    search_in_phone: bool = Field(True)
    search_in_room: bool = Field(True)
    search_in_institution: bool = Field(True)
    
    # Filters
    status: Optional[StudentStatus] = None
    
    # Pagination
    page: int = Field(1, ge=1)
    page_size: int = Field(20, ge=1, le=100)


class StudentSortOptions(BaseFilterSchema):
    """Student sorting options"""
    sort_by: str = Field(
        "created_at",
        pattern="^(name|email|room_number|check_in_date|created_at|monthly_rent)$"
    )
    sort_order: str = Field("desc", pattern="^(asc|desc)$")


class StudentExportRequest(BaseFilterSchema):
    """Export students request"""
    hostel_id: Optional[UUID] = None
    filters: Optional[StudentFilterParams] = None
    
    # Export format
    format: str = Field("csv", pattern="^(csv|excel|pdf)$")
    
    # Fields to include
    include_financial_data: bool = Field(False)
    include_attendance_data: bool = Field(False)
    include_guardian_info: bool = Field(True)
    include_institutional_info: bool = Field(True)


class StudentBulkActionRequest(BaseFilterSchema):
    """Bulk action on students"""
    student_ids: List[UUID] = Field(..., min_items=1, description="Student IDs")
    action: str = Field(
        ...,
        pattern="^(activate|deactivate|send_notification|export|change_status)$",
        description="Action to perform"
    )
    
    # Action-specific parameters
    new_status: Optional[StudentStatus] = Field(None, description="For change_status action")
    notification_message: Optional[str] = Field(None, description="For send_notification action")

# --- File: D:\hostel-management-saas\app\schemas\student\student_profile.py ---
"""
Student profile management schemas
"""
from typing import List, Optional
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import IDProofType, DietaryPreference


class StudentProfileCreate(BaseCreateSchema):
    """Create student profile (extends user registration)"""
    # Guardian (required for students)
    guardian_name: str = Field(..., min_length=2, max_length=255)
    guardian_phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$')
    guardian_email: Optional[str] = None
    guardian_relation: Optional[str] = None
    guardian_address: Optional[str] = None
    
    # Institutional OR employment (at least one)
    institution_name: Optional[str] = None
    course: Optional[str] = None
    year_of_study: Optional[str] = None
    student_id_number: Optional[str] = None
    
    company_name: Optional[str] = None
    designation: Optional[str] = None
    
    # ID proof
    id_proof_type: Optional[IDProofType] = None
    id_proof_number: Optional[str] = None
    
    # Preferences
    dietary_preference: Optional[DietaryPreference] = None
    food_allergies: Optional[str] = None


class StudentProfileUpdate(BaseUpdateSchema):
    """Update student profile"""
    # Guardian updates
    guardian_name: Optional[str] = Field(None, min_length=2, max_length=255)
    guardian_phone: Optional[str] = Field(None, pattern=r'^\+?[1-9]\d{9,14}$')
    guardian_email: Optional[str] = None
    guardian_relation: Optional[str] = None
    guardian_address: Optional[str] = None
    
    # Institutional
    institution_name: Optional[str] = None
    course: Optional[str] = None
    year_of_study: Optional[str] = None
    student_id_number: Optional[str] = None
    
    # Employment
    company_name: Optional[str] = None
    designation: Optional[str] = None
    
    # Preferences
    dietary_preference: Optional[DietaryPreference] = None
    food_allergies: Optional[str] = None


class StudentDocuments(BaseSchema):
    """Student document management"""
    student_id: UUID
    documents: List["DocumentInfo"] = Field(default_factory=list)


class DocumentInfo(BaseSchema):
    """Individual document information"""
    document_type: str = Field(..., description="Type of document")
    document_name: str = Field(..., description="Document name")
    document_url: HttpUrl = Field(..., description="Document URL")
    uploaded_at: datetime = Field(..., description="Upload timestamp")
    verified: bool = Field(False, description="Verification status")
    verified_by: Optional[UUID] = None
    verified_at: Optional[datetime] = None


class DocumentUploadRequest(BaseCreateSchema):
    """Upload document request"""
    student_id: UUID = Field(..., description="Student ID")
    document_type: str = Field(
        ...,
        pattern="^(id_proof|address_proof|photo|institutional_id|company_id|other)$",
        description="Document type"
    )
    document_name: str = Field(..., description="Document name")
    document_url: HttpUrl = Field(..., description="Document URL (after upload to storage)")


class DocumentVerificationRequest(BaseCreateSchema):
    """Verify document request"""
    document_id: UUID = Field(..., description="Document ID")
    verified: bool = Field(..., description="Verification status")
    notes: Optional[str] = Field(None, description="Verification notes")


class StudentPreferences(BaseUpdateSchema):
    """Student preferences and settings"""
    # Meal preferences
    mess_subscribed: Optional[bool] = None
    dietary_preference: Optional[DietaryPreference] = None
    food_allergies: Optional[str] = None
    
    # Notification preferences
    email_notifications: bool = Field(True)
    sms_notifications: bool = Field(True)
    push_notifications: bool = Field(True)
    
    # Privacy
    show_profile_to_others: bool = Field(True, description="Show profile to other students")
    allow_roommate_contact: bool = Field(True, description="Allow roommates to contact")

# --- File: D:\hostel-management-saas\app\schemas\student\student_response.py ---
"""
Student response schemas
"""
from decimal import Decimal
from datetime import date, datetime
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import StudentStatus, IDProofType, DietaryPreference


class StudentResponse(BaseResponseSchema):
    """Student response schema"""
    user_id: UUID
    hostel_id: UUID
    hostel_name: str
    room_id: Optional[UUID]
    room_number: Optional[str]
    bed_id: Optional[UUID]
    bed_number: Optional[str]
    
    # Personal info (from user)
    full_name: str
    email: str
    phone: str
    
    # Guardian
    guardian_name: str
    guardian_phone: str
    
    # Status
    student_status: StudentStatus
    check_in_date: Optional[date]
    expected_checkout_date: Optional[date]
    
    # Financial
    monthly_rent_amount: Optional[Decimal]
    security_deposit_amount: Decimal
    security_deposit_paid: bool
    
    # Meal
    mess_subscribed: bool


class StudentDetail(BaseResponseSchema):
    """Detailed student information"""
    # User information
    user_id: UUID
    full_name: str
    email: str
    phone: str
    gender: Optional[str]
    date_of_birth: Optional[date]
    profile_image_url: Optional[str]
    
    # Hostel assignment
    hostel_id: UUID
    hostel_name: str
    room_id: Optional[UUID]
    room_number: Optional[str]
    room_type: Optional[str]
    bed_id: Optional[UUID]
    bed_number: Optional[str]
    
    # Identification
    id_proof_type: Optional[IDProofType]
    id_proof_number: Optional[str]
    id_proof_document_url: Optional[str]
    
    # Guardian information
    guardian_name: str
    guardian_phone: str
    guardian_email: Optional[str]
    guardian_relation: Optional[str]
    guardian_address: Optional[str]
    
    # Institutional information
    institution_name: Optional[str]
    course: Optional[str]
    year_of_study: Optional[str]
    student_id_number: Optional[str]
    
    # Employment information
    company_name: Optional[str]
    designation: Optional[str]
    company_id_url: Optional[str]
    
    # Dates
    check_in_date: Optional[date]
    expected_checkout_date: Optional[date]
    actual_checkout_date: Optional[date]
    
    # Financial
    security_deposit_amount: Decimal
    security_deposit_paid: bool
    security_deposit_paid_date: Optional[date]
    monthly_rent_amount: Optional[Decimal]
    
    # Meal preferences
    mess_subscribed: bool
    dietary_preference: Optional[DietaryPreference]
    food_allergies: Optional[str]
    
    # Status
    student_status: StudentStatus
    notice_period_start: Optional[date]
    notice_period_end: Optional[date]
    
    # Source
    booking_id: Optional[UUID]
    
    # Documents
    additional_documents: List[dict] = Field(default_factory=list)


class StudentProfile(BaseSchema):
    """Student public profile"""
    id: UUID
    full_name: str
    profile_image_url: Optional[str]
    hostel_name: str
    room_number: Optional[str]
    check_in_date: Optional[date]
    institution_name: Optional[str]
    course: Optional[str]


class StudentListItem(BaseSchema):
    """Student list item (for admin views)"""
    id: UUID
    user_id: UUID
    full_name: str
    email: str
    phone: str
    room_number: Optional[str]
    bed_number: Optional[str]
    student_status: StudentStatus
    check_in_date: Optional[date]
    monthly_rent: Optional[Decimal]
    payment_status: str = Field(..., description="current/overdue/advance")
    created_at: datetime


class StudentFinancialInfo(BaseSchema):
    """Student financial information"""
    student_id: UUID
    student_name: str
    
    # Rent
    monthly_rent_amount: Decimal
    
    # Security deposit
    security_deposit_amount: Decimal
    security_deposit_paid: bool
    security_deposit_refundable: Decimal
    
    # Payments
    total_paid: Decimal
    total_due: Decimal
    last_payment_date: Optional[date]
    next_due_date: Optional[date]
    
    # Outstanding
    overdue_amount: Decimal
    advance_amount: Decimal
    
    # Mess
    mess_charges_monthly: Decimal
    mess_balance: Decimal


class StudentContactInfo(BaseSchema):
    """Student contact information"""
    student_id: UUID
    student_name: str
    email: str
    phone: str
    
    # Guardian
    guardian_name: str
    guardian_phone: str
    guardian_email: Optional[str]
    guardian_relation: Optional[str]
    
    # Emergency
    emergency_contact_name: Optional[str]
    emergency_contact_phone: Optional[str]

# --- File: D:\hostel-management-saas\app\schemas\student\student_room_history.py ---
"""
Student room history and transfer schemas
"""
from datetime import date
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema


class RoomHistoryResponse(BaseSchema):
    """Student room history"""
    student_id: UUID
    student_name: str
    hostel_id: UUID
    hostel_name: str
    room_history: List["RoomHistoryItem"] = Field(..., description="Room assignment history")


class RoomHistoryItem(BaseResponseSchema):
    """Individual room history entry"""
    hostel_id: UUID
    hostel_name: str
    room_id: UUID
    room_number: str
    room_type: str
    bed_id: Optional[UUID]
    bed_number: Optional[str]
    
    move_in_date: date
    move_out_date: Optional[date]
    duration_days: Optional[int]
    
    rent_amount: Optional[Decimal]
    reason: Optional[str]
    
    requested_by: Optional[UUID]
    approved_by: Optional[UUID]


class RoomTransferRequest(BaseCreateSchema):
    """Request room transfer"""
    student_id: UUID = Field(..., description="Student ID")
    current_room_id: UUID = Field(..., description="Current room ID")
    requested_room_id: UUID = Field(..., description="Desired room ID")
    requested_bed_id: Optional[UUID] = Field(None, description="Desired bed ID (if specific)")
    
    transfer_date: date = Field(..., description="Desired transfer date")
    reason: str = Field(..., min_length=10, max_length=500, description="Transfer reason")
    
    # Financial implications
    accept_price_difference: bool = Field(
        False,
        description="Accept if new room has different price"
    )


class RoomTransferApproval(BaseCreateSchema):
    """Approve/reject room transfer"""
    transfer_request_id: UUID = Field(..., description="Transfer request ID")
    approved: bool = Field(..., description="Approval status")
    
    # If approved
    new_room_id: Optional[UUID] = Field(None, description="Approved room (may differ from requested)")
    new_bed_id: Optional[UUID] = Field(None, description="Assigned bed")
    transfer_date: Optional[date] = Field(None, description="Approved transfer date")
    
    # If rejected
    rejection_reason: Optional[str] = Field(None, description="Rejection reason")
    
    # Financial adjustments
    rent_adjustment: Optional[Decimal] = Field(None, description="Rent adjustment amount")
    additional_charges: Optional[Decimal] = Field(None, description="Transfer charges")
    
    admin_notes: Optional[str] = Field(None, description="Admin notes")


class RoomTransferStatus(BaseSchema):
    """Room transfer request status"""
    request_id: UUID
    student_id: UUID
    student_name: str
    
    current_room: str
    requested_room: str
    
    transfer_date: date
    reason: str
    
    status: str = Field(..., pattern="^(pending|approved|rejected|completed|cancelled)$")
    requested_at: datetime
    processed_at: Optional[datetime]
    processed_by: Optional[UUID]
    
    approval_notes: Optional[str]


class BulkRoomTransfer(BaseCreateSchema):
    """Bulk room transfer (admin only)"""
    transfers: List["SingleTransfer"] = Field(..., min_items=1, description="List of transfers")
    transfer_date: date = Field(..., description="Transfer date for all")
    reason: str = Field(..., description="Common reason")


class SingleTransfer(BaseSchema):
    """Single transfer in bulk operation"""
    student_id: UUID
    new_room_id: UUID
    new_bed_id: Optional[UUID]

# --- File: D:\hostel-management-saas\app\schemas\student\__init__.py ---
"""
Student schemas package
"""
from app.schemas.student.student_base import (
    StudentBase,
    StudentCreate,
    StudentUpdate
)
from app.schemas.student.student_response import (
    StudentResponse,
    StudentDetail,
    StudentProfile,
    StudentListItem
)
from app.schemas.student.student_profile import (
    StudentProfileCreate,
    StudentProfileUpdate,
    StudentDocuments
)
from app.schemas.student.student_room_history import (
    RoomHistoryResponse,
    RoomTransferRequest,
    RoomTransferApproval
)
from app.schemas.student.student_dashboard import (
    StudentDashboard,
    StudentStats,
    StudentFinancialSummary
)
from app.schemas.student.student_filters import (
    StudentFilterParams,
    StudentSearchRequest,
    StudentSortOptions
)

__all__ = [
    # Base
    "StudentBase",
    "StudentCreate",
    "StudentUpdate",
    
    # Response
    "StudentResponse",
    "StudentDetail",
    "StudentProfile",
    "StudentListItem",
    
    # Profile
    "StudentProfileCreate",
    "StudentProfileUpdate",
    "StudentDocuments",
    
    # Room history
    "RoomHistoryResponse",
    "RoomTransferRequest",
    "RoomTransferApproval",
    
    # Dashboard
    "StudentDashboard",
    "StudentStats",
    "StudentFinancialSummary",
    
    # Filters
    "StudentFilterParams",
    "StudentSearchRequest",
    "StudentSortOptions",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\subscription =====

# --- File: D:\hostel-management-saas\app\schemas\subscription\commission.py ---
"""
Booking commission tracking schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Optional, List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema


class CommissionConfig(BaseSchema):
    """Global/platform commission configuration"""
    default_commission_percentage: Decimal = Field(
        Decimal("5.00"), ge=0, le=100, description="Default commission%"
    )
    min_commission_percentage: Decimal = Field(Decimal("0.00"), ge=0, le=100)
    max_commission_percentage: Decimal = Field(Decimal("30.00"), ge=0, le=100)

    # Per-plan overrides
    commission_by_plan: dict[str, Decimal] = Field(
        default_factory=dict,
        description="plan_type (Standard/Premium) -> commission %",
    )


class BookingCommissionResponse(BaseResponseSchema):
    """Commission record for a booking"""
    booking_id: UUID
    hostel_id: UUID
    subscription_id: UUID

    booking_amount: Decimal
    commission_percentage: Decimal
    commission_amount: Decimal
    currency: str

    status: str  # pending, calculated, paid, waived
    due_date: Optional[date]
    paid_date: Optional[date]
    payment_reference: Optional[str]


class CommissionSummary(BaseSchema):
    """Commission summary for platform/hostel"""
    scope_type: str = Field(..., pattern="^(platform|hostel)$")
    hostel_id: Optional[UUID] = None

    period_start: date
    period_end: date

    total_commission_due: Decimal
    total_commission_paid: Decimal
    total_bookings_count: int
    bookings_with_commission_count: int

# --- File: D:\hostel-management-saas\app\schemas\subscription\subscription_base.py ---
"""
Hostel subscription schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseResponseSchema, BaseSchema
from app.schemas.common.enums import SubscriptionStatus, BillingCycle


class SubscriptionBase(BaseSchema):
    """Base subscription for a hostel"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    plan_id: UUID = Field(..., description="Subscription plan ID")

    subscription_reference: str = Field(..., max_length=100)

    billing_cycle: BillingCycle = Field(..., description="Billing cycle (monthly/yearly)")
    amount: Decimal = Field(..., ge=0, description="Amount per billing period")
    currency: str = Field("INR", min_length=3, max_length=3)

    # Period
    start_date: date = Field(..., description="Subscription start date")
    end_date: date = Field(..., description="Subscription end date")

    auto_renew: bool = Field(True)
    next_billing_date: Optional[date] = None

    status: SubscriptionStatus = Field(SubscriptionStatus.ACTIVE)


class SubscriptionCreate(SubscriptionBase, BaseCreateSchema):
    """Create new hostel subscription"""
    trial_end_date: Optional[date] = None


class SubscriptionUpdate(BaseUpdateSchema):
    """Update subscription (e.g. status, next billing)"""
    status: Optional[SubscriptionStatus] = None
    end_date: Optional[date] = None
    auto_renew: Optional[bool] = None
    next_billing_date: Optional[date] = None

# --- File: D:\hostel-management-saas\app\schemas\subscription\subscription_billing.py ---
"""
Subscription billing schemas
"""
from datetime import date
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class BillingCycleInfo(BaseSchema):
    """Info about current billing cycle for subscription"""
    subscription_id: UUID
    hostel_id: UUID
    plan_name: str

    cycle_start: date
    cycle_end: date
    billing_cycle: str  # monthly/yearly

    amount: Decimal
    currency: str

    next_billing_date: date
    auto_renew: bool


class GenerateInvoiceRequest(BaseCreateSchema):
    """Generate invoice for subscription cycle"""
    subscription_id: UUID
    billing_date: date

    # Overridable
    amount_override: Optional[Decimal] = None


class InvoiceInfo(BaseSchema):
    """Generated invoice info"""
    invoice_id: UUID
    subscription_id: UUID
    hostel_id: UUID

    invoice_number: str
    invoice_date: date
    due_date: date

    amount: Decimal
    currency: str

    status: str  # draft, issued, paid, overdue, cancelled
    invoice_url: Optional[str]

# --- File: D:\hostel-management-saas\app\schemas\subscription\subscription_cancellation.py ---
"""
Subscription cancellation schemas
"""
from datetime import date, datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema


class CancellationRequest(BaseCreateSchema):
    """Cancel subscription"""
    subscription_id: UUID
    hostel_id: UUID

    cancellation_reason: str = Field(..., min_length=10, max_length=500)
    cancel_immediately: bool = Field(False, description="Cancel now vs at end of term")


class CancellationResponse(BaseSchema):
    """Cancellation response"""
    subscription_id: UUID
    hostel_id: UUID

    cancelled: bool
    cancellation_effective_date: date
    cancelled_at: datetime
    cancelled_by: UUID

    message: str

# --- File: D:\hostel-management-saas\app\schemas\subscription\subscription_plan_base.py ---
"""
Subscription plan definition schemas
"""
from decimal import Decimal
from typing import Dict, Optional, List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseUpdateSchema, BaseResponseSchema
from app.schemas.common.enums import SubscriptionPlan


class SubscriptionPlanBase(BaseSchema):
    """Base subscription plan schema"""
    plan_name: str = Field(..., min_length=3, max_length=100, description="Plan internal name")
    display_name: str = Field(..., min_length=3, max_length=100, description="Plan display name")
    plan_type: SubscriptionPlan = Field(..., description="Plan tier/type")

    description: Optional[str] = Field(None, max_length=1000)

    price_monthly: Decimal = Field(..., ge=0, description="Monthly price")
    price_yearly: Decimal = Field(..., ge=0, description="Yearly price")
    currency: str = Field("INR", min_length=3, max_length=3)

    # Feature flags & limits as JSON
    features: Dict[str, object] = Field(
        default_factory=dict,
        description="Feature flags (e.g. max_hostels, advanced_analytics)",
    )

    max_hostels: Optional[int] = Field(None, ge=1)
    max_rooms_per_hostel: Optional[int] = Field(None, ge=1)
    max_students: Optional[int] = Field(None, ge=1)

    is_active: bool = Field(True)
    is_public: bool = Field(True, description="Show on pricing page")
    sort_order: int = Field(0, description="Ordering for display")


class PlanCreate(SubscriptionPlanBase, BaseCreateSchema):
    """Create new subscription plan"""
    pass


class PlanUpdate(BaseUpdateSchema):
    """Update subscription plan"""
    display_name: Optional[str] = None
    description: Optional[str] = None
    price_monthly: Optional[Decimal] = Field(None, ge=0)
    price_yearly: Optional[Decimal] = Field(None, ge=0)
    currency: Optional[str] = None
    features: Optional[Dict[str, object]] = None
    max_hostels: Optional[int] = Field(None, ge=1)
    max_rooms_per_hostel: Optional[int] = Field(None, ge=1)
    max_students: Optional[int] = Field(None, ge=1)
    is_active: Optional[bool] = None
    is_public: Optional[bool] = None
    sort_order: Optional[int] = None

# --- File: D:\hostel-management-saas\app\schemas\subscription\subscription_plan_response.py ---
"""
Subscription plan response & comparison schemas
"""
from decimal import Decimal
from typing import Dict, List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import SubscriptionPlan


class PlanResponse(BaseResponseSchema):
    """Subscription plan response"""
    plan_name: str
    display_name: str
    plan_type: SubscriptionPlan

    description: Optional[str]
    price_monthly: Decimal
    price_yearly: Decimal
    currency: str

    features: Dict[str, object]
    max_hostels: Optional[int]
    max_rooms_per_hostel: Optional[int]
    max_students: Optional[int]

    is_active: bool
    is_public: bool
    sort_order: int


class PlanFeatures(BaseSchema):
    """Human-friendly plan feature matrix"""
    plan_name: str
    display_name: str
    features: Dict[str, str] = Field(..., description="Feature -> label/value")


class PlanComparison(BaseSchema):
    """Compare multiple plans side by side"""
    plans: List[PlanResponse]
    feature_matrix: Dict[str, Dict[str, object]] = Field(
        ...,
        description="Feature key -> plan_name -> value",
    )

# --- File: D:\hostel-management-saas\app\schemas\subscription\subscription_response.py ---
"""
Subscription response schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import SubscriptionStatus, BillingCycle, SubscriptionPlan


class SubscriptionResponse(BaseResponseSchema):
    """Hostel subscription response"""
    hostel_id: UUID
    hostel_name: str

    plan_id: UUID
    plan_name: str
    display_name: str
    plan_type: SubscriptionPlan

    subscription_reference: str
    billing_cycle: BillingCycle
    amount: Decimal
    currency: str

    start_date: date
    end_date: date
    auto_renew: bool
    next_billing_date: Optional[date]
    status: SubscriptionStatus

    trial_end_date: Optional[date]
    last_payment_date: Optional[date]
    last_payment_amount: Optional[Decimal]


class BillingHistoryItem(BaseSchema):
    """Single billing event"""
    billing_date: date
    amount: Decimal
    currency: str
    status: str
    payment_reference: Optional[str]
    invoice_url: Optional[str]


class BillingHistory(BaseSchema):
    """Subscription billing history"""
    subscription_id: UUID
    hostel_id: UUID

    items: list[BillingHistoryItem]
    total_billed: Decimal
    total_paid: Decimal
    total_outstanding: Decimal

# --- File: D:\hostel-management-saas\app\schemas\subscription\subscription_upgrade.py ---
"""
Subscription upgrade/downgrade schemas
"""
from datetime import date
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema
from app.schemas.common.enums import BillingCycle


class UpgradeRequest(BaseCreateSchema):
    """Request to change subscription plan"""
    hostel_id: UUID
    current_plan_id: UUID
    new_plan_id: UUID
    billing_cycle: BillingCycle = Field(...)

    # Timing
    effective_from: date = Field(..., description="When new plan takes effect")
    prorate: bool = Field(True, description="Prorate charges/refunds")


class UpgradePreview(BaseSchema):
    """Preview cost impact of upgrade/downgrade"""
    current_plan_name: str
    new_plan_name: str

    current_amount: Decimal
    new_amount: Decimal

    # For current period
    prorated_charge: Decimal = Field(..., description="Additional amount to charge")
    prorated_refund: Decimal = Field(..., description="If downgrade, refund amount")

    effective_from: date
    message: str


class DowngradeRequest(UpgradeRequest):
    """Same payload, semantics are downgrade if new plan is smaller"""
    pass

# --- File: D:\hostel-management-saas\app\schemas\subscription\__init__.py ---



# ===== Folder: D:\hostel-management-saas\app\schemas\supervisor =====

# --- File: D:\hostel-management-saas\app\schemas\supervisor\supervisor_activity.py ---
"""
Supervisor activity and audit log schemas
"""
from datetime import datetime
from typing import List, Optional, Dict, Any
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseResponseSchema, BaseFilterSchema
from app.schemas.common.enums import AuditActionCategory
from app.schemas.common.filters import DateTimeRangeFilter


class SupervisorActivityLog(BaseResponseSchema):
    """Supervisor activity log entry"""
    supervisor_id: UUID
    supervisor_name: str
    hostel_id: UUID
    hostel_name: str
    
    action_type: str = Field(..., description="Type of action performed")
    action_category: AuditActionCategory = Field(..., description="Action category")
    
    entity_type: Optional[str] = Field(None, description="Type of entity affected")
    entity_id: Optional[UUID] = Field(None, description="ID of affected entity")
    
    action_description: str = Field(..., description="Human-readable description")
    
    metadata: Dict[str, Any] = Field(default_factory=dict, description="Additional action details")
    
    ip_address: Optional[str] = None
    user_agent: Optional[str] = None


class ActivityDetail(BaseSchema):
    """Detailed activity information"""
    activity_id: UUID
    supervisor_id: UUID
    supervisor_name: str
    
    timestamp: datetime
    action_type: str
    action_category: AuditActionCategory
    action_description: str
    
    # Entity details
    entity_type: Optional[str]
    entity_id: Optional[UUID]
    entity_name: Optional[str]
    
    # Changes made
    old_values: Optional[Dict[str, Any]] = None
    new_values: Optional[Dict[str, Any]] = None
    
    # Context
    ip_address: Optional[str]
    user_agent: Optional[str]
    location: Optional[str]
    
    # Result
    success: bool = Field(True, description="Whether action succeeded")
    error_message: Optional[str] = None


class ActivitySummary(BaseSchema):
    """Activity summary for supervisor"""
    supervisor_id: UUID
    supervisor_name: str
    period_start: datetime
    period_end: datetime
    
    total_actions: int
    
    # By category
    actions_by_category: Dict[str, int] = Field(
        default_factory=dict,
        description="Count of actions by category"
    )
    
    # By type
    actions_by_type: Dict[str, int] = Field(
        default_factory=dict,
        description="Count of actions by type"
    )
    
    # Top activities
    top_activities: List["TopActivity"] = Field(
        default_factory=list,
        description="Most frequent activities"
    )
    
    # Activity timeline
    activity_timeline: List["ActivityTimelinePoint"] = Field(
        default_factory=list,
        description="Activity over time"
    )
    
    # Peak activity times
    peak_hours: List[int] = Field(
        default_factory=list,
        description="Hours with most activity (0-23)"
    )


class TopActivity(BaseSchema):
    """Top activity item"""
    action_type: str
    action_category: str
    count: int
    last_performed: datetime


class ActivityTimelinePoint(BaseSchema):
    """Activity timeline data point"""
    timestamp: datetime
    action_count: int
    categories: Dict[str, int]


class ActivityFilterParams(BaseFilterSchema):
    """Filter parameters for activity logs"""
    # Supervisor filter
    supervisor_id: Optional[UUID] = None
    supervisor_ids: Optional[List[UUID]] = None
    
    # Hostel filter
    hostel_id: Optional[UUID] = None
    
    # Time range
    date_range: Optional[DateTimeRangeFilter] = None
    
    # Action filters
    action_category: Optional[AuditActionCategory] = None
    action_categories: Optional[List[AuditActionCategory]] = None
    action_type: Optional[str] = None
    
    # Entity filter
    entity_type: Optional[str] = None
    entity_id: Optional[UUID] = None
    
    # Success filter
    success_only: Optional[bool] = None
    failed_only: Optional[bool] = None
    
    # Pagination
    page: int = Field(1, ge=1)
    page_size: int = Field(50, ge=1, le=100)


class ActivityExportRequest(BaseSchema):
    """Export activity logs"""
    filters: ActivityFilterParams = Field(..., description="Filter criteria")
    format: str = Field("csv", pattern="^(csv|excel|pdf|json)$")
    include_metadata: bool = Field(False, description="Include full metadata")

# --- File: D:\hostel-management-saas\app\schemas\supervisor\supervisor_assignment.py ---
"""
Supervisor assignment schemas
"""
from datetime import date
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseUpdateSchema, BaseResponseSchema
from app.schemas.common.enums import PermissionLevel


class SupervisorAssignment(BaseResponseSchema):
    """Supervisor-hostel assignment"""
    supervisor_id: UUID
    supervisor_name: str
    hostel_id: UUID
    hostel_name: str
    assigned_by: UUID
    assigned_by_name: str
    assigned_date: date
    is_active: bool
    
    # Permissions summary
    permission_level: str = Field(..., description="Summary of permission level")
    
    # Activity
    last_active: Optional[datetime]


class AssignmentRequest(BaseCreateSchema):
    """Assign supervisor to hostel"""
    user_id: UUID = Field(..., description="User ID to assign as supervisor")
    hostel_id: UUID = Field(..., description="Hostel ID")
    
    # Employment details
    employee_id: Optional[str] = None
    join_date: date = Field(..., description="Joining date")
    employment_type: str = Field("full_time", pattern="^(full_time|part_time|contract)$")
    shift_timing: Optional[str] = None
    
    # Permissions (optional, will use defaults if not provided)
    permissions: Optional[dict] = Field(None, description="Custom permissions")


class AssignmentUpdate(BaseUpdateSchema):
    """Update supervisor assignment"""
    employee_id: Optional[str] = None
    employment_type: Optional[str] = Field(None, pattern="^(full_time|part_time|contract)$")
    shift_timing: Optional[str] = None
    is_active: Optional[bool] = None


class RevokeAssignmentRequest(BaseCreateSchema):
    """Revoke supervisor assignment"""
    supervisor_id: UUID = Field(..., description="Supervisor ID")
    revoke_date: date = Field(..., description="Effective revocation date")
    reason: str = Field(..., min_length=10, max_length=500, description="Reason for revocation")
    
    # Handover
    handover_to_supervisor_id: Optional[UUID] = Field(
        None,
        description="Transfer responsibilities to another supervisor"
    )
    handover_notes: Optional[str] = None


class AssignmentTransfer(BaseCreateSchema):
    """Transfer supervisor to different hostel"""
    supervisor_id: UUID = Field(..., description="Supervisor ID")
    from_hostel_id: UUID = Field(..., description="Current hostel")
    to_hostel_id: UUID = Field(..., description="New hostel")
    transfer_date: date = Field(..., description="Transfer effective date")
    reason: str = Field(..., description="Transfer reason")
    
    # Whether to retain same permissions
    retain_permissions: bool = Field(True, description="Keep same permission set")
    
    # New permissions if not retaining
    new_permissions: Optional[dict] = None

# --- File: D:\hostel-management-saas\app\schemas\supervisor\supervisor_base.py ---
"""
Supervisor base schemas
"""
from datetime import date
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import SupervisorStatus, EmploymentType


class SupervisorBase(BaseSchema):
    """Base supervisor schema"""
    user_id: UUID = Field(..., description="Associated user ID")
    assigned_hostel_id: UUID = Field(..., description="Assigned hostel ID")
    
    # Employment details
    employee_id: Optional[str] = Field(None, max_length=100, description="Employee ID")
    join_date: date = Field(..., description="Joining date")
    employment_type: EmploymentType = Field(EmploymentType.FULL_TIME, description="Employment type")
    shift_timing: Optional[str] = Field(None, max_length=100, description="Shift timing (e.g., '9 AM - 6 PM')")


class SupervisorCreate(SupervisorBase, BaseCreateSchema):
    """Create supervisor schema"""
    assigned_by: UUID = Field(..., description="Admin who is assigning the supervisor")
    
    # Initial permissions (can be customized later)
    permissions: Optional[dict] = Field(None, description="Initial permission settings")


class SupervisorUpdate(BaseUpdateSchema):
    """Update supervisor schema"""
    employee_id: Optional[str] = Field(None, max_length=100)
    employment_type: Optional[EmploymentType] = None
    shift_timing: Optional[str] = None
    
    # Status updates
    status: Optional[SupervisorStatus] = None
    is_active: Optional[bool] = None
    
    # Permissions update
    permissions: Optional[dict] = None


class SupervisorStatusUpdate(BaseUpdateSchema):
    """Update supervisor status"""
    status: SupervisorStatus = Field(..., description="New status")
    is_active: bool = Field(..., description="Active status")
    
    # If terminating
    termination_date: Optional[date] = Field(None, description="Termination date")
    termination_reason: Optional[str] = Field(None, description="Termination reason")
    
    # If suspending
    suspension_reason: Optional[str] = Field(None, description="Suspension reason")
    suspension_end_date: Optional[date] = Field(None, description="Expected end of suspension")


class SupervisorReassignment(BaseCreateSchema):
    """Reassign supervisor to different hostel"""
    supervisor_id: UUID = Field(..., description="Supervisor ID")
    new_hostel_id: UUID = Field(..., description="New hostel ID")
    effective_date: date = Field(..., description="Effective date of reassignment")
    reason: Optional[str] = Field(None, description="Reassignment reason")

# --- File: D:\hostel-management-saas\app\schemas\supervisor\supervisor_dashboard.py ---
"""
Supervisor dashboard schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema


class SupervisorDashboard(BaseSchema):
    """Supervisor dashboard overview"""
    supervisor_id: UUID
    supervisor_name: str
    hostel_id: UUID
    hostel_name: str
    
    # Metrics
    metrics: "DashboardMetrics"
    
    # Tasks
    tasks: "TaskSummary"
    
    # Recent activity
    recent_complaints: List["RecentComplaintItem"] = Field(default_factory=list, max_items=5)
    recent_maintenance: List["RecentMaintenanceItem"] = Field(default_factory=list, max_items=5)
    pending_leaves: List["PendingLeaveItem"] = Field(default_factory=list, max_items=5)
    
    # Today's schedule
    today_schedule: "TodaySchedule"
    
    # Alerts
    alerts: List["DashboardAlert"] = Field(default_factory=list)
    
    # Quick stats
    last_login: Optional[datetime]
    actions_today: int


class DashboardMetrics(BaseSchema):
    """Dashboard key metrics"""
    # Students
    total_students: int
    active_students: int
    
    # Occupancy
    total_beds: int
    occupied_beds: int
    available_beds: int
    occupancy_percentage: Decimal
    
    # Complaints
    total_complaints: int
    open_complaints: int
    assigned_to_me: int
    resolved_today: int
    average_resolution_time_hours: Decimal
    
    # Maintenance
    pending_maintenance: int
    in_progress_maintenance: int
    completed_today: int
    
    # Attendance
    attendance_marked_today: bool
    total_present_today: int
    total_absent_today: int
    students_on_leave: int
    
    # Payments (view only)
    overdue_payments_count: int
    
    # Announcements
    unread_admin_messages: int


class TaskSummary(BaseSchema):
    """Summary of pending tasks"""
    # High priority tasks
    urgent_complaints: int
    critical_maintenance: int
    pending_leave_approvals: int
    
    # Daily tasks
    attendance_pending: bool
    menu_published_today: bool
    daily_inspection_done: bool
    
    # Overdue tasks
    overdue_complaint_resolutions: int
    overdue_maintenance: int
    
    # Total pending
    total_pending_tasks: int


class RecentComplaintItem(BaseSchema):
    """Recent complaint item for dashboard"""
    complaint_id: UUID
    complaint_number: str
    title: str
    category: str
    priority: str
    status: str
    student_name: str
    room_number: str
    created_at: datetime
    age_hours: int


class RecentMaintenanceItem(BaseSchema):
    """Recent maintenance item for dashboard"""
    request_id: UUID
    request_number: str
    title: str
    category: str
    priority: str
    status: str
    room_number: Optional[str]
    estimated_cost: Optional[Decimal]
    created_at: datetime


class PendingLeaveItem(BaseSchema):
    """Pending leave approval"""
    leave_id: UUID
    student_name: str
    room_number: str
    leave_type: str
    from_date: date
    to_date: date
    total_days: int
    reason: str
    applied_at: datetime


class TodaySchedule(BaseSchema):
    """Today's schedule for supervisor"""
    date: date
    
    # Routine tasks
    attendance_marking_time: str = Field(..., description="Expected time for attendance")
    inspection_rounds: List[str] = Field(default_factory=list, description="Scheduled inspection areas")
    
    # Scheduled maintenance
    scheduled_maintenance: List["ScheduledMaintenanceItem"] = Field(default_factory=list)
    
    # Meetings
    scheduled_meetings: List["ScheduledMeeting"] = Field(default_factory=list)
    
    # Special events
    special_events: List[str] = Field(default_factory=list)


class ScheduledMaintenanceItem(BaseSchema):
    """Scheduled maintenance for today"""
    maintenance_id: UUID
    title: str
    scheduled_time: str
    room_number: Optional[str]
    assigned_staff: Optional[str]


class ScheduledMeeting(BaseSchema):
    """Scheduled meeting"""
    meeting_id: UUID
    title: str
    time: str
    attendees: List[str]
    location: str


class DashboardAlert(BaseSchema):
    """Dashboard alert/notification"""
    alert_id: UUID
    alert_type: str = Field(
        ...,
        pattern="^(urgent|warning|info)$",
        description="Alert severity"
    )
    title: str
    message: str
    action_required: bool
    action_url: Optional[str]
    created_at: datetime


class QuickActions(BaseSchema):
    """Quick action buttons for dashboard"""
    actions: List["QuickAction"]


class QuickAction(BaseSchema):
    """Individual quick action"""
    action_id: str
    label: str
    icon: str
    url: str
    badge_count: Optional[int] = Field(None, description="Number indicator (e.g., pending items)")

# --- File: D:\hostel-management-saas\app\schemas\supervisor\supervisor_performance.py ---
"""
Supervisor performance tracking schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import List, Optional, Dict
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.filters import DateRangeFilter


class PerformanceMetrics(BaseSchema):
    """Supervisor performance metrics"""
    supervisor_id: UUID
    supervisor_name: str
    hostel_id: UUID
    period_start: date
    period_end: date
    
    # Complaint handling
    complaints_handled: int
    complaints_resolved: int
    complaint_resolution_rate: Decimal = Field(..., description="% of complaints resolved")
    average_resolution_time_hours: Decimal
    sla_compliance_rate: Decimal = Field(..., description="% meeting SLA")
    
    # Attendance management
    attendance_records_created: int
    attendance_accuracy: Decimal = Field(..., description="% accuracy (if verified)")
    leaves_approved: int
    leaves_rejected: int
    
    # Maintenance management
    maintenance_requests_created: int
    maintenance_completed: int
    maintenance_completion_rate: Decimal
    average_maintenance_time_hours: Decimal
    
    # Announcements
    announcements_created: int
    announcement_reach: int = Field(..., description="Total students reached")
    
    # Responsiveness
    average_first_response_time_minutes: Decimal
    availability_percentage: Decimal = Field(..., description="% of working hours active")
    
    # Student satisfaction
    student_feedback_score: Optional[Decimal] = Field(
        None,
        ge=0,
        le=5,
        description="Average rating from students"
    )
    
    # Overall rating
    overall_performance_score: Decimal = Field(..., ge=0, le=100, description="Calculated performance score")


class PerformanceReport(BaseSchema):
    """Comprehensive performance report"""
    supervisor_id: UUID
    supervisor_name: str
    hostel_name: str
    report_period: DateRangeFilter
    generated_at: datetime
    
    # Summary metrics
    summary: PerformanceMetrics
    
    # Detailed breakdown
    complaint_performance: "ComplaintPerformance"
    attendance_performance: "AttendancePerformance"
    maintenance_performance: "MaintenancePerformance"
    
    # Trends
    performance_trends: List["PerformanceTrendPoint"]
    
    # Comparisons
    comparison_with_peers: Optional["PeerComparison"] = None
    comparison_with_previous_period: Optional["PeriodComparison"] = None
    
    # Strengths and areas for improvement
    strengths: List[str] = Field(default_factory=list)
    areas_for_improvement: List[str] = Field(default_factory=list)
    
    # Recommendations
    recommendations: List[str] = Field(default_factory=list)


class ComplaintPerformance(BaseSchema):
    """Complaint handling performance details"""
    total_complaints: int
    resolved_complaints: int
    pending_complaints: int
    
    # By category
    complaints_by_category: Dict[str, int]
    
    # By priority
    complaints_by_priority: Dict[str, int]
    
    # Resolution times
    average_resolution_time_hours: Decimal
    fastest_resolution_hours: Decimal
    slowest_resolution_hours: Decimal
    
    # SLA performance
    within_sla: int
    breached_sla: int
    sla_compliance_rate: Decimal
    
    # Student satisfaction
    average_complaint_rating: Optional[Decimal]


class AttendancePerformance(BaseSchema):
    """Attendance management performance"""
    total_attendance_records: int
    days_attendance_marked: int
    days_attendance_missed: int
    
    # Timeliness
    on_time_marking_rate: Decimal = Field(..., description="% of times marked on time")
    average_marking_delay_minutes: Decimal
    
    # Accuracy
    corrections_made: int
    accuracy_rate: Decimal
    
    # Leave management
    leaves_processed: int
    average_leave_approval_time_hours: Decimal


class MaintenancePerformance(BaseSchema):
    """Maintenance management performance"""
    requests_created: int
    requests_completed: int
    requests_pending: int
    
    # By category
    requests_by_category: Dict[str, int]
    
    # Completion time
    average_completion_time_hours: Decimal
    
    # Cost management
    total_maintenance_cost: Decimal
    average_cost_per_request: Decimal
    within_budget_rate: Decimal
    
    # Preventive maintenance
    preventive_tasks_completed: int
    preventive_compliance_rate: Decimal


class PerformanceTrendPoint(BaseSchema):
    """Performance trend data point"""
    period: str = Field(..., description="Time period (e.g., '2024-01' or 'Week 15')")
    overall_score: Decimal
    complaint_score: Decimal
    attendance_score: Decimal
    maintenance_score: Decimal


class PeerComparison(BaseSchema):
    """Comparison with peer supervisors"""
    total_supervisors: int
    rank: int = Field(..., description="Rank among peers (1 = best)")
    percentile: Decimal = Field(..., description="Performance percentile")
    
    # Metric comparisons
    metrics_vs_average: Dict[str, "MetricComparison"]


class MetricComparison(BaseSchema):
    """Individual metric comparison"""
    metric_name: str
    supervisor_value: Decimal
    peer_average: Decimal
    difference_percentage: Decimal
    better_than_average: bool


class PeriodComparison(BaseSchema):
    """Comparison with previous period"""
    previous_period: DateRangeFilter
    current_period: DateRangeFilter
    
    # Overall change
    overall_score_change: Decimal = Field(..., description="% change in overall score")
    
    # Metric changes
    metric_changes: Dict[str, Decimal] = Field(
        ...,
        description="% change for each metric"
    )
    
    # Improvement/decline indicators
    improved_metrics: List[str]
    declined_metrics: List[str]


class PerformanceReview(BaseCreateSchema):
    """Performance review by admin"""
    supervisor_id: UUID = Field(..., description="Supervisor being reviewed")
    review_period: DateRangeFilter = Field(..., description="Review period")
    
    # Ratings (1-5 scale)
    complaint_handling_rating: Decimal = Field(..., ge=1, le=5)
    attendance_management_rating: Decimal = Field(..., ge=1, le=5)
    maintenance_management_rating: Decimal = Field(..., ge=1, le=5)
    communication_rating: Decimal = Field(..., ge=1, le=5)
    professionalism_rating: Decimal = Field(..., ge=1, le=5)
    reliability_rating: Decimal = Field(..., ge=1, le=5)
    
    # Overall rating (calculated or manual)
    overall_rating: Decimal = Field(..., ge=1, le=5)
    
    # Textual feedback
    strengths: str = Field(..., min_length=20, description="Supervisor strengths")
    areas_for_improvement: str = Field(..., min_length=20, description="Areas to improve")
    goals_for_next_period: str = Field(..., description="Goals for next review period")
    
    # Additional comments
    admin_comments: Optional[str] = None
    
    # Action items
    action_items: List[str] = Field(default_factory=list, description="Specific action items")


class PerformanceReviewResponse(BaseSchema):
    """Performance review response"""
    review_id: UUID
    supervisor_id: UUID
    supervisor_name: str
    reviewed_by: UUID
    reviewed_by_name: str
    review_date: date
    
    review_period: DateRangeFilter
    
    # Ratings
    ratings: Dict[str, Decimal]
    overall_rating: Decimal
    
    # Feedback
    strengths: str
    areas_for_improvement: str
    goals_for_next_period: str
    admin_comments: Optional[str]
    
    # Actions
    action_items: List[str]
    
    # Supervisor acknowledgment
    acknowledged: bool = Field(False)
    acknowledged_at: Optional[datetime] = None
    supervisor_comments: Optional[str] = None


class PerformanceGoal(BaseCreateSchema):
    """Set performance goal for supervisor"""
    supervisor_id: UUID
    goal_name: str = Field(..., min_length=5, max_length=255)
    goal_description: str = Field(..., min_length=20)
    
    # Measurable target
    metric_name: str = Field(..., description="Metric to measure (e.g., 'complaint_resolution_rate')")
    target_value: Decimal = Field(..., description="Target value to achieve")
    
    # Timeline
    start_date: date
    end_date: date
    
    # Priority
    priority: str = Field("medium", pattern="^(low|medium|high)$")


class PerformanceGoalProgress(BaseSchema):
    """Track progress on performance goal"""
    goal_id: UUID
    goal_name: str
    metric_name: str
    target_value: Decimal
    current_value: Decimal
    progress_percentage: Decimal
    
    start_date: date
    end_date: date
    days_remaining: int
    
    status: str = Field(
        ...,
        pattern="^(on_track|at_risk|behind|completed|failed)$"
    )
    
    last_updated: datetime

# --- File: D:\hostel-management-saas\app\schemas\supervisor\supervisor_permissions.py ---
"""
Supervisor permission schemas
"""
from decimal import Decimal
from typing import Dict, Optional, Any
from pydantic import Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseUpdateSchema


class SupervisorPermissions(BaseSchema):
    """Supervisor permission configuration"""
    # Complaint management
    can_manage_complaints: bool = Field(True, description="Can view and manage complaints")
    can_assign_complaints: bool = Field(True, description="Can assign complaints to staff")
    can_resolve_complaints: bool = Field(True, description="Can mark complaints as resolved")
    
    # Attendance management
    can_record_attendance: bool = Field(True, description="Can record daily attendance")
    can_approve_leaves: bool = Field(True, description="Can approve leave applications")
    max_leave_days_approval: int = Field(3, ge=1, le=10, description="Max days of leave can approve independently")
    
    # Maintenance management
    can_manage_maintenance: bool = Field(True, description="Can create and manage maintenance requests")
    can_assign_maintenance: bool = Field(True, description="Can assign maintenance tasks")
    maintenance_approval_threshold: Decimal = Field(
        Decimal("5000.00"),
        ge=0,
        description="Maximum repair cost can approve independently (INR)"
    )
    
    # Mess menu management
    can_update_mess_menu: bool = Field(True, description="Can update daily mess menu")
    menu_requires_approval: bool = Field(False, description="Menu changes require admin approval")
    can_publish_special_menus: bool = Field(False, description="Can publish special occasion menus")
    
    # Announcements
    can_create_announcements: bool = Field(True, description="Can create announcements")
    urgent_announcement_requires_approval: bool = Field(
        True,
        description="Urgent announcements require admin approval"
    )
    can_send_push_notifications: bool = Field(False, description="Can send push notifications")
    
    # Student management
    can_view_student_profiles: bool = Field(True, description="Can view student profiles")
    can_update_student_contacts: bool = Field(True, description="Can update student contact info")
    can_view_student_payments: bool = Field(True, description="Can view payment status (read-only)")
    
    # Financial access
    can_view_financial_reports: bool = Field(False, description="Can view detailed financial reports")
    can_view_revenue_data: bool = Field(False, description="Can view revenue data")
    
    # Room management
    can_view_room_availability: bool = Field(True, description="Can view room availability")
    can_suggest_room_transfers: bool = Field(True, description="Can suggest room transfers (requires admin approval)")
    
    # Booking management (view only)
    can_view_bookings: bool = Field(True, description="Can view booking requests")
    can_contact_visitors: bool = Field(True, description="Can contact visitors for inquiries")


class PermissionUpdate(BaseUpdateSchema):
    """Update supervisor permissions"""
    permissions: Dict[str, Any] = Field(..., description="Permission key-value pairs to update")
    
    @field_validator('permissions')
    @classmethod
    def validate_permissions(cls, v: Dict[str, Any]) -> Dict[str, Any]:
        """Validate permission values"""
        valid_keys = set(SupervisorPermissions.model_fields.keys())
        invalid_keys = set(v.keys()) - valid_keys
        if invalid_keys:
            raise ValueError(f"Invalid permission keys: {invalid_keys}")
        return v


class PermissionCheckRequest(BaseSchema):
    """Request to check specific permission"""
    supervisor_id: UUID = Field(..., description="Supervisor ID")
    permission_key: str = Field(..., description="Permission to check")
    
    # Context for threshold-based permissions
    context: Optional[Dict[str, Any]] = Field(
        None,
        description="Additional context (e.g., {'amount': 7500} for maintenance threshold)"
    )


class PermissionCheckResponse(BaseSchema):
    """Response for permission check"""
    supervisor_id: UUID
    permission_key: str
    has_permission: bool = Field(..., description="Whether supervisor has permission")
    requires_approval: bool = Field(False, description="Whether action requires admin approval")
    threshold_exceeded: bool = Field(False, description="Whether threshold is exceeded")
    message: Optional[str] = Field(None, description="Explanation message")
    
    # Threshold details if applicable
    threshold_value: Optional[Decimal] = None
    actual_value: Optional[Decimal] = None


class BulkPermissionUpdate(BaseUpdateSchema):
    """Update permissions for multiple supervisors"""
    supervisor_ids: List[UUID] = Field(..., min_items=1, description="Supervisor IDs")
    permissions: Dict[str, Any] = Field(..., description="Permissions to update for all")


class PermissionTemplate(BaseSchema):
    """Permission template for quick assignment"""
    template_name: str = Field(..., description="Template name (e.g., 'Junior Supervisor', 'Senior Supervisor')")
    description: Optional[str] = None
    permissions: SupervisorPermissions = Field(..., description="Permission set")


class ApplyPermissionTemplate(BaseSchema):
    """Apply permission template to supervisor(s)"""
    supervisor_ids: List[UUID] = Field(..., min_items=1)
    template_name: str = Field(..., description="Template to apply")
    override_existing: bool = Field(True, description="Override existing permissions")

# --- File: D:\hostel-management-saas\app\schemas\supervisor\supervisor_profile.py ---
"""
Supervisor profile schemas
"""
from datetime import date
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseUpdateSchema
from app.schemas.common.enums import EmploymentType, SupervisorStatus


class SupervisorProfile(BaseSchema):
    """Complete supervisor profile"""
    id: UUID
    user_id: UUID
    full_name: str
    email: str
    phone: str
    profile_image_url: Optional[str]
    
    # Assignment
    hostel_id: UUID
    hostel_name: str
    
    # Employment
    employment: "SupervisorEmployment"
    
    # Permissions
    permissions: dict
    
    # Performance
    performance_summary: "PerformanceSummary"


class SupervisorEmployment(BaseSchema):
    """Supervisor employment details"""
    employee_id: Optional[str]
    join_date: date
    employment_type: EmploymentType
    shift_timing: Optional[str]
    
    status: SupervisorStatus
    is_active: bool
    
    # If terminated
    termination_date: Optional[date]
    termination_reason: Optional[str]
    
    # Assigned by
    assigned_by: UUID
    assigned_by_name: str
    assigned_date: date


class PerformanceSummary(BaseSchema):
    """Performance summary"""
    total_complaints_resolved: int
    average_resolution_time_hours: Decimal
    total_attendance_records: int
    total_maintenance_requests: int
    
    current_month_complaints: int
    current_month_attendance_records: int
    
    performance_rating: Optional[Decimal]
    last_performance_review: Optional[date]


class SupervisorProfileUpdate(BaseUpdateSchema):
    """Update supervisor profile (supervisor can update own profile)"""
    # Contact updates (requires admin approval)
    phone: Optional[str] = Field(None, pattern=r'^\+?[1-9]\d{9,14}$')
    
    # Shift preference (requires admin approval)
    preferred_shift_timing: Optional[str] = None
    
    # Personal notes
    notes: Optional[str] = Field(None, max_length=1000)

# --- File: D:\hostel-management-saas\app\schemas\supervisor\supervisor_response.py ---
"""
Supervisor response schemas
"""
from datetime import date, datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import SupervisorStatus, EmploymentType


class SupervisorResponse(BaseResponseSchema):
    """Supervisor response schema"""
    user_id: UUID
    full_name: str
    email: str
    phone: str
    
    assigned_hostel_id: UUID
    hostel_name: str
    
    employee_id: Optional[str]
    join_date: date
    employment_type: EmploymentType
    
    status: SupervisorStatus
    is_active: bool
    
    assigned_by: UUID
    assigned_date: date


class SupervisorDetail(BaseResponseSchema):
    """Detailed supervisor information"""
    # User information
    user_id: UUID
    full_name: str
    email: str
    phone: str
    profile_image_url: Optional[str]
    
    # Hostel assignment
    assigned_hostel_id: UUID
    hostel_name: str
    assigned_by: UUID
    assigned_by_name: str
    assigned_date: date
    
    # Employment
    employee_id: Optional[str]
    join_date: date
    employment_type: EmploymentType
    shift_timing: Optional[str]
    
    # Status
    status: SupervisorStatus
    is_active: bool
    termination_date: Optional[date]
    termination_reason: Optional[str]
    
    # Permissions
    permissions: dict = Field(default_factory=dict)
    
    # Performance
    total_complaints_resolved: int
    average_resolution_time_hours: Decimal
    last_performance_review: Optional[date]
    performance_rating: Optional[Decimal]
    
    # Activity
    last_login: Optional[datetime]
    total_logins: int


class SupervisorListItem(BaseSchema):
    """Supervisor list item"""
    id: UUID
    user_id: UUID
    full_name: str
    email: str
    phone: str
    hostel_name: str
    employee_id: Optional[str]
    employment_type: EmploymentType
    status: SupervisorStatus
    is_active: bool
    join_date: date
    performance_rating: Optional[Decimal]


class SupervisorSummary(BaseSchema):
    """Supervisor summary for hostel"""
    supervisor_id: UUID
    full_name: str
    email: str
    phone: str
    employee_id: Optional[str]
    status: SupervisorStatus
    shift_timing: Optional[str]
    
    # Quick stats
    complaints_handled_this_month: int
    attendance_records_this_month: int
    last_active: Optional[datetime]

# --- File: D:\hostel-management-saas\app\schemas\supervisor\__init__.py ---
"""
Supervisor schemas package
"""
from app.schemas.supervisor.supervisor_base import (
    SupervisorBase,
    SupervisorCreate,
    SupervisorUpdate
)
from app.schemas.supervisor.supervisor_response import (
    SupervisorResponse,
    SupervisorDetail,
    SupervisorListItem
)
from app.schemas.supervisor.supervisor_profile import (
    SupervisorProfile,
    SupervisorEmployment,
    SupervisorProfileUpdate
)
from app.schemas.supervisor.supervisor_permissions import (
    SupervisorPermissions,
    PermissionUpdate,
    PermissionCheckRequest,
    PermissionCheckResponse
)
from app.schemas.supervisor.supervisor_assignment import (
    SupervisorAssignment,
    AssignmentRequest,
    AssignmentUpdate,
    RevokeAssignmentRequest
)
from app.schemas.supervisor.supervisor_activity import (
    SupervisorActivityLog,
    ActivitySummary,
    ActivityDetail,
    ActivityFilterParams
)
from app.schemas.supervisor.supervisor_dashboard import (
    SupervisorDashboard,
    DashboardMetrics,
    TaskSummary
)
from app.schemas.supervisor.supervisor_performance import (
    PerformanceMetrics,
    PerformanceReport,
    PerformanceReview
)

__all__ = [
    # Base
    "SupervisorBase",
    "SupervisorCreate",
    "SupervisorUpdate",
    
    # Response
    "SupervisorResponse",
    "SupervisorDetail",
    "SupervisorListItem",
    
    # Profile
    "SupervisorProfile",
    "SupervisorEmployment",
    "SupervisorProfileUpdate",
    
    # Permissions
    "SupervisorPermissions",
    "PermissionUpdate",
    "PermissionCheckRequest",
    "PermissionCheckResponse",
    
    # Assignment
    "SupervisorAssignment",
    "AssignmentRequest",
    "AssignmentUpdate",
    "RevokeAssignmentRequest",
    
    # Activity
    "SupervisorActivityLog",
    "ActivitySummary",
    "ActivityDetail",
    "ActivityFilterParams",
    
    # Dashboard
    "SupervisorDashboard",
    "DashboardMetrics",
    "TaskSummary",
    
    # Performance
    "PerformanceMetrics",
    "PerformanceReport",
    "PerformanceReview",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\user =====

# --- File: D:\hostel-management-saas\app\schemas\user\user_base.py ---
"""
User base schemas
"""
from datetime import date
from typing import Optional
from pydantic import EmailStr, Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import UserRole, Gender
from app.schemas.common.mixins import AddressMixin, EmergencyContactMixin


class UserBase(BaseSchema):
    """Base user schema"""
    email: EmailStr = Field(..., description="Email address")
    phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$', description="Phone number")
    full_name: str = Field(..., min_length=2, max_length=255, description="Full name")
    user_role: UserRole = Field(..., description="User role")
    gender: Optional[Gender] = Field(None, description="Gender")
    date_of_birth: Optional[date] = Field(None, description="Date of birth")
    profile_image_url: Optional[str] = Field(None, description="Profile image URL")
    
    @field_validator('date_of_birth')
    @classmethod
    def validate_age(cls, v: Optional[date]) -> Optional[date]:
        """Validate user is at least 16 years old"""
        if v:
            from datetime import date
            today = date.today()
            age = today.year - v.year - ((today.month, today.day) < (v.month, v.day))
            if age < 16:
                raise ValueError('User must be at least 16 years old')
            if age > 100:
                raise ValueError('Invalid date of birth')
        return v


class UserCreate(UserBase, BaseCreateSchema):
    """Create user schema"""
    password: str = Field(..., min_length=8, max_length=128, description="Password")
    
    @field_validator('password')
    @classmethod
    def validate_password(cls, v: str) -> str:
        """Validate password strength"""
        if len(v) < 8:
            raise ValueError('Password must be at least 8 characters')
        if not any(c.isdigit() for c in v):
            raise ValueError('Password must contain at least one digit')
        if not any(c.isupper() for c in v):
            raise ValueError('Password must contain at least one uppercase letter')
        if not any(c.islower() for c in v):
            raise ValueError('Password must contain at least one lowercase letter')
        return v


class UserUpdate(BaseUpdateSchema):
    """Update user schema (all fields optional)"""
    email: Optional[EmailStr] = None
    phone: Optional[str] = Field(None, pattern=r'^\+?[1-9]\d{9,14}$')
    full_name: Optional[str] = Field(None, min_length=2, max_length=255)
    gender: Optional[Gender] = None
    date_of_birth: Optional[date] = None
    profile_image_url: Optional[str] = None
    is_active: Optional[bool] = None


class UserAddressUpdate(AddressMixin, BaseUpdateSchema):
    """Update user address"""
    pass


class UserEmergencyContactUpdate(EmergencyContactMixin, BaseUpdateSchema):
    """Update emergency contact information"""
    pass

# --- File: D:\hostel-management-saas\app\schemas\user\user_profile.py ---
"""
User profile update schemas
"""
from datetime import date
from typing import Optional
from pydantic import EmailStr, Field, HttpUrl

from app.schemas.common.base import BaseUpdateSchema
from app.schemas.common.enums import Gender


class ProfileUpdate(BaseUpdateSchema):
    """Update user profile"""
    full_name: Optional[str] = Field(None, min_length=2, max_length=255, description="Full name")
    gender: Optional[Gender] = Field(None, description="Gender")
    date_of_birth: Optional[date] = Field(None, description="Date of birth")
    address_line1: Optional[str] = Field(None, description="Address line 1")
    address_line2: Optional[str] = Field(None, description="Address line 2")
    city: Optional[str] = Field(None, description="City")
    state: Optional[str] = Field(None, description="State")
    pincode: Optional[str] = Field(None, pattern=r'^\d{6}$', description="Pincode")
    country: Optional[str] = Field(None, description="Country")


class ProfileImageUpdate(BaseUpdateSchema):
    """Update profile image"""
    profile_image_url: HttpUrl = Field(..., description="Profile image URL")


class ContactInfoUpdate(BaseUpdateSchema):
    """Update contact information"""
    phone: Optional[str] = Field(None, pattern=r'^\+?[1-9]\d{9,14}$', description="Phone number")
    email: Optional[EmailStr] = Field(None, description="Email address")
    emergency_contact_name: Optional[str] = Field(None, description="Emergency contact name")
    emergency_contact_phone: Optional[str] = Field(None, pattern=r'^\+?[1-9]\d{9,14}$', description="Emergency phone")
    emergency_contact_relation: Optional[str] = Field(None, description="Relation")


class NotificationPreferencesUpdate(BaseUpdateSchema):
    """Update notification preferences"""
    email_notifications: bool = Field(True, description="Enable email notifications")
    sms_notifications: bool = Field(True, description="Enable SMS notifications")
    push_notifications: bool = Field(True, description="Enable push notifications")
    
    # Specific notification types
    booking_notifications: bool = Field(True, description="Booking-related notifications")
    payment_notifications: bool = Field(True, description="Payment notifications")
    complaint_notifications: bool = Field(True, description="Complaint updates")
    announcement_notifications: bool = Field(True, description="Hostel announcements")
    marketing_notifications: bool = Field(False, description="Marketing communications")

# --- File: D:\hostel-management-saas\app\schemas\user\user_response.py ---
"""
User response schemas
"""
from datetime import datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import UserRole, Gender


class UserResponse(BaseResponseSchema):
    """User response schema"""
    email: str = Field(..., description="Email address")
    phone: str = Field(..., description="Phone number")
    full_name: str = Field(..., description="Full name")
    user_role: UserRole = Field(..., description="User role")
    is_active: bool = Field(..., description="Account active status")
    is_email_verified: bool = Field(..., description="Email verification status")
    is_phone_verified: bool = Field(..., description="Phone verification status")
    profile_image_url: Optional[str] = Field(None, description="Profile image URL")
    last_login_at: Optional[datetime] = Field(None, description="Last login timestamp")


class UserDetail(BaseResponseSchema):
    """Detailed user information"""
    email: str = Field(..., description="Email address")
    phone: str = Field(..., description="Phone number")
    full_name: str = Field(..., description="Full name")
    user_role: UserRole = Field(..., description="User role")
    gender: Optional[Gender] = Field(None, description="Gender")
    date_of_birth: Optional[date] = Field(None, description="Date of birth")
    profile_image_url: Optional[str] = Field(None, description="Profile image URL")
    
    # Address
    address_line1: Optional[str] = Field(None, description="Address line 1")
    address_line2: Optional[str] = Field(None, description="Address line 2")
    city: Optional[str] = Field(None, description="City")
    state: Optional[str] = Field(None, description="State")
    country: Optional[str] = Field(None, description="Country")
    pincode: Optional[str] = Field(None, description="Pincode")
    
    # Emergency contact
    emergency_contact_name: Optional[str] = Field(None, description="Emergency contact name")
    emergency_contact_phone: Optional[str] = Field(None, description="Emergency contact phone")
    emergency_contact_relation: Optional[str] = Field(None, description="Relation")
    
    # Account status
    is_active: bool = Field(..., description="Account active status")
    is_email_verified: bool = Field(..., description="Email verification status")
    is_phone_verified: bool = Field(..., description="Phone verification status")
    email_verified_at: Optional[datetime] = Field(None, description="Email verification timestamp")
    phone_verified_at: Optional[datetime] = Field(None, description="Phone verification timestamp")
    last_login_at: Optional[datetime] = Field(None, description="Last login timestamp")


class UserListItem(BaseSchema):
    """User list item (minimal info for lists)"""
    id: UUID = Field(..., description="User ID")
    email: str = Field(..., description="Email")
    full_name: str = Field(..., description="Full name")
    user_role: UserRole = Field(..., description="Role")
    is_active: bool = Field(..., description="Active status")
    profile_image_url: Optional[str] = Field(None, description="Profile image")
    created_at: datetime = Field(..., description="Registration date")


class UserProfile(BaseSchema):
    """User public profile"""
    id: UUID = Field(..., description="User ID")
    full_name: str = Field(..., description="Full name")
    profile_image_url: Optional[str] = Field(None, description="Profile image URL")
    user_role: UserRole = Field(..., description="User role")

# --- File: D:\hostel-management-saas\app\schemas\user\user_session.py ---
"""
User session schemas
"""
from datetime import datetime
from typing import List, Optional
from pydantic import Field, IPvAnyAddress
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema


class UserSession(BaseResponseSchema):
    """User session information"""
    user_id: UUID = Field(..., description="User ID")
    device_info: Optional[dict] = Field(None, description="Device information")
    ip_address: Optional[str] = Field(None, description="IP address")
    is_revoked: bool = Field(False, description="Session revoked status")
    expires_at: datetime = Field(..., description="Session expiration")
    last_activity: datetime = Field(..., description="Last activity timestamp")


class SessionInfo(BaseSchema):
    """Session information for display"""
    session_id: UUID = Field(..., description="Session ID")
    device_name: Optional[str] = Field(None, description="Device name")
    device_type: Optional[str] = Field(None, description="Device type (mobile/desktop/tablet)")
    browser: Optional[str] = Field(None, description="Browser name")
    os: Optional[str] = Field(None, description="Operating system")
    ip_address: Optional[str] = Field(None, description="IP address")
    location: Optional[str] = Field(None, description="Approximate location")
    is_current: bool = Field(False, description="Is current session")
    created_at: datetime = Field(..., description="Session start time")
    last_activity: datetime = Field(..., description="Last activity")
    expires_at: datetime = Field(..., description="Expiration time")


class ActiveSessionsList(BaseSchema):
    """List of active sessions"""
    sessions: List[SessionInfo] = Field(..., description="Active sessions")
    total_sessions: int = Field(..., description="Total number of sessions")


class RevokeSessionRequest(BaseSchema):
    """Revoke specific session"""
    session_id: UUID = Field(..., description="Session ID to revoke")


class RevokeAllSessionsRequest(BaseSchema):
    """Revoke all sessions except current"""
    keep_current: bool = Field(True, description="Keep current session active")

# --- File: D:\hostel-management-saas\app\schemas\user\__init__.py ---
"""
User schemas package
"""
from app.schemas.user.user_base import (
    UserBase,
    UserCreate,
    UserUpdate
)
from app.schemas.user.user_response import (
    UserResponse,
    UserDetail,
    UserListItem,
    UserProfile
)
from app.schemas.user.user_profile import (
    ProfileUpdate,
    ProfileImageUpdate,
    ContactInfoUpdate
)
from app.schemas.user.user_session import (
    UserSession,
    SessionInfo,
    ActiveSessionsList
)

__all__ = [
    # Base
    "UserBase",
    "UserCreate",
    "UserUpdate",
    
    # Response
    "UserResponse",
    "UserDetail",
    "UserListItem",
    "UserProfile",
    
    # Profile
    "ProfileUpdate",
    "ProfileImageUpdate",
    "ContactInfoUpdate",
    
    # Session
    "UserSession",
    "SessionInfo",
    "ActiveSessionsList",
]


# ===== Folder: D:\hostel-management-saas\app\schemas\visitor =====

# --- File: D:\hostel-management-saas\app\schemas\visitor\visitor_base.py ---
"""
Visitor base schemas
"""
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import RoomType


class VisitorBase(BaseSchema):
    """Base visitor schema"""
    user_id: UUID = Field(..., description="Associated user ID")
    
    # Preferences
    preferred_room_type: Optional[RoomType] = Field(None, description="Preferred room type")
    budget_min: Optional[Decimal] = Field(None, ge=0, description="Minimum budget")
    budget_max: Optional[Decimal] = Field(None, ge=0, description="Maximum budget")
    preferred_cities: List[str] = Field(default_factory=list, description="Preferred cities")
    preferred_amenities: List[str] = Field(default_factory=list, description="Must-have amenities")
    
    # Saved/favorite hostels
    favorite_hostel_ids: List[UUID] = Field(default_factory=list, description="Favorite hostel IDs")
    
    # Notification preferences
    email_notifications: bool = Field(True, description="Receive email notifications")
    sms_notifications: bool = Field(True, description="Receive SMS notifications")
    push_notifications: bool = Field(True, description="Receive push notifications")


class VisitorCreate(VisitorBase, BaseCreateSchema):
    """Create visitor profile"""
    pass


class VisitorUpdate(BaseUpdateSchema):
    """Update visitor profile"""
    preferred_room_type: Optional[RoomType] = None
    budget_min: Optional[Decimal] = Field(None, ge=0)
    budget_max: Optional[Decimal] = Field(None, ge=0)
    preferred_cities: Optional[List[str]] = None
    preferred_amenities: Optional[List[str]] = None
    
    # Notification preferences
    email_notifications: Optional[bool] = None
    sms_notifications: Optional[bool] = None
    push_notifications: Optional[bool] = None

# --- File: D:\hostel-management-saas\app\schemas\visitor\visitor_dashboard.py ---
"""
Visitor dashboard schemas
"""
from datetime import datetime
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema


class VisitorDashboard(BaseSchema):
    """Visitor dashboard overview"""
    visitor_id: UUID
    visitor_name: str
    
    # Saved hostels
    saved_hostels: "SavedHostels"
    
    # Booking history
    booking_history: "BookingHistory"
    
    # Recent activity
    recent_searches: List["RecentSearch"] = Field(default_factory=list, max_items=5)
    recently_viewed: List["RecentlyViewedHostel"] = Field(default_factory=list, max_items=10)
    
    # Recommendations
    recommended_hostels: List["RecommendedHostel"] = Field(default_factory=list, max_items=5)
    
    # Alerts
    price_drop_alerts: List["PriceDropAlert"] = Field(default_factory=list)
    availability_alerts: List["AvailabilityAlert"] = Field(default_factory=list)
    
    # Stats
    total_searches: int
    total_hostel_views: int
    total_bookings: int


class SavedHostels(BaseSchema):
    """Saved/favorite hostels"""
    total_saved: int
    hostels: List["SavedHostelItem"] = Field(default_factory=list)


class SavedHostelItem(BaseSchema):
    """Individual saved hostel"""
    hostel_id: UUID
    hostel_name: str
    hostel_city: str
    starting_price: Decimal
    average_rating: Decimal
    available_beds: int
    cover_image_url: Optional[str]
    
    saved_at: datetime
    notes: Optional[str] = Field(None, description="Personal notes about this hostel")
    
    # Price tracking
    price_when_saved: Decimal
    current_price: Decimal
    price_changed: bool
    price_change_percentage: Optional[Decimal]


class BookingHistory(BaseSchema):
    """Booking history summary"""
    total_bookings: int
    active_bookings: int
    completed_bookings: int
    cancelled_bookings: int
    
    bookings: List["BookingHistoryItem"] = Field(default_factory=list)


class BookingHistoryItem(BaseSchema):
    """Individual booking in history"""
    booking_id: UUID
    booking_reference: str
    hostel_id: UUID
    hostel_name: str
    room_type: str
    
    booking_date: datetime
    check_in_date: date
    duration_months: int
    
    status: str
    total_amount: Decimal
    
    # Actions
    can_cancel: bool
    can_modify: bool
    can_review: bool


class RecentSearch(BaseSchema):
    """Recent search item"""
    search_id: UUID
    search_query: Optional[str]
    filters_applied: dict
    results_count: int
    searched_at: datetime


class RecentlyViewedHostel(BaseSchema):
    """Recently viewed hostel"""
    hostel_id: UUID
    hostel_name: str
    hostel_city: str
    starting_price: Decimal
    average_rating: Decimal
    cover_image_url: Optional[str]
    
    viewed_at: datetime
    view_count: int = Field(..., description="Number of times viewed")


class RecommendedHostel(BaseSchema):
    """Recommended hostel based on preferences"""
    hostel_id: UUID
    hostel_name: str
    hostel_city: str
    starting_price: Decimal
    average_rating: Decimal
    available_beds: int
    cover_image_url: Optional[str]
    
    match_score: Decimal = Field(..., ge=0, le=100, description="How well it matches preferences")
    match_reasons: List[str] = Field(..., description="Why it's recommended")


class PriceDropAlert(BaseSchema):
    """Price drop alert"""
    alert_id: UUID
    hostel_id: UUID
    hostel_name: str
    
    previous_price: Decimal
    new_price: Decimal
    discount_percentage: Decimal
    
    alert_created: datetime
    is_read: bool


class AvailabilityAlert(BaseSchema):
    """Availability alert"""
    alert_id: UUID
    hostel_id: UUID
    hostel_name: str
    room_type: str
    
    message: str
    
    alert_created: datetime
    is_read: bool

# --- File: D:\hostel-management-saas\app\schemas\visitor\visitor_favorites.py ---
"""
Visitor favorites/wishlist schemas
"""
from datetime import datetime
from decimal import Decimal
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class FavoriteRequest(BaseCreateSchema):
    """Add/remove hostel from favorites"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    is_favorite: bool = Field(..., description="Add (true) or remove (false)")
    notes: Optional[str] = Field(None, max_length=500, description="Personal notes")


class FavoritesList(BaseSchema):
    """List of favorite hostels"""
    visitor_id: UUID
    total_favorites: int
    favorites: List["FavoriteHostelItem"]


class FavoriteHostelItem(BaseSchema):
    """Individual favorite hostel"""
    favorite_id: UUID
    hostel_id: UUID
    hostel_name: str
    hostel_slug: str
    hostel_city: str
    hostel_type: str
    
    # Pricing
    starting_price_monthly: Decimal
    price_when_saved: Decimal
    current_price: Decimal
    has_price_drop: bool
    price_drop_percentage: Optional[Decimal]
    
    # Availability
    available_beds: int
    has_availability: bool
    
    # Rating
    average_rating: Decimal
    total_reviews: int
    
    # Media
    cover_image_url: Optional[str]
    
    # Favorite metadata
    notes: Optional[str]
    added_to_favorites: datetime
    
    # Tracking
    times_viewed: int
    last_viewed: Optional[datetime]


class FavoriteUpdate(BaseCreateSchema):
    """Update favorite notes"""
    favorite_id: UUID
    notes: str = Field(..., max_length=500)


class FavoritesExport(BaseSchema):
    """Export favorites list"""
    format: str = Field("pdf", pattern="^(pdf|csv|json)$")
    include_prices: bool = Field(True)
    include_notes: bool = Field(True)


class FavoriteComparison(BaseSchema):
    """Compare favorite hostels"""
    favorite_ids: List[UUID] = Field(..., min_items=2, max_items=4, description="2-4 favorites to compare")

# --- File: D:\hostel-management-saas\app\schemas\visitor\visitor_preferences.py ---
"""
Visitor preferences schemas
"""
from decimal import Decimal
from typing import List, Optional
from pydantic import Field, field_validator

from app.schemas.common.base import BaseSchema, BaseUpdateSchema
from app.schemas.common.enums import RoomType, HostelType, DietaryPreference


class VisitorPreferences(BaseSchema):
    """Complete visitor preferences"""
    # Room preferences
    preferred_room_type: Optional[RoomType] = None
    preferred_hostel_type: Optional[HostelType] = None
    
    # Budget
    budget_min: Optional[Decimal] = Field(None, ge=0)
    budget_max: Optional[Decimal] = Field(None, ge=0)
    
    # Location
    preferred_cities: List[str] = Field(default_factory=list)
    preferred_areas: List[str] = Field(default_factory=list)
    max_distance_from_work_km: Optional[Decimal] = Field(None, ge=0, le=50)
    
    # Amenities (must-have)
    required_amenities: List[str] = Field(default_factory=list)
    preferred_amenities: List[str] = Field(default_factory=list)
    
    # Facilities
    need_parking: bool = Field(False)
    need_gym: bool = Field(False)
    need_laundry: bool = Field(False)
    need_mess: bool = Field(False)
    
    # Dietary
    dietary_preference: Optional[DietaryPreference] = None
    
    # Move-in
    earliest_move_in_date: Optional[date] = None
    preferred_lease_duration_months: Optional[int] = Field(None, ge=1, le=24)
    
    # Notifications
    email_notifications: bool = Field(True)
    sms_notifications: bool = Field(True)
    push_notifications: bool = Field(True)
    
    # Specific notification types
    notify_on_price_drop: bool = Field(True, description="Notify when saved hostel reduces price")
    notify_on_availability: bool = Field(True, description="Notify when saved hostel has availability")
    notify_on_new_listings: bool = Field(True, description="Notify about new matching hostels")
    
    @field_validator('budget_max')
    @classmethod
    def validate_budget(cls, v: Optional[Decimal], info) -> Optional[Decimal]:
        """Validate budget_max >= budget_min"""
        if v and info.data.get('budget_min'):
            if v < info.data['budget_min']:
                raise ValueError('Maximum budget must be >= minimum budget')
        return v


class PreferenceUpdate(BaseUpdateSchema):
    """Update visitor preferences"""
    preferred_room_type: Optional[RoomType] = None
    preferred_hostel_type: Optional[HostelType] = None
    budget_min: Optional[Decimal] = Field(None, ge=0)
    budget_max: Optional[Decimal] = Field(None, ge=0)
    preferred_cities: Optional[List[str]] = None
    required_amenities: Optional[List[str]] = None
    dietary_preference: Optional[DietaryPreference] = None
    
    # Notification toggles
    email_notifications: Optional[bool] = None
    sms_notifications: Optional[bool] = None
    push_notifications: Optional[bool] = None
    notify_on_price_drop: Optional[bool] = None
    notify_on_availability: Optional[bool] = None
    notify_on_new_listings: Optional[bool] = None


class SearchPreferences(BaseSchema):
    """Saved search preferences"""
    search_name: str = Field(..., min_length=3, max_length=100, description="Name for this saved search")
    
    # Search criteria
    cities: List[str] = Field(default_factory=list)
    room_types: List[RoomType] = Field(default_factory=list)
    min_price: Optional[Decimal] = None
    max_price: Optional[Decimal] = None
    amenities: List[str] = Field(default_factory=list)
    
    # Alert settings
    notify_on_new_matches: bool = Field(True, description="Notify when new hostels match criteria")
    notification_frequency: str = Field(
        "daily",
        pattern="^(instant|daily|weekly)$",
        description="How often to send notifications"
    )


class SavedSearch(BaseSchema):
    """Saved search with ID"""
    id: UUID
    visitor_id: UUID
    search_name: str
    criteria: dict = Field(..., description="Search criteria as JSON")
    notify_on_new_matches: bool
    notification_frequency: str
    
    # Stats
    total_matches: int = Field(0, description="Current number of matching hostels")
    new_matches_since_last_check: int = Field(0)
    
    created_at: datetime
    last_checked: Optional[datetime]

# --- File: D:\hostel-management-saas\app\schemas\visitor\visitor_response.py ---
"""
Visitor response schemas
"""
from decimal import Decimal
from datetime import datetime
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import RoomType


class VisitorResponse(BaseResponseSchema):
    """Visitor response schema"""
    user_id: UUID
    full_name: str
    email: str
    phone: str
    
    # Preferences
    preferred_room_type: Optional[RoomType]
    budget_min: Optional[Decimal]
    budget_max: Optional[Decimal]
    preferred_cities: List[str]
    
    # Stats
    total_bookings: int = Field(0, description="Total bookings made")
    saved_hostels_count: int = Field(0, description="Number of saved hostels")
    
    # Notification preferences
    email_notifications: bool
    sms_notifications: bool
    push_notifications: bool


class VisitorProfile(BaseSchema):
    """Visitor public profile"""
    id: UUID
    user_id: UUID
    full_name: str
    profile_image_url: Optional[str]
    member_since: datetime


class VisitorDetail(BaseResponseSchema):
    """Detailed visitor information"""
    # User info
    user_id: UUID
    full_name: str
    email: str
    phone: str
    profile_image_url: Optional[str]
    
    # Preferences
    preferred_room_type: Optional[RoomType]
    budget_min: Optional[Decimal]
    budget_max: Optional[Decimal]
    preferred_cities: List[str]
    preferred_amenities: List[str]
    
    # Saved hostels
    favorite_hostel_ids: List[UUID]
    total_saved_hostels: int
    
    # Activity
    total_bookings: int
    completed_bookings: int
    cancelled_bookings: int
    total_inquiries: int
    
    # Reviews
    total_reviews_written: int
    average_rating_given: Optional[Decimal]
    
    # Notification preferences
    email_notifications: bool
    sms_notifications: bool
    push_notifications: bool
    
    # Account info
    created_at: datetime
    last_login: Optional[datetime]


class VisitorStats(BaseSchema):
    """Visitor statistics"""
    visitor_id: UUID
    
    # Search activity
    total_searches: int
    unique_hostels_viewed: int
    average_search_filters_used: Decimal
    
    # Engagement
    total_hostel_views: int
    total_comparisons: int
    total_inquiries: int
    
    # Bookings
    total_bookings: int
    booking_conversion_rate: Decimal = Field(..., description="% of views that became bookings")
    
    # Preferences insight
    most_searched_city: Optional[str]
    most_viewed_room_type: Optional[RoomType]
    average_budget: Optional[Decimal]

# --- File: D:\hostel-management-saas\app\schemas\visitor\__init__.py ---
"""
Visitor schemas package
"""
from app.schemas.visitor.visitor_base import (
    VisitorBase,
    VisitorCreate,
    VisitorUpdate
)
from app.schemas.visitor.visitor_response import (
    VisitorResponse,
    VisitorProfile,
    VisitorDetail
)
from app.schemas.visitor.visitor_preferences import (
    VisitorPreferences,
    PreferenceUpdate,
    SearchPreferences
)
from app.schemas.visitor.visitor_dashboard import (
    VisitorDashboard,
    SavedHostels,
    BookingHistory
)
from app.schemas.visitor.visitor_favorites import (
    FavoriteRequest,
    FavoritesList,
    FavoriteHostelItem
)

__all__ = [
    # Base
    "VisitorBase",
    "VisitorCreate",
    "VisitorUpdate",
    
    # Response
    "VisitorResponse",
    "VisitorProfile",
    "VisitorDetail",
    
    # Preferences
    "VisitorPreferences",
    "PreferenceUpdate",
    "SearchPreferences",
    
    # Dashboard
    "VisitorDashboard",
    "SavedHostels",
    "BookingHistory",
    
    # Favorites
    "FavoriteRequest",
    "FavoritesList",
    "FavoriteHostelItem",
]
