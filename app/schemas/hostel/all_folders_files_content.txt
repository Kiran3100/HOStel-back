### Combined Content from Folder: C:\Users\HP\OneDrive\Documents\GitHub\HOStel-back\app\schemas\hostel ###



# ===== Folder: C:\Users\HP\OneDrive\Documents\GitHub\HOStel-back\app\schemas\hostel =====

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\HOStel-back\app\schemas\hostel\hostel_admin.py ---
# --- File: app/schemas/hostel/hostel_admin.py ---
"""
Hostel admin view schemas with enhanced configuration options.
"""

from __future__ import annotations

from datetime import datetime
from decimal import Decimal
from typing import Optional

from pydantic import Field, field_validator

from app.schemas.common.base import BaseSchema, BaseUpdateSchema
from app.schemas.common.enums import HostelStatus, SubscriptionPlan, SubscriptionStatus

__all__ = [
    "HostelAdminView",
    "HostelSettings",
    "HostelVisibilityUpdate",
    "HostelCapacityUpdate",
    "HostelStatusUpdate",
]


class HostelAdminView(BaseSchema):
    """
    Comprehensive hostel view for administrators.
    
    Provides complete hostel information with statistics and metrics.
    """

    id: str = Field(..., description="Hostel ID")
    name: str = Field(..., description="Hostel name")
    slug: str = Field(..., description="URL slug")

    # Status
    status: HostelStatus = Field(..., description="Operational status")
    is_active: bool = Field(..., description="Active status")
    is_public: bool = Field(..., description="Public listing visibility")
    is_featured: bool = Field(..., description="Featured in listings")
    is_verified: bool = Field(..., description="Verification status")

    # Capacity stats
    total_rooms: int = Field(..., ge=0, description="Total number of rooms")
    total_beds: int = Field(..., ge=0, description="Total number of beds")
    occupied_beds: int = Field(..., ge=0, description="Currently occupied beds")
    available_beds: int = Field(..., ge=0, description="Available beds")
    occupancy_percentage: Decimal = Field(
        ...,
        ge=0,
        le=100,
        description="Current occupancy percentage",
    )

    # Students
    total_students: int = Field(
        ...,
        ge=0,
        description="Total registered students",
    )
    active_students: int = Field(
        ...,
        ge=0,
        description="Currently active students",
    )

    # Financial
    total_revenue_this_month: Decimal = Field(
        ...,
        ge=0,
        description="Total revenue for current month",
    )
    outstanding_payments: Decimal = Field(
        ...,
        ge=0,
        description="Total outstanding payment amount",
    )

    # Pending items
    pending_bookings: int = Field(
        ...,
        ge=0,
        description="Number of pending booking requests",
    )
    pending_complaints: int = Field(
        ...,
        ge=0,
        description="Number of open/pending complaints",
    )
    pending_maintenance: int = Field(
        ...,
        ge=0,
        description="Number of pending maintenance requests",
    )

    # Subscription
    subscription_plan: Optional[SubscriptionPlan] = Field(
        default=None,
        description="Current subscription plan",
    )
    subscription_status: Optional[SubscriptionStatus] = Field(
        default=None,
        description="Subscription status",
    )
    subscription_expires_at: Optional[datetime] = Field(
        default=None,
        description="Subscription expiration date",
    )

    # Performance
    average_rating: Decimal = Field(
        ...,
        ge=0,
        le=5,
        description="Average rating from reviews",
    )
    total_reviews: int = Field(
        ...,
        ge=0,
        description="Total number of reviews",
    )


class HostelSettings(BaseUpdateSchema):
    """
    Hostel configuration settings.
    
    Manages hostel operational and behavioral settings.
    """

    # Visibility
    is_public: Optional[bool] = Field(
        default=None,
        description="Make hostel visible in public listings",
    )
    is_active: Optional[bool] = Field(
        default=None,
        description="Hostel operational status",
    )

    # Booking settings
    auto_approve_bookings: bool = Field(
        default=False,
        description="Automatically approve booking requests",
    )
    booking_advance_percentage: Decimal = Field(
        default=Decimal("20.00"),
        ge=0,
        le=100,
        description="Required advance payment percentage",
    )
    max_booking_duration_months: int = Field(
        default=12,
        ge=1,
        le=24,
        description="Maximum booking duration in months",
    )
    min_booking_duration_days: int = Field(
        default=30,
        ge=1,
        le=365,
        description="Minimum booking duration in days",
    )

    # Payment settings
    payment_due_day: int = Field(
        default=5,
        ge=1,
        le=28,
        description="Monthly payment due date",
    )
    late_payment_grace_days: int = Field(
        default=3,
        ge=0,
        le=10,
        description="Grace period for late payments (days)",
    )
    late_payment_penalty_percentage: Decimal = Field(
        default=Decimal("5.00"),
        ge=0,
        le=50,
        description="Late payment penalty percentage",
    )

    # Attendance settings
    enable_attendance_tracking: bool = Field(
        default=True,
        description="Enable attendance tracking system",
    )
    minimum_attendance_percentage: Decimal = Field(
        default=Decimal("75.00"),
        ge=0,
        le=100,
        description="Minimum required attendance percentage",
    )
    attendance_grace_period_days: int = Field(
        default=7,
        ge=0,
        le=30,
        description="Attendance tracking grace period for new students",
    )

    # Notification settings
    notify_on_booking: bool = Field(
        default=True,
        description="Send notifications for new bookings",
    )
    notify_on_complaint: bool = Field(
        default=True,
        description="Send notifications for new complaints",
    )
    notify_on_payment: bool = Field(
        default=True,
        description="Send notifications for payments",
    )
    notify_on_maintenance: bool = Field(
        default=True,
        description="Send notifications for maintenance requests",
    )

    # Mess settings
    mess_included: bool = Field(
        default=False,
        description="Mess facility included in rent",
    )
    mess_charges_monthly: Optional[Decimal] = Field(
        default=None,
        ge=0,
        description="Monthly mess charges (if separate)",
    )
    mess_advance_booking_days: int = Field(
        default=1,
        ge=0,
        le=7,
        description="Days in advance for mess meal booking",
    )

    # Security settings
    visitor_entry_time_start: Optional[str] = Field(
        default=None,
        pattern=r"^([01]?[0-9]|2[0-3]):[0-5][0-9]$",
        description="Visitor entry allowed from (HH:MM)",
    )
    visitor_entry_time_end: Optional[str] = Field(
        default=None,
        pattern=r"^([01]?[0-9]|2[0-3]):[0-5][0-9]$",
        description="Visitor entry allowed until (HH:MM)",
    )
    late_entry_time: Optional[str] = Field(
        default=None,
        pattern=r"^([01]?[0-9]|2[0-3]):[0-5][0-9]$",
        description="Late entry cutoff time (HH:MM)",
    )


class HostelVisibilityUpdate(BaseUpdateSchema):
    """
    Update hostel visibility settings.
    
    Controls hostel appearance in public listings and searches.
    """

    is_public: bool = Field(
        ...,
        description="Make hostel publicly visible",
    )
    is_featured: bool = Field(
        default=False,
        description="Feature hostel in search results",
    )
    is_verified: bool = Field(
        default=False,
        description="Mark hostel as verified (admin only)",
    )


class HostelCapacityUpdate(BaseUpdateSchema):
    """
    Update hostel capacity information.
    
    Admin-only operation to modify hostel capacity.
    """

    total_rooms: int = Field(
        ...,
        ge=1,
        description="Total number of rooms",
    )
    total_beds: int = Field(
        ...,
        ge=1,
        description="Total number of beds",
    )

    @field_validator("total_beds")
    @classmethod
    def validate_beds_vs_rooms(cls, v: int, info) -> int:
        """Validate that total beds is reasonable compared to rooms."""
        total_rooms = info.data.get("total_rooms")
        if total_rooms is not None and v < total_rooms:
            raise ValueError(
                "Total beds cannot be less than total rooms"
            )
        if total_rooms is not None and v > (total_rooms * 8):
            raise ValueError(
                "Total beds seems unreasonably high compared to rooms"
            )
        return v


class HostelStatusUpdate(BaseUpdateSchema):
    """
    Update hostel operational status.
    
    Tracks status changes with reason.
    """

    status: HostelStatus = Field(
        ...,
        description="New hostel status",
    )
    is_active: bool = Field(
        ...,
        description="Active status",
    )
    reason: Optional[str] = Field(
        default=None,
        min_length=10,
        max_length=500,
        description="Reason for status change",
    )
    effective_date: Optional[datetime] = Field(
        default=None,
        description="Effective date of status change",
    )

    @field_validator("reason")
    @classmethod
    def validate_reason_required(cls, v: Optional[str], info) -> Optional[str]:
        """Require reason for certain status changes."""
        status = info.data.get("status")
        is_active = info.data.get("is_active")
        
        # Require reason if deactivating or setting to maintenance/closed
        if (
            is_active is False
            or status in [HostelStatus.UNDER_MAINTENANCE, HostelStatus.CLOSED]
        ) and not v:
            raise ValueError(
                "Reason is required when deactivating or changing to "
                "maintenance/closed status"
            )
        return v

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\HOStel-back\app\schemas\hostel\hostel_analytics.py ---
# --- File: app/schemas/hostel/hostel_analytics.py ---
"""
Hostel analytics and reporting schemas with comprehensive metrics.
"""

from __future__ import annotations

from datetime import date, datetime
from decimal import Decimal
from typing import Dict, List, Optional
from uuid import UUID

from pydantic import Field, field_validator, model_validator

from app.schemas.common.base import BaseSchema
from app.schemas.common.filters import DateRangeFilter

__all__ = [
    "HostelAnalytics",
    "OccupancyAnalytics",
    "OccupancyDataPoint",
    "RevenueAnalytics",
    "RevenueDataPoint",
    "BookingAnalytics",
    "BookingDataPoint",
    "ComplaintAnalytics",
    "ReviewAnalytics",
    "RatingDataPoint",
    "HostelOccupancyStats",
    "RoomTypeOccupancy",
    "HostelRevenueStats",
    "MonthlyRevenue",
    "AnalyticsRequest",
]


class OccupancyDataPoint(BaseSchema):
    """
    Single occupancy data point for trends.
    
    Represents occupancy at a specific point in time.
    """

    data_date: date = Field(..., description="Date of the data point")
    occupancy_rate: Decimal = Field(
        ...,
        ge=0,
        le=100,
        description="Occupancy rate percentage",
    )
    occupied_beds: int = Field(
        ...,
        ge=0,
        description="Number of occupied beds",
    )
    total_beds: int = Field(
        ...,
        ge=1,
        description="Total available beds",
    )


class OccupancyAnalytics(BaseSchema):
    """
    Comprehensive occupancy analytics.
    
    Provides detailed occupancy metrics and trends.
    """

    current_occupancy_rate: Decimal = Field(
        ...,
        ge=0,
        le=100,
        description="Current occupancy percentage",
    )
    average_occupancy_rate: Decimal = Field(
        ...,
        ge=0,
        le=100,
        description="Average occupancy for the period",
    )
    peak_occupancy_rate: Decimal = Field(
        ...,
        ge=0,
        le=100,
        description="Peak occupancy during period",
    )
    lowest_occupancy_rate: Decimal = Field(
        ...,
        ge=0,
        le=100,
        description="Lowest occupancy during period",
    )

    total_beds: int = Field(
        ...,
        ge=0,
        description="Total bed capacity",
    )
    occupied_beds: int = Field(
        ...,
        ge=0,
        description="Currently occupied beds",
    )
    available_beds: int = Field(
        ...,
        ge=0,
        description="Currently available beds",
    )

    # Trends
    occupancy_trend: List[OccupancyDataPoint] = Field(
        default_factory=list,
        description="Historical occupancy trend",
    )

    # Predictions
    predicted_occupancy_next_month: Optional[Decimal] = Field(
        default=None,
        ge=0,
        le=100,
        description="Predicted occupancy for next month",
    )
    trend_direction: str = Field(
        ...,
        pattern=r"^(increasing|decreasing|stable)$",
        description="Overall occupancy trend direction",
    )


class RevenueDataPoint(BaseSchema):
    """
    Single revenue data point.
    
    Represents revenue metrics at a specific point in time.
    """

    data_date: date = Field(..., description="Date of the data point")
    revenue: Decimal = Field(
        ...,
        ge=0,
        description="Total revenue",
    )
    collected: Decimal = Field(
        ...,
        ge=0,
        description="Amount collected",
    )
    pending: Decimal = Field(
        ...,
        ge=0,
        description="Amount pending",
    )


class RevenueAnalytics(BaseSchema):
    """
    Comprehensive revenue analytics.
    
    Provides detailed financial metrics and trends.
    """

    total_revenue: Decimal = Field(
        ...,
        ge=0,
        description="Total revenue for period",
    )
    rent_revenue: Decimal = Field(
        ...,
        ge=0,
        description="Revenue from rent",
    )
    mess_revenue: Decimal = Field(
        ...,
        ge=0,
        description="Revenue from mess charges",
    )
    other_revenue: Decimal = Field(
        ...,
        ge=0,
        description="Revenue from other sources",
    )

    total_collected: Decimal = Field(
        ...,
        ge=0,
        description="Total amount collected",
    )
    total_pending: Decimal = Field(
        ...,
        ge=0,
        description="Total amount pending",
    )
    total_overdue: Decimal = Field(
        ...,
        ge=0,
        description="Total overdue amount",
    )

    collection_rate: Decimal = Field(
        ...,
        ge=0,
        le=100,
        description="Payment collection rate percentage",
    )

    # Trends
    revenue_trend: List[RevenueDataPoint] = Field(
        default_factory=list,
        description="Historical revenue trend",
    )

    # Comparisons
    revenue_vs_last_period: Decimal = Field(
        ...,
        description="Percentage change from last period",
    )
    revenue_vs_last_year: Optional[Decimal] = Field(
        default=None,
        description="Year-over-year percentage change",
    )

    # Additional metrics
    average_revenue_per_bed: Decimal = Field(
        ...,
        ge=0,
        description="Average revenue per occupied bed",
    )


class BookingDataPoint(BaseSchema):
    """
    Single booking data point.
    
    Represents booking metrics at a specific point in time.
    """

    data_date: date = Field(..., description="Date of the data point")
    total_bookings: int = Field(
        ...,
        ge=0,
        description="Total bookings",
    )
    approved: int = Field(
        ...,
        ge=0,
        description="Approved bookings",
    )
    rejected: int = Field(
        ...,
        ge=0,
        description="Rejected bookings",
    )


class BookingAnalytics(BaseSchema):
    """
    Comprehensive booking analytics.
    
    Provides detailed booking metrics and conversion rates.
    """

    total_bookings: int = Field(
        ...,
        ge=0,
        description="Total booking requests",
    )
    approved_bookings: int = Field(
        ...,
        ge=0,
        description="Approved bookings",
    )
    pending_bookings: int = Field(
        ...,
        ge=0,
        description="Pending bookings",
    )
    rejected_bookings: int = Field(
        ...,
        ge=0,
        description="Rejected bookings",
    )
    cancelled_bookings: int = Field(
        ...,
        ge=0,
        description="Cancelled bookings",
    )

    conversion_rate: Decimal = Field(
        ...,
        ge=0,
        le=100,
        description="Booking approval rate percentage",
    )
    cancellation_rate: Decimal = Field(
        ...,
        ge=0,
        le=100,
        description="Cancellation rate percentage",
    )

    # Sources
    booking_sources: Dict[str, int] = Field(
        default_factory=dict,
        description="Bookings by source (website, app, etc.)",
    )

    # Trends
    booking_trend: List[BookingDataPoint] = Field(
        default_factory=list,
        description="Historical booking trend",
    )

    # Average metrics
    average_booking_value: Decimal = Field(
        ...,
        ge=0,
        description="Average booking value",
    )


class ComplaintAnalytics(BaseSchema):
    """
    Comprehensive complaint analytics.
    
    Provides detailed complaint metrics and resolution statistics.
    """

    total_complaints: int = Field(
        ...,
        ge=0,
        description="Total complaints",
    )
    open_complaints: int = Field(
        ...,
        ge=0,
        description="Currently open complaints",
    )
    resolved_complaints: int = Field(
        ...,
        ge=0,
        description="Resolved complaints",
    )
    closed_complaints: int = Field(
        ...,
        ge=0,
        description="Closed complaints",
    )

    average_resolution_time_hours: Decimal = Field(
        ...,
        ge=0,
        description="Average time to resolve (hours)",
    )
    resolution_rate: Decimal = Field(
        ...,
        ge=0,
        le=100,
        description="Percentage of resolved complaints",
    )

    # By category
    complaints_by_category: Dict[str, int] = Field(
        default_factory=dict,
        description="Complaints grouped by category",
    )

    # By priority
    complaints_by_priority: Dict[str, int] = Field(
        default_factory=dict,
        description="Complaints grouped by priority",
    )

    # SLA compliance
    sla_compliance_rate: Decimal = Field(
        ...,
        ge=0,
        le=100,
        description="Percentage meeting SLA",
    )
    sla_breaches: int = Field(
        ...,
        ge=0,
        description="Number of SLA breaches",
    )


class RatingDataPoint(BaseSchema):
    """
    Single rating data point.
    
    Represents rating metrics for a period.
    """

    month: str = Field(
        ...,
        pattern=r"^\d{4}-\d{2}$",
        description="Month in YYYY-MM format",
    )
    average_rating: Decimal = Field(
        ...,
        ge=0,
        le=5,
        description="Average rating",
    )
    review_count: int = Field(
        ...,
        ge=0,
        description="Number of reviews",
    )


class ReviewAnalytics(BaseSchema):
    """
    Comprehensive review analytics.
    
    Provides detailed review and rating statistics.
    """

    total_reviews: int = Field(
        ...,
        ge=0,
        description="Total number of reviews",
    )
    average_rating: Decimal = Field(
        ...,
        ge=0,
        le=5,
        description="Overall average rating",
    )

    # Rating distribution
    rating_distribution: Dict[str, int] = Field(
        default_factory=dict,
        description="Count of ratings by star (1-5)",
    )

    # Detailed aspect ratings
    average_cleanliness_rating: Optional[Decimal] = Field(
        default=None,
        ge=0,
        le=5,
        description="Average cleanliness rating",
    )
    average_food_quality_rating: Optional[Decimal] = Field(
        default=None,
        ge=0,
        le=5,
        description="Average food quality rating",
    )
    average_staff_behavior_rating: Optional[Decimal] = Field(
        default=None,
        ge=0,
        le=5,
        description="Average staff behavior rating",
    )
    average_security_rating: Optional[Decimal] = Field(
        default=None,
        ge=0,
        le=5,
        description="Average security rating",
    )
    average_value_rating: Optional[Decimal] = Field(
        default=None,
        ge=0,
        le=5,
        description="Average value for money rating",
    )

    # Trends
    rating_trend: List[RatingDataPoint] = Field(
        default_factory=list,
        description="Historical rating trend",
    )

    # Sentiment
    positive_reviews: int = Field(
        ...,
        ge=0,
        description="Number of positive reviews (4-5 stars)",
    )
    negative_reviews: int = Field(
        ...,
        ge=0,
        description="Number of negative reviews (1-2 stars)",
    )
    sentiment_score: Decimal = Field(
        ...,
        ge=-1,
        le=1,
        description="Overall sentiment score (-1 to 1)",
    )


class HostelAnalytics(BaseSchema):
    """
    Comprehensive hostel analytics dashboard.
    
    Aggregates all analytics for a hostel over a period.
    """

    hostel_id: UUID = Field(..., description="Hostel ID")
    hostel_name: str = Field(..., description="Hostel name")
    period_start: date = Field(..., description="Analytics period start")
    period_end: date = Field(..., description="Analytics period end")

    occupancy: OccupancyAnalytics = Field(
        ...,
        description="Occupancy analytics",
    )
    revenue: RevenueAnalytics = Field(
        ...,
        description="Revenue analytics",
    )
    bookings: BookingAnalytics = Field(
        ...,
        description="Booking analytics",
    )
    complaints: ComplaintAnalytics = Field(
        ...,
        description="Complaint analytics",
    )
    reviews: ReviewAnalytics = Field(
        ...,
        description="Review analytics",
    )

    generated_at: datetime = Field(
        ...,
        description="Analytics generation timestamp",
    )


class RoomTypeOccupancy(BaseSchema):
    """
    Occupancy statistics by room type.
    
    Provides occupancy breakdown for different room types.
    """

    room_type: str = Field(
        ...,
        description="Room type (single, double, etc.)",
    )
    total_beds: int = Field(
        ...,
        ge=0,
        description="Total beds of this type",
    )
    occupied_beds: int = Field(
        ...,
        ge=0,
        description="Occupied beds of this type",
    )
    available_beds: int = Field(
        ...,
        ge=0,
        description="Available beds of this type",
    )
    occupancy_percentage: Decimal = Field(
        ...,
        ge=0,
        le=100,
        description="Occupancy percentage for this type",
    )


class HostelOccupancyStats(BaseSchema):
    """
    Detailed occupancy statistics with breakdowns and projections.
    
    Provides comprehensive occupancy analysis.
    """

    hostel_id: UUID = Field(..., description="Hostel ID")

    # Current status
    total_rooms: int = Field(
        ...,
        ge=0,
        description="Total number of rooms",
    )
    total_beds: int = Field(
        ...,
        ge=0,
        description="Total number of beds",
    )
    occupied_beds: int = Field(
        ...,
        ge=0,
        description="Currently occupied beds",
    )
    available_beds: int = Field(
        ...,
        ge=0,
        description="Currently available beds",
    )
    occupancy_percentage: Decimal = Field(
        ...,
        ge=0,
        le=100,
        description="Current occupancy percentage",
    )

    # By room type
    occupancy_by_room_type: List[RoomTypeOccupancy] = Field(
        default_factory=list,
        description="Occupancy breakdown by room type",
    )

    # Historical
    occupancy_history: List[OccupancyDataPoint] = Field(
        default_factory=list,
        description="Historical occupancy data",
    )

    # Projections
    projected_occupancy_30_days: Optional[Decimal] = Field(
        default=None,
        ge=0,
        le=100,
        description="Projected occupancy in 30 days",
    )
    projected_occupancy_90_days: Optional[Decimal] = Field(
        default=None,
        ge=0,
        le=100,
        description="Projected occupancy in 90 days",
    )


class MonthlyRevenue(BaseSchema):
    """
    Monthly revenue breakdown with detailed metrics.
    
    Represents revenue for a single month.
    """

    month: str = Field(
        ...,
        pattern=r"^\d{4}-\d{2}$",
        description="Month in YYYY-MM format",
    )
    revenue: Decimal = Field(
        ...,
        ge=0,
        description="Total revenue",
    )
    collected: Decimal = Field(
        ...,
        ge=0,
        description="Amount collected",
    )
    pending: Decimal = Field(
        ...,
        ge=0,
        description="Amount pending",
    )
    student_count: int = Field(
        ...,
        ge=0,
        description="Number of students",
    )
    average_revenue_per_student: Decimal = Field(
        ...,
        ge=0,
        description="Average revenue per student",
    )


class HostelRevenueStats(BaseSchema):
    """
    Detailed revenue statistics with breakdowns and growth metrics.
    
    Provides comprehensive financial analysis.
    """

    hostel_id: UUID = Field(..., description="Hostel ID")
    period: DateRangeFilter = Field(
        ...,
        description="Analysis period",
    )

    # Totals
    total_revenue: Decimal = Field(
        ...,
        ge=0,
        description="Total revenue for period",
    )
    total_expenses: Decimal = Field(
        ...,
        ge=0,
        description="Total expenses for period",
    )
    net_profit: Decimal = Field(
        ...,
        description="Net profit (can be negative)",
    )
    profit_margin: Decimal = Field(
        ...,
        ge=-100,
        le=100,
        description="Profit margin percentage",
    )

    # Revenue breakdown
    revenue_by_type: Dict[str, Decimal] = Field(
        default_factory=dict,
        description="Revenue breakdown by type (rent, mess, etc.)",
    )

    # Collection
    total_collected: Decimal = Field(
        ...,
        ge=0,
        description="Total amount collected",
    )
    total_pending: Decimal = Field(
        ...,
        ge=0,
        description="Total amount pending",
    )
    total_overdue: Decimal = Field(
        ...,
        ge=0,
        description="Total overdue amount",
    )
    collection_efficiency: Decimal = Field(
        ...,
        ge=0,
        le=100,
        description="Collection efficiency percentage",
    )

    # Monthly breakdown
    monthly_revenue: List[MonthlyRevenue] = Field(
        default_factory=list,
        description="Month-by-month revenue breakdown",
    )

    # Comparison
    revenue_growth_mom: Decimal = Field(
        ...,
        description="Month-over-month growth percentage",
    )
    revenue_growth_yoy: Optional[Decimal] = Field(
        default=None,
        description="Year-over-year growth percentage",
    )


class AnalyticsRequest(BaseSchema):
    """
    Request schema for generating analytics.
    
    Specifies parameters for analytics generation.
    """

    hostel_id: UUID = Field(..., description="Hostel ID")
    start_date: date = Field(..., description="Analytics start date")
    end_date: date = Field(..., description="Analytics end date")
    include_predictions: bool = Field(
        default=False,
        description="Include predictive analytics",
    )
    granularity: str = Field(
        default="daily",
        pattern=r"^(daily|weekly|monthly)$",
        description="Data granularity",
    )

    @model_validator(mode="after")
    def validate_date_range(self) -> "AnalyticsRequest":
        """Validate date range is reasonable."""
        if self.end_date < self.start_date:
            raise ValueError("end_date must be after or equal to start_date")
        
        # Check if date range is not too large (max 2 years)
        days_diff = (self.end_date - self.start_date).days
        if days_diff > 730:  # 2 years
            raise ValueError("Date range cannot exceed 2 years")
        
        return self

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\HOStel-back\app\schemas\hostel\hostel_base.py ---
# --- File: app/schemas/hostel/hostel_base.py ---
"""
Hostel base schemas with enhanced validation and type safety.
"""

from __future__ import annotations

from datetime import time
from decimal import Decimal
from typing import Dict, List, Optional

from pydantic import Field, HttpUrl, field_validator, model_validator

from app.schemas.common.base import (
    BaseCreateSchema,
    BaseSchema,
    BaseUpdateSchema,
)
from app.schemas.common.enums import HostelStatus, HostelType
from app.schemas.common.mixins import AddressMixin, ContactMixin, LocationMixin

__all__ = [
    "HostelBase",
    "HostelCreate",
    "HostelUpdate",
    "HostelMediaUpdate",
    "HostelSEOUpdate",
]


class HostelBase(BaseSchema, AddressMixin, ContactMixin, LocationMixin):
    """
    Base hostel schema with common fields.
    
    Combines address, contact, and location information with hostel-specific fields.
    """

    name: str = Field(
        ...,
        min_length=3,
        max_length=255,
        description="Hostel name",
        examples=["Green Valley Hostel"],
    )
    slug: str = Field(
        ...,
        min_length=3,
        max_length=255,
        pattern=r"^[a-z0-9-]+$",
        description="URL-friendly slug (lowercase, alphanumeric, hyphens only)",
        examples=["green-valley-hostel"],
    )
    description: Optional[str] = Field(
        default=None,
        max_length=2000,
        description="Detailed hostel description",
    )

    # Type
    hostel_type: HostelType = Field(
        ...,
        description="Hostel type (boys/girls/co-ed)",
    )

    # Website
    website_url: Optional[HttpUrl] = Field(
        default=None,
        description="Hostel official website URL",
    )

    # Pricing
    starting_price_monthly: Optional[Decimal] = Field(
        default=None,
        ge=0,
        max_digits=10,
        decimal_places=2,
        description="Starting monthly price (lowest room type)",
    )
    currency: str = Field(
        default="INR",
        min_length=3,
        max_length=3,
        pattern=r"^[A-Z]{3}$",
        description="Currency code (ISO 4217)",
        examples=["INR", "USD"],
    )

    # Amenities and facilities
    amenities: List[str] = Field(
        default_factory=list,
        description="List of amenities (WiFi, AC, etc.)",
        examples=[["WiFi", "AC", "Laundry", "Hot Water"]],
    )
    facilities: List[str] = Field(
        default_factory=list,
        description="List of facilities (Gym, Library, etc.)",
        examples=[["Gym", "Library", "Common Room"]],
    )
    security_features: List[str] = Field(
        default_factory=list,
        description="Security features (CCTV, Guards, etc.)",
        examples=[["CCTV", "24/7 Security", "Biometric Access"]],
    )

    # Policies
    rules: Optional[str] = Field(
        default=None,
        max_length=5000,
        description="Hostel rules and regulations",
    )
    check_in_time: Optional[time] = Field(
        default=None,
        description="Standard check-in time",
        examples=["10:00:00"],
    )
    check_out_time: Optional[time] = Field(
        default=None,
        description="Standard check-out time",
        examples=["11:00:00"],
    )
    visitor_policy: Optional[str] = Field(
        default=None,
        max_length=1000,
        description="Visitor policy details",
    )
    late_entry_policy: Optional[str] = Field(
        default=None,
        max_length=1000,
        description="Late entry policy and timings",
    )

    # Location info
    nearby_landmarks: List[Dict[str, str]] = Field(
        default_factory=list,
        description="Nearby landmarks with name, type, and distance",
        examples=[[{"name": "Metro Station", "type": "transport", "distance": "500m"}]],
    )
    connectivity_info: Optional[str] = Field(
        default=None,
        max_length=1000,
        description="Public transport and connectivity information",
    )

    @field_validator("slug")
    @classmethod
    def validate_slug(cls, v: str) -> str:
        """
        Validate and normalize slug format.
        
        Ensures slug contains only lowercase letters, numbers, and hyphens.
        """
        v = v.lower().strip()
        if not v.replace("-", "").isalnum():
            raise ValueError(
                "Slug can only contain lowercase letters, numbers, and hyphens"
            )
        # Remove consecutive hyphens
        while "--" in v:
            v = v.replace("--", "-")
        # Remove leading/trailing hyphens
        v = v.strip("-")
        return v

    @field_validator("name")
    @classmethod
    def validate_name(cls, v: str) -> str:
        """Validate and normalize hostel name."""
        v = v.strip()
        # Remove excessive whitespace
        v = " ".join(v.split())
        if v.isdigit():
            raise ValueError("Hostel name cannot be only numbers")
        return v

    @field_validator("amenities", "facilities", "security_features")
    @classmethod
    def validate_and_clean_lists(cls, v: List[str]) -> List[str]:
        """
        Validate and clean list fields.
        
        Removes empty strings, duplicates, and normalizes values.
        """
        if not v:
            return []
        # Clean and normalize
        cleaned = [item.strip() for item in v if item and item.strip()]
        # Remove duplicates while preserving order
        seen = set()
        unique = []
        for item in cleaned:
            item_lower = item.lower()
            if item_lower not in seen:
                seen.add(item_lower)
                unique.append(item)
        return unique

    @field_validator("nearby_landmarks")
    @classmethod
    def validate_landmarks(cls, v: List[Dict[str, str]]) -> List[Dict[str, str]]:
        """Validate nearby landmarks structure."""
        if not v:
            return []
        validated = []
        for landmark in v:
            if not isinstance(landmark, dict):
                continue
            if "name" in landmark and landmark["name"].strip():
                validated.append({
                    "name": landmark.get("name", "").strip(),
                    "type": landmark.get("type", "other").strip(),
                    "distance": landmark.get("distance", "").strip(),
                })
        return validated

    @field_validator("currency")
    @classmethod
    def validate_currency(cls, v: str) -> str:
        """Normalize currency code to uppercase."""
        return v.upper().strip()

    @model_validator(mode="after")
    def validate_check_times(self) -> "HostelBase":
        """Validate check-in and check-out times."""
        if (
            self.check_in_time is not None
            and self.check_out_time is not None
            and self.check_in_time >= self.check_out_time
        ):
            raise ValueError("Check-in time must be before check-out time")
        return self


class HostelCreate(HostelBase, BaseCreateSchema):
    """
    Schema for creating a hostel.
    
    Enforces required fields for hostel creation.
    """

    # Override to enforce requirements
    name: str = Field(
        ...,
        min_length=3,
        max_length=255,
        description="Hostel name (required)",
    )
    hostel_type: HostelType = Field(
        ...,
        description="Hostel type (required)",
    )
    contact_phone: str = Field(
        ...,
        pattern=r"^\+?[1-9]\d{9,14}$",
        description="Primary contact phone (required)",
    )
    address_line1: str = Field(
        ...,
        min_length=5,
        max_length=255,
        description="Address line 1 (required)",
    )
    city: str = Field(
        ...,
        min_length=2,
        max_length=100,
        description="City (required)",
    )
    state: str = Field(
        ...,
        min_length=2,
        max_length=100,
        description="State (required)",
    )
    pincode: str = Field(
        ...,
        pattern=r"^\d{6}$",
        description="6-digit pincode (required)",
    )


class HostelUpdate(BaseUpdateSchema):
    """
    Schema for updating hostel information.
    
    All fields are optional for partial updates.
    """

    # Basic info
    name: Optional[str] = Field(
        default=None,
        min_length=3,
        max_length=255,
        description="Hostel name",
    )
    slug: Optional[str] = Field(
        default=None,
        min_length=3,
        max_length=255,
        pattern=r"^[a-z0-9-]+$",
        description="URL slug",
    )
    description: Optional[str] = Field(
        default=None,
        max_length=2000,
        description="Description",
    )
    hostel_type: Optional[HostelType] = Field(
        default=None,
        description="Hostel type",
    )

    # Address fields
    address_line1: Optional[str] = Field(
        default=None,
        min_length=5,
        max_length=255,
        description="Address line 1",
    )
    address_line2: Optional[str] = Field(
        default=None,
        max_length=255,
        description="Address line 2",
    )
    city: Optional[str] = Field(
        default=None,
        min_length=2,
        max_length=100,
        description="City",
    )
    state: Optional[str] = Field(
        default=None,
        min_length=2,
        max_length=100,
        description="State",
    )
    pincode: Optional[str] = Field(
        default=None,
        pattern=r"^\d{6}$",
        description="Pincode",
    )
    country: Optional[str] = Field(
        default=None,
        min_length=2,
        max_length=100,
        description="Country",
    )

    # Contact
    contact_phone: Optional[str] = Field(
        default=None,
        pattern=r"^\+?[1-9]\d{9,14}$",
        description="Contact phone",
    )
    alternate_phone: Optional[str] = Field(
        default=None,
        pattern=r"^\+?[1-9]\d{9,14}$",
        description="Alternate phone",
    )
    contact_email: Optional[str] = Field(
        default=None,
        description="Contact email",
    )
    website_url: Optional[HttpUrl] = Field(
        default=None,
        description="Website URL",
    )

    # Location
    latitude: Optional[Decimal] = Field(
        default=None,
        ge=-90,
        le=90,
        description="Latitude",
    )
    longitude: Optional[Decimal] = Field(
        default=None,
        ge=-180,
        le=180,
        description="Longitude",
    )

    # Pricing
    starting_price_monthly: Optional[Decimal] = Field(
        default=None,
        ge=0,
        description="Starting monthly price",
    )
    currency: Optional[str] = Field(
        default=None,
        min_length=3,
        max_length=3,
        pattern=r"^[A-Z]{3}$",
        description="Currency code",
    )

    # Lists
    amenities: Optional[List[str]] = Field(
        default=None,
        description="Amenities list",
    )
    facilities: Optional[List[str]] = Field(
        default=None,
        description="Facilities list",
    )
    security_features: Optional[List[str]] = Field(
        default=None,
        description="Security features list",
    )

    # Policies
    rules: Optional[str] = Field(
        default=None,
        max_length=5000,
        description="Rules and regulations",
    )
    check_in_time: Optional[time] = Field(
        default=None,
        description="Check-in time",
    )
    check_out_time: Optional[time] = Field(
        default=None,
        description="Check-out time",
    )
    visitor_policy: Optional[str] = Field(
        default=None,
        max_length=1000,
        description="Visitor policy",
    )
    late_entry_policy: Optional[str] = Field(
        default=None,
        max_length=1000,
        description="Late entry policy",
    )

    # Location info
    nearby_landmarks: Optional[List[Dict[str, str]]] = Field(
        default=None,
        description="Nearby landmarks",
    )
    connectivity_info: Optional[str] = Field(
        default=None,
        max_length=1000,
        description="Connectivity info",
    )

    # Media
    cover_image_url: Optional[str] = Field(
        default=None,
        description="Cover image URL",
    )
    gallery_images: Optional[List[str]] = Field(
        default=None,
        description="Gallery image URLs",
    )
    virtual_tour_url: Optional[HttpUrl] = Field(
        default=None,
        description="Virtual tour URL",
    )

    # Status
    status: Optional[HostelStatus] = Field(
        default=None,
        description="Operational status",
    )
    is_active: Optional[bool] = Field(
        default=None,
        description="Active status",
    )

    # Apply same validators as base
    _validate_slug = field_validator("slug")(HostelBase.validate_slug.__func__)
    _validate_name = field_validator("name")(HostelBase.validate_name.__func__)
    _validate_lists = field_validator(
        "amenities", "facilities", "security_features"
    )(HostelBase.validate_and_clean_lists.__func__)
    _validate_currency = field_validator("currency")(
        HostelBase.validate_currency.__func__
    )

    @field_validator("contact_phone", "alternate_phone")
    @classmethod
    def normalize_phone(cls, v: Optional[str]) -> Optional[str]:
        """Normalize phone numbers."""
        if v is not None:
            return v.replace(" ", "").replace("-", "").strip()
        return v


class HostelMediaUpdate(BaseUpdateSchema):
    """
    Update hostel media (images, videos, virtual tours).
    
    Manages hostel visual content.
    """

    cover_image_url: Optional[str] = Field(
        default=None,
        description="Cover/main image URL",
    )
    gallery_images: List[str] = Field(
        default_factory=list,
        max_items=20,
        description="Gallery image URLs (max 20)",
    )
    virtual_tour_url: Optional[HttpUrl] = Field(
        default=None,
        description="360° virtual tour URL",
    )
    video_urls: Optional[List[HttpUrl]] = Field(
        default=None,
        max_items=5,
        description="Video URLs (max 5)",
    )

    @field_validator("gallery_images")
    @classmethod
    def validate_gallery_images(cls, v: List[str]) -> List[str]:
        """Validate gallery images."""
        if not v:
            return []
        # Remove empty strings and duplicates
        cleaned = [img.strip() for img in v if img and img.strip()]
        # Remove duplicates while preserving order
        seen = set()
        unique = []
        for img in cleaned:
            if img not in seen:
                seen.add(img)
                unique.append(img)
        return unique[:20]  # Limit to 20


class HostelSEOUpdate(BaseUpdateSchema):
    """
    Update hostel SEO metadata.
    
    Manages search engine optimization fields.
    """

    meta_title: Optional[str] = Field(
        default=None,
        min_length=10,
        max_length=60,
        description="SEO meta title (optimal: 50-60 chars)",
    )
    meta_description: Optional[str] = Field(
        default=None,
        min_length=50,
        max_length=160,
        description="SEO meta description (optimal: 150-160 chars)",
    )
    meta_keywords: Optional[str] = Field(
        default=None,
        max_length=500,
        description="SEO keywords (comma-separated)",
    )
    og_title: Optional[str] = Field(
        default=None,
        max_length=95,
        description="Open Graph title",
    )
    og_description: Optional[str] = Field(
        default=None,
        max_length=200,
        description="Open Graph description",
    )
    og_image_url: Optional[HttpUrl] = Field(
        default=None,
        description="Open Graph image URL",
    )

    @field_validator("meta_keywords")
    @classmethod
    def validate_keywords(cls, v: Optional[str]) -> Optional[str]:
        """Validate and clean meta keywords."""
        if v is None:
            return v
        # Split, clean, and rejoin
        keywords = [kw.strip() for kw in v.split(",") if kw.strip()]
        # Limit to 10 keywords
        return ", ".join(keywords[:10])

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\HOStel-back\app\schemas\hostel\hostel_comparison.py ---
# --- File: app/schemas/hostel/hostel_comparison.py ---
"""
Hostel comparison schemas for side-by-side analysis.
"""

from __future__ import annotations

from datetime import datetime
from decimal import Decimal
from typing import Dict, List, Optional
from uuid import UUID

from pydantic import Field, field_validator

from app.schemas.common.base import BaseCreateSchema, BaseSchema
from app.schemas.common.enums import HostelType

__all__ = [
    "HostelComparisonRequest",
    "ComparisonResult",
    "ComparisonItem",
    "RoomTypeComparison",
    "ComparisonSummary",
    "PriceComparison",
    "AmenityComparison",
]


class HostelComparisonRequest(BaseCreateSchema):
    """
    Request to compare multiple hostels.
    
    Allows comparison of 2-4 hostels side by side.
    """

    hostel_ids: List[UUID] = Field(
        ...,
        min_length=2,
        max_length=4,
        description="2-4 hostel IDs to compare",
    )

    @field_validator("hostel_ids")
    @classmethod
    def validate_unique_ids(cls, v: List[UUID]) -> List[UUID]:
        """Ensure hostel IDs are unique."""
        if len(v) != len(set(v)):
            raise ValueError("Hostel IDs must be unique")
        return v


class RoomTypeComparison(BaseSchema):
    """
    Room type details for comparison.
    
    Provides room-specific information for comparison.
    """

    room_type: str = Field(
        ...,
        description="Room type (single, double, etc.)",
    )
    price_monthly: Decimal = Field(
        ...,
        ge=0,
        description="Monthly price",
    )
    available_beds: int = Field(
        ...,
        ge=0,
        description="Available beds",
    )
    total_beds: int = Field(
        ...,
        ge=0,
        description="Total beds",
    )
    amenities: List[str] = Field(
        default_factory=list,
        description="Room-specific amenities",
    )


class ComparisonItem(BaseSchema):
    """
    Individual hostel data in comparison.
    
    Complete hostel information formatted for comparison.
    """

    id: UUID = Field(..., description="Hostel ID")
    name: str = Field(..., description="Hostel name")
    slug: str = Field(..., description="URL slug")
    hostel_type: HostelType = Field(..., description="Hostel type")

    # Location
    city: str = Field(..., description="City")
    state: str = Field(..., description="State")
    address: str = Field(..., description="Full address")
    distance_from_center_km: Optional[Decimal] = Field(
        default=None,
        ge=0,
        description="Distance from city center (km)",
    )

    # Pricing
    starting_price_monthly: Decimal = Field(
        ...,
        ge=0,
        description="Starting monthly price",
    )
    price_range_monthly: str = Field(
        ...,
        description="Price range (e.g., '₹5,000 - ₹15,000')",
    )
    security_deposit: Optional[Decimal] = Field(
        default=None,
        ge=0,
        description="Security deposit amount",
    )

    # Capacity
    total_beds: int = Field(
        ...,
        ge=0,
        description="Total bed capacity",
    )
    available_beds: int = Field(
        ...,
        ge=0,
        description="Currently available beds",
    )

    # Ratings
    average_rating: Decimal = Field(
        ...,
        ge=0,
        le=5,
        description="Average rating",
    )
    total_reviews: int = Field(
        ...,
        ge=0,
        description="Total number of reviews",
    )
    rating_breakdown: Dict[str, int] = Field(
        default_factory=dict,
        description="Rating distribution (1-5 stars)",
    )

    # Amenities
    amenities: List[str] = Field(
        default_factory=list,
        description="General amenities",
    )
    facilities: List[str] = Field(
        default_factory=list,
        description="Facilities available",
    )
    security_features: List[str] = Field(
        default_factory=list,
        description="Security features",
    )

    # Room types
    room_types_available: List[str] = Field(
        default_factory=list,
        description="Available room types",
    )
    room_type_details: List[RoomTypeComparison] = Field(
        default_factory=list,
        description="Detailed room type information",
    )

    # Policies
    check_in_time: Optional[str] = Field(
        default=None,
        description="Check-in time",
    )
    check_out_time: Optional[str] = Field(
        default=None,
        description="Check-out time",
    )
    visitor_allowed: bool = Field(
        ...,
        description="Whether visitors are allowed",
    )

    # Media
    cover_image_url: Optional[str] = Field(
        default=None,
        description="Cover image URL",
    )
    total_images: int = Field(
        ...,
        ge=0,
        description="Total number of images",
    )
    has_virtual_tour: bool = Field(
        ...,
        description="Virtual tour availability",
    )

    # Highlights
    unique_features: List[str] = Field(
        default_factory=list,
        description="Unique selling points",
    )
    pros: List[str] = Field(
        default_factory=list,
        description="Advantages/pros",
    )
    cons: List[str] = Field(
        default_factory=list,
        description="Disadvantages/cons",
    )


class PriceComparison(BaseSchema):
    """
    Price comparison summary.
    
    Provides price statistics across compared hostels.
    """

    lowest_price: Decimal = Field(
        ...,
        ge=0,
        description="Lowest starting price",
    )
    highest_price: Decimal = Field(
        ...,
        ge=0,
        description="Highest starting price",
    )
    average_price: Decimal = Field(
        ...,
        ge=0,
        description="Average starting price",
    )
    price_difference_percentage: Decimal = Field(
        ...,
        ge=0,
        description="Percentage difference between lowest and highest",
    )


class AmenityComparison(BaseSchema):
    """
    Amenity comparison summary.
    
    Provides amenity statistics and unique features.
    """

    common_amenities: List[str] = Field(
        default_factory=list,
        description="Amenities present in all compared hostels",
    )
    unique_to_hostel: Dict[str, List[str]] = Field(
        default_factory=dict,
        description="Unique amenities per hostel (hostel_id: [amenities])",
    )
    total_unique_amenities: int = Field(
        ...,
        ge=0,
        description="Total number of unique amenity types",
    )


class ComparisonSummary(BaseSchema):
    """
    Comparison summary with recommendations.
    
    Provides quick insights and best options.
    """

    best_for_budget: UUID = Field(
        ...,
        description="Best value for money (hostel ID)",
    )
    best_rated: UUID = Field(
        ...,
        description="Highest rated hostel (hostel ID)",
    )
    best_location: Optional[UUID] = Field(
        default=None,
        description="Best location (hostel ID)",
    )
    most_amenities: UUID = Field(
        ...,
        description="Most amenities (hostel ID)",
    )
    best_availability: UUID = Field(
        ...,
        description="Best bed availability (hostel ID)",
    )

    price_comparison: PriceComparison = Field(
        ...,
        description="Price comparison statistics",
    )
    amenity_comparison: AmenityComparison = Field(
        ...,
        description="Amenity comparison statistics",
    )


class ComparisonResult(BaseSchema):
    """
    Complete comparison result.
    
    Aggregates all comparison data and insights.
    """

    hostels: List[ComparisonItem] = Field(
        ...,
        description="Hostels being compared",
    )
    comparison_criteria: List[str] = Field(
        ...,
        description="Criteria included in comparison",
    )
    summary: ComparisonSummary = Field(
        ...,
        description="Comparison summary and recommendations",
    )
    generated_at: datetime = Field(
        ...,
        description="Comparison generation timestamp",
    )

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\HOStel-back\app\schemas\hostel\hostel_filter.py ---
# --- File: app/schemas/hostel/hostel_filter.py ---
"""
Hostel filter and sort schemas with advanced filtering options.
"""

from __future__ import annotations

from datetime import date
from decimal import Decimal
from typing import List, Optional
from uuid import UUID

from pydantic import Field, field_validator

from app.schemas.common.base import BaseFilterSchema
from app.schemas.common.enums import HostelStatus, HostelType

__all__ = [
    "HostelFilterParams",
    "HostelSortOptions",
    "AdvancedFilters",
    "BulkFilterParams",
]


class HostelFilterParams(BaseFilterSchema):
    """
    Hostel listing filter parameters.
    
    Provides comprehensive filtering options for hostel queries.
    """

    # Text search
    search: Optional[str] = Field(
        default=None,
        min_length=1,
        max_length=255,
        description="Search in name, description, city",
    )

    # Location
    city: Optional[str] = Field(
        default=None,
        description="Filter by city",
    )
    state: Optional[str] = Field(
        default=None,
        description="Filter by state",
    )
    cities: Optional[List[str]] = Field(
        default=None,
        description="Filter by multiple cities",
    )

    # Type
    hostel_type: Optional[HostelType] = Field(
        default=None,
        description="Filter by hostel type",
    )
    hostel_types: Optional[List[HostelType]] = Field(
        default=None,
        description="Filter by multiple hostel types",
    )

    # Status
    status: Optional[HostelStatus] = Field(
        default=None,
        description="Filter by operational status",
    )
    is_active: Optional[bool] = Field(
        default=None,
        description="Filter by active status",
    )
    is_public: Optional[bool] = Field(
        default=None,
        description="Filter by public visibility",
    )
    is_featured: Optional[bool] = Field(
        default=None,
        description="Filter by featured status",
    )
    is_verified: Optional[bool] = Field(
        default=None,
        description="Filter by verification status",
    )

    # Price range
    price_min: Optional[Decimal] = Field(
        default=None,
        ge=0,
        description="Minimum monthly price",
    )
    price_max: Optional[Decimal] = Field(
        default=None,
        ge=0,
        description="Maximum monthly price",
    )

    # Rating
    min_rating: Optional[Decimal] = Field(
        default=None,
        ge=0,
        le=5,
        description="Minimum average rating",
    )

    # Availability
    has_availability: Optional[bool] = Field(
        default=None,
        description="Filter by bed availability",
    )
    min_available_beds: Optional[int] = Field(
        default=None,
        ge=0,
        description="Minimum available beds required",
    )

    # Amenities
    amenities: Optional[List[str]] = Field(
        default=None,
        description="Required amenities (all must be present)",
    )

    # Admin filters
    admin_id: Optional[UUID] = Field(
        default=None,
        description="Filter by assigned admin (admin only)",
    )
    has_subscription: Optional[bool] = Field(
        default=None,
        description="Filter by subscription status (admin only)",
    )

    @field_validator("price_max")
    @classmethod
    def validate_price_range(cls, v: Optional[Decimal], info) -> Optional[Decimal]:
        """Validate price range."""
        if v is not None:
            price_min = info.data.get("price_min")
            if price_min is not None and v < price_min:
                raise ValueError("price_max must be greater than or equal to price_min")
        return v


class HostelSortOptions(BaseFilterSchema):
    """
    Hostel sorting options.
    
    Defines available sort criteria and order.
    """

    sort_by: str = Field(
        default="created_at",
        pattern=r"^(name|city|price|rating|occupancy|created_at|updated_at)$",
        description="Field to sort by",
    )
    sort_order: str = Field(
        default="desc",
        pattern=r"^(asc|desc)$",
        description="Sort order (ascending/descending)",
    )

    @field_validator("sort_order")
    @classmethod
    def normalize_sort_order(cls, v: str) -> str:
        """Normalize sort order to lowercase."""
        return v.lower()


class AdvancedFilters(BaseFilterSchema):
    """
    Advanced filtering options.
    
    Provides additional filtering criteria for complex queries.
    """

    # Date filters
    created_after: Optional[date] = Field(
        default=None,
        description="Filter hostels created after this date",
    )
    created_before: Optional[date] = Field(
        default=None,
        description="Filter hostels created before this date",
    )

    # Occupancy
    occupancy_min: Optional[Decimal] = Field(
        default=None,
        ge=0,
        le=100,
        description="Minimum occupancy percentage",
    )
    occupancy_max: Optional[Decimal] = Field(
        default=None,
        ge=0,
        le=100,
        description="Maximum occupancy percentage",
    )

    # Reviews
    min_reviews: Optional[int] = Field(
        default=None,
        ge=0,
        description="Minimum number of reviews",
    )

    # Rooms
    min_rooms: Optional[int] = Field(
        default=None,
        ge=0,
        description="Minimum number of rooms",
    )
    max_rooms: Optional[int] = Field(
        default=None,
        ge=0,
        description="Maximum number of rooms",
    )

    # Revenue (admin only)
    revenue_min: Optional[Decimal] = Field(
        default=None,
        ge=0,
        description="Minimum monthly revenue (admin only)",
    )
    revenue_max: Optional[Decimal] = Field(
        default=None,
        ge=0,
        description="Maximum monthly revenue (admin only)",
    )

    @field_validator("created_before")
    @classmethod
    def validate_date_range(cls, v: Optional[date], info) -> Optional[date]:
        """Validate date range."""
        if v is not None:
            created_after = info.data.get("created_after")
            if created_after is not None and v < created_after:
                raise ValueError("created_before must be after or equal to created_after")
        return v

    @field_validator("occupancy_max")
    @classmethod
    def validate_occupancy_range(cls, v: Optional[Decimal], info) -> Optional[Decimal]:
        """Validate occupancy range."""
        if v is not None:
            occupancy_min = info.data.get("occupancy_min")
            if occupancy_min is not None and v < occupancy_min:
                raise ValueError("occupancy_max must be >= occupancy_min")
        return v


class BulkFilterParams(BaseFilterSchema):
    """
    Bulk operation filter parameters.
    
    Allows filtering hostels for bulk operations.
    """

    hostel_ids: List[UUID] = Field(
        ...,
        min_length=1,
        max_length=100,
        description="List of hostel IDs (max 100)",
    )

    # Or use filters
    use_filters: bool = Field(
        default=False,
        description="Use filter criteria instead of explicit IDs",
    )
    filters: Optional[HostelFilterParams] = Field(
        default=None,
        description="Filter criteria (if use_filters is True)",
    )

    @field_validator("hostel_ids")
    @classmethod
    def validate_unique_ids(cls, v: List[UUID]) -> List[UUID]:
        """Ensure hostel IDs are unique."""
        if len(v) != len(set(v)):
            raise ValueError("Hostel IDs must be unique")
        return v

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\HOStel-back\app\schemas\hostel\hostel_public.py ---
# --- File: app/schemas/hostel/hostel_public.py ---
"""
Public hostel profile schemas for visitor-facing content.
"""

from __future__ import annotations

from datetime import time
from decimal import Decimal
from typing import Dict, List, Optional
from uuid import UUID

from pydantic import Field

from app.schemas.common.base import BaseSchema
from app.schemas.common.enums import HostelType

__all__ = [
    "PublicHostelCard",
    "PublicRoomType",
    "PublicHostelProfile",
    "PublicHostelList",
]


class PublicHostelCard(BaseSchema):
    """
    Hostel card for public listing/search results.
    
    Provides essential information for hostel browsing.
    """

    id: UUID = Field(..., description="Hostel ID")
    name: str = Field(..., description="Hostel name")
    slug: str = Field(..., description="URL slug")
    hostel_type: HostelType = Field(..., description="Hostel type")
    city: str = Field(..., description="City")
    state: str = Field(..., description="State")
    starting_price_monthly: Decimal = Field(
        ...,
        ge=0,
        description="Starting monthly price",
    )
    currency: str = Field(..., description="Currency code")
    average_rating: Decimal = Field(
        ...,
        ge=0,
        le=5,
        description="Average rating",
    )
    total_reviews: int = Field(
        ...,
        ge=0,
        description="Total number of reviews",
    )
    available_beds: int = Field(
        ...,
        ge=0,
        description="Available beds",
    )
    cover_image_url: Optional[str] = Field(
        default=None,
        description="Cover image URL",
    )
    is_featured: bool = Field(
        ...,
        description="Featured status",
    )
    amenities: List[str] = Field(
        default_factory=list,
        max_length=5,
        description="Top 5 amenities for quick view",
    )
    distance_km: Optional[Decimal] = Field(
        default=None,
        ge=0,
        description="Distance from search location (if applicable)",
    )


class PublicRoomType(BaseSchema):
    """
    Public room type information.
    
    Provides room-specific details for visitors.
    """

    room_type: str = Field(
        ...,
        description="Room type (single, double, etc.)",
    )
    price_monthly: Decimal = Field(
        ...,
        ge=0,
        description="Monthly price",
    )
    price_quarterly: Optional[Decimal] = Field(
        default=None,
        ge=0,
        description="Quarterly price (if available)",
    )
    price_yearly: Optional[Decimal] = Field(
        default=None,
        ge=0,
        description="Yearly price (if available)",
    )
    available_beds: int = Field(
        ...,
        ge=0,
        description="Available beds of this type",
    )
    total_beds: int = Field(
        ...,
        ge=0,
        description="Total beds of this type",
    )
    room_amenities: List[str] = Field(
        default_factory=list,
        description="Room-specific amenities",
    )
    room_images: List[str] = Field(
        default_factory=list,
        max_length=10,
        description="Room images (max 10)",
    )
    room_size_sqft: Optional[int] = Field(
        default=None,
        ge=0,
        description="Room size in square feet",
    )


class PublicHostelProfile(BaseSchema):
    """
    Complete public hostel profile.
    
    Comprehensive hostel information for detail pages.
    """

    id: UUID = Field(..., description="Hostel ID")
    name: str = Field(..., description="Hostel name")
    slug: str = Field(..., description="URL slug")
    description: Optional[str] = Field(
        default=None,
        description="Hostel description",
    )
    hostel_type: HostelType = Field(..., description="Hostel type")

    # Contact (public)
    contact_phone: str = Field(..., description="Contact phone number")
    contact_email: Optional[str] = Field(
        default=None,
        description="Contact email",
    )
    website_url: Optional[str] = Field(
        default=None,
        description="Official website URL",
    )

    # Address
    address_line1: str = Field(..., description="Address line 1")
    address_line2: Optional[str] = Field(
        default=None,
        description="Address line 2",
    )
    city: str = Field(..., description="City")
    state: str = Field(..., description="State")
    pincode: str = Field(..., description="Pincode")
    latitude: Optional[Decimal] = Field(
        default=None,
        description="Latitude for map display",
    )
    longitude: Optional[Decimal] = Field(
        default=None,
        description="Longitude for map display",
    )

    # Pricing
    starting_price_monthly: Decimal = Field(
        ...,
        ge=0,
        description="Starting monthly price",
    )
    currency: str = Field(..., description="Currency code")

    # Availability
    available_beds: int = Field(
        ...,
        ge=0,
        description="Total available beds",
    )
    total_beds: int = Field(
        ...,
        ge=0,
        description="Total bed capacity",
    )

    # Ratings
    average_rating: Decimal = Field(
        ...,
        ge=0,
        le=5,
        description="Average rating",
    )
    total_reviews: int = Field(
        ...,
        ge=0,
        description="Total number of reviews",
    )
    rating_breakdown: Dict[str, int] = Field(
        default_factory=dict,
        description="Rating distribution {1: count, 2: count, ...}",
    )

    # Features
    amenities: List[str] = Field(
        default_factory=list,
        description="Available amenities",
    )
    facilities: List[str] = Field(
        default_factory=list,
        description="Available facilities",
    )
    security_features: List[str] = Field(
        default_factory=list,
        description="Security features",
    )

    # Policies
    rules: Optional[str] = Field(
        default=None,
        description="Hostel rules and regulations",
    )
    check_in_time: Optional[time] = Field(
        default=None,
        description="Standard check-in time",
    )
    check_out_time: Optional[time] = Field(
        default=None,
        description="Standard check-out time",
    )
    visitor_policy: Optional[str] = Field(
        default=None,
        description="Visitor policy",
    )

    # Location
    nearby_landmarks: List[Dict[str, str]] = Field(
        default_factory=list,
        description="Nearby landmarks with details",
    )
    connectivity_info: Optional[str] = Field(
        default=None,
        description="Public transport connectivity",
    )

    # Media
    cover_image_url: Optional[str] = Field(
        default=None,
        description="Cover image URL",
    )
    gallery_images: List[str] = Field(
        default_factory=list,
        description="Gallery images",
    )
    virtual_tour_url: Optional[str] = Field(
        default=None,
        description="360° virtual tour URL",
    )

    # Room types available
    room_types: List[PublicRoomType] = Field(
        default_factory=list,
        description="Available room types with pricing",
    )

    # Additional info
    established_year: Optional[int] = Field(
        default=None,
        ge=1900,
        le=2100,
        description="Year established",
    )
    total_rooms: int = Field(
        ...,
        ge=0,
        description="Total number of rooms",
    )


class PublicHostelList(BaseSchema):
    """
    List of public hostels with metadata.
    
    Response schema for hostel listing pages.
    """

    hostels: List[PublicHostelCard] = Field(
        ...,
        description="List of hostels",
    )
    total_count: int = Field(
        ...,
        ge=0,
        description="Total number of hostels matching criteria",
    )
    filters_applied: Dict[str, str] = Field(
        default_factory=dict,
        description="Summary of applied filters",
    )
    page: int = Field(
        default=1,
        ge=1,
        description="Current page number",
    )
    page_size: int = Field(
        default=20,
        ge=1,
        le=100,
        description="Items per page",
    )
    total_pages: int = Field(
        ...,
        ge=0,
        description="Total number of pages",
    )

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\HOStel-back\app\schemas\hostel\hostel_response.py ---
# --- File: app/schemas/hostel/hostel_response.py ---
"""
Hostel response schemas for API responses.
"""

from __future__ import annotations

from datetime import datetime, time
from decimal import Decimal
from typing import List, Optional
from uuid import UUID

from pydantic import Field

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import HostelStatus, HostelType

__all__ = [
    "HostelResponse",
    "HostelDetail",
    "HostelListItem",
    "HostelStats",
]


class HostelResponse(BaseResponseSchema):
    """
    Basic hostel response schema.
    
    Standard response for hostel operations.
    """

    name: str = Field(..., description="Hostel name")
    slug: str = Field(..., description="URL slug")
    hostel_type: HostelType = Field(..., description="Hostel type")
    city: str = Field(..., description="City")
    state: str = Field(..., description="State")
    starting_price_monthly: Optional[Decimal] = Field(
        default=None,
        description="Starting monthly price",
    )
    average_rating: Decimal = Field(
        ...,
        ge=0,
        le=5,
        description="Average rating",
    )
    total_reviews: int = Field(
        ...,
        ge=0,
        description="Total number of reviews",
    )
    total_rooms: int = Field(
        ...,
        ge=0,
        description="Total number of rooms",
    )
    available_beds: int = Field(
        ...,
        ge=0,
        description="Available beds",
    )
    is_public: bool = Field(..., description="Public visibility")
    is_featured: bool = Field(..., description="Featured status")
    cover_image_url: Optional[str] = Field(
        default=None,
        description="Cover image URL",
    )
    status: HostelStatus = Field(..., description="Operational status")


class HostelDetail(BaseResponseSchema):
    """
    Detailed hostel information.
    
    Comprehensive hostel data for detail views.
    """

    name: str = Field(..., description="Hostel name")
    slug: str = Field(..., description="URL slug")
    description: Optional[str] = Field(
        default=None,
        description="Hostel description",
    )

    # Type and contact
    hostel_type: HostelType = Field(..., description="Hostel type")
    contact_email: Optional[str] = Field(
        default=None,
        description="Contact email",
    )
    contact_phone: str = Field(..., description="Contact phone")
    alternate_phone: Optional[str] = Field(
        default=None,
        description="Alternate phone",
    )
    website_url: Optional[str] = Field(
        default=None,
        description="Website URL",
    )

    # Address
    address_line1: str = Field(..., description="Address line 1")
    address_line2: Optional[str] = Field(
        default=None,
        description="Address line 2",
    )
    city: str = Field(..., description="City")
    state: str = Field(..., description="State")
    pincode: str = Field(..., description="Pincode")
    country: str = Field(..., description="Country")
    latitude: Optional[Decimal] = Field(
        default=None,
        description="Latitude",
    )
    longitude: Optional[Decimal] = Field(
        default=None,
        description="Longitude",
    )

    # Pricing
    starting_price_monthly: Optional[Decimal] = Field(
        default=None,
        description="Starting monthly price",
    )
    currency: str = Field(..., description="Currency code")

    # Capacity
    total_rooms: int = Field(
        ...,
        ge=0,
        description="Total number of rooms",
    )
    total_beds: int = Field(
        ...,
        ge=0,
        description="Total number of beds",
    )
    occupied_beds: int = Field(
        ...,
        ge=0,
        description="Occupied beds",
    )
    available_beds: int = Field(
        ...,
        ge=0,
        description="Available beds",
    )

    # Ratings
    average_rating: Decimal = Field(
        ...,
        ge=0,
        le=5,
        description="Average rating",
    )
    total_reviews: int = Field(
        ...,
        ge=0,
        description="Total reviews",
    )

    # Features
    amenities: List[str] = Field(
        default_factory=list,
        description="Available amenities",
    )
    facilities: List[str] = Field(
        default_factory=list,
        description="Available facilities",
    )
    security_features: List[str] = Field(
        default_factory=list,
        description="Security features",
    )

    # Policies
    rules: Optional[str] = Field(
        default=None,
        description="Hostel rules",
    )
    check_in_time: Optional[time] = Field(
        default=None,
        description="Check-in time",
    )
    check_out_time: Optional[time] = Field(
        default=None,
        description="Check-out time",
    )
    visitor_policy: Optional[str] = Field(
        default=None,
        description="Visitor policy",
    )
    late_entry_policy: Optional[str] = Field(
        default=None,
        description="Late entry policy",
    )

    # Location info
    nearby_landmarks: List[dict] = Field(
        default_factory=list,
        description="Nearby landmarks",
    )
    connectivity_info: Optional[str] = Field(
        default=None,
        description="Connectivity information",
    )

    # Media
    cover_image_url: Optional[str] = Field(
        default=None,
        description="Cover image URL",
    )
    gallery_images: List[str] = Field(
        default_factory=list,
        description="Gallery images",
    )
    virtual_tour_url: Optional[str] = Field(
        default=None,
        description="Virtual tour URL",
    )

    # Status
    is_public: bool = Field(..., description="Public visibility")
    is_featured: bool = Field(..., description="Featured status")
    is_verified: bool = Field(..., description="Verification status")
    status: HostelStatus = Field(..., description="Operational status")
    is_active: bool = Field(..., description="Active status")

    # SEO
    meta_title: Optional[str] = Field(
        default=None,
        description="SEO meta title",
    )
    meta_description: Optional[str] = Field(
        default=None,
        description="SEO meta description",
    )
    meta_keywords: Optional[str] = Field(
        default=None,
        description="SEO keywords",
    )


class HostelListItem(BaseSchema):
    """
    Hostel list item for list views.
    
    Minimal information for efficient list rendering.
    """

    id: UUID = Field(..., description="Hostel ID")
    name: str = Field(..., description="Hostel name")
    slug: str = Field(..., description="URL slug")
    hostel_type: HostelType = Field(..., description="Hostel type")
    city: str = Field(..., description="City")
    state: str = Field(..., description="State")
    starting_price_monthly: Optional[Decimal] = Field(
        default=None,
        description="Starting price",
    )
    average_rating: Decimal = Field(
        ...,
        ge=0,
        le=5,
        description="Average rating",
    )
    total_reviews: int = Field(
        ...,
        ge=0,
        description="Total reviews",
    )
    available_beds: int = Field(
        ...,
        ge=0,
        description="Available beds",
    )
    cover_image_url: Optional[str] = Field(
        default=None,
        description="Cover image",
    )
    is_featured: bool = Field(..., description="Featured status")
    distance_km: Optional[Decimal] = Field(
        default=None,
        ge=0,
        description="Distance from search location",
    )


class HostelStats(BaseSchema):
    """
    Hostel statistics summary.
    
    Key metrics and statistics for a hostel.
    """

    hostel_id: UUID = Field(..., description="Hostel ID")

    # Occupancy
    total_rooms: int = Field(
        ...,
        ge=0,
        description="Total rooms",
    )
    total_beds: int = Field(
        ...,
        ge=0,
        description="Total beds",
    )
    occupied_beds: int = Field(
        ...,
        ge=0,
        description="Occupied beds",
    )
    available_beds: int = Field(
        ...,
        ge=0,
        description="Available beds",
    )
    occupancy_percentage: Decimal = Field(
        ...,
        ge=0,
        le=100,
        description="Occupancy percentage",
    )

    # Revenue
    total_revenue_monthly: Decimal = Field(
        ...,
        ge=0,
        description="Total monthly revenue",
    )
    total_outstanding: Decimal = Field(
        ...,
        ge=0,
        description="Total outstanding payments",
    )

    # Students
    total_students: int = Field(
        ...,
        ge=0,
        description="Total registered students",
    )
    active_students: int = Field(
        ...,
        ge=0,
        description="Active students",
    )

    # Complaints
    open_complaints: int = Field(
        ...,
        ge=0,
        description="Open complaints",
    )
    resolved_complaints: int = Field(
        ...,
        ge=0,
        description="Resolved complaints",
    )

    # Bookings
    pending_bookings: int = Field(
        ...,
        ge=0,
        description="Pending booking requests",
    )
    confirmed_bookings: int = Field(
        ...,
        ge=0,
        description="Confirmed bookings",
    )

    # Reviews
    average_rating: Decimal = Field(
        ...,
        ge=0,
        le=5,
        description="Average rating",
    )
    total_reviews: int = Field(
        ...,
        ge=0,
        description="Total reviews",
    )

    # Last updated
    updated_at: datetime = Field(..., description="Last update timestamp")

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\HOStel-back\app\schemas\hostel\hostel_search.py ---
# --- File: app/schemas/hostel/hostel_search.py ---
"""
Hostel search schemas with comprehensive search and filtering.
"""

from __future__ import annotations

from datetime import date
from decimal import Decimal
from typing import List, Optional

from pydantic import Field, field_validator, model_validator

from app.schemas.common.base import BaseFilterSchema, BaseSchema
from app.schemas.common.enums import HostelType, RoomType
from app.schemas.hostel.hostel_public import PublicHostelCard

__all__ = [
    "HostelSearchRequest",
    "HostelSearchResponse",
    "SearchFacets",
    "FacetItem",
    "PriceRangeFacet",
    "RatingFacet",
    "HostelSearchFilters",
]


class HostelSearchRequest(BaseFilterSchema):
    """
    Hostel search request with comprehensive filtering.
    
    Supports text search, location-based search, and various filters.
    """

    # Text search
    query: Optional[str] = Field(
        default=None,
        min_length=1,
        max_length=255,
        description="Search query (name, description, city)",
    )

    # Location filters
    city: Optional[str] = Field(
        default=None,
        description="Filter by city name",
    )
    state: Optional[str] = Field(
        default=None,
        description="Filter by state name",
    )
    pincode: Optional[str] = Field(
        default=None,
        pattern=r"^\d{6}$",
        description="Filter by 6-digit pincode",
    )

    # Location-based search (radius)
    latitude: Optional[Decimal] = Field(
        default=None,
        ge=-90,
        le=90,
        description="Latitude for radius search",
    )
    longitude: Optional[Decimal] = Field(
        default=None,
        ge=-180,
        le=180,
        description="Longitude for radius search",
    )
    radius_km: Optional[Decimal] = Field(
        default=None,
        ge=0,
        le=50,
        description="Search radius in kilometers",
    )

    # Type filter
    hostel_type: Optional[HostelType] = Field(
        default=None,
        description="Filter by hostel type",
    )

    # Price filter
    min_price: Optional[Decimal] = Field(
        default=None,
        ge=0,
        description="Minimum monthly price",
    )
    max_price: Optional[Decimal] = Field(
        default=None,
        ge=0,
        description="Maximum monthly price",
    )

    # Room type
    room_type: Optional[RoomType] = Field(
        default=None,
        description="Preferred room type",
    )

    # Amenities filter
    amenities: Optional[List[str]] = Field(
        default=None,
        max_length=10,
        description="Required amenities (all must be present)",
    )

    # Availability
    available_beds_min: Optional[int] = Field(
        default=None,
        ge=0,
        description="Minimum available beds required",
    )

    # Rating filter
    min_rating: Optional[Decimal] = Field(
        default=None,
        ge=0,
        le=5,
        description="Minimum average rating",
    )

    # Features
    verified_only: bool = Field(
        default=False,
        description="Show only verified hostels",
    )
    featured_only: bool = Field(
        default=False,
        description="Show only featured hostels",
    )

    # Sort
    sort_by: str = Field(
        default="relevance",
        pattern=r"^(relevance|price_low|price_high|rating|distance|newest)$",
        description="Sort criteria",
    )

    # Pagination
    page: int = Field(
        default=1,
        ge=1,
        description="Page number",
    )
    page_size: int = Field(
        default=20,
        ge=1,
        le=100,
        description="Results per page",
    )

    @model_validator(mode="after")
    def validate_location_search(self) -> "HostelSearchRequest":
        """Validate location-based search parameters."""
        # If radius search, both lat/lon and radius are required
        has_lat = self.latitude is not None
        has_lon = self.longitude is not None
        has_radius = self.radius_km is not None

        if any([has_lat, has_lon, has_radius]):
            if not all([has_lat, has_lon, has_radius]):
                raise ValueError(
                    "For radius search, latitude, longitude, and radius_km "
                    "are all required"
                )
        return self

    @field_validator("max_price")
    @classmethod
    def validate_price_range(cls, v: Optional[Decimal], info) -> Optional[Decimal]:
        """Validate price range."""
        if v is not None:
            min_price = info.data.get("min_price")
            if min_price is not None and v < min_price:
                raise ValueError("max_price must be >= min_price")
        return v


class FacetItem(BaseSchema):
    """
    Facet item with count.
    
    Represents a filter option with result count.
    """

    value: str = Field(..., description="Facet value")
    label: str = Field(..., description="Display label")
    count: int = Field(
        ...,
        ge=0,
        description="Number of results with this value",
    )


class PriceRangeFacet(BaseSchema):
    """
    Price range facet.
    
    Represents a price range filter option.
    """

    min_price: Decimal = Field(..., ge=0, description="Range minimum")
    max_price: Decimal = Field(..., ge=0, description="Range maximum")
    label: str = Field(..., description="Display label")
    count: int = Field(
        ...,
        ge=0,
        description="Number of results in range",
    )


class RatingFacet(BaseSchema):
    """
    Rating facet.
    
    Represents a rating filter option.
    """

    min_rating: Decimal = Field(
        ...,
        ge=0,
        le=5,
        description="Minimum rating",
    )
    label: str = Field(..., description="Display label")
    count: int = Field(
        ...,
        ge=0,
        description="Number of results",
    )


class SearchFacets(BaseSchema):
    """
    Search facets for filtering.
    
    Provides available filter options with counts.
    """

    cities: List[FacetItem] = Field(
        default_factory=list,
        description="Available cities with result counts",
    )
    hostel_types: List[FacetItem] = Field(
        default_factory=list,
        description="Hostel types with result counts",
    )
    price_ranges: List[PriceRangeFacet] = Field(
        default_factory=list,
        description="Price ranges with result counts",
    )
    amenities: List[FacetItem] = Field(
        default_factory=list,
        description="Available amenities with result counts",
    )
    ratings: List[RatingFacet] = Field(
        default_factory=list,
        description="Rating distribution",
    )


class HostelSearchResponse(BaseSchema):
    """
    Hostel search response.
    
    Complete search results with metadata and facets.
    """

    results: List[PublicHostelCard] = Field(
        ...,
        description="Search results",
    )
    total_results: int = Field(
        ...,
        ge=0,
        description="Total matching hostels",
    )
    total_pages: int = Field(
        ...,
        ge=0,
        description="Total number of pages",
    )
    current_page: int = Field(
        ...,
        ge=1,
        description="Current page number",
    )
    filters_applied: dict = Field(
        default_factory=dict,
        description="Summary of applied filters",
    )
    facets: SearchFacets = Field(
        ...,
        description="Available filter facets",
    )


class HostelSearchFilters(BaseFilterSchema):
    """
    Advanced search filters.
    
    Additional filtering options for hostel search.
    """

    # Gender
    gender: Optional[str] = Field(
        default=None,
        pattern=r"^(boys|girls|co_ed)$",
        description="Gender preference",
    )

    # Facilities (boolean filters)
    has_wifi: Optional[bool] = Field(
        default=None,
        description="Has WiFi",
    )
    has_ac: Optional[bool] = Field(
        default=None,
        description="Has AC",
    )
    has_laundry: Optional[bool] = Field(
        default=None,
        description="Has laundry facility",
    )
    has_parking: Optional[bool] = Field(
        default=None,
        description="Has parking",
    )
    has_gym: Optional[bool] = Field(
        default=None,
        description="Has gym/fitness center",
    )
    has_mess: Optional[bool] = Field(
        default=None,
        description="Has mess/canteen",
    )

    # Security
    has_cctv: Optional[bool] = Field(
        default=None,
        description="Has CCTV surveillance",
    )
    has_security_guard: Optional[bool] = Field(
        default=None,
        description="Has security guard",
    )

    # Rules
    allow_visitors: Optional[bool] = Field(
        default=None,
        description="Allows visitors",
    )

    # Availability
    check_in_date: Optional[date] = Field(
        default=None,
        description="Desired check-in date",
    )

    @field_validator("check_in_date")
    @classmethod
    def validate_check_in_date(cls, v: Optional[date]) -> Optional[date]:
        """Validate check-in date is not in the past."""
        if v is not None:
            from datetime import date as dt
            if v < dt.today():
                raise ValueError("Check-in date cannot be in the past")
        return v

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\HOStel-back\app\schemas\hostel\__init__.py ---
from __future__ import annotations

from app.schemas.hostel.hostel_admin import (
    HostelAdminView,
    HostelCapacityUpdate,
    HostelSettings,
    HostelStatusUpdate,
    HostelVisibilityUpdate,
)
from app.schemas.hostel.hostel_analytics import (
    AnalyticsRequest,
    BookingAnalytics,
    ComplaintAnalytics,
    HostelAnalytics,
    HostelOccupancyStats,
    HostelRevenueStats,
    OccupancyAnalytics,
    RevenueAnalytics,
    ReviewAnalytics,
)
from app.schemas.hostel.hostel_base import (
    HostelBase,
    HostelCreate,
    HostelMediaUpdate,
    HostelSEOUpdate,
    HostelUpdate,
)
from app.schemas.hostel.hostel_comparison import (
    ComparisonItem,
    ComparisonResult,
    HostelComparisonRequest,
)
from app.schemas.hostel.hostel_filter import (
    AdvancedFilters,
    BulkFilterParams,
    HostelFilterParams,
    HostelSortOptions,
)
from app.schemas.hostel.hostel_public import (
    PublicHostelCard,
    PublicHostelList,
    PublicHostelProfile,
    PublicRoomType,
)
from app.schemas.hostel.hostel_response import (
    HostelDetail,
    HostelListItem,
    HostelResponse,
    HostelStats,
)
from app.schemas.hostel.hostel_search import (
    HostelSearchFilters,
    HostelSearchRequest,
    HostelSearchResponse,
    SearchFacets,
)

__all__ = [
    # Base
    "HostelBase",
    "HostelCreate",
    "HostelUpdate",
    "HostelMediaUpdate",
    "HostelSEOUpdate",
    # Response
    "HostelResponse",
    "HostelDetail",
    "HostelListItem",
    "HostelStats",
    # Public
    "PublicHostelProfile",
    "PublicHostelList",
    "PublicHostelCard",
    "PublicRoomType",
    # Admin
    "HostelAdminView",
    "HostelSettings",
    "HostelVisibilityUpdate",
    "HostelCapacityUpdate",
    "HostelStatusUpdate",
    # Search
    "HostelSearchRequest",
    "HostelSearchResponse",
    "HostelSearchFilters",
    "SearchFacets",
    # Filter
    "HostelFilterParams",
    "HostelSortOptions",
    "AdvancedFilters",
    "BulkFilterParams",
    # Analytics
    "HostelAnalytics",
    "OccupancyAnalytics",
    "RevenueAnalytics",
    "BookingAnalytics",
    "ComplaintAnalytics",
    "ReviewAnalytics",
    "HostelOccupancyStats",
    "HostelRevenueStats",
    "AnalyticsRequest",
    # Comparison
    "HostelComparisonRequest",
    "ComparisonResult",
    "ComparisonItem",
]


# ===== Folder: C:\Users\HP\OneDrive\Documents\GitHub\HOStel-back\app\schemas\hostel\__pycache__ =====
