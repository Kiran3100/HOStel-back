### Combined Content from Folder: D:\hostel-management-saas\app\schemas\booking ###



# ===== Folder: D:\hostel-management-saas\app\schemas\booking =====

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_approval.py ---
"""
Booking approval schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema


class BookingApprovalRequest(BaseCreateSchema):
    """Approve booking request"""
    booking_id: UUID = Field(..., description="Booking ID to approve")
    
    # Room assignment
    room_id: UUID = Field(..., description="Assigned room")
    bed_id: UUID = Field(..., description="Assigned bed")
    
    # Confirm or adjust dates
    approved_check_in_date: date = Field(..., description="Approved check-in date")
    
    # Confirm or adjust pricing
    final_rent_monthly: Decimal = Field(..., ge=0, description="Final monthly rent")
    final_security_deposit: Decimal = Field(..., ge=0, description="Final security deposit")
    
    # Additional charges
    processing_fee: Decimal = Field(Decimal("0.00"), ge=0, description="One-time processing fee")
    
    # Notes
    admin_notes: Optional[str] = Field(None, max_length=500, description="Internal notes")
    message_to_guest: Optional[str] = Field(None, max_length=1000, description="Message to guest")
    
    # Payment requirement
    advance_payment_required: bool = Field(True, description="Require advance payment")
    advance_payment_percentage: Decimal = Field(
        Decimal("20.00"),
        ge=0,
        le=100,
        description="Advance payment %"
    )


class ApprovalResponse(BaseSchema):
    """Booking approval response"""
    booking_id: UUID
    booking_reference: str
    
    status: str = Field("approved", description="New status")
    
    # Assignment details
    room_number: str
    bed_number: str
    
    # Final amounts
    monthly_rent: Decimal
    security_deposit: Decimal
    advance_amount: Decimal
    total_amount: Decimal
    
    # Dates
    approved_at: datetime
    check_in_date: date
    
    # Next steps
    payment_pending: bool
    payment_deadline: Optional[datetime]
    
    message: str


class RejectionRequest(BaseCreateSchema):
    """Reject booking request"""
    booking_id: UUID = Field(..., description="Booking ID to reject")
    rejection_reason: str = Field(..., min_length=10, max_length=500, description="Reason for rejection")
    
    # Suggest alternatives
    suggest_alternative_dates: bool = Field(False)
    alternative_check_in_dates: Optional[list[date]] = Field(None, max_items=3)
    
    suggest_alternative_room_types: bool = Field(False)
    alternative_room_types: Optional[list[str]] = None
    
    # Message to guest
    message_to_guest: Optional[str] = Field(None, max_length=1000)


class BulkApprovalRequest(BaseCreateSchema):
    """Approve multiple bookings"""
    booking_ids: list[UUID] = Field(..., min_items=1, description="Booking IDs to approve")
    
    # Common settings
    auto_assign_rooms: bool = Field(True, description="Auto-assign available rooms")
    send_notifications: bool = Field(True, description="Send approval notifications")


class ApprovalSettings(BaseSchema):
    """Hostel booking approval settings"""
    hostel_id: UUID
    
    auto_approve_enabled: bool = Field(False, description="Auto-approve bookings")
    auto_approve_conditions: dict = Field(
        default_factory=dict,
        description="Conditions for auto-approval"
    )
    
    approval_expiry_hours: int = Field(48, ge=1, le=168, description="Hours to respond to booking")
    
    require_advance_payment: bool = Field(True)
    advance_payment_percentage: Decimal = Field(Decimal("20.00"), ge=0, le=100)

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_assignment.py ---
"""
Booking room and bed assignment schemas
"""
from datetime import date
from typing import Optional, List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class RoomAssignment(BaseSchema):
    """Room assignment for booking"""
    booking_id: UUID
    booking_reference: str
    
    hostel_id: UUID
    room_id: UUID
    room_number: str
    room_type: str
    
    assigned_by: UUID
    assigned_by_name: str
    assigned_at: datetime
    
    check_in_date: date


class BedAssignment(BaseSchema):
    """Bed assignment for booking"""
    booking_id: UUID
    booking_reference: str
    
    room_id: UUID
    room_number: str
    bed_id: UUID
    bed_number: str
    
    assigned_by: UUID
    assigned_by_name: str
    assigned_at: datetime


class AssignmentRequest(BaseCreateSchema):
    """Assign room and bed to booking"""
    booking_id: UUID = Field(..., description="Booking ID")
    room_id: UUID = Field(..., description="Room to assign")
    bed_id: UUID = Field(..., description="Bed to assign")
    
    # Override check-in date if needed
    override_check_in_date: Optional[date] = Field(None, description="Override preferred check-in date")
    
    notes: Optional[str] = Field(None, max_length=500, description="Assignment notes")


class BulkAssignmentRequest(BaseCreateSchema):
    """Bulk assign rooms to multiple bookings"""
    assignments: List["SingleAssignment"] = Field(..., min_items=1, description="List of assignments")
    
    auto_approve: bool = Field(False, description="Auto-approve after assignment")


class SingleAssignment(BaseSchema):
    """Single assignment in bulk operation"""
    booking_id: UUID
    room_id: UUID
    bed_id: UUID


class AssignmentResponse(BaseSchema):
    """Assignment response"""
    booking_id: UUID
    booking_reference: str
    
    room_assigned: bool
    room_number: Optional[str]
    bed_number: Optional[str]
    
    message: str
    next_steps: List[str]


class ReassignmentRequest(BaseCreateSchema):
    """Reassign booking to different room/bed"""
    booking_id: UUID
    current_room_id: UUID
    new_room_id: UUID
    new_bed_id: UUID
    
    reason: str = Field(..., min_length=10, max_length=500)
    notify_guest: bool = Field(True)

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_base.py ---
"""
Booking base schemas
"""
from datetime import date
from decimal import Decimal
from typing import Optional
from pydantic import Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseSchema
from app.schemas.common.enums import BookingStatus, RoomType, BookingSource


class BookingBase(BaseSchema):
    """Base booking schema"""
    visitor_id: UUID = Field(..., description="Visitor/guest making booking")
    hostel_id: UUID = Field(..., description="Hostel being booked")
    
    # Booking details
    room_type_requested: RoomType = Field(..., description="Requested room type")
    preferred_check_in_date: date = Field(..., description="Preferred check-in date")
    stay_duration_months: int = Field(..., ge=1, le=24, description="Stay duration in months")
    
    # Pricing
    quoted_rent_monthly: Decimal = Field(..., ge=0, description="Quoted monthly rent")
    total_amount: Decimal = Field(..., ge=0, description="Total amount")
    security_deposit: Decimal = Field(Decimal("0.00"), ge=0, description="Security deposit")
    advance_amount: Decimal = Field(Decimal("0.00"), ge=0, description="Advance payment amount")
    
    # Special requests
    special_requests: Optional[str] = Field(None, max_length=1000, description="Special requests")
    dietary_preferences: Optional[str] = Field(None, max_length=255, description="Dietary preferences")
    has_vehicle: bool = Field(False, description="Has vehicle")
    vehicle_details: Optional[str] = Field(None, max_length=255, description="Vehicle details")
    
    # Source
    source: BookingSource = Field(BookingSource.WEBSITE, description="Booking source")
    referral_code: Optional[str] = Field(None, max_length=50, description="Referral code used")
    
    @field_validator('total_amount')
    @classmethod
    def validate_total_amount(cls, v: Decimal, info) -> Decimal:
        """Validate total amount calculation"""
        if 'quoted_rent_monthly' in info.data and 'stay_duration_months' in info.data:
            expected = info.data['quoted_rent_monthly'] * info.data['stay_duration_months']
            if abs(v - expected) > Decimal('0.01'):  # Allow small floating point differences
                raise ValueError(f'Total amount should be approximately {expected}')
        return v


class BookingCreate(BookingBase, BaseCreateSchema):
    """Create booking schema"""
    # Guest information embedded
    guest_name: str = Field(..., min_length=2, max_length=255)
    guest_email: str = Field(...)
    guest_phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$')
    
    # Optional ID proof
    guest_id_proof_type: Optional[str] = None
    guest_id_proof_number: Optional[str] = None
    
    # Emergency contact
    emergency_contact_name: Optional[str] = None
    emergency_contact_phone: Optional[str] = None
    emergency_contact_relation: Optional[str] = None
    
    # Institutional/employment
    institution_or_company: Optional[str] = None
    designation_or_course: Optional[str] = None


class BookingUpdate(BaseUpdateSchema):
    """Update booking schema"""
    room_type_requested: Optional[RoomType] = None
    preferred_check_in_date: Optional[date] = None
    stay_duration_months: Optional[int] = Field(None, ge=1, le=24)
    
    special_requests: Optional[str] = None
    dietary_preferences: Optional[str] = None
    has_vehicle: Optional[bool] = None
    vehicle_details: Optional[str] = None
    
    # Status updates (admin only)
    booking_status: Optional[BookingStatus] = None

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_calendar.py ---
"""
Booking calendar schemas
"""
from datetime import date, datetime
from typing import List, Dict, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.enums import BookingStatus


class CalendarView(BaseSchema):
    """Calendar view of bookings"""
    hostel_id: UUID
    month: str = Field(..., description="Month in YYYY-MM format")
    
    # Calendar data
    days: Dict[str, "DayBookings"] = Field(..., description="Bookings by date")
    
    # Summary
    total_check_ins: int
    total_check_outs: int
    peak_occupancy_date: Optional[date]
    
    # Room availability summary
    available_rooms_by_date: Dict[str, int]


class DayBookings(BaseSchema):
    """Bookings for a specific day"""
    date: date
    
    check_ins: List["BookingEvent"] = Field(default_factory=list)
    check_outs: List["BookingEvent"] = Field(default_factory=list)
    pending_bookings: List["BookingEvent"] = Field(default_factory=list)
    
    available_beds: int
    total_beds: int


class BookingEvent(BaseSchema):
    """Booking event for calendar"""
    booking_id: UUID
    booking_reference: str
    guest_name: str
    room_number: Optional[str]
    room_type: str
    status: BookingStatus
    
    # For check-in events
    is_check_in: bool = Field(False)
    # For check-out events  
    is_check_out: bool = Field(False)


class CalendarEvent(BaseSchema):
    """Generic calendar event"""
    event_id: UUID
    event_type: str = Field(..., pattern="^(check_in|check_out|booking_request|maintenance)$")
    title: str
    start_date: date
    end_date: Optional[date]
    
    # Related entities
    booking_id: Optional[UUID] = None
    room_id: Optional[UUID] = None
    
    # Display
    color: str = Field(..., description="Color code for event")
    is_all_day: bool = Field(True)


class AvailabilityCalendar(BaseSchema):
    """Room availability calendar"""
    hostel_id: UUID
    room_id: Optional[UUID] = Field(None, description="Specific room or all rooms")
    month: str = Field(..., description="YYYY-MM")
    
    availability: Dict[str, "DayAvailability"]


class DayAvailability(BaseSchema):
    """Availability for a specific day"""
    date: date
    total_beds: int
    available_beds: int
    booked_beds: int
    is_fully_booked: bool
    
    # Bookings for this day
    active_bookings: List[UUID] = Field(default_factory=list)

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_cancellation.py ---
"""
Booking cancellation schemas
"""
from datetime import datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class CancellationRequest(BaseCreateSchema):
    """Request to cancel booking"""
    booking_id: UUID = Field(..., description="Booking ID to cancel")
    cancelled_by_role: str = Field(
        ...,
        pattern="^(visitor|admin|system)$",
        description="Who is cancelling"
    )
    
    cancellation_reason: str = Field(
        ...,
        min_length=10,
        max_length=500,
        description="Reason for cancellation"
    )
    
    # Refund preference
    request_refund: bool = Field(True, description="Request refund of advance payment")
    
    # Additional details
    additional_comments: Optional[str] = Field(None, max_length=1000)


class CancellationResponse(BaseSchema):
    """Cancellation response"""
    booking_id: UUID
    booking_reference: str
    
    cancelled: bool
    cancelled_at: datetime
    
    # Refund information
    refund: "RefundCalculation"
    
    message: str
    confirmation_sent: bool


class RefundCalculation(BaseSchema):
    """Refund calculation details"""
    advance_paid: Decimal
    cancellation_charge: Decimal
    cancellation_charge_percentage: Decimal
    
    refundable_amount: Decimal
    refund_processing_time_days: int
    
    # Refund method
    refund_method: str = Field(..., description="How refund will be processed")
    
    # Breakdown
    breakdown: dict = Field(
        ...,
        description="Detailed refund breakdown"
    )


class CancellationPolicy(BaseSchema):
    """Hostel cancellation policy"""
    hostel_id: UUID
    
    # Charges based on timing
    cancellation_before_days: List["CancellationCharge"] = Field(
        ...,
        description="Cancellation charges based on days before check-in"
    )
    
    # Special conditions
    no_show_charge_percentage: Decimal = Field(
        Decimal("100.00"),
        description="Charge if guest doesn't show up"
    )
    
    refund_processing_days: int = Field(7, description="Days to process refund")
    
    policy_text: str = Field(..., description="Full policy text")


class CancellationCharge(BaseSchema):
    """Cancellation charge tier"""
    days_before_checkin: int = Field(..., description="Days before check-in")
    charge_percentage: Decimal = Field(..., ge=0, le=100, description="% of advance to charge")
    
    description: str


class BulkCancellation(BaseCreateSchema):
    """Cancel multiple bookings"""
    booking_ids: List[UUID] = Field(..., min_items=1)
    reason: str = Field(..., min_length=10)
    process_refunds: bool = Field(True)

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_conversion.py ---
"""
Booking to student conversion schemas
"""
from datetime import date
from typing import Optional, List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class ConvertToStudentRequest(BaseCreateSchema):
    """Convert confirmed booking to student profile"""
    booking_id: UUID = Field(..., description="Booking ID to convert")
    
    # Check-in details
    actual_check_in_date: date = Field(..., description="Actual check-in date")
    
    # Financial confirmation
    security_deposit_paid: bool = Field(..., description="Security deposit paid")
    first_month_rent_paid: bool = Field(..., description="First month rent paid")
    
    # Additional student details (if not in booking)
    student_id_number: Optional[str] = None
    guardian_address: Optional[str] = None
    
    # Documents uploaded
    id_proof_uploaded: bool = Field(False)
    photo_uploaded: bool = Field(False)
    
    notes: Optional[str] = Field(None, max_length=500, description="Conversion notes")


class ConversionResponse(BaseSchema):
    """Conversion response"""
    booking_id: UUID
    student_profile_id: UUID
    
    converted: bool
    conversion_date: date
    
    # Room assignment
    room_number: str
    bed_number: str
    
    # Financial setup
    monthly_rent: Decimal
    security_deposit: Decimal
    next_payment_due_date: date
    
    message: str
    next_steps: List[str]


class ConversionChecklist(BaseSchema):
    """Pre-conversion checklist"""
    booking_id: UUID
    booking_reference: str
    
    # Checklist items
    checks: List["ChecklistItem"]
    
    all_checks_passed: bool
    can_convert: bool
    
    missing_items: List[str]


class ChecklistItem(BaseSchema):
    """Individual checklist item"""
    item_name: str
    description: str
    is_completed: bool
    is_required: bool
    completed_at: Optional[datetime] = None
    notes: Optional[str] = None


class BulkConversion(BaseCreateSchema):
    """Convert multiple bookings to students"""
    booking_ids: List[UUID] = Field(..., min_items=1)
    conversion_date: date
    
    # Common financial confirmation
    all_deposits_paid: bool
    all_first_rents_paid: bool


class ConversionRollback(BaseCreateSchema):
    """Rollback conversion (emergency only)"""
    student_profile_id: UUID
    reason: str = Field(..., min_length=20, max_length=500)
    
    # What to do with data
    delete_student_profile: bool = Field(False)
    restore_booking: bool = Field(True)

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_filters.py ---
"""
Booking filter and search schemas
"""
from datetime import date
from typing import List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseFilterSchema
from app.schemas.common.enums import BookingStatus, BookingSource, RoomType


class BookingFilterParams(BaseFilterSchema):
    """Booking filter parameters"""
    # Text search
    search: Optional[str] = Field(None, description="Search in reference, guest name, email, phone")
    
    # Hostel filter
    hostel_id: Optional[UUID] = None
    hostel_ids: Optional[List[UUID]] = None
    
    # Status filter
    status: Optional[BookingStatus] = None
    statuses: Optional[List[BookingStatus]] = None
    
    # Date filters
    booking_date_from: Optional[date] = None
    booking_date_to: Optional[date] = None
    check_in_date_from: Optional[date] = None
    check_in_date_to: Optional[date] = None
    
    # Room type
    room_type: Optional[RoomType] = None
    
    # Source
    source: Optional[BookingSource] = None
    
    # Payment status
    advance_paid: Optional[bool] = None
    
    # Conversion status
    converted_to_student: Optional[bool] = None
    
    # Expiry
    expiring_soon: Optional[bool] = Field(None, description="Bookings expiring in next 24 hours")
    expired: Optional[bool] = None


class BookingSearchRequest(BaseFilterSchema):
    """Booking search request"""
    query: str = Field(..., min_length=1, description="Search query")
    hostel_id: Optional[UUID] = None
    
    # Search fields
    search_in_reference: bool = Field(True)
    search_in_guest_name: bool = Field(True)
    search_in_email: bool = Field(True)
    search_in_phone: bool = Field(True)
    
    # Status filter
    status: Optional[BookingStatus] = None
    
    # Pagination
    page: int = Field(1, ge=1)
    page_size: int = Field(20, ge=1, le=100)


class BookingSortOptions(BaseFilterSchema):
    """Booking sorting options"""
    sort_by: str = Field(
        "booking_date",
        pattern="^(booking_date|check_in_date|guest_name|status|total_amount)$"
    )
    sort_order: str = Field("desc", pattern="^(asc|desc)$")


class BookingExportRequest(BaseFilterSchema):
    """Export bookings"""
    hostel_id: Optional[UUID] = None
    filters: Optional[BookingFilterParams] = None
    
    format: str = Field("csv", pattern="^(csv|excel|pdf)$")
    
    # Fields to include
    include_guest_details: bool = Field(True)
    include_payment_details: bool = Field(True)
    include_assignment_details: bool = Field(True)


class BookingAnalyticsRequest(BaseFilterSchema):
    """Booking analytics request"""
    hostel_id: Optional[UUID] = None
    date_from: date
    date_to: date
    
    group_by: str = Field("day", pattern="^(day|week|month)$")

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_modification.py ---
"""
Booking modification schemas
"""
from datetime import date
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema
from app.schemas.common.enums import RoomType


class ModificationRequest(BaseCreateSchema):
    """Request to modify booking"""
    booking_id: UUID = Field(..., description="Booking ID")
    
    # What to modify
    modify_check_in_date: bool = Field(False)
    new_check_in_date: Optional[date] = None
    
    modify_duration: bool = Field(False)
    new_duration_months: Optional[int] = Field(None, ge=1, le=24)
    
    modify_room_type: bool = Field(False)
    new_room_type: Optional[RoomType] = None
    
    # Reason
    modification_reason: str = Field(..., min_length=10, max_length=500)
    
    # Accept price difference
    accept_price_change: bool = Field(False, description="Accept if price changes")


class ModificationResponse(BaseSchema):
    """Modification response"""
    booking_id: UUID
    booking_reference: str
    
    # What changed
    modifications_applied: List[str]
    
    # Price impact
    original_total: Decimal
    new_total: Decimal
    price_difference: Decimal
    additional_payment_required: bool
    additional_amount: Decimal
    
    # Status
    requires_admin_approval: bool
    auto_approved: bool
    
    message: str


class DateChangeRequest(BaseCreateSchema):
    """Request to change check-in date"""
    booking_id: UUID
    new_check_in_date: date = Field(..., description="New desired check-in date")
    reason: str = Field(..., min_length=10, max_length=500)


class DurationChangeRequest(BaseCreateSchema):
    """Request to change stay duration"""
    booking_id: UUID
    new_duration_months: int = Field(..., ge=1, le=24)
    reason: str = Field(..., min_length=10, max_length=500)


class RoomTypeChangeRequest(BaseCreateSchema):
    """Request to change room type"""
    booking_id: UUID
    new_room_type: RoomType
    reason: str = Field(..., min_length=10, max_length=500)
    accept_price_difference: bool = Field(False)


class ModificationApproval(BaseCreateSchema):
    """Approve/reject modification request"""
    modification_request_id: UUID
    approved: bool
    
    # If approved
    adjusted_price: Optional[Decimal] = None
    
    # If rejected
    rejection_reason: Optional[str] = None
    
    admin_notes: Optional[str] = None

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_request.py ---
"""
Booking request schemas
"""
from datetime import date
from decimal import Decimal
from typing import Optional
from pydantic import EmailStr, Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema
from app.schemas.common.enums import RoomType


class GuestInformation(BaseSchema):
    """Guest information for booking"""
    guest_name: str = Field(..., min_length=2, max_length=255, description="Full name")
    guest_email: EmailStr = Field(..., description="Email address")
    guest_phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$', description="Phone number")
    
    # ID proof (optional at booking, required at check-in)
    guest_id_proof_type: Optional[str] = Field(
        None,
        pattern="^(aadhaar|passport|driving_license|voter_id|pan_card)$"
    )
    guest_id_proof_number: Optional[str] = Field(None, max_length=50)
    
    # Emergency contact
    emergency_contact_name: Optional[str] = Field(None, max_length=255)
    emergency_contact_phone: Optional[str] = Field(None, pattern=r'^\+?[1-9]\d{9,14}$')
    emergency_contact_relation: Optional[str] = Field(None, max_length=50)
    
    # Institutional/employment details
    institution_or_company: Optional[str] = Field(None, max_length=255)
    designation_or_course: Optional[str] = Field(None, max_length=255)


class BookingRequest(BaseCreateSchema):
    """Complete booking request"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    
    # Booking details
    room_type_requested: RoomType = Field(..., description="Desired room type")
    preferred_check_in_date: date = Field(..., description="Desired check-in date")
    stay_duration_months: int = Field(..., ge=1, le=24, description="Stay duration (1-24 months)")
    
    # Guest information
    guest_info: GuestInformation = Field(..., description="Guest details")
    
    # Special requests
    special_requests: Optional[str] = Field(None, max_length=1000)
    dietary_preferences: Optional[str] = Field(None, max_length=255)
    has_vehicle: bool = Field(False)
    vehicle_details: Optional[str] = Field(None, max_length=255)
    
    # Referral
    referral_code: Optional[str] = Field(None, max_length=50)
    
    @field_validator('preferred_check_in_date')
    @classmethod
    def validate_checkin_date(cls, v: date) -> date:
        """Validate check-in date is in future"""
        from datetime import date as date_type
        if v < date_type.today():
            raise ValueError('Check-in date must be in the future')
        return v


class BookingInquiry(BaseCreateSchema):
    """Simple inquiry (without full booking)"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    
    # Contact info
    visitor_name: str = Field(..., min_length=2, max_length=255)
    visitor_email: EmailStr = Field(...)
    visitor_phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$')
    
    # Interest details
    room_type_interest: Optional[RoomType] = None
    preferred_check_in_date: Optional[date] = None
    message: Optional[str] = Field(None, max_length=1000)


class QuickBookingRequest(BaseCreateSchema):
    """Quick booking (minimal information)"""
    hostel_id: UUID
    room_type_requested: RoomType
    check_in_date: date
    duration_months: int = Field(..., ge=1, le=24)
    
    # Minimal guest info (rest can be added later)
    name: str = Field(..., min_length=2, max_length=255)
    email: EmailStr
    phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$')

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_response.py ---
"""
Booking response schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import BookingStatus, RoomType, BookingSource


class BookingResponse(BaseResponseSchema):
    """Booking response schema"""
    booking_reference: str
    visitor_id: UUID
    hostel_id: UUID
    hostel_name: str
    
    room_type_requested: RoomType
    preferred_check_in_date: date
    stay_duration_months: int
    expected_check_out_date: date
    
    # Guest info
    guest_name: str
    guest_email: str
    guest_phone: str
    
    # Pricing
    quoted_rent_monthly: Decimal
    total_amount: Decimal
    security_deposit: Decimal
    advance_amount: Decimal
    advance_paid: bool
    
    # Status
    booking_status: BookingStatus
    
    # Dates
    booking_date: datetime
    expires_at: Optional[datetime]


class BookingDetail(BaseResponseSchema):
    """Detailed booking information"""
    booking_reference: str
    visitor_id: UUID
    visitor_name: str
    
    hostel_id: UUID
    hostel_name: str
    hostel_city: str
    hostel_address: str
    hostel_phone: str
    
    # Requested details
    room_type_requested: RoomType
    preferred_check_in_date: date
    stay_duration_months: int
    expected_check_out_date: date
    
    # Assignment (if approved)
    room_id: Optional[UUID]
    room_number: Optional[str]
    bed_id: Optional[UUID]
    bed_number: Optional[str]
    
    # Guest information
    guest_name: str
    guest_email: str
    guest_phone: str
    guest_id_proof_type: Optional[str]
    guest_id_proof_number: Optional[str]
    
    # Emergency contact
    emergency_contact_name: Optional[str]
    emergency_contact_phone: Optional[str]
    emergency_contact_relation: Optional[str]
    
    # Institutional/employment
    institution_or_company: Optional[str]
    designation_or_course: Optional[str]
    
    # Special requests
    special_requests: Optional[str]
    dietary_preferences: Optional[str]
    has_vehicle: bool
    vehicle_details: Optional[str]
    
    # Pricing
    quoted_rent_monthly: Decimal
    total_amount: Decimal
    security_deposit: Decimal
    advance_amount: Decimal
    advance_paid: bool
    advance_payment_id: Optional[UUID]
    
    # Status workflow
    booking_status: BookingStatus
    approved_by: Optional[UUID]
    approved_by_name: Optional[str]
    approved_at: Optional[datetime]
    rejected_by: Optional[UUID]
    rejected_at: Optional[datetime]
    rejection_reason: Optional[str]
    
    # Cancellation
    cancelled_by: Optional[UUID]
    cancelled_at: Optional[datetime]
    cancellation_reason: Optional[str]
    
    # Conversion
    converted_to_student: bool
    student_profile_id: Optional[UUID]
    conversion_date: Optional[date]
    
    # Source
    source: BookingSource
    referral_code: Optional[str]
    
    # Timestamps
    booking_date: datetime
    expires_at: Optional[datetime]


class BookingListItem(BaseSchema):
    """Booking list item"""
    id: UUID
    booking_reference: str
    guest_name: str
    guest_phone: str
    
    hostel_name: str
    room_type_requested: str
    
    preferred_check_in_date: date
    stay_duration_months: int
    
    total_amount: Decimal
    advance_paid: bool
    
    booking_status: BookingStatus
    booking_date: datetime
    
    # Quick indicators
    is_urgent: bool = Field(..., description="Expiring soon")
    days_until_checkin: Optional[int]


class BookingConfirmation(BaseSchema):
    """Booking confirmation response"""
    booking_id: UUID
    booking_reference: str
    
    hostel_name: str
    room_type: str
    check_in_date: date
    
    total_amount: Decimal
    advance_amount: Decimal
    balance_amount: Decimal
    
    confirmation_message: str
    next_steps: list[str]
    
    # Contact
    hostel_contact_phone: str
    hostel_contact_email: Optional[str]

# --- File: D:\hostel-management-saas\app\schemas\booking\booking_waitlist.py ---
"""
Booking waitlist schemas
"""
from datetime import date, datetime
from typing import Optional
from pydantic import Field, EmailStr
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema
from app.schemas.common.enums import RoomType, WaitlistStatus


class WaitlistRequest(BaseCreateSchema):
    """Add to waitlist when hostel is full"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    visitor_id: UUID = Field(..., description="Visitor ID")
    
    room_type: RoomType = Field(..., description="Desired room type")
    preferred_check_in_date: date = Field(..., description="Desired check-in date")
    
    # Contact
    contact_email: EmailStr = Field(..., description="Email for notifications")
    contact_phone: str = Field(..., pattern=r'^\+?[1-9]\d{9,14}$')
    
    # Additional info
    notes: Optional[str] = Field(None, max_length=500)


class WaitlistResponse(BaseResponseSchema):
    """Waitlist entry response"""
    hostel_id: UUID
    hostel_name: str
    visitor_id: UUID
    
    room_type: RoomType
    preferred_check_in_date: date
    
    contact_email: str
    contact_phone: str
    
    priority: int = Field(..., description="Position in waitlist (1 = first)")
    status: WaitlistStatus
    
    estimated_availability_date: Optional[date] = Field(
        None,
        description="Estimated date when room might be available"
    )
    
    created_at: datetime


class WaitlistStatus(BaseSchema):
    """Waitlist status for visitor"""
    waitlist_id: UUID
    hostel_name: str
    room_type: str
    
    position: int = Field(..., description="Current position in queue")
    total_in_queue: int
    
    status: str = Field(..., pattern="^(waiting|notified|converted|expired|cancelled)$")
    
    # Notifications
    last_notification_sent: Optional[datetime]
    notification_count: int
    
    # Estimated wait
    estimated_wait_days: Optional[int]


class WaitlistNotification(BaseSchema):
    """Notification when room becomes available"""
    waitlist_id: UUID
    visitor_id: UUID
    hostel_id: UUID
    
    message: str
    available_room_id: UUID
    available_bed_id: UUID
    
    # Action required
    response_deadline: datetime = Field(..., description="Deadline to respond")
    
    # Booking link
    booking_link: str


class WaitlistConversion(BaseCreateSchema):
    """Convert waitlist to booking"""
    waitlist_id: UUID
    accept: bool = Field(..., description="Accept the available room")
    
    # If accepting
    proceed_with_booking: bool = Field(True)


class WaitlistCancellation(BaseCreateSchema):
    """Remove from waitlist"""
    waitlist_id: UUID
    cancellation_reason: Optional[str] = Field(None, max_length=500)


class WaitlistManagement(BaseSchema):
    """Manage waitlist (admin)"""
    hostel_id: UUID
    room_type: RoomType
    
    total_in_waitlist: int
    entries: List["WaitlistEntry"]


class WaitlistEntry(BaseSchema):
    """Individual waitlist entry"""
    waitlist_id: UUID
    visitor_name: str
    contact_email: str
    contact_phone: str
    
    preferred_check_in_date: date
    priority: int
    status: WaitlistStatus
    
    days_waiting: int
    created_at: datetime

# --- File: D:\hostel-management-saas\app\schemas\booking\__init__.py ---
"""
Booking schemas package
"""
from app.schemas.booking.booking_base import (
    BookingBase,
    BookingCreate,
    BookingUpdate
)
from app.schemas.booking.booking_response import (
    BookingResponse,
    BookingDetail,
    BookingListItem
)
from app.schemas.booking.booking_request import (
    BookingRequest,
    GuestInformation,
    BookingInquiry
)
from app.schemas.booking.booking_approval import (
    BookingApprovalRequest,
    ApprovalResponse,
    RejectionRequest
)
from app.schemas.booking.booking_calendar import (
    CalendarView,
    CalendarEvent,
    AvailabilityCalendar,
    DayBookings
)
from app.schemas.booking.booking_assignment import (
    RoomAssignment,
    BedAssignment,
    AssignmentRequest
)
from app.schemas.booking.booking_cancellation import (
    CancellationRequest,
    CancellationResponse,
    RefundCalculation
)
from app.schemas.booking.booking_modification import (
    ModificationRequest,
    ModificationResponse,
    DateChangeRequest
)
from app.schemas.booking.booking_waitlist import (
    WaitlistRequest,
    WaitlistResponse,
    WaitlistStatus,
    WaitlistNotification
)
from app.schemas.booking.booking_conversion import (
    ConvertToStudentRequest,
    ConversionResponse,
    ConversionChecklist
)
from app.schemas.booking.booking_filters import (
    BookingFilterParams,
    BookingSearchRequest,
    BookingSortOptions
)

__all__ = [
    # Base
    "BookingBase",
    "BookingCreate",
    "BookingUpdate",
    
    # Response
    "BookingResponse",
    "BookingDetail",
    "BookingListItem",
    
    # Request
    "BookingRequest",
    "GuestInformation",
    "BookingInquiry",
    
    # Approval
    "BookingApprovalRequest",
    "ApprovalResponse",
    "RejectionRequest",
    
    # Calendar
    "CalendarView",
    "CalendarEvent",
    "AvailabilityCalendar",
    "DayBookings",
    
    # Assignment
    "RoomAssignment",
    "BedAssignment",
    "AssignmentRequest",
    
    # Cancellation
    "CancellationRequest",
    "CancellationResponse",
    "RefundCalculation",
    
    # Modification
    "ModificationRequest",
    "ModificationResponse",
    "DateChangeRequest",
    
    # Waitlist
    "WaitlistRequest",
    "WaitlistResponse",
    "WaitlistStatus",
    "WaitlistNotification",
    
    # Conversion
    "ConvertToStudentRequest",
    "ConversionResponse",
    "ConversionChecklist",
    
    # Filters
    "BookingFilterParams",
    "BookingSearchRequest",
    "BookingSortOptions",
]
