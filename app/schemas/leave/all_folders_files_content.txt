### Combined Content from Folder: D:\Last Github Push\Last\HOStel-back\app\schemas\leave ###



# ===== Folder: D:\Last Github Push\Last\HOStel-back\app\schemas\leave =====

# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\leave\leave_application.py ---
"""
Leave application & cancellation request schemas
"""
from datetime import date
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema
from app.schemas.common.enums import LeaveType


class LeaveApplicationRequest(BaseCreateSchema):
    """Student-sent leave application request"""
    student_id: UUID
    hostel_id: UUID

    leave_type: LeaveType
    from_date: date
    to_date: date
    reason: str = Field(..., min_length=10, max_length=1000)

    contact_during_leave: Optional[str] = Field(None, max_length=20)
    emergency_contact: Optional[str] = Field(None, max_length=20)

    supporting_document_url: Optional[str] = None


class LeaveCancellationRequest(BaseCreateSchema):
    """Student request to cancel an already approved/pending leave"""
    leave_id: UUID
    student_id: UUID

    cancellation_reason: str = Field(..., min_length=10, max_length=500)

# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\leave\leave_approval.py ---
"""
Leave approval & workflow schemas
"""
from datetime import datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema
from app.schemas.common.enums import LeaveStatus


class LeaveApprovalRequest(BaseCreateSchema):
    """Supervisor/admin leave approval/rejection"""
    leave_id: UUID
    approver_id: UUID

    approve: bool
    approval_notes: Optional[str] = Field(
        None, max_length=500, description="Additional notes"
    )

    # If rejecting
    rejection_reason: Optional[str] = Field(None, max_length=500)


class LeaveApprovalResponse(BaseSchema):
    """Approval outcome"""
    leave_id: UUID
    status: LeaveStatus

    approved_by: Optional[UUID]
    approved_by_name: Optional[str]
    approved_at: Optional[datetime]

    rejected_by: Optional[UUID]
    rejected_by_name: Optional[str]
    rejected_at: Optional[datetime]

    message: str

# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\leave\leave_balance.py ---
"""
Leave balance schemas
"""
from datetime import date
from typing import List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema
from app.schemas.common.enums import LeaveType


class LeaveBalance(BaseSchema):
    """Leave balance for a single leave type"""
    leave_type: LeaveType
    allocated_per_year: int = Field(..., ge=0)
    used_days: int = Field(..., ge=0)
    remaining_days: int = Field(..., ge=0)


class LeaveBalanceSummary(BaseSchema):
    """Overall leave balance for a student"""
    student_id: UUID
    student_name: str
    hostel_id: UUID
    hostel_name: str

    academic_year_start: date
    academic_year_end: date

    balances: List[LeaveBalance] = Field(default_factory=list)

# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\leave\leave_base.py ---
"""
Base leave schemas
"""
from datetime import date
from typing import Optional
from pydantic import Field, field_validator
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseUpdateSchema
from app.schemas.common.enums import LeaveType, LeaveStatus


class LeaveBase(BaseSchema):
    """Base leave application fields"""
    student_id: UUID = Field(..., description="Student requesting leave")
    hostel_id: UUID = Field(..., description="Hostel context")

    leave_type: LeaveType = Field(..., description="Type of leave")
    from_date: date = Field(..., description="Start of leave")
    to_date: date = Field(..., description="End of leave")
    total_days: int = Field(..., ge=1, description="Computed total leave days")

    reason: str = Field(..., min_length=10, max_length=1000, description="Leave reason")

    contact_during_leave: Optional[str] = Field(
        None, max_length=20, description="Contact phone during leave"
    )
    emergency_contact: Optional[str] = Field(
        None, max_length=20, description="Emergency contact during leave"
    )

    supporting_document_url: Optional[str] = Field(
        None, description="Document URL (e.g. medical certificate)"
    )

    @field_validator("total_days")
    @classmethod
    def validate_total_days(cls, v: int, info):
        if "from_date" in info.data and "to_date" in info.data:
            fd = info.data["from_date"]
            td = info.data["to_date"]
            days = (td - fd).days + 1
            if days != v:
                raise ValueError("total_days must equal (to_date - from_date + 1)")
        return v


class LeaveCreate(LeaveBase, BaseCreateSchema):
    """Create leave application"""
    pass


class LeaveUpdate(BaseUpdateSchema):
    """Update leave application (typically before approval)"""
    leave_type: Optional[LeaveType] = None
    from_date: Optional[date] = None
    to_date: Optional[date] = None
    total_days: Optional[int] = Field(None, ge=1)
    reason: Optional[str] = None
    contact_during_leave: Optional[str] = None
    emergency_contact: Optional[str] = None
    supporting_document_url: Optional[str] = None
    status: Optional[LeaveStatus] = None

# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\leave\leave_response.py ---
"""
Leave response schemas
"""
from datetime import date, datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import LeaveType, LeaveStatus


class LeaveResponse(BaseResponseSchema):
    """Leave list item for basic display"""
    student_id: UUID
    student_name: str
    hostel_id: UUID
    hostel_name: str

    leave_type: LeaveType
    from_date: date
    to_date: date
    total_days: int

    status: LeaveStatus
    applied_at: datetime


class LeaveDetail(BaseResponseSchema):
    """Detailed leave view"""
    student_id: UUID
    student_name: str
    student_room: Optional[str]

    hostel_id: UUID
    hostel_name: str

    leave_type: LeaveType
    from_date: date
    to_date: date
    total_days: int
    reason: str

    contact_during_leave: Optional[str]
    emergency_contact: Optional[str]
    supporting_document_url: Optional[str]

    status: LeaveStatus
    applied_at: datetime
    approved_at: Optional[datetime]
    rejected_at: Optional[datetime]
    cancelled_at: Optional[datetime]

    approved_by: Optional[UUID]
    approved_by_name: Optional[str]
    rejected_by: Optional[UUID]
    rejected_by_name: Optional[str]

    rejection_reason: Optional[str]
    cancellation_reason: Optional[str]


class LeaveListItem(BaseSchema):
    """List row for leave applications"""
    id: UUID
    student_name: str
    room_number: Optional[str]
    leave_type: LeaveType
    from_date: date
    to_date: date
    total_days: int
    status: LeaveStatus
    applied_at: datetime

# --- File: D:\Last Github Push\Last\HOStel-back\app\schemas\leave\__init__.py ---
"""
Leave management schemas package
"""

from app.schemas.leave.leave_base import (
    LeaveBase,
    LeaveCreate,
    LeaveUpdate,
)
from app.schemas.leave.leave_response import (
    LeaveResponse,
    LeaveDetail,
    LeaveListItem,
)
from app.schemas.leave.leave_application import (
    LeaveApplicationRequest,
    LeaveCancellationRequest,
)
from app.schemas.leave.leave_approval import (
    LeaveApprovalRequest,
    LeaveApprovalResponse,
)
from app.schemas.leave.leave_balance import (
    LeaveBalance,
    LeaveBalanceSummary,
)

__all__ = [
    # Base
    "LeaveBase",
    "LeaveCreate",
    "LeaveUpdate",
    # Response
    "LeaveResponse",
    "LeaveDetail",
    "LeaveListItem",
    # Application
    "LeaveApplicationRequest",
    "LeaveCancellationRequest",
    # Approval
    "LeaveApprovalRequest",
    "LeaveApprovalResponse",
    # Balance
    "LeaveBalance",
    "LeaveBalanceSummary",
]
