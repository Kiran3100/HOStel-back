### Combined Content from Folder: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\subscription ###



# ===== Folder: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\subscription =====

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\subscription\commission.py ---
"""
Booking commission tracking schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Optional, List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema


class CommissionConfig(BaseSchema):
    """Global/platform commission configuration"""
    default_commission_percentage: Decimal = Field(
        Decimal("5.00"), ge=0, le=100, description="Default commission%"
    )
    min_commission_percentage: Decimal = Field(Decimal("0.00"), ge=0, le=100)
    max_commission_percentage: Decimal = Field(Decimal("30.00"), ge=0, le=100)

    # Per-plan overrides
    commission_by_plan: dict[str, Decimal] = Field(
        default_factory=dict,
        description="plan_type (Standard/Premium) -> commission %",
    )


class BookingCommissionResponse(BaseResponseSchema):
    """Commission record for a booking"""
    booking_id: UUID
    hostel_id: UUID
    subscription_id: UUID

    booking_amount: Decimal
    commission_percentage: Decimal
    commission_amount: Decimal
    currency: str

    status: str  # pending, calculated, paid, waived
    due_date: Optional[date]
    paid_date: Optional[date]
    payment_reference: Optional[str]


class CommissionSummary(BaseSchema):
    """Commission summary for platform/hostel"""
    scope_type: str = Field(..., pattern="^(platform|hostel)$")
    hostel_id: Optional[UUID] = None

    period_start: date
    period_end: date

    total_commission_due: Decimal
    total_commission_paid: Decimal
    total_bookings_count: int
    bookings_with_commission_count: int

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\subscription\subscription_base.py ---
"""
Hostel subscription schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseUpdateSchema, BaseResponseSchema, BaseSchema
from app.schemas.common.enums import SubscriptionStatus, BillingCycle


class SubscriptionBase(BaseSchema):
    """Base subscription for a hostel"""
    hostel_id: UUID = Field(..., description="Hostel ID")
    plan_id: UUID = Field(..., description="Subscription plan ID")

    subscription_reference: str = Field(..., max_length=100)

    billing_cycle: BillingCycle = Field(..., description="Billing cycle (monthly/yearly)")
    amount: Decimal = Field(..., ge=0, description="Amount per billing period")
    currency: str = Field("INR", min_length=3, max_length=3)

    # Period
    start_date: date = Field(..., description="Subscription start date")
    end_date: date = Field(..., description="Subscription end date")

    auto_renew: bool = Field(True)
    next_billing_date: Optional[date] = None

    status: SubscriptionStatus = Field(SubscriptionStatus.ACTIVE)


class SubscriptionCreate(SubscriptionBase, BaseCreateSchema):
    """Create new hostel subscription"""
    trial_end_date: Optional[date] = None


class SubscriptionUpdate(BaseUpdateSchema):
    """Update subscription (e.g. status, next billing)"""
    status: Optional[SubscriptionStatus] = None
    end_date: Optional[date] = None
    auto_renew: Optional[bool] = None
    next_billing_date: Optional[date] = None

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\subscription\subscription_billing.py ---
"""
Subscription billing schemas
"""
from datetime import date
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema


class BillingCycleInfo(BaseSchema):
    """Info about current billing cycle for subscription"""
    subscription_id: UUID
    hostel_id: UUID
    plan_name: str

    cycle_start: date
    cycle_end: date
    billing_cycle: str  # monthly/yearly

    amount: Decimal
    currency: str

    next_billing_date: date
    auto_renew: bool


class GenerateInvoiceRequest(BaseCreateSchema):
    """Generate invoice for subscription cycle"""
    subscription_id: UUID
    billing_date: date

    # Overridable
    amount_override: Optional[Decimal] = None


class InvoiceInfo(BaseSchema):
    """Generated invoice info"""
    invoice_id: UUID
    subscription_id: UUID
    hostel_id: UUID

    invoice_number: str
    invoice_date: date
    due_date: date

    amount: Decimal
    currency: str

    status: str  # draft, issued, paid, overdue, cancelled
    invoice_url: Optional[str]

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\subscription\subscription_cancellation.py ---
"""
Subscription cancellation schemas
"""
from datetime import date, datetime
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema


class CancellationRequest(BaseCreateSchema):
    """Cancel subscription"""
    subscription_id: UUID
    hostel_id: UUID

    cancellation_reason: str = Field(..., min_length=10, max_length=500)
    cancel_immediately: bool = Field(False, description="Cancel now vs at end of term")


class CancellationResponse(BaseSchema):
    """Cancellation response"""
    subscription_id: UUID
    hostel_id: UUID

    cancelled: bool
    cancellation_effective_date: date
    cancelled_at: datetime
    cancelled_by: UUID

    message: str

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\subscription\subscription_plan_base.py ---
"""
Subscription plan definition schemas
"""
from decimal import Decimal
from typing import Dict, Optional, List
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseUpdateSchema, BaseResponseSchema
from app.schemas.common.enums import SubscriptionPlan


class SubscriptionPlanBase(BaseSchema):
    """Base subscription plan schema"""
    plan_name: str = Field(..., min_length=3, max_length=100, description="Plan internal name")
    display_name: str = Field(..., min_length=3, max_length=100, description="Plan display name")
    plan_type: SubscriptionPlan = Field(..., description="Plan tier/type")

    description: Optional[str] = Field(None, max_length=1000)

    price_monthly: Decimal = Field(..., ge=0, description="Monthly price")
    price_yearly: Decimal = Field(..., ge=0, description="Yearly price")
    currency: str = Field("INR", min_length=3, max_length=3)

    # Feature flags & limits as JSON
    features: Dict[str, object] = Field(
        default_factory=dict,
        description="Feature flags (e.g. max_hostels, advanced_analytics)",
    )

    max_hostels: Optional[int] = Field(None, ge=1)
    max_rooms_per_hostel: Optional[int] = Field(None, ge=1)
    max_students: Optional[int] = Field(None, ge=1)

    is_active: bool = Field(True)
    is_public: bool = Field(True, description="Show on pricing page")
    sort_order: int = Field(0, description="Ordering for display")


class PlanCreate(SubscriptionPlanBase, BaseCreateSchema):
    """Create new subscription plan"""
    pass


class PlanUpdate(BaseUpdateSchema):
    """Update subscription plan"""
    display_name: Optional[str] = None
    description: Optional[str] = None
    price_monthly: Optional[Decimal] = Field(None, ge=0)
    price_yearly: Optional[Decimal] = Field(None, ge=0)
    currency: Optional[str] = None
    features: Optional[Dict[str, object]] = None
    max_hostels: Optional[int] = Field(None, ge=1)
    max_rooms_per_hostel: Optional[int] = Field(None, ge=1)
    max_students: Optional[int] = Field(None, ge=1)
    is_active: Optional[bool] = None
    is_public: Optional[bool] = None
    sort_order: Optional[int] = None

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\subscription\subscription_plan_response.py ---
"""
Subscription plan response & comparison schemas
"""
from decimal import Decimal
from typing import Dict, List, Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import SubscriptionPlan


class PlanResponse(BaseResponseSchema):
    """Subscription plan response"""
    plan_name: str
    display_name: str
    plan_type: SubscriptionPlan

    description: Optional[str]
    price_monthly: Decimal
    price_yearly: Decimal
    currency: str

    features: Dict[str, object]
    max_hostels: Optional[int]
    max_rooms_per_hostel: Optional[int]
    max_students: Optional[int]

    is_active: bool
    is_public: bool
    sort_order: int


class PlanFeatures(BaseSchema):
    """Human-friendly plan feature matrix"""
    plan_name: str
    display_name: str
    features: Dict[str, str] = Field(..., description="Feature -> label/value")


class PlanComparison(BaseSchema):
    """Compare multiple plans side by side"""
    plans: List[PlanResponse]
    feature_matrix: Dict[str, Dict[str, object]] = Field(
        ...,
        description="Feature key -> plan_name -> value",
    )

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\subscription\subscription_response.py ---
"""
Subscription response schemas
"""
from datetime import date, datetime
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema
from app.schemas.common.enums import SubscriptionStatus, BillingCycle, SubscriptionPlan


class SubscriptionResponse(BaseResponseSchema):
    """Hostel subscription response"""
    hostel_id: UUID
    hostel_name: str

    plan_id: UUID
    plan_name: str
    display_name: str
    plan_type: SubscriptionPlan

    subscription_reference: str
    billing_cycle: BillingCycle
    amount: Decimal
    currency: str

    start_date: date
    end_date: date
    auto_renew: bool
    next_billing_date: Optional[date]
    status: SubscriptionStatus

    trial_end_date: Optional[date]
    last_payment_date: Optional[date]
    last_payment_amount: Optional[Decimal]


class BillingHistoryItem(BaseSchema):
    """Single billing event"""
    billing_date: date
    amount: Decimal
    currency: str
    status: str
    payment_reference: Optional[str]
    invoice_url: Optional[str]


class BillingHistory(BaseSchema):
    """Subscription billing history"""
    subscription_id: UUID
    hostel_id: UUID

    items: list[BillingHistoryItem]
    total_billed: Decimal
    total_paid: Decimal
    total_outstanding: Decimal

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\subscription\subscription_upgrade.py ---
"""
Subscription upgrade/downgrade schemas
"""
from datetime import date
from decimal import Decimal
from typing import Optional
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema
from app.schemas.common.enums import BillingCycle


class UpgradeRequest(BaseCreateSchema):
    """Request to change subscription plan"""
    hostel_id: UUID
    current_plan_id: UUID
    new_plan_id: UUID
    billing_cycle: BillingCycle = Field(...)
 
    # Timing
    effective_from: date = Field(..., description="When new plan takes effect")
    prorate: bool = Field(True, description="Prorate charges/refunds")


class UpgradePreview(BaseSchema):
    """Preview cost impact of upgrade/downgrade"""
    current_plan_name: str
    new_plan_name: str

    current_amount: Decimal
    new_amount: Decimal

    # For current period
    prorated_charge: Decimal = Field(..., description="Additional amount to charge")
    prorated_refund: Decimal = Field(..., description="If downgrade, refund amount")

    effective_from: date
    message: str


class DowngradeRequest(UpgradeRequest):
    """Same payload, semantics are downgrade if new plan is smaller"""
    pass

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\subscription\__init__.py ---

