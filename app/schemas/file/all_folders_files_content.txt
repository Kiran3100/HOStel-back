### Combined Content from Folder: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\file ###



# ===== Folder: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\file =====

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\file\document_upload.py ---
"""
Document upload-specific schemas
"""
from datetime import date
from typing import Optional, List
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema
from app.schemas.file.file_upload import FileUploadInitResponse


class DocumentUploadInitRequest(BaseCreateSchema):
    """
    Initialize a document upload.

    For ID proofs, agreements, invoices, etc.
    """
    filename: str = Field(..., min_length=1, max_length=255)
    content_type: str = Field(
        ...,
        pattern=r"^(application\/pdf|image\/[a-zA-Z0-9.+-]+)$",
        description="Allowed: PDF or image formats",
    )
    size_bytes: int = Field(
        ...,
        ge=1,
        le=25 * 1024 * 1024,
        description="Max 25MB for documents",
    )

    uploaded_by_user_id: UUID
    student_id: Optional[UUID] = None
    hostel_id: Optional[UUID] = None

    document_type: str = Field(
        ...,
        pattern=(
            r"^(id_proof|address_proof|agreement|invoice|receipt|"
            r"medical_certificate|other)$"
        ),
        description="Type of document",
    )

    # Additional classification
    description: Optional[str] = Field(None, max_length=255)


class DocumentUploadInitResponse(FileUploadInitResponse):
    """Document-specific init response (same as generic for now)"""
    # Can be extended with OCR flags, etc.
    pass


class DocumentValidationResult(BaseSchema):
    """
    Result of backend-side document validation
    (e.g. mime, size, simple content checks).
    """
    storage_key: str
    is_valid: bool
    reason: Optional[str] = Field(None, description="Why invalid, if false")

    # Optional extracted info (non-PII summary)
    extracted_metadata: Optional[dict] = Field(
        None,
        description="e.g. issue_date, expiry_date (if parsed)",
    )


class DocumentInfo(BaseSchema):
    """Document info for student/admin views"""
    id: UUID
    storage_key: str
    url: HttpUrl

    document_type: str
    description: Optional[str]

    uploaded_by_user_id: UUID
    uploaded_by_name: Optional[str]

    uploaded_at: date
    verified: bool
    verified_by: Optional[UUID]
    verified_at: Optional[date]
    verification_notes: Optional[str]


class DocumentList(BaseSchema):
    """List of documents for a student/hostel"""
    owner_type: str = Field(..., pattern="^(student|hostel|system)$")
    owner_id: UUID

    documents: List[DocumentInfo] = Field(default_factory=list)
    total_documents: int

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\file\file_response.py ---
"""
File information and listing schemas
"""
from datetime import datetime
from typing import List, Optional, Dict
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseResponseSchema, BaseSchema


class FileMetadata(BaseSchema):
    """Additional metadata attached to a file"""
    content_type: str = Field(..., description="MIME type")
    size_bytes: int = Field(..., ge=0, description="File size in bytes")

    # Optional metadata
    original_filename: Optional[str] = Field(None, description="Original filename")
    tags: List[str] = Field(default_factory=list)
    category: Optional[str] = Field(None, description="Logical category")
    custom_metadata: Dict[str, str] = Field(
        default_factory=dict,
        description="Free-form key/value metadata (e.g. 'room_id', 'hostel_id')",
    )


class FileInfo(BaseResponseSchema):
    """Full file information as stored in the system"""
    storage_key: str = Field(..., description="Storage path/key (unique)")

    # Ownership / context
    uploaded_by_user_id: UUID
    hostel_id: Optional[UUID] = None

    # Access
    is_public: bool = Field(False, description="Publicly accessible or not")
    public_url: Optional[HttpUrl] = Field(None, description="Public CDN URL if is_public=True")
    signed_url: Optional[HttpUrl] = Field(
        None,
        description="Signed temporary URL for private access (optional)",
    )

    # Metadata
    metadata: FileMetadata

    # Audit
    created_at: datetime
    updated_at: datetime


class FileURL(BaseSchema):
    """Simple container for a file URL"""
    url: HttpUrl
    expires_at: Optional[datetime] = Field(
        None,
        description="If signed URL, when it will expire",
    )


class FileListResponse(BaseSchema):
    """Paginated list of files"""
    items: List[FileInfo] = Field(default_factory=list)
    total_items: int
    page: int
    page_size: int

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\file\file_upload.py ---
"""
Generic file upload schemas (pre-signed URL / direct upload)
"""
from datetime import datetime
from typing import List, Optional, Dict
from pydantic import Field
from uuid import UUID

from app.schemas.common.base import BaseSchema, BaseCreateSchema, BaseResponseSchema


class FileUploadInitRequest(BaseCreateSchema):
    """
    Request to initialize a file upload.

    Typically used to generate a pre-signed URL or
    register a file before multipart upload.
    """
    filename: str = Field(..., min_length=1, max_length=255)
    content_type: str = Field(
        ...,
        max_length=255,
        description="MIME type, e.g. 'image/jpeg', 'application/pdf'",
    )
    size_bytes: int = Field(
        ...,
        ge=1,
        le=50 * 1024 * 1024,
        description="Expected file size in bytes (max 50MB by default)",
    )

    # Logical location
    folder: Optional[str] = Field(
        None,
        max_length=255,
        description="Logical folder/path (e.g. 'hostels/123/photos')",
    )

    # Ownership / context
    uploaded_by_user_id: UUID = Field(..., description="User initiating upload")
    hostel_id: Optional[UUID] = Field(
        None,
        description="Hostel context (if file is hostel-specific)",
    )

    # Metadata / classification
    category: Optional[str] = Field(
        None,
        max_length=50,
        description="Category, e.g. 'hostel_photo', 'document', 'avatar'",
    )
    tags: List[str] = Field(
        default_factory=list,
        description="Free-form tags for search/filtering",
    )

    # Access control
    is_public: bool = Field(
        False,
        description="If true, file will be publicly accessible (CDN/public URL)",
    )


class FileUploadInitResponse(BaseResponseSchema):
    """
    Response for upload initialization.

    Either returns a direct upload URL (pre-signed) or
    indicates that the client should upload via the API.
    """
    filename: str
    content_type: str
    size_bytes: int

    storage_key: str = Field(
        ...,
        description="Internal storage key/path for this file",
    )

    # Pre-signed URL (for direct S3/GCS upload)
    upload_url: Optional[str] = Field(
        None,
        description="Pre-signed URL for direct upload to object storage",
    )
    upload_method: str = Field(
        "PUT",
        description="HTTP method to use with upload_url (PUT/POST)",
    )
    upload_headers: Dict[str, str] = Field(
        default_factory=dict,
        description="Any headers that must be included when uploading",
    )

    # Access information
    is_public: bool
    public_url: Optional[str] = Field(
        None,
        description="Public URL if file is/will be public",
    )


class FileUploadCompleteRequest(BaseCreateSchema):
    """
    Notify backend that the client finished uploading the file
    to the storage using the pre-signed URL.
    """
    storage_key: str = Field(..., description="Storage key returned in init response")
    uploaded_by_user_id: UUID = Field(..., description="User who uploaded")
    checksum: Optional[str] = Field(
        None,
        description="Optional checksum/ETag from storage to verify integrity",
    )

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\file\image_upload.py ---
"""
Image upload-specific schemas
"""
from typing import List, Optional
from pydantic import Field, HttpUrl
from uuid import UUID

from app.schemas.common.base import BaseCreateSchema, BaseSchema
from app.schemas.file.file_upload import FileUploadInitResponse


class ImageUploadInitRequest(BaseCreateSchema):
    """
    Initialize an image upload.

    Used for hostel photos, room photos, avatars, etc.
    """
    filename: str = Field(..., min_length=1, max_length=255)
    content_type: str = Field(
        ...,
        pattern=r"^image\/[a-zA-Z0-9.+-]+$",
        description="Image MIME type, e.g. 'image/jpeg', 'image/png'",
    )
    size_bytes: int = Field(
        ...,
        ge=1,
        le=20 * 1024 * 1024,
        description="Max 20MB for images",
    )

    uploaded_by_user_id: UUID
    hostel_id: Optional[UUID] = None

    # Usage context
    usage: str = Field(
        ...,
        pattern=r"^(hostel_cover|hostel_gallery|room_photo|avatar|document_scan)$",
        description="Intended usage of the image",
    )

    # Optional transformations
    generate_variants: bool = Field(
        True,
        description="If true, system may generate resized variants",
    )


class ImageVariant(BaseSchema):
    """Information about an image variant (thumbnail, medium, etc.)"""
    name: str = Field(..., description="Variant name, e.g. 'thumbnail', 'medium'")
    url: HttpUrl = Field(..., description="URL for this variant")
    width: Optional[int] = Field(None, ge=1)
    height: Optional[int] = Field(None, ge=1)
    size_bytes: Optional[int] = Field(None, ge=0)


class ImageUploadInitResponse(FileUploadInitResponse):
    """
    Image-specific upload init response.

    Extends generic file upload init response with image-specific hints.
    """
    variants_planned: List[str] = Field(
        default_factory=lambda: ["thumbnail", "medium"],
        description="Variants the system will generate after upload (for reference)",
    )


class ImageProcessingResult(BaseSchema):
    """Result of post-upload image processing"""
    storage_key: str
    original_url: HttpUrl
    variants: List[ImageVariant] = Field(default_factory=list)

# --- File: C:\Users\HP\OneDrive\Documents\GitHub\hostel-back\app\schemas\file\__init__.py ---
"""
File management schemas package
"""

from app.schemas.file.file_upload import (
    FileUploadInitRequest,
    FileUploadInitResponse,
    FileUploadCompleteRequest,
)
from app.schemas.file.file_response import (
    FileInfo,
    FileMetadata,
    FileURL,
    FileListResponse,
)
from app.schemas.file.image_upload import (
    ImageUploadInitRequest,
    ImageUploadInitResponse,
    ImageVariant,
)
from app.schemas.file.document_upload import (
    DocumentUploadInitRequest,
    DocumentUploadInitResponse,
    DocumentValidationResult,
)

__all__ = [
    # Generic file
    "FileUploadInitRequest",
    "FileUploadInitResponse",
    "FileUploadCompleteRequest",
    "FileInfo",
    "FileMetadata",
    "FileURL",
    "FileListResponse",
    # Images
    "ImageUploadInitRequest",
    "ImageUploadInitResponse",
    "ImageVariant",
    # Documents
    "DocumentUploadInitRequest",
    "DocumentUploadInitResponse",
    "DocumentValidationResult",
]
